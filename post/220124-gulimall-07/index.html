<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>å•†å“å±¬æ€§ç¶­è­·ã€åº«å­˜æ¨¡çµ„ã€åŸºç¤ç¯‡ç¸½çµ</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-07">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="å•†å“å±¬æ€§ç¶­è­·ã€åº«å­˜æ¨¡çµ„ã€åŸºç¤ç¯‡ç¸½çµ" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-07" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220124-gulimall-07/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-24T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="å•†å“å±¬æ€§ç¶­è­·ã€åº«å­˜æ¨¡çµ„ã€åŸºç¤ç¯‡ç¸½çµ"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-07"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%95%86%e5%93%81%e5%b1%ac%e6%80%a7%e7%b6%ad%e8%ad%b7" onclick="onNavClick(`#å•†å“å±¬æ€§ç¶­è­·-nav`)" id="å•†å“å±¬æ€§ç¶­è­·-nav">
									å•†å“å±¬æ€§ç¶­è­·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spu%e6%aa%a2%e7%b4%a2" onclick="onNavClick(`#spuæª¢ç´¢-nav`)" id="spuæª¢ç´¢-nav">
									spuæª¢ç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%8d%b2%e5%8f%96spu%e8%a6%8f%e6%a0%bc%e8%88%87%e4%bf%ae%e6%94%b9" onclick="onNavClick(`#ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹-nav`)" id="ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹-nav">
									ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#sku%e6%aa%a2%e7%b4%a2" onclick="onNavClick(`#skuæª¢ç´¢-nav`)" id="skuæª¢ç´¢-nav">
									skuæª¢ç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ba%ab%e5%ad%98%e6%a8%a1%e7%b5%84" onclick="onNavClick(`#åº«å­˜æ¨¡çµ„-nav`)" id="åº«å­˜æ¨¡çµ„-nav">
									åº«å­˜æ¨¡çµ„
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%a8%a1%e7%b5%84%e5%8a%9f%e8%83%bd%e8%aa%aa%e6%98%8e" onclick="onNavClick(`#æ¨¡çµ„åŠŸèƒ½èªªæ˜-nav`)" id="æ¨¡çµ„åŠŸèƒ½èªªæ˜-nav">
									æ¨¡çµ„åŠŸèƒ½èªªæ˜
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b9%be%e5%80%8b%e7%b0%a1%e5%96%ae%e7%9a%84%e6%90%9c%e7%b4%a2" onclick="onNavClick(`#å¹¾å€‹ç°¡å–®çš„æœç´¢-nav`)" id="å¹¾å€‹ç°¡å–®çš„æœç´¢-nav">
									å¹¾å€‹ç°¡å–®çš„æœç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%88%e4%bd%b5%e6%8e%a1%e8%b3%bc%e9%9c%80%e6%b1%82" onclick="onNavClick(`#åˆä½µæ¡è³¼éœ€æ±‚-nav`)" id="åˆä½µæ¡è³¼éœ€æ±‚-nav">
									åˆä½µæ¡è³¼éœ€æ±‚
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%a0%98%e5%8f%96%e6%8e%a1%e8%b3%bc%e5%96%ae" onclick="onNavClick(`#é ˜å–æ¡è³¼å–®-nav`)" id="é ˜å–æ¡è³¼å–®-nav">
									é ˜å–æ¡è³¼å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%88%90%e6%8e%a1%e8%b3%bc%e5%96%ae" onclick="onNavClick(`#å®Œæˆæ¡è³¼å–®-nav`)" id="å®Œæˆæ¡è³¼å–®-nav">
									å®Œæˆæ¡è³¼å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e5%9f%ba%e7%a4%8e%e7%af%87%e7%b8%bd%e7%b5%90" onclick="onNavClick(`#åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ-nav`)" id="åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ-nav">
									åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%95%86%e5%93%81%e5%b1%ac%e6%80%a7%e7%b6%ad%e8%ad%b7" onclick="onNavClick(`#å•†å“å±¬æ€§ç¶­è­·-nav`)" id="å•†å“å±¬æ€§ç¶­è­·-nav">
									å•†å“å±¬æ€§ç¶­è­·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spu%e6%aa%a2%e7%b4%a2" onclick="onNavClick(`#spuæª¢ç´¢-nav`)" id="spuæª¢ç´¢-nav">
									spuæª¢ç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%8d%b2%e5%8f%96spu%e8%a6%8f%e6%a0%bc%e8%88%87%e4%bf%ae%e6%94%b9" onclick="onNavClick(`#ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹-nav`)" id="ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹-nav">
									ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#sku%e6%aa%a2%e7%b4%a2" onclick="onNavClick(`#skuæª¢ç´¢-nav`)" id="skuæª¢ç´¢-nav">
									skuæª¢ç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%ba%ab%e5%ad%98%e6%a8%a1%e7%b5%84" onclick="onNavClick(`#åº«å­˜æ¨¡çµ„-nav`)" id="åº«å­˜æ¨¡çµ„-nav">
									åº«å­˜æ¨¡çµ„
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%a8%a1%e7%b5%84%e5%8a%9f%e8%83%bd%e8%aa%aa%e6%98%8e" onclick="onNavClick(`#æ¨¡çµ„åŠŸèƒ½èªªæ˜-nav`)" id="æ¨¡çµ„åŠŸèƒ½èªªæ˜-nav">
									æ¨¡çµ„åŠŸèƒ½èªªæ˜
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b9%be%e5%80%8b%e7%b0%a1%e5%96%ae%e7%9a%84%e6%90%9c%e7%b4%a2" onclick="onNavClick(`#å¹¾å€‹ç°¡å–®çš„æœç´¢-nav`)" id="å¹¾å€‹ç°¡å–®çš„æœç´¢-nav">
									å¹¾å€‹ç°¡å–®çš„æœç´¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%88%e4%bd%b5%e6%8e%a1%e8%b3%bc%e9%9c%80%e6%b1%82" onclick="onNavClick(`#åˆä½µæ¡è³¼éœ€æ±‚-nav`)" id="åˆä½µæ¡è³¼éœ€æ±‚-nav">
									åˆä½µæ¡è³¼éœ€æ±‚
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%a0%98%e5%8f%96%e6%8e%a1%e8%b3%bc%e5%96%ae" onclick="onNavClick(`#é ˜å–æ¡è³¼å–®-nav`)" id="é ˜å–æ¡è³¼å–®-nav">
									é ˜å–æ¡è³¼å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e6%88%90%e6%8e%a1%e8%b3%bc%e5%96%ae" onclick="onNavClick(`#å®Œæˆæ¡è³¼å–®-nav`)" id="å®Œæˆæ¡è³¼å–®-nav">
									å®Œæˆæ¡è³¼å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e5%9f%ba%e7%a4%8e%e7%af%87%e7%b8%bd%e7%b5%90" onclick="onNavClick(`#åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ-nav`)" id="åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ-nav">
									åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/gulimall.png')"
                    
                
            >
                <div class="post-title">
                    å•†å“å±¬æ€§ç¶­è­·ã€åº«å­˜æ¨¡çµ„ã€åŸºç¤ç¯‡ç¸½çµ
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-07
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-01-24 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%95%86%E5%9F%8E%E9%A0%85%E7%9B%AE">Javaå¾®æœå‹™å•†åŸé …ç›®</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="å•†å“å±¬æ€§ç¶­è­·">å•†å“å±¬æ€§ç¶­è­·</h1>
<h2 id="spuæª¢ç´¢">spuæª¢ç´¢</h2>
<ul>
<li>ä¸€å€‹å¿«é€Ÿæ‰¾åˆ°APIçš„æ–¹æ³•
<ul>
<li>è£ä¸Šæ’ä»¶<code>RestfulTool</code>ï¼Œç›´æ¥è²¼ä¸Šæ–‡æª”çµ¦çš„URLç¬é–“å°±èƒ½å®šä½</li>
</ul>
</li>
</ul>
<p><img src="image-20220118092156668.png" alt="image-20220118092156668"></p>
<ul>
<li>SpuInfoServiceImpl.java
<ul>
<li>è™•ç†å¤šæ¢ä»¶æ¨¡ç³Šæœç´¢</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> PageUtils <span style="color:#008b45">queryPageByKeyword</span>(Map&lt;String, Object&gt; params) {
</span></span><span style="display:flex;"><span><span style="color:#228b22">/*
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">key: &#39;è¯ç‚º&#39;,//æª¢ç´¢é—œéµå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">catelogId: 6,//ä¸‰ç´šåˆ†é¡id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">brandId: 1,//å“ç‰Œid
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">status: 0,//å•†å“ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">*/</span>
</span></span><span style="display:flex;"><span>    QueryWrapper&lt;SpuInfoEntity&gt; wrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;&gt;();
</span></span><span style="display:flex;"><span>    String key = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(key) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(key)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">and</span>(w -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ¨¡ç³Šæœç´¢ç‚ºäº†æ€•è“‹æ‰ä¸‹é¢çš„æ‰€ä»¥ç”¨andï¼Œå…¶å¯¦ä¹Ÿèƒ½æ”¾æœ€å¾Œå°±å¥½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// å„ªå…ˆ NOT&gt;AND&gt;OR
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            w.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;id&#34;</span>, key).<span style="color:#658b00">or</span>().<span style="color:#658b00">like</span>(<span style="color:#cd5555">&#34;spu_name&#34;</span>, key);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String status = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;status&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(status)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;publish_status&#34;</span>, status);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String catelogId = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;catelogId&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(catelogId) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(catelogId)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;catalog_id&#34;</span>, catelogId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String brandId = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;brandId&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(brandId) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(brandId)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;brand_id&#34;</span>, brandId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    IPage&lt;SpuInfoEntity&gt; page = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">page</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">new</span> Query&lt;SpuInfoEntity&gt;().<span style="color:#658b00">getPage</span>(params), wrapper
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> PageUtils(page);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æŒ‡å®šæ™‚é–“æ—¥æœŸæ ¼å¼ï¼Œapplication.properties</li>
</ul>
<pre tabindex="0"><code>spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=GMT+8
</code></pre><ul>
<li>å¦å¤–ç™¼ç¾ä¸€å€‹å°BUGï¼Œä¿å­˜æ™‚æ²’æŒ‡å®šstatusç‹€æ…‹ç«Ÿç„¶ä¸æ˜¯0è‡ªå·±ä¿®æ­£ä¸€ä¸‹
<ul>
<li>ä¸å°å¾Œä¾†ç™¼ç¾æ˜¯å› ç‚ºVoç”¨longç”¨æ¥ï¼ŒçµæœåŸä¾†ä»–åœ¨è³‡æ–™åº«èˆ‡entityä¸­æ˜¯intæ‰€ä»¥å°ä¸ä¸Šï¼ŒBeanUtilså°æ‹·å¤±æ•—</li>
<li>å…¶å¯¦é€™å°±å­˜åœ¨ä¸€å€‹å‘é»ï¼Œå°±æ˜¯å‰ç«¯æ ¡é©—åšä¸å¥½ï¼Œå‚³ä¾†nullå°±ç®—äº†ï¼Œå¦‚æœå‚³ä¾†0æˆ–&quot;0&quot;å°±å®¹æ˜“å‘</li>
<li>æˆ‘æ„Ÿè¦ºç•¶åˆè¨­è¨ˆä»£è™Ÿç¢¼å°±è©²ç›´æ¥é¿é–‹0ï¼Œå°±åƒHTTPéŒ¯èª¤ä»£ç¢¼ä¹Ÿæ²’è¦‹ç”¨0çš„ï¼Œåæ­£intèƒ½ç”¨åˆ°127</li>
<li>ä½†æ˜¯é è¨­0æœ‰æ™‚å€™åˆæŒºæ–¹ä¾¿çš„ï¼Œé‚„æ˜¯çœ‹å¯¦éš›ç‹€æ³å§</li>
</ul>
</li>
</ul>
<h3 id="ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹">ç²å–spuè¦æ ¼èˆ‡ä¿®æ”¹</h3>
<ul>
<li>AttrController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// ç²å–spuè¦æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@GetMapping</span>(<span style="color:#cd5555">&#34;/base/listforspu/{spuId}&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">baseAttrlistforspu</span>(<span style="color:#707a7c">@PathVariable</span>(<span style="color:#cd5555">&#34;spuId&#34;</span>) Long spuId) {
</span></span><span style="display:flex;"><span>    List&lt;ProductAttrValueEntity&gt; entities = productAttrValueService.<span style="color:#658b00">baseAttrListforspu</span>(spuId);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">ok</span>().<span style="color:#658b00">put</span>(<span style="color:#cd5555">&#34;data&#34;</span>, entities);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">// ä¿®æ”¹spu
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@PostMapping</span>(<span style="color:#cd5555">&#34;/update/{spuId}&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">updateSpuAttr</span>(<span style="color:#707a7c">@PathVariable</span>(<span style="color:#cd5555">&#34;spuId&#34;</span>) Long spuId,
</span></span><span style="display:flex;"><span>                       <span style="color:#707a7c">@RequestBody</span> List&lt;ProductAttrValueEntity&gt; entities) {
</span></span><span style="display:flex;"><span>    productAttrValueService.<span style="color:#658b00">updateSpuAttr</span>(spuId, entities);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ProductAttrValueServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// ç²å–spuè¦æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> List&lt;ProductAttrValueEntity&gt; <span style="color:#008b45">baseAttrListforspu</span>(Long spuId) {
</span></span><span style="display:flex;"><span>    List&lt;ProductAttrValueEntity&gt; attrValueEntityList = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">baseMapper</span>.<span style="color:#658b00">selectList</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;spu_id&#34;</span>, spuId));
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> attrValueEntityList;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ä¿®æ”¹å•†å“è¦æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param spuId
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param entities
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(rollbackFor = Exception.<span style="color:#658b00">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">updateSpuAttr</span>(Long spuId, List&lt;ProductAttrValueEntity&gt; entities) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€åˆªé™¤spuIdä¹‹å‰å°æ‡‰çš„æ‰€æœ‰å±¬æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">baseMapper</span>.<span style="color:#658b00">delete</span>(<span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;ProductAttrValueEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;spu_id&#34;</span>, spuId));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 2ã€æ·»åŠ å•†å“è¦æ ¼ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;ProductAttrValueEntity&gt; collect = entities.<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(item -&gt; {
</span></span><span style="display:flex;"><span>        item.<span style="color:#658b00">setSpuId</span>(spuId);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> item;
</span></span><span style="display:flex;"><span>    }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ‰¹é‡æ–°å¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">saveBatch</span>(collect);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>å‰ç«¯åˆè¦è£œä¸€å€‹éç©ºåˆ¤æ–·ï¼Œæˆ‘æ„Ÿè¦ºé€™æ˜¯å› ç‚ºä¸åŒç‰ˆæœ¬è¼‰å…¥é †åºä¸åŒé€ æˆçš„BUGï¼Œæš«ä¸”ä¸æ·±ç©¶</li>
</ul>
<p><img src="image-20220118170207649.png" alt="image-20220118170207649"></p>
<ul>
<li>å¦å¤–é‚„æœ‰ä¸€å€‹å°BUGå°±æ˜¯å¤šé¸çš„å±¬æ€§ï¼Œåªè³¦äºˆå–®å€‹å€¼ï¼Œä¸”è©²å€¼ä¸å±¬æ–¼ç®¡ç†çš„å±¬æ€§(attrè¡¨ä¸­å¯é¸çš„valuesï¼Œæœƒå‡ºç¾åœ¨ä¸‹æ‹‰è¡¨å–®ä¸­)ï¼Œå°±æ˜¯èªªé‚£å€‹å€¼æ˜¯saveçš„æ™‚å€™æˆ–ä¿®æ”¹æ™‚ç¾åŠ çš„ã€‚æœƒå°è‡´å®ƒåœ¨å‰ç«¯é é¢ä¿®æ”¹å±¬æ€§æ™‚å›é¡¯å¤±æ•—(ä½†è³‡æ–™åº«ä¸­è¡¨æ ¼æ¬„ä½æ²’éŒ¯)</li>
</ul>
<h2 id="skuæª¢ç´¢">skuæª¢ç´¢</h2>
<ul>
<li>SkuInfoServiceImpl.java
<ul>
<li>å¤§åŒå°ç•°ï¼Œå¦å¤–å¾ç¶²å‹é‚£å­¸åˆ°mybatisplusè‡ªå¸¶çš„å·¥å…·åŒ…<code>StringUtils.isNotBlank</code>æ¯”Springçš„<code>!StringUtils.isEmpty</code>æ›´å¥½ç”¨</li>
<li>å¦å¤–æ³¨æ„åƒ¹æ ¼å€é–“æœç´¢ï¼Œå‰ç«¯é è¨­å‚³ä¾†æ˜¯0è¦åšåˆ¤æ–·</li>
<li>æˆ‘æ³¨æ„åˆ°å‚³ä¾†çš„åƒæ•¸éƒ½è½‰æˆStringè™•ç†ï¼Œè€Œmybatisplusæœç´¢æ™‚ä¹Ÿæ˜¯æœƒè‡ªå‹•æŠŠStringè½‰æˆè³‡æ–™åº«ä¸­çš„å°æ‡‰çš„æ ¼å¼</li>
<li>ç¸½ä¹‹éƒ½ç”¨Stringä¹çœ‹æ²’æ¯›ç—…</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> PageUtils <span style="color:#008b45">queryPageByKeyword</span>(Map&lt;String, Object&gt; params) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// key: &#39;è¯ç‚º&#39;,//æª¢ç´¢é—œéµå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// catelogId: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// brandId: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// min: 0,
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// max: 0
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    QueryWrapper&lt;SkuInfoEntity&gt; wrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;&gt;();
</span></span><span style="display:flex;"><span>    String key = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(key) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(key)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">and</span>(w -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ¨¡ç³Šæœç´¢ç‚ºäº†æ€•è“‹æ‰ä¸‹é¢çš„æ‰€ä»¥ç”¨andï¼Œå…¶å¯¦ä¹Ÿèƒ½æ”¾æœ€å¾Œå°±å¥½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// å„ªå…ˆ NOT&gt;AND&gt;OR
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            w.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;sku_id&#34;</span>, key).<span style="color:#658b00">or</span>().<span style="color:#658b00">like</span>(<span style="color:#cd5555">&#34;sku_name&#34;</span>, key);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String catelogId = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;catelogId&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(catelogId) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(catelogId)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;catalog_id&#34;</span>, catelogId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String brandId = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;brandId&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(brandId) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(brandId)) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;brand_id&#34;</span>, brandId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String min = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;min&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(min) &amp;&amp; <span style="color:#8b008b;font-weight:bold">new</span> BigDecimal(min).<span style="color:#658b00">compareTo</span>(BigDecimal.<span style="color:#658b00">ZERO</span>) &gt; 0) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">ge</span>(<span style="color:#cd5555">&#34;price&#34;</span>, min);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String max = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;max&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(max) &amp;&amp; <span style="color:#8b008b;font-weight:bold">new</span> BigDecimal(max).<span style="color:#658b00">compareTo</span>(BigDecimal.<span style="color:#658b00">ZERO</span>) &gt; 0) {
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">le</span>(<span style="color:#cd5555">&#34;price&#34;</span>, max);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    IPage&lt;SkuInfoEntity&gt; page = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">page</span>(<span style="color:#8b008b;font-weight:bold">new</span> Query&lt;SkuInfoEntity&gt;().<span style="color:#658b00">getPage</span>(params), wrapper);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> PageUtils(page);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h1 id="åº«å­˜æ¨¡çµ„">åº«å­˜æ¨¡çµ„</h1>
<p>è¤‡ç¿’ä¸€ä¸‹é–‹æ–°æ¨¡çµ„è¨­å®š</p>
<ul>
<li>å•Ÿå‹•é¡è¨»è§£æƒæMapperä½ç½®ã€é–‹å•Ÿäº¤æ˜“ã€é–‹å•Ÿæœå‹™ç™¼ç¾</li>
<li>å…¶å¯¦äº¤æ˜“è·ŸMapperå¯ä»¥çœç•¥</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@EnableTransactionManagement</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@MapperScan</span>(<span style="color:#cd5555">&#34;yozi.mall.ware.dao&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@EnableDiscoveryClient</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">WareApplication</span> {
</span></span></code></pre></div><ul>
<li>application.properties
<ul>
<li>æˆ‘æ„Ÿè¦ºé‚„æ˜¯.propertieså¥½ç”¨ï¼Œä¸ç”¨åœ¨é‚£é‚Šå°é½Šï¼Œè¤‡è£½è²¼ä¸Šä¹Ÿå¿«</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># æœå‹™è¨»å†Šç™¼ç¾ç›¸é—œ
server.port=11000
server.servlet.session.timeout=30m
spring.application.name=ware
spring.cloud.nacos.discovery.server-addr=localhost:8848
spring.cloud.nacos.config.server-addr=localhost:8848

# DB
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.url=jdbc:mysql://localhost:3306/gulimall_wms?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# mybatis-plusè¨­å®š
mybatis-plus.mapper-locations=classpath:/mapper/**/*.xml
mybatis-plus.global-config.db-config.id-type=auto

# jsonæ—¥æœŸæ™‚é–“æ ¼å¼
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=GMT+8
</code></pre><ul>
<li>åˆ†é æ’ä»¶ï¼Œç›´æ¥è¤‡è£½è²¼ä¸Š
<ul>
<li>æˆ‘æ„Ÿè¦ºé€™ç¨®æ‡‰è©²çµ¦commonç®¡ç†</li>
</ul>
</li>
<li>å›å»è¨­å®šç¶²é—œè¦å‰‡ï¼Œä¸è¦æ‰‹è³¤è½‰æ›ï¼Œ.propertiesçš„æ•¸çµ„å¾ˆæ‚²åŠ‡</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">spring</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#8b008b;font-weight:bold">cloud</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#8b008b;font-weight:bold">gateway</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#8b008b;font-weight:bold">routes</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#8b008b;font-weight:bold">id</span>:<span style="color:#bbb"> </span>product_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">uri</span>:<span style="color:#bbb"> </span>lb://product<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/product/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#8b008b;font-weight:bold">id</span>:<span style="color:#bbb"> </span>member_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">uri</span>:<span style="color:#bbb"> </span>lb://member<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/member/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#8b008b;font-weight:bold">id</span>:<span style="color:#bbb"> </span>ware_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">uri</span>:<span style="color:#bbb"> </span>lb://ware<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/ware/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/api/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#8b008b;font-weight:bold">id</span>:<span style="color:#bbb"> </span>upload_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">uri</span>:<span style="color:#bbb"> </span>lb://third-party<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/third-party/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/api/third-party/(?&lt;segment&gt;.*),/$\{segment}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">        </span>- <span style="color:#8b008b;font-weight:bold">id</span>:<span style="color:#bbb"> </span>admin_route<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">uri</span>:<span style="color:#bbb"> </span>lb://renren-fast<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">predicates</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- Path=/api/**<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">          </span><span style="color:#8b008b;font-weight:bold">filters</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>- RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\{segment}<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="æ¨¡çµ„åŠŸèƒ½èªªæ˜">æ¨¡çµ„åŠŸèƒ½èªªæ˜</h2>
<ul>
<li>è¡¨èˆ‡å¾Œå°çš„å°æ‡‰</li>
</ul>
<p><img src="image-20220118122024322.png" alt="image-20220118122024322"></p>
<ul>
<li>åŸºæœ¬å–®ä½æ˜¯å•†å“åº«å­˜id(wms_ware_skuè¡¨)ï¼Œèˆ‡ä¸€å€‹å•†å“sku_idå°æ‡‰ï¼Œé‚„æœ‰æ‰€åœ¨å€‰åº«(é—œè¯wms_ware_infoè¡¨)èˆ‡æ•¸é‡ç­‰ç­‰</li>
<li>å¾å•†å“åº«å­˜idæ–°å¢æ¡è³¼éœ€æ±‚(wms_purchase_detailè¡¨)ï¼Œå¤šå€‹æ¡è³¼éœ€æ±‚idå½™æ•´æˆä¸€å€‹æ¡è³¼å–®id(wms_purchaseè¡¨)ï¼Œé€™é‚ŠåŒ…å«æ¡è³¼äººã€ç¸½é‡‘é¡ç­‰ç­‰</li>
<li>å¾æ¡è³¼å–®idå°æ‡‰åˆ°åº«å­˜å·¥ä½œå–®(wms_ware_order_task)ï¼Œé€™é‚Šæœ‰æ¡è³¼å–®çš„é…é€ç‹€æ…‹ã€ç‰©æµã€ä»˜æ¬¾æ–¹å¼ã€ä»»å‹™é€²åº¦ç­‰ç­‰ï¼Œé‚„èƒ½æŸ¥çœ‹è©³ç´°æ¡è³¼çš„æ˜¯é‚£äº›sku(wms_ware_order_task_detailè¡¨)</li>
</ul>
<p><img src="image-20220118123014788.png" alt="image-20220118123014788"></p>
<h2 id="å¹¾å€‹ç°¡å–®çš„æœç´¢">å¹¾å€‹ç°¡å–®çš„æœç´¢</h2>
<ul>
<li>æœç´¢å€‰åº«åˆ—è¡¨ï¼ŒWareInfoServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> PageUtils <span style="color:#008b45">queryPage</span>(Map&lt;String, Object&gt; params) {
</span></span><span style="display:flex;"><span>    QueryWrapper&lt;WareInfoEntity&gt; queryWrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;&gt;();
</span></span><span style="display:flex;"><span>    String key = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(key)) {
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;id&#34;</span>, key)
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">or</span>().<span style="color:#658b00">like</span>(<span style="color:#cd5555">&#34;name&#34;</span>, key)
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">or</span>().<span style="color:#658b00">like</span>(<span style="color:#cd5555">&#34;address&#34;</span>, key)
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">or</span>().<span style="color:#658b00">like</span>(<span style="color:#cd5555">&#34;areacode&#34;</span>, key);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    IPage&lt;WareInfoEntity&gt; page = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">page</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">new</span> Query&lt;WareInfoEntity&gt;().<span style="color:#658b00">getPage</span>(params),
</span></span><span style="display:flex;"><span>            queryWrapper
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> PageUtils(page);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æœç´¢æ¡è³¼éœ€æ±‚ï¼ŒPurchaseDetailServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> PageUtils <span style="color:#008b45">queryPage</span>(Map&lt;String, Object&gt; params) {
</span></span><span style="display:flex;"><span>    QueryWrapper&lt;PurchaseDetailEntity&gt; queryWrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;PurchaseDetailEntity&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String key = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;key&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(key)) {
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#658b00">and</span>(wrapper -&gt; {
</span></span><span style="display:flex;"><span>            wrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;purchase_id&#34;</span>, key).<span style="color:#658b00">or</span>().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;sku_id&#34;</span>, key);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String status = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;status&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(status) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(status)) {
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;status&#34;</span>, status);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    String wareId = (String) params.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;wareId&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isNotBlank</span>(wareId) &amp;&amp; !<span style="color:#cd5555">&#34;0&#34;</span>.<span style="color:#658b00">equalsIgnoreCase</span>(wareId)) {
</span></span><span style="display:flex;"><span>        queryWrapper.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;ware_id&#34;</span>, wareId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    IPage&lt;PurchaseDetailEntity&gt; page = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">page</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">new</span> Query&lt;PurchaseDetailEntity&gt;().<span style="color:#658b00">getPage</span>(params),
</span></span><span style="display:flex;"><span>            queryWrapper
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> PageUtils(page);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>PurchaseServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// æŸ¥è©¢æœªé ˜å–çš„æ¡è³¼å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> PageUtils <span style="color:#008b45">queryPageUnreceive</span>(Map&lt;String, Object&gt; params) {
</span></span><span style="display:flex;"><span>    QueryWrapper&lt;PurchaseEntity&gt; queryWrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;PurchaseEntity&gt;()
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;status&#34;</span>, 0).<span style="color:#658b00">or</span>().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;status&#34;</span>, 1);
</span></span><span style="display:flex;"><span>    IPage&lt;PurchaseEntity&gt; page = <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">page</span>(<span style="color:#8b008b;font-weight:bold">new</span> Query&lt;PurchaseEntity&gt;().<span style="color:#658b00">getPage</span>(params), queryWrapper);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> PageUtils(page);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="åˆä½µæ¡è³¼éœ€æ±‚">åˆä½µæ¡è³¼éœ€æ±‚</h2>
<ul>
<li>PurchaseController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// åˆä½µæ¡è³¼éœ€æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@PostMapping</span>(<span style="color:#cd5555">&#34;/merge&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">merge</span>(<span style="color:#707a7c">@RequestBody</span> MergeVo mergeVo) {
</span></span><span style="display:flex;"><span>    purchaseService.<span style="color:#658b00">mergePurchase</span>(mergeVo);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>PurchaseServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// åˆä½µæ¡è³¼éœ€æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Transactional</span>(rollbackFor = Exception.<span style="color:#658b00">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">mergePurchase</span>(MergeVo mergeVo) {
</span></span><span style="display:flex;"><span>    Long purchaseId = mergeVo.<span style="color:#658b00">getPurchaseId</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ²’æœ‰é¸æ“‡ä»»ä½•ã€æ¡è³¼å–®ã€‘ï¼Œå°‡è‡ªå‹•å‰µå»ºæ–°å–®é€²è¡Œåˆä½µã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (purchaseId == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        PurchaseEntity purchaseEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseEntity();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è¨­ç½®æ¡è³¼å–®çš„é è¨­ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        purchaseEntity.<span style="color:#658b00">setStatus</span>(WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">CREATED</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">save</span>(purchaseEntity);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç²å–æ–°å»ºæ¡è³¼å–®çš„id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        purchaseId = purchaseEntity.<span style="color:#658b00">getId</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å–å‡ºå‰ç«¯ä¾†çš„æ¡è³¼éœ€æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;Long&gt; items = mergeVo.<span style="color:#658b00">getItems</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ç¢ºèªæ¡è³¼å–®ç‹€æ…‹æ˜¯0,1(é‚„æ²’è²·)æ‰å¯ä»¥åˆä½µ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Collection&lt;PurchaseDetailEntity&gt; purchaseDetailEntities = purchaseDetailService.<span style="color:#658b00">listByIds</span>(items);
</span></span><span style="display:flex;"><span>    purchaseDetailEntities.<span style="color:#658b00">forEach</span>((item) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (!item.<span style="color:#658b00">getStatus</span>().<span style="color:#658b00">equals</span>(WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">CREATED</span>.<span style="color:#658b00">getCode</span>())
</span></span><span style="display:flex;"><span>                &amp;&amp; !item.<span style="color:#658b00">getStatus</span>().<span style="color:#658b00">equals</span>(WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">ASSIGNED</span>.<span style="color:#658b00">getCode</span>())) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> IllegalArgumentException(<span style="color:#cd5555">&#34;æ­£åœ¨æ¡è³¼ï¼Œç„¡æ³•é€²è¡Œåˆ†é…&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// lambdaè¡¨é”å¼èªªè¦finalè®Šæ•¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Long finalPurchaseId = purchaseId;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ”¹è®Šæ¡è³¼éœ€æ±‚çš„ç‹€æ…‹ï¼Œä½µåˆ°é€™å–®ä¸Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;PurchaseDetailEntity&gt; collect = items.<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(i -&gt; {
</span></span><span style="display:flex;"><span>        PurchaseDetailEntity purchaseDetailEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseDetailEntity();
</span></span><span style="display:flex;"><span>        purchaseDetailEntity.<span style="color:#658b00">setId</span>(i);
</span></span><span style="display:flex;"><span>        purchaseDetailEntity.<span style="color:#658b00">setPurchaseId</span>(finalPurchaseId);
</span></span><span style="display:flex;"><span>        purchaseDetailEntity.<span style="color:#658b00">setStatus</span>(WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">ASSIGNED</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> purchaseDetailEntity;
</span></span><span style="display:flex;"><span>    }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//æ‰¹é‡ä¿®æ”¹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    purchaseDetailService.<span style="color:#658b00">updateBatchById</span>(collect);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    PurchaseEntity purchaseEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseEntity();
</span></span><span style="display:flex;"><span>    purchaseEntity.<span style="color:#658b00">setId</span>(purchaseId);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">updateById</span>(purchaseEntity);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>å—ä¸äº†ä¸€ç›´<code>new Date()</code>ï¼Œè®“æ—¥æœŸè‡ªå‹•å¡«å……
<ul>
<li><a href="https://yoziming.github.io/post/220112-agg-spring-02-mybatis-plus/#%e8%87%aa%e5%8b%95%e5%a1%ab%e5%85%85">https://yoziming.github.io/post/220112-agg-spring-02-mybatis-plus/#%e8%87%aa%e5%8b%95%e5%a1%ab%e5%85%85</a></li>
</ul>
</li>
<li>å¸¸æ•¸é¡ WareConstant.java
<ul>
<li>æ‰çŸ¥é“åŸä¾†å¯ä»¥åœ¨ä¸€å€‹é¡ä¸­å¯«å¤šå€‹enum</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">WareConstant</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">enum</span> PurchaseStatusEnum {
</span></span><span style="display:flex;"><span>        CREATED(0, <span style="color:#cd5555">&#34;æ–°å»º&#34;</span>),
</span></span><span style="display:flex;"><span>        ASSIGNED(1, <span style="color:#cd5555">&#34;å·²åˆ†é…&#34;</span>),
</span></span><span style="display:flex;"><span>        RECEIVE(2, <span style="color:#cd5555">&#34;å·²é ˜å–&#34;</span>),
</span></span><span style="display:flex;"><span>        FINISH(3, <span style="color:#cd5555">&#34;å·²å®Œæˆ&#34;</span>),
</span></span><span style="display:flex;"><span>        HASERROR(4, <span style="color:#cd5555">&#34;æœ‰ç•°å¸¸&#34;</span>),
</span></span><span style="display:flex;"><span>        ;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">enum</span> PurchaseDetailStatusEnum {
</span></span><span style="display:flex;"><span>        CREATED(0, <span style="color:#cd5555">&#34;æ–°å»º&#34;</span>),
</span></span><span style="display:flex;"><span>        ASSIGNED(1, <span style="color:#cd5555">&#34;å·²åˆ†é…&#34;</span>),
</span></span><span style="display:flex;"><span>        BUYING(2, <span style="color:#cd5555">&#34;æ­£åœ¨æ¡è³¼&#34;</span>),
</span></span><span style="display:flex;"><span>        FINISH(3, <span style="color:#cd5555">&#34;å·²å®Œæˆ&#34;</span>),
</span></span><span style="display:flex;"><span>        HASERROR(4, <span style="color:#cd5555">&#34;æ¡è³¼å¤±æ•—&#34;</span>),
</span></span></code></pre></div><ul>
<li>é€™è£¡å‰ç«¯æœ‰ä¸€å€‹BUGï¼Œç•¶åˆä½µæŸäº›éœ€æ±‚åˆ°æ¡è³¼å–®å¾Œï¼Œç”¢ç”Ÿçš„æ¡è³¼å–®idï¼Œåœ¨ROMä¸­ç‚ºpurchaseIdï¼Œæœƒæ±™æŸ“åˆ°æ–°å¢å®Œé¡¯ç¤ºçš„é è¨­å€¼(å‡è±¡)</li>
<li>æŠŠé€™æ¢banäº†å°±å¥½äº†ï¼Œåæ­£æœ¬ä¾†postå°±æ²’è¦å‚³æ¥é‚£éº¼å¤šæ±è¥¿</li>
</ul>
<p><img src="image-20220118143537293.png" alt="image-20220118143537293"></p>
<h2 id="é ˜å–æ¡è³¼å–®">é ˜å–æ¡è³¼å–®</h2>
<ul>
<li>æš«æ™‚å…ˆå‡è£æ¡è³¼äººå“¡æœ‰å€‹appä¹‹é¡èƒ½å¤ é ˜å–ï¼Œé©—è­‰é‚£äº›å…ˆä¸ç®¡ï¼Œç™¼çµ¦å¾Œç«¯çš„å°±æ˜¯æ¡è³¼å–®idæ§‹æˆçš„æ•¸çµ„[]</li>
</ul>
<p><img src="image-20220118144431155.png" alt="image-20220118144431155"></p>
<ul>
<li>PurchaseController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// é ˜å–æ¡è³¼å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@PostMapping</span>(<span style="color:#cd5555">&#34;/received&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">received</span>(<span style="color:#707a7c">@RequestBody</span> List&lt;Long&gt; ids) {
</span></span><span style="display:flex;"><span>    purchaseService.<span style="color:#658b00">received</span>(ids);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>PurchaseServiceImpl.java
<ul>
<li>//TODO é€™è£¡æœ‰é‚è¼¯æ¼æ´ï¼Œæ²’åˆ†é…ä¹Ÿèƒ½é ˜(å“¡å·¥è‡ªä¸»æ¶æ´»å¹¹?)ï¼Œæœƒå°è‡´æ¡è³¼äººé‚£äº›æ¬„ä½éƒ½æ˜¯ç©ºçš„å»é€²å…¥æ¡è³¼ç‹€æ…‹ï¼Œå…ˆç•™è‘—å§</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * é ˜å–æ¡è³¼å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param ids æ¡è³¼å–®çš„id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">received</span>(List&lt;Long&gt; ids) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List&lt;PurchaseEntity&gt; collect = ids.<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(<span style="color:#8b008b;font-weight:bold">this</span>::getById)
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">filter</span>(
</span></span><span style="display:flex;"><span>                    <span style="color:#228b22">// 1ã€ç¢ºèªç•¶å‰æ¡è³¼å–®æ˜¯æ–°å»ºæˆ–è€…æ˜¯å·²åˆ†é…ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                    item -&gt; item.<span style="color:#658b00">getStatus</span>() == WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">CREATED</span>.<span style="color:#658b00">getCode</span>() ||
</span></span><span style="display:flex;"><span>                            item.<span style="color:#658b00">getStatus</span>() == WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">ASSIGNED</span>.<span style="color:#658b00">getCode</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">peek</span>(
</span></span><span style="display:flex;"><span>                    <span style="color:#228b22">// æ”¹è®Šæ¡è³¼å–®ç‹€æ…‹ç‚ºå·²é ˜å–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                    item -&gt; {
</span></span><span style="display:flex;"><span>                        item.<span style="color:#658b00">setStatus</span>(WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">RECEIVE</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>                    }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ä¿å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">updateBatchById</span>(collect);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ”¹è®Šæ¡è³¼éœ€æ±‚çš„ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    collect.<span style="color:#658b00">forEach</span>((item) -&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç”¨æ¡è³¼å–®è™ŸæŸ¥å…¶ä¸‹çš„æ¡è³¼éœ€æ±‚ï¼Œä¸”status&lt;2(é‚„æ²’å»è²·)çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        QueryWrapper&lt;PurchaseDetailEntity&gt; wrapper = <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;PurchaseDetailEntity&gt;();
</span></span><span style="display:flex;"><span>        wrapper.<span style="color:#658b00">and</span>(q -&gt; {
</span></span><span style="display:flex;"><span>            q.<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;purchase_id&#34;</span>, item.<span style="color:#658b00">getId</span>());
</span></span><span style="display:flex;"><span>            q.<span style="color:#658b00">lt</span>(<span style="color:#cd5555">&#34;status&#34;</span>, 2);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        List&lt;PurchaseDetailEntity&gt; list = purchaseDetailService.<span style="color:#658b00">list</span>(wrapper);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        List&lt;PurchaseDetailEntity&gt; detailEntities = list.<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(entity -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ›´æ–°è¦æ‹¿å‡ºid
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            PurchaseDetailEntity purchaseDetailEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseDetailEntity();
</span></span><span style="display:flex;"><span>            purchaseDetailEntity.<span style="color:#658b00">setId</span>(entity.<span style="color:#658b00">getId</span>());
</span></span><span style="display:flex;"><span>            purchaseDetailEntity.<span style="color:#658b00">setStatus</span>(WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">BUYING</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> purchaseDetailEntity;
</span></span><span style="display:flex;"><span>        }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>        purchaseDetailService.<span style="color:#658b00">updateBatchById</span>(detailEntities);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å®Œæˆæ¡è³¼å–®">å®Œæˆæ¡è³¼å–®</h2>
<ul>
<li>APIèˆ‡Vo</li>
</ul>
<p><img src="image-20220118144826792.png" alt="image-20220118144826792"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">è«‹æ±‚bodyï¼Œç¬¬ä¸€å€‹idæ˜¯æ¡è³¼å–®è™Ÿï¼Œè£¡é¢çš„itemIdæ˜¯æ¡è³¼éœ€æ±‚è™Ÿ</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;id&#34;</span>: <span style="color:#b452cd">8</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;items&#34;</span>: [{<span style="color:#8b008b;font-weight:bold">&#34;itemId&#34;</span>:<span style="color:#b452cd">16</span>,<span style="color:#8b008b;font-weight:bold">&#34;status&#34;</span>:<span style="color:#b452cd">3</span>,<span style="color:#8b008b;font-weight:bold">&#34;reason&#34;</span>:<span style="color:#cd5555">&#34;&#34;</span>},{<span style="color:#8b008b;font-weight:bold">&#34;itemId&#34;</span>:<span style="color:#b452cd">17</span>,<span style="color:#8b008b;font-weight:bold">&#34;status&#34;</span>:<span style="color:#b452cd">4</span>,<span style="color:#8b008b;font-weight:bold">&#34;reason&#34;</span>:<span style="color:#cd5555">&#34;ç¼ºè²¨&#34;</span>}]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>PurchaseServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * å®Œæˆæ¡è³¼å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param doneVo
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(rollbackFor = Exception.<span style="color:#658b00">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">done</span>(PurchaseDoneVo doneVo) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ¡è³¼å–®id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Long id = doneVo.<span style="color:#658b00">getId</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// TODO æ‡‰è©²æ˜¯è¦å…ˆåˆ¤æ–·æ¡è³¼å–®èˆ‡æ¡è³¼éœ€æ±‚æ˜¯å¦å®Œæˆæ‰èƒ½å¾€ä¸‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ”¹è®Šæ¡è³¼éœ€æ±‚çš„ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Boolean flag = <span style="color:#8b008b;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    List&lt;PurchaseItemDoneVo&gt; items = doneVo.<span style="color:#658b00">getItems</span>();
</span></span><span style="display:flex;"><span>    List&lt;PurchaseDetailEntity&gt; updates = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (PurchaseItemDoneVo item : items) {
</span></span><span style="display:flex;"><span>        PurchaseDetailEntity purchaseDetailEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseDetailEntity();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ¡è³¼éœ€æ±‚å¤±æ•—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (item.<span style="color:#658b00">getStatus</span>() == WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">HASERROR</span>.<span style="color:#658b00">getCode</span>()) {
</span></span><span style="display:flex;"><span>            flag = <span style="color:#8b008b;font-weight:bold">false</span>;
</span></span><span style="display:flex;"><span>            purchaseDetailEntity.<span style="color:#658b00">setStatus</span>(item.<span style="color:#658b00">getStatus</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            purchaseDetailEntity.<span style="color:#658b00">setStatus</span>(WareConstant.<span style="color:#658b00">PurchaseDetailStatusEnum</span>.<span style="color:#658b00">FINISH</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// å°‡æˆåŠŸæ¡è³¼çš„é€²è¡Œå…¥åº«
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// æŸ¥å‡ºç•¶å‰æ¡è³¼é …çš„è©³ç´°ä¿¡æ¯ï¼Œå…¥åº«
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            PurchaseDetailEntity entity = purchaseDetailService.<span style="color:#658b00">getById</span>(item.<span style="color:#658b00">getItemId</span>());
</span></span><span style="display:flex;"><span>            wareSkuService.<span style="color:#658b00">addStock</span>(entity.<span style="color:#658b00">getSkuId</span>(), entity.<span style="color:#658b00">getWareId</span>(), entity.<span style="color:#658b00">getSkuNum</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        purchaseDetailEntity.<span style="color:#658b00">setId</span>(item.<span style="color:#658b00">getItemId</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è£é€²æ›´æ–°çš„list
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        updates.<span style="color:#658b00">add</span>(purchaseDetailEntity);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ‰¹é‡æ›´æ–°
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    purchaseDetailService.<span style="color:#658b00">updateBatchById</span>(updates);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ”¹è®Šæ¡è³¼å–®ç‹€æ…‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    PurchaseEntity purchaseEntity = <span style="color:#8b008b;font-weight:bold">new</span> PurchaseEntity();
</span></span><span style="display:flex;"><span>    purchaseEntity.<span style="color:#658b00">setId</span>(id);
</span></span><span style="display:flex;"><span>    purchaseEntity.<span style="color:#658b00">setStatus</span>(flag ? WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">FINISH</span>.<span style="color:#658b00">getCode</span>() :
</span></span><span style="display:flex;"><span>            WareConstant.<span style="color:#658b00">PurchaseStatusEnum</span>.<span style="color:#658b00">HASERROR</span>.<span style="color:#658b00">getCode</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">updateById</span>(purchaseEntity);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>WareSkuServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(rollbackFor = Exception.<span style="color:#658b00">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">addStock</span>(Long skuId, Long wareId, Integer skuNum) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æŸå€‰åº«ä¸­çš„æŸskuæ‡‰è©²æ˜¯å”¯ä¸€çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    WareSkuEntity isExistWareSku = wareSkuDao.<span style="color:#658b00">selectOne</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;WareSkuEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;sku_id&#34;</span>, skuId).<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;ware_id&#34;</span>, wareId));
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (isExistWareSku == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// åˆ¤è®€å¦‚æœæ²’æœ‰é€™å€‹åº«å­˜è¨˜éŒ„ï¼Œæ–°å¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        WareSkuEntity wareSkuEntity = <span style="color:#8b008b;font-weight:bold">new</span> WareSkuEntity();
</span></span><span style="display:flex;"><span>        wareSkuEntity.<span style="color:#658b00">setSkuId</span>(skuId);
</span></span><span style="display:flex;"><span>        wareSkuEntity.<span style="color:#658b00">setStock</span>(skuNum);
</span></span><span style="display:flex;"><span>        wareSkuEntity.<span style="color:#658b00">setWareId</span>(wareId);
</span></span><span style="display:flex;"><span>        wareSkuEntity.<span style="color:#658b00">setStockLocked</span>(0);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// é ç«¯æŸ¥æ‰¾setSkuName
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        R info = productFeignService.<span style="color:#658b00">info</span>(skuId);
</span></span><span style="display:flex;"><span>        Map&lt;String, Object&gt; data = (Map&lt;String, Object&gt;) info.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;skuInfo&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (info.<span style="color:#658b00">getCode</span>() == 0) {
</span></span><span style="display:flex;"><span>            wareSkuEntity.<span style="color:#658b00">setSkuName</span>((String) data.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;skuName&#34;</span>));
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ·»åŠ åº«å­˜ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        wareSkuDao.<span style="color:#658b00">insert</span>(wareSkuEntity);
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ä¿®æ”¹åº«å­˜ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        Integer oldStock = isExistWareSku.<span style="color:#658b00">getStock</span>();
</span></span><span style="display:flex;"><span>        wareSkuDao.<span style="color:#658b00">addStock</span>(skuId, wareId, oldStock + skuNum);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>é€™é‚Šåˆé€ äº†ä¸€å€‹Feignæ¥å£ï¼ŒæŒºç°¡å–®çš„ï¼Œåœ¨å•Ÿå‹•é¡è¨»è§£enable&hellip;</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@FeignClient</span>(<span style="color:#cd5555">&#34;product&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">interface</span> <span style="color:#008b45;font-weight:bold">ProductFeignService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å®Œæˆæ¡è³¼éœ€æ±‚æ™‚ï¼Œå­˜è¡¨éœ€è¦sku_name
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#707a7c">@RequestMapping</span>(<span style="color:#cd5555">&#34;/product/skuinfo/info/{skuId}&#34;</span>)
</span></span><span style="display:flex;"><span>    R <span style="color:#008b45">info</span>(<span style="color:#707a7c">@PathVariable</span>(<span style="color:#cd5555">&#34;skuId&#34;</span>) Long skuId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ›´æ–°åº«å­˜æ•¸é‡å¯«äº†ä¸€å€‹SQLï¼ŒåŸä¾†å¯ä»¥å¿«é€Ÿç”Ÿæˆ@Param</li>
</ul>
<p><img src="image-20220118150055379.png" alt="image-20220118150055379"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;update</span> <span style="color:#658b00">id=</span><span style="color:#cd5555">&#34;addStock&#34;</span><span style="color:#8b008b;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>        UPDATE wms_ware_sku
</span></span><span style="display:flex;"><span>        SET stock = #{skuNum}
</span></span><span style="display:flex;"><span>        WHERE sku_id = #{skuId}
</span></span><span style="display:flex;"><span>          AND ware_id = #{wareId}
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;/update&gt;</span>
</span></span></code></pre></div><h1 id="åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ">åˆ†ä½ˆå¼åŸºç¤ç¯‡ç¸½çµ</h1>
<ul>
<li>
<p>åˆ†ä½ˆå¼åŸºç¤æ¦‚å¿µ</p>
<ul>
<li>å¾®æœå‹™ã€è¨»å†Šä¸­å¿ƒï¼ˆNacosï¼‰ã€é…ç½®ä¸­å¿ƒï¼ˆNacos Cofigï¼‰ã€é ç¨‹èª¿ç”¨ã€Feignã€ç¶²é—œ</li>
</ul>
</li>
<li>
<p>åŸºç¤é–‹ç™¼</p>
<ul>
<li>SpringBoot2.0ã€SpringCloudã€Mybatis-Plusã€Vueçµ„ä»¶åŒ–ã€é›²å­˜å„²</li>
</ul>
</li>
<li>
<p>ç’°å¢ƒ</p>
<ul>
<li>Vagrantã€Linuxã€Dockerã€MySQLã€Redisã€é€†å‘å·¥ç¨‹&amp;äººäººé–‹æº</li>
</ul>
</li>
<li>
<p>é–‹ç™¼è¦ç¯„</p>
<ul>
<li>æ•¸æ“šæ ¡é©—JSR303ã€å…¨å±€ç•°å¸¸è™•ç†ã€å…¨å±€çµ±ä¸€è¿”å›ã€è·¨åŸŸè™•ç†</li>
<li>æšèˆ‰ç‹€æ…‹ã€æ¥­å‹™ç‹€æ…‹ã€VOèˆ‡TOèˆ‡POåŠƒåˆ†ã€é‚è¼¯åˆªé™¤</li>
</ul>
</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-01-24</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220125-gulimall-08-elasticsearch/">
			ä¸‹ä¸€ç¯‡<br>ElasticSearchèˆ‡Springæ•´åˆ
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220123-array-list-polymorphism/">
			ä¸Šä¸€ç¯‡<br>arrayã€listå¤šå‹èˆ‡BaseMapperä¹‹è¬
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
