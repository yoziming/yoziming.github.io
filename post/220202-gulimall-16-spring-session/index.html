<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>è¨»å†Šã€ç™»å…¥èˆ‡Spring Session</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-16">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="è¨»å†Šã€ç™»å…¥èˆ‡Spring Session" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-16" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220202-gulimall-16-spring-session/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-02T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-02T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="è¨»å†Šã€ç™»å…¥èˆ‡Spring Session"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-16"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#webmvcconfigurer" onclick="onNavClick(`#webmvcconfigurer-nav`)" id="webmvcconfigurer-nav">
									WebMvcConfigurer
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e5%86%8a" onclick="onNavClick(`#è¨»å†Š-nav`)" id="è¨»å†Š-nav">
									è¨»å†Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%9f%a5%e8%ad%98%e9%bb%9e" onclick="onNavClick(`#çŸ¥è­˜é»-nav`)" id="çŸ¥è­˜é»-nav">
									çŸ¥è­˜é»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%99%bb%e5%85%a5" onclick="onNavClick(`#ç™»å…¥-nav`)" id="ç™»å…¥-nav">
									ç™»å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5" onclick="onNavClick(`#ç¬¬ä¸‰æ–¹ç™»å…¥-nav`)" id="ç¬¬ä¸‰æ–¹ç™»å…¥-nav">
									ç¬¬ä¸‰æ–¹ç™»å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#session%e5%85%b1%e4%ba%ab%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#sessionå…±äº«å•é¡Œ-nav`)" id="sessionå…±äº«å•é¡Œ-nav">
									sessionå…±äº«å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#spring-session" onclick="onNavClick(`#spring-session-nav`)" id="spring-session-nav">
									Spring Session
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%b7%a8%e7%a2%bc%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ç·¨ç¢¼å•é¡Œ-nav`)" id="ç·¨ç¢¼å•é¡Œ-nav">
									ç·¨ç¢¼å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ä½œç”¨åŸŸå•é¡Œ-nav`)" id="ä½œç”¨åŸŸå•é¡Œ-nav">
									ä½œç”¨åŸŸå•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%80%e8%b5%b7%e8%a7%a3%e6%b1%ba" onclick="onNavClick(`#ä¸€èµ·è§£æ±º-nav`)" id="ä¸€èµ·è§£æ±º-nav">
									ä¸€èµ·è§£æ±º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86" onclick="onNavClick(`#æ ¸å¿ƒåŸç†-nav`)" id="æ ¸å¿ƒåŸç†-nav">
									æ ¸å¿ƒåŸç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e5%96%84%e7%99%bb%e5%85%a5%e5%8a%9f%e8%83%bd" onclick="onNavClick(`#å®Œå–„ç™»å…¥åŠŸèƒ½-nav`)" id="å®Œå–„ç™»å…¥åŠŸèƒ½-nav">
									å®Œå–„ç™»å…¥åŠŸèƒ½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%96%ae%e9%bb%9e%e7%99%bb%e5%85%a5" onclick="onNavClick(`#å–®é»ç™»å…¥-nav`)" id="å–®é»ç™»å…¥-nav">
									å–®é»ç™»å…¥
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#webmvcconfigurer" onclick="onNavClick(`#webmvcconfigurer-nav`)" id="webmvcconfigurer-nav">
									WebMvcConfigurer
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e5%86%8a" onclick="onNavClick(`#è¨»å†Š-nav`)" id="è¨»å†Š-nav">
									è¨»å†Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%9f%a5%e8%ad%98%e9%bb%9e" onclick="onNavClick(`#çŸ¥è­˜é»-nav`)" id="çŸ¥è­˜é»-nav">
									çŸ¥è­˜é»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%99%bb%e5%85%a5" onclick="onNavClick(`#ç™»å…¥-nav`)" id="ç™»å…¥-nav">
									ç™»å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%96%b9%e7%99%bb%e5%85%a5" onclick="onNavClick(`#ç¬¬ä¸‰æ–¹ç™»å…¥-nav`)" id="ç¬¬ä¸‰æ–¹ç™»å…¥-nav">
									ç¬¬ä¸‰æ–¹ç™»å…¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#session%e5%85%b1%e4%ba%ab%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#sessionå…±äº«å•é¡Œ-nav`)" id="sessionå…±äº«å•é¡Œ-nav">
									sessionå…±äº«å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#spring-session" onclick="onNavClick(`#spring-session-nav`)" id="spring-session-nav">
									Spring Session
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%b7%a8%e7%a2%bc%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ç·¨ç¢¼å•é¡Œ-nav`)" id="ç·¨ç¢¼å•é¡Œ-nav">
									ç·¨ç¢¼å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ä½œç”¨åŸŸå•é¡Œ-nav`)" id="ä½œç”¨åŸŸå•é¡Œ-nav">
									ä½œç”¨åŸŸå•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%80%e8%b5%b7%e8%a7%a3%e6%b1%ba" onclick="onNavClick(`#ä¸€èµ·è§£æ±º-nav`)" id="ä¸€èµ·è§£æ±º-nav">
									ä¸€èµ·è§£æ±º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%a0%b8%e5%bf%83%e5%8e%9f%e7%90%86" onclick="onNavClick(`#æ ¸å¿ƒåŸç†-nav`)" id="æ ¸å¿ƒåŸç†-nav">
									æ ¸å¿ƒåŸç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%8c%e5%96%84%e7%99%bb%e5%85%a5%e5%8a%9f%e8%83%bd" onclick="onNavClick(`#å®Œå–„ç™»å…¥åŠŸèƒ½-nav`)" id="å®Œå–„ç™»å…¥åŠŸèƒ½-nav">
									å®Œå–„ç™»å…¥åŠŸèƒ½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%96%ae%e9%bb%9e%e7%99%bb%e5%85%a5" onclick="onNavClick(`#å–®é»ç™»å…¥-nav`)" id="å–®é»ç™»å…¥-nav">
									å–®é»ç™»å…¥
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/gulimall.png')"
                    
                
            >
                <div class="post-title">
                    è¨»å†Šã€ç™»å…¥èˆ‡Spring Session
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-16
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-02-02 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">Java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h2 id="webmvcconfigurer">WebMvcConfigurer</h2>
<blockquote>
<p>åƒè€ƒ <a href="https://blog.csdn.net/pan_junbiao/article/details/120039885">https://blog.csdn.net/pan_junbiao/article/details/120039885</a></p>
</blockquote>
<ul>
<li>è¤‡ç¿’SpringMVC</li>
<li>WebMvcConfigureræ˜¯ä¸€å€‹æ¥å£ï¼Œç”¨JavaBeançš„æ–¹å¼ä»£æ›¿web.xmlï¼Œå¸¸ç”¨æ–¼:</li>
<li>æ””æˆªå™¨ï¼Œä¾‹å¦‚:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">addInterceptors</span>(InterceptorRegistry registry) {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">super</span>.<span style="color:#658b00">addInterceptors</span>(registry);
</span></span><span style="display:flex;"><span>    registry.<span style="color:#658b00">addInterceptor</span>(<span style="color:#8b008b;font-weight:bold">new</span> TestInterceptor()).<span style="color:#658b00">addPathPatterns</span>(<span style="color:#cd5555">&#34;/**&#34;</span>).<span style="color:#658b00">excludePathPatterns</span>(<span style="color:#cd5555">&#34;/emp/toLogin&#34;</span>,<span style="color:#cd5555">&#34;/emp/login&#34;</span>,<span style="color:#cd5555">&#34;/js/**&#34;</span>,<span style="color:#cd5555">&#34;/css/**&#34;</span>,<span style="color:#cd5555">&#34;/images/**&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>è·¨åŸŸè¨­å®šï¼Œä¾‹å¦‚:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// è·¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">addCorsMappings</span>(CorsRegistry registry) {
</span></span><span style="display:flex;"><span>    registry.<span style="color:#658b00">addMapping</span>(<span style="color:#cd5555">&#34;/**&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">allowedOrigins</span>(<span style="color:#cd5555">&#34;*&#34;</span>)  <span style="color:#228b22">//æµè§ˆå™¨å…è®¸æ‰€æœ‰çš„åŸŸè®¿é—® / æ³¨æ„ * ä¸èƒ½æ»¡è¶³å¸¦æœ‰cookieçš„è®¿é—®,Origin å¿…é¡»æ˜¯å…¨åŒ¹é…
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            .<span style="color:#658b00">allowCredentials</span>(<span style="color:#8b008b;font-weight:bold">true</span>)   <span style="color:#228b22">// å…è®¸å¸¦cookieè®¿é—®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            .<span style="color:#658b00">allowedMethods</span>(<span style="color:#cd5555">&#34;GET&#34;</span>, <span style="color:#cd5555">&#34;POST&#34;</span>, <span style="color:#cd5555">&#34;PUT&#34;</span>, <span style="color:#cd5555">&#34;DELETE&#34;</span>, <span style="color:#cd5555">&#34;OPTIONS&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">allowedHeaders</span>(<span style="color:#cd5555">&#34;token&#34;</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#658b00">maxAge</span>(3600);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>æ›´å¤šé—œæ–¼è·¨åŸŸï¼Œåƒè€ƒ <a href="https://segmentfault.com/a/1190000019485883">https://segmentfault.com/a/1190000019485883</a></p>
</blockquote>
<ul>
<li>æ˜ å°„htmlé é¢
<ul>
<li>å‰å¾Œç¶´ä¸€æ¨£ç”±thymeleafåŠ ä¸Š</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MallWebConfig</span> <span style="color:#8b008b;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// Viewæ˜ å°„ï¼Œçœä¸‹é€ controllerä¸€å€‹ä¸€å€‹è¨­å®š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">addViewControllers</span>(ViewControllerRegistry registry) {
</span></span><span style="display:flex;"><span>        registry.<span style="color:#658b00">addViewController</span>(<span style="color:#cd5555">&#34;/&#34;</span>).<span style="color:#658b00">setViewName</span>(<span style="color:#cd5555">&#34;login&#34;</span>);
</span></span><span style="display:flex;"><span>        registry.<span style="color:#658b00">addViewController</span>(<span style="color:#cd5555">&#34;/login.html&#34;</span>).<span style="color:#658b00">setViewName</span>(<span style="color:#cd5555">&#34;login&#34;</span>);
</span></span><span style="display:flex;"><span>        registry.<span style="color:#658b00">addViewController</span>(<span style="color:#cd5555">&#34;/reg.html&#34;</span>).<span style="color:#658b00">setViewName</span>(<span style="color:#cd5555">&#34;reg&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>/* ç›¸ç•¶æ–¼
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/login.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">loginPage</span>() {
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;login&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="è¨»å†Š">è¨»å†Š</h2>
<ul>
<li>LoginController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// è¨»å†Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@PostMapping</span>(value = <span style="color:#cd5555">&#34;/register&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">register</span>(<span style="color:#707a7c">@Valid</span> UserRegisterVo vos, BindingResult result, RedirectAttributes attributes) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å¦‚æœæœ‰éŒ¯èª¤å›åˆ°è¨»å†Šé é¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (result.<span style="color:#658b00">hasErrors</span>()) {
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; errors =
</span></span><span style="display:flex;"><span>                result.<span style="color:#658b00">getFieldErrors</span>().<span style="color:#658b00">stream</span>().<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toMap</span>(FieldError::getField,
</span></span><span style="display:flex;"><span>                        FieldError::getDefaultMessage));
</span></span><span style="display:flex;"><span>        attributes.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;errors&#34;</span>, errors);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/reg.html&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å‰ç«¯é©—è­‰è¢«ç¹éï¼Œè‹¥å‚³ç©ºå€¼è®“ä»–è¿”å›
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (vos.<span style="color:#658b00">getPassword</span>().<span style="color:#658b00">isEmpty</span>() || vos.<span style="color:#658b00">getCode</span>().<span style="color:#658b00">isEmpty</span>() || vos.<span style="color:#658b00">getUserName</span>().<span style="color:#658b00">isEmpty</span>() || vos.<span style="color:#658b00">getPhone</span>().<span style="color:#658b00">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/reg.html&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ç²å–é©—è­‰ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    String code = vos.<span style="color:#658b00">getCode</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//é©—è­‰ç¢¼é€šéï¼ŒçœŸæ­£è¨»å†Šï¼Œèª¿ç”¨é ç¨‹æœå‹™é€²è¡Œè¨»å†Šæœƒå“¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (code.<span style="color:#658b00">equals</span>(<span style="color:#cd5555">&#34;1234&#34;</span>)) {
</span></span><span style="display:flex;"><span>        R register = memberFeignService.<span style="color:#658b00">register</span>(vos);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (register.<span style="color:#658b00">getCode</span>() == 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">//æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/login.html&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">//å¤±æ•—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            Map&lt;String, String&gt; errors = <span style="color:#8b008b;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>            errors.<span style="color:#658b00">put</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, register.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;String&gt;() {
</span></span><span style="display:flex;"><span>            }));
</span></span><span style="display:flex;"><span>            attributes.<span style="color:#658b00">addFlashAttribute</span>(<span style="color:#cd5555">&#34;errors&#34;</span>, errors);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/reg.html&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//é©—è­‰ç¢¼éŒ¯èª¤
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        Map&lt;String, String&gt; errors = <span style="color:#8b008b;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>        errors.<span style="color:#658b00">put</span>(<span style="color:#cd5555">&#34;code&#34;</span>, <span style="color:#cd5555">&#34;é©—è­‰ç¢¼éŒ¯èª¤&#34;</span>);
</span></span><span style="display:flex;"><span>        attributes.<span style="color:#658b00">addFlashAttribute</span>(<span style="color:#cd5555">&#34;errors&#34;</span>, errors);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/reg.html&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>çŸ¥è­˜é»:</p>
<ul>
<li>
<p>ç”¨æ‹‹å‡ºç•°å¸¸çš„æ–¹å¼å‘ŠçŸ¥æ˜¯å¦é‡è¤‡è¨»å†Š</p>
</li>
<li>
<p>ç”¨MD5åŠ é¹½åŠ å¯†ï¼Œå¥½è™•:</p>
<ul>
<li>å¿«é€Ÿã€æŠ—æ”¹(é›ªå´©æ•ˆæ‡‰ï¼Œåªè¦æœ‰åŸå§‹è³‡æ–™ä»»ä½•è®ŠåŒ–ç®—å‡ºçš„MD5éƒ½æœƒå¤©å·®åœ°åˆ¥)ã€ä¸å¯é€†</li>
<li>ä½†æ˜¯å¯ä»¥æš´åŠ›ç ´è§£ï¼Œæ‰€ä»¥è¦åŠ é¹½</li>
</ul>
</li>
</ul>
</li>
<li>
<p>MemberController.java</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@PostMapping</span>(value = <span style="color:#cd5555">&#34;/register&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">register</span>(<span style="color:#707a7c">@RequestBody</span> MemberUserRegisterVo vo) {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        memberService.<span style="color:#658b00">register</span>(vo);
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (PhoneException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">error</span>(BizCodeEnum.<span style="color:#658b00">PHONE_EXIST_EXCEPTION</span>.<span style="color:#658b00">getCode</span>(), BizCodeEnum.<span style="color:#658b00">PHONE_EXIST_EXCEPTION</span>.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (UsernameException e) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">error</span>(BizCodeEnum.<span style="color:#658b00">USER_EXIST_EXCEPTION</span>.<span style="color:#658b00">getCode</span>(), BizCodeEnum.<span style="color:#658b00">USER_EXIST_EXCEPTION</span>.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">ok</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>MemberServiceImpl.java
<ul>
<li>Springçš„BCryptPasswordEncoderå·²ç¶“è‡ªå‹•åŠ é¹½äº†</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">register</span>(MemberUserRegisterVo vo) {
</span></span><span style="display:flex;"><span>    MemberEntity memberEntity = <span style="color:#8b008b;font-weight:bold">new</span> MemberEntity();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è¨­ç½®ç­‰ç´šç‚ºæ™®é€šæœƒå“¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    MemberLevelEntity levelEntity = memberLevelDao.<span style="color:#658b00">getDefaultLevel</span>();
</span></span><span style="display:flex;"><span>    memberEntity.<span style="color:#658b00">setLevelId</span>(levelEntity.<span style="color:#658b00">getId</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æª¢æŸ¥ç”¨æˆ¶åå’Œæ‰‹æ©Ÿè™Ÿæ˜¯å¦å”¯ä¸€ï¼Œå¯èƒ½æ‹‹å‡ºç•°å¸¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    checkPhoneUnique(vo.<span style="color:#658b00">getPhone</span>());
</span></span><span style="display:flex;"><span>    checkUserNameUnique(vo.<span style="color:#658b00">getUserName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è¨­å®šå¸³è™Ÿå¯†ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    memberEntity.<span style="color:#658b00">setNickname</span>(vo.<span style="color:#658b00">getUserName</span>());
</span></span><span style="display:flex;"><span>    memberEntity.<span style="color:#658b00">setUsername</span>(vo.<span style="color:#658b00">getUserName</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å¯†ç¢¼é€²è¡ŒMD5åŠ å¯†
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BCryptPasswordEncoder bCryptPasswordEncoder = <span style="color:#8b008b;font-weight:bold">new</span> BCryptPasswordEncoder();
</span></span><span style="display:flex;"><span>    String encode = bCryptPasswordEncoder.<span style="color:#658b00">encode</span>(vo.<span style="color:#658b00">getPassword</span>());
</span></span><span style="display:flex;"><span>    memberEntity.<span style="color:#658b00">setPassword</span>(encode);
</span></span><span style="display:flex;"><span>    memberEntity.<span style="color:#658b00">setMobile</span>(vo.<span style="color:#658b00">getPhone</span>());
</span></span><span style="display:flex;"><span>    memberEntity.<span style="color:#658b00">setGender</span>(0);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// memberEntity.setCreateTime(new Date());
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// ä¿å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    baseMapper.<span style="color:#658b00">insert</span>(memberEntity);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">checkPhoneUnique</span>(String phone) <span style="color:#8b008b;font-weight:bold">throws</span> PhoneException {
</span></span><span style="display:flex;"><span>    Long phoneCount = baseMapper.<span style="color:#658b00">selectCount</span>(<span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;MemberEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;mobile&#34;</span>, phone));
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (phoneCount &gt; 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> PhoneException();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">checkUserNameUnique</span>(String userName) <span style="color:#8b008b;font-weight:bold">throws</span> UsernameException {
</span></span><span style="display:flex;"><span>    Long usernameCount = baseMapper.<span style="color:#658b00">selectCount</span>(<span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;MemberEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;username&#34;</span>, userName));
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (usernameCount &gt; 0) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> UsernameException();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="çŸ¥è­˜é»">çŸ¥è­˜é»</h3>
<blockquote>
<p>addAttributeèˆ‡addFlashAttributeçš„å€åˆ¥</p>
</blockquote>
<pre tabindex="0"><code>attr.addAttribute(â€œparamâ€, value);
</code></pre><ul>
<li>é€™ç¨®æ–¹å¼å°±ç›¸ç•¶æ–¼é‡å®šå‘ä¹‹å¾Œï¼Œåœ¨urlå¾Œé¢æ‹¼æ¥åƒæ•¸ï¼Œé€™æ¨£åœ¨é‡å®šå‘ä¹‹å¾Œçš„é é¢æˆ–è€…æ§åˆ¶å™¨å†å»ç²å–urlå¾Œé¢çš„åƒæ•¸å°±å¯ä»¥äº†ï¼Œä½†é€™å€‹æ–¹å¼å› ç‚ºæ˜¯åœ¨urlå¾Œé¢æ·»åŠ åƒæ•¸çš„æ–¹å¼ï¼Œæ‰€ä»¥æš´éœ²äº†åƒæ•¸ï¼Œæœ‰é¢¨éšª</li>
</ul>
<pre tabindex="0"><code>attr.addFlashAttribute(â€œparamâ€, value);
</code></pre><ul>
<li>é€™ç¨®æ–¹å¼ä¹Ÿèƒ½é”åˆ°é‡æ–°å‘å¸¶åƒï¼Œè€Œä¸”èƒ½éš±è—åƒæ•¸ï¼Œå…¶åŸç†å°±æ˜¯æ”¾åˆ°sessionä¸­ï¼Œsessionåœ¨è·³åˆ°é é¢åé¦¬ä¸Šç§»é™¤å°è±¡</li>
</ul>
<h2 id="ç™»å…¥">ç™»å…¥</h2>
<ul>
<li>LoginController.java
<ul>
<li><code>AuthServerConstant.LOGIN_USER</code>å…¶å¯¦å°±æ˜¯<code>&quot;loginUser&quot;</code>ï¼Œæ”¾æˆå¸¸æ•¸æ˜¯ç‚ºäº†é¿å…ä½¿ç”¨é­”æ³•å€¼</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@PostMapping</span>(value = <span style="color:#cd5555">&#34;/login&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">login</span>(UserLoginVo vo, RedirectAttributes attributes, HttpSession session) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// é ç¨‹èª¿ç”¨memberçš„é©—è­‰å¸³è™Ÿå¯†ç¢¼æœå‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    R login = memberFeignService.<span style="color:#658b00">login</span>(vo);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (login.<span style="color:#658b00">getCode</span>() == 0) {
</span></span><span style="display:flex;"><span>        MemberResponseVo data = login.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;data&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;MemberResponseVo&gt;() {
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;ç”¨æˆ¶&#34;</span>+data.<span style="color:#658b00">getUsername</span>()+<span style="color:#cd5555">&#34;ç™»å…¥æˆåŠŸ&#34;</span>);
</span></span><span style="display:flex;"><span>        session.<span style="color:#658b00">setAttribute</span>(AuthServerConstant.<span style="color:#658b00">LOGIN_USER</span>, data);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://mall.com&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        Map&lt;String, String&gt; errors = <span style="color:#8b008b;font-weight:bold">new</span> HashMap&lt;&gt;();
</span></span><span style="display:flex;"><span>        errors.<span style="color:#658b00">put</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, login.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;String&gt;() {
</span></span><span style="display:flex;"><span>        }));
</span></span><span style="display:flex;"><span>        attributes.<span style="color:#658b00">addFlashAttribute</span>(<span style="color:#cd5555">&#34;errors&#34;</span>, errors);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://auth.mall.com/login.html&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>é©—è­‰å¸³è™Ÿå¯†ç¢¼å¾ˆç°¡å–®å°±ä¸è²¼äº†ï¼Œæ¥è‘—ä¸»è¦è™•ç†Sessionçš„å•é¡Œ</li>
</ul>
<h3 id="ç¬¬ä¸‰æ–¹ç™»å…¥">ç¬¬ä¸‰æ–¹ç™»å…¥</h3>
<ul>
<li>ç¬¬ä¸‰æ–¹ç™»å…¥æˆ‘è‡ªå·±ç”¨googleè©¦äº†éƒ½ä¸æˆåŠŸï¼Œä¸»è¦å¡åœ¨ä¸çŸ¥é“requestç¶²å€åˆ°åº•è©²æ€å¯«</li>
</ul>
<p><img src="image-20220125222347983.png" alt="image-20220125222347983"></p>
<ul>
<li>æœæ•™å­¸æ¯”è¼ƒå¤šæ˜¯ç”¨spring securityï¼Œç…§æ•™å­¸èƒ½é€ ä¸€å€‹æ–°çš„Loginé é¢ï¼Œçµåˆèµ·ä¾†æåŠå¤©éƒ½å¤±æ•—ï¼Œå”‰å…ˆè·³éå§</li>
</ul>
<h2 id="sessionå…±äº«å•é¡Œ">sessionå…±äº«å•é¡Œ</h2>
<ul>
<li>
<p>å­ç¶²åŸŸã€åˆ†æ•£å¼æœå‹™ç”¨å‚³çµ±sessionæ‡‰ä»˜ä¸ä¾†ï¼Œæœ‰å¹¾ç¨®å¯é¸æ–¹æ¡ˆ</p>
</li>
<li>
<p>sessionè¤‡è£½ï¼Œæ¯ä¸€å€‹sessionéƒ½è¤‡è£½åˆ°æ‰€æœ‰webserverä¸­ï¼ŒTomcatä¿®æ”¹é…ç½®æ–‡ä»¶å°±èƒ½è¾¦åˆ°</p>
<ul>
<li>ç¼ºé»: ä½”ç”¨å¤š</li>
</ul>
</li>
<li>
<p>å®¢æˆ·ç«¯å­˜å„²ï¼Œä¿å­˜åœ¨cookieä¸­</p>
<ul>
<li>ç¼ºé»: å®‰å…¨éš±æ‚£(ç¯¡æ”¹)ã€ç¶²çµ¡æµé‡ã€cookieé•·åº¦é™åˆ¶</li>
</ul>
</li>
<li>
<p>hashä¸€è‡´æ€§ï¼Œä¾‹å¦‚æ‹¿å®¢æˆ·ç«¯IPä¾†è¨ˆç®—ï¼Œç®—å‡ºä¾†ä¸€æ¨£å°±è² è¼‰å‡è¡¡åˆ†åˆ°æŒ‡å®šçš„ä¼ºæœå™¨</p>
<ul>
<li>ç¼ºé»: æ°´å¹³æ“´å±•æœƒå¼•ç™¼sessionå¤±æ•ˆ</li>
</ul>
</li>
<li>
<p>çµ±ä¸€å­˜å„²ï¼Œä¾‹å¦‚æŠŠsessionå­˜åˆ°redis</p>
<ul>
<li>ç¼ºé»: redisé‚„æ˜¯æ¯”è¨˜æ†¶é«”æ…¢ï¼Œå¤šå¢æºé€šæ¶ˆè€—ï¼Œä½†å•é¡Œä¸å¤§</li>
</ul>
</li>
</ul>
<h1 id="spring-session">Spring Session</h1>
<blockquote>
<p>å®˜æ–¹ <a href="https://docs.spring.io/spring-session/reference/samples.html">https://docs.spring.io/spring-session/reference/samples.html</a></p>
</blockquote>
<ul>
<li>Springéƒ½å¹«ä½ æƒ³å¥½äº†ï¼Œå¼•åŒ…å§</li>
</ul>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
    &lt;artifactId&gt;spring-session-data-redis&lt;/artifactId&gt;
    &lt;version&gt;2.6.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li>application.properties
<ul>
<li>é‚„å¯ä»¥è¨­å®šéæœŸæ™‚é–“ç­‰ç­‰ï¼Œé è¨­æ˜¯30m</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>spring.session.store-type=redis
# ç•¶ç„¶é‚„è¦è¨­å®šredisæ‰€åœ¨
spring.redis.host=localhost
spring.redis.port=6379
</code></pre><ul>
<li>åˆ°å•Ÿå‹•é¡è¨»è§£<code>@EnableRedisHttpSession</code></li>
</ul>
<p><img src="image-20220125201947928.png" alt="image-20220125201947928"></p>
<ul>
<li>å°‡è¦å­˜é€²sessionçš„beanåºåˆ—åŒ–</li>
</ul>
<p><img src="image-20220125204057093.png" alt="image-20220125204057093"></p>
<h2 id="ç·¨ç¢¼å•é¡Œ">ç·¨ç¢¼å•é¡Œ</h2>
<ul>
<li>é€™æ¨£ä¸€ä¾†å­˜æ˜¯èƒ½å­˜äº†ï¼Œç„¶è€Œæ˜¯ç·¨æˆäºŒé€²åˆ¶é¡å‹ï¼Œé¡¯ç„¶ä¸å¥½ç”¨ï¼Œæ‡‰è©²æ”¹æˆJSON</li>
</ul>
<p><img src="image-20220125205905259.png" alt="image-20220125205905259"></p>
<h2 id="ä½œç”¨åŸŸå•é¡Œ">ä½œç”¨åŸŸå•é¡Œ</h2>
<ul>
<li>é è¨­çš„sessionæ˜¯æ ¹æ“šç•¶å‰åŸŸ(åœ¨authä¼ºæœå™¨)å­˜çš„ï¼Œç•¶å›åˆ°ä¸»ç¶²åŸŸæˆ–è½‰åˆ°å…¶ä»–å­ç¶²åŸŸå°±ç”¨ä¸äº†</li>
</ul>
<p><img src="image-20220125210029897.png" alt="image-20220125210029897"></p>
<h2 id="ä¸€èµ·è§£æ±º">ä¸€èµ·è§£æ±º</h2>
<ul>
<li>MallSessionConfig.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MallSessionConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> CookieSerializer <span style="color:#008b45">cookieSerializer</span>() {
</span></span><span style="display:flex;"><span>        DefaultCookieSerializer cookieSerializer = <span style="color:#8b008b;font-weight:bold">new</span> DefaultCookieSerializer();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ”¾å¤§ä½œç”¨åŸŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        cookieSerializer.<span style="color:#658b00">setDomainName</span>(<span style="color:#cd5555">&#34;mall.com&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è‡ªè¨‚åç¨±
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        cookieSerializer.<span style="color:#658b00">setCookieName</span>(<span style="color:#cd5555">&#34;MALLSESSION&#34;</span>);
</span></span><span style="display:flex;"><span>        cookieSerializer.<span style="color:#658b00">setCookieMaxAge</span>(60 * 60 * 24 * 7);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> cookieSerializer;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ•´æˆJSONæ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> RedisSerializer&lt;Object&gt; <span style="color:#008b45">springSessionDefaultRedisSerializer</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> GenericJackson2JsonRedisSerializer();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æˆåŠŸ!</li>
</ul>
<p><img src="image-20220125211255800.png" alt="image-20220125211255800"></p>
<h2 id="æ ¸å¿ƒåŸç†">æ ¸å¿ƒåŸç†</h2>
<blockquote>
<p>è£é£¾è€…æ¨¡å¼ï¼Œå°±åƒé‹¼éµäººç©¿ä¸Š<em>åæµ©å…‹è£ç”²</em>ï¼Œæœ‰é¡å¤–å¢å¼·ä½†ä»ç„¶ä¿ç•™åŸå§‹åŠŸèƒ½</p>
</blockquote>
<ul>
<li><code>@EnablcRedisHttpSession</code>å°å…¥RedisHttpSessionConfigurationé…ç½®é¡ï¼Œåœ¨é€™å€‹é…ç½®é¡ä¸­æœ‰<code>SessionRepositoryFilter</code>éæ¿¾å™¨</li>
<li>åŸå§‹çš„httpè«‹æ±‚requestå’ŒéŸ¿æ‡‰responseç¶“éæ¿¾å™¨æ”¾è¡Œå¾Œï¼Œè®Šæˆäº†<code>SessionRepositoryRequestWrapper</code>èˆ‡<code>SessionRepositoryResponseWrapper</code></li>
<li>ä¹‹å¾Œæˆ‘å€‘æ“ä½œsessionå…¶å¯¦å°±æ˜¯æ“ä½œé€™äº›Wrapperï¼Œè€ŒWrapperæŠŠåŸå§‹çš„sessionæ–¹æ³•éƒ½é‡å¯«(åŠ æ–™)äº†ï¼Œä¾‹å¦‚RedisHttpSessionçš„<code>.getSession()</code>æ–¹æ³•å°±æ˜¯å»redisæ‰¾æ±è¥¿</li>
<li>Spring Sessionå·²ç¶“è€ƒæ…®éå„ç¨®ç¼ºé»ï¼Œåªè¦ç€è¦½å™¨ä¸é—œï¼Œæœƒçµ¦redisä¸­çš„sessionè‡ªå‹•å»¶æœŸ</li>
</ul>
<h2 id="å®Œå–„ç™»å…¥åŠŸèƒ½">å®Œå–„ç™»å…¥åŠŸèƒ½</h2>
<ul>
<li>æ·»åŠ Spring Sessionä¾è³´ã€åšå¥½è¨­å®šï¼Œç¾åœ¨Productæ¨¡çµ„ã€Searchæ¨¡çµ„ä¹Ÿéƒ½å¯ä»¥èª¿ç”¨å…±äº«çš„sessionäº†</li>
<li>ä¿®æ”¹å‰ç«¯é é¢ï¼Œä¾æ“šsessionåˆ¤æ–·æ˜¯å¦å·²ç™»å…¥</li>
</ul>
<p><img src="image-20220125222040181.png" alt="image-20220125222040181"></p>
<ul>
<li>LoginController.java
<ul>
<li>å·²ç¶“ç™»å…¥çš„äººé‚„æƒ³ç™»å…¥å°±è®“å®ƒè·³è½‰</li>
<li>è¦æŠŠä¹‹å‰è¨­å®šçš„Viewæ˜ å°„é—œæ‰</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * åˆ¤æ–·sessionæ˜¯å¦æœ‰loginUserï¼Œæ²’æœ‰å°±è·³è½‰ç™»éŒ„é é¢ï¼Œæœ‰å°±è·³è½‰é¦–é 
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/login.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">loginPage</span>(HttpSession session) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å¾sessionå…ˆå–å‡ºä¾†ç”¨æˆ¶çš„ä¿¡æ¯ï¼Œåˆ¤æ–·ç”¨æˆ¶æ˜¯å¦å·²ç¶“ç™»éŒ„éäº†
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Object attribute = session.<span style="color:#658b00">getAttribute</span>(AuthServerConstant.<span style="color:#658b00">LOGIN_USER</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å¦‚æœç”¨æˆ¶æ²’ç™»éŒ„é‚£å°±è·³è½‰åˆ°ç™»éŒ„é é¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (attribute == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;login&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://mall.com&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">// ç™»å‡º
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/loguot.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">logout</span>(HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    request.<span style="color:#658b00">getSession</span>().<span style="color:#658b00">removeAttribute</span>(AuthServerConstant.<span style="color:#658b00">LOGIN_USER</span>);
</span></span><span style="display:flex;"><span>    request.<span style="color:#658b00">getSession</span>().<span style="color:#658b00">invalidate</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://mall.com&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="å–®é»ç™»å…¥">å–®é»ç™»å…¥</h1>
<blockquote>
<p>Single Sign Onï¼Œç°¡ç¨±SSO</p>
</blockquote>
<ul>
<li>ç”¨åœ¨ä¸åŒåŸŸåï¼ŒåŸç†æ˜¯æœ‰ä¸€å€‹ä¸­å¤®èªè­‰ç³»çµ±å°ˆé–€è™•ç†ç™»å…¥</li>
</ul>
<p><img src="image-20220125224243309.png" alt="image-20220125224243309"></p>
<ul>
<li>æœ‰å¾ˆå¤šå¯¦ç¾æ–¹å¼ï¼Œæ¯”è¼ƒå¸¸è¦‹æ˜¯ç”¨<strong>Token</strong></li>
<li>æš«æ™‚æ‡‰è©²æ˜¯ç”¨ä¸ä¸Šï¼Œå°±åªå…ˆäº†è§£ä¸€ä¸‹ï¼Œæœ‰éœ€è¦å†å›ä¾†è£œ</li>
<li><a href="https://www.bilibili.com/video/BV1np4y1C7Yf?p=233">https://www.bilibili.com/video/BV1np4y1C7Yf?p=233</a></li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-02-02</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220203-bitcoin/">
			ä¸‹ä¸€ç¯‡<br>å€‹äººå°å€å¡Šéˆçš„ç™½è©±ç†è§£
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220201-gulimall-15/">
			ä¸Šä¸€ç¯‡<br>å•†å“è©³æƒ…
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
