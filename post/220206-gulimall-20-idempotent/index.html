<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>æäº¤è¨‚å–®: å†ªç­‰æ€§ã€åˆ†æ•£å¼äº¤æ˜“çš„ä¸€è‡´æ€§</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-20">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="æäº¤è¨‚å–®: å†ªç­‰æ€§ã€åˆ†æ•£å¼äº¤æ˜“çš„ä¸€è‡´æ€§" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-20" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220206-gulimall-20-idempotent/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-06T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æäº¤è¨‚å–®: å†ªç­‰æ€§ã€åˆ†æ•£å¼äº¤æ˜“çš„ä¸€è‡´æ€§"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-20"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%86%aa%e7%ad%89%e6%80%a7" onclick="onNavClick(`#å†ªç­‰æ€§-nav`)" id="å†ªç­‰æ€§-nav">
									å†ªç­‰æ€§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#token" onclick="onNavClick(`#token-nav`)" id="token-nav">
									Token
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%8e%96" onclick="onNavClick(`#é–-nav`)" id="é–-nav">
									é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%95%b8%e6%93%9a%e5%ba%ab%e6%82%b2%e8%a7%80%e9%8e%96" onclick="onNavClick(`#æ•¸æ“šåº«æ‚²è§€é–-nav`)" id="æ•¸æ“šåº«æ‚²è§€é–-nav">
									æ•¸æ“šåº«æ‚²è§€é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%95%b8%e6%93%9a%e5%ba%ab%e6%a8%82%e8%a7%80%e9%8e%96" onclick="onNavClick(`#æ•¸æ“šåº«æ¨‚è§€é–-nav`)" id="æ•¸æ“šåº«æ¨‚è§€é–-nav">
									æ•¸æ“šåº«æ¨‚è§€é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e9%8e%96" onclick="onNavClick(`#åˆ†ä½ˆå¼é–-nav`)" id="åˆ†ä½ˆå¼é–-nav">
									åˆ†ä½ˆå¼é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%94%af%e4%b8%80%e7%b4%84%e6%9d%9f" onclick="onNavClick(`#å”¯ä¸€ç´„æŸ-nav`)" id="å”¯ä¸€ç´„æŸ-nav">
									å”¯ä¸€ç´„æŸ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%8f%90%e4%ba%a4%e8%a8%82%e5%96%ae" onclick="onNavClick(`#æäº¤è¨‚å–®-nav`)" id="æäº¤è¨‚å–®-nav">
									æäº¤è¨‚å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b5%81%e7%a8%8b" onclick="onNavClick(`#æµç¨‹-nav`)" id="æµç¨‹-nav">
									æµç¨‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a8%8b%e5%bc%8f%e7%a2%bc" onclick="onNavClick(`#ç¨‹å¼ç¢¼-nav`)" id="ç¨‹å¼ç¢¼-nav">
									ç¨‹å¼ç¢¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a4%87%e7%bf%92%e6%9c%ac%e5%9c%b0%e4%ba%8b%e5%8b%99" onclick="onNavClick(`#è¤‡ç¿’æœ¬åœ°äº‹å‹™-nav`)" id="è¤‡ç¿’æœ¬åœ°äº‹å‹™-nav">
									è¤‡ç¿’æœ¬åœ°äº‹å‹™
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spring%e4%ba%8b%e5%8b%99%e5%8f%83%e6%95%b8" onclick="onNavClick(`#springäº‹å‹™åƒæ•¸-nav`)" id="springäº‹å‹™åƒæ•¸-nav">
									springäº‹å‹™åƒæ•¸
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%ba%8b%e5%8b%99%e5%82%b3%e6%92%ad" onclick="onNavClick(`#äº‹å‹™å‚³æ’­-nav`)" id="äº‹å‹™å‚³æ’­-nav">
									äº‹å‹™å‚³æ’­
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9d%91" onclick="onNavClick(`#å‘-nav`)" id="å‘-nav">
									å‘
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e6%95%a3%e5%bc%8f%e4%ba%a4%e6%98%93" onclick="onNavClick(`#åˆ†æ•£å¼äº¤æ˜“-nav`)" id="åˆ†æ•£å¼äº¤æ˜“-nav">
									åˆ†æ•£å¼äº¤æ˜“
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#cap%e5%ae%9a%e7%90%86" onclick="onNavClick(`#capå®šç†-nav`)" id="capå®šç†-nav">
									CAPå®šç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#raft%e7%ae%97%e6%b3%95" onclick="onNavClick(`#raftç®—æ³•-nav`)" id="raftç®—æ³•-nav">
									raftç®—æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%a0%98%e5%b0%8e%e9%81%b8%e8%88%89" onclick="onNavClick(`#é ˜å°é¸èˆ‰-nav`)" id="é ˜å°é¸èˆ‰-nav">
									é ˜å°é¸èˆ‰
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%97%a5%e8%aa%8c%e8%a4%87%e8%a3%bd" onclick="onNavClick(`#æ—¥èªŒè¤‡è£½-nav`)" id="æ—¥èªŒè¤‡è£½-nav">
									æ—¥èªŒè¤‡è£½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#base%e7%90%86%e8%ab%96" onclick="onNavClick(`#baseç†è«–-nav`)" id="baseç†è«–-nav">
									BASEç†è«–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e4%ba%8b%e5%8b%99%e5%b9%be%e7%a8%ae%e6%96%b9%e6%a1%88" onclick="onNavClick(`#åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ-nav`)" id="åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ-nav">
									åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#2pc" onclick="onNavClick(`#2pc-nav`)" id="2pc-nav">
									2PC
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#xa-transaction" onclick="onNavClick(`#xa-transaction-nav`)" id="xa-transaction-nav">
									XA Transaction
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#at%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#atæ¨¡å¼-nav`)" id="atæ¨¡å¼-nav">
									ATæ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tcc%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#tccæ¨¡å¼-nav`)" id="tccæ¨¡å¼-nav">
									TCCæ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9c%80%e5%a4%a7%e5%8a%aa%e5%8a%9b%e9%80%9a%e7%9f%a5" onclick="onNavClick(`#æœ€å¤§åŠªåŠ›é€šçŸ¥-nav`)" id="æœ€å¤§åŠªåŠ›é€šçŸ¥-nav">
									æœ€å¤§åŠªåŠ›é€šçŸ¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%af%e9%9d%a0%e6%b6%88%e6%81%af%e6%9c%80%e7%b5%82%e4%b8%80%e8%87%b4%e6%80%a7" onclick="onNavClick(`#å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§-nav`)" id="å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§-nav">
									å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%86%aa%e7%ad%89%e6%80%a7" onclick="onNavClick(`#å†ªç­‰æ€§-nav`)" id="å†ªç­‰æ€§-nav">
									å†ªç­‰æ€§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#token" onclick="onNavClick(`#token-nav`)" id="token-nav">
									Token
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%8e%96" onclick="onNavClick(`#é–-nav`)" id="é–-nav">
									é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%95%b8%e6%93%9a%e5%ba%ab%e6%82%b2%e8%a7%80%e9%8e%96" onclick="onNavClick(`#æ•¸æ“šåº«æ‚²è§€é–-nav`)" id="æ•¸æ“šåº«æ‚²è§€é–-nav">
									æ•¸æ“šåº«æ‚²è§€é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%95%b8%e6%93%9a%e5%ba%ab%e6%a8%82%e8%a7%80%e9%8e%96" onclick="onNavClick(`#æ•¸æ“šåº«æ¨‚è§€é–-nav`)" id="æ•¸æ“šåº«æ¨‚è§€é–-nav">
									æ•¸æ“šåº«æ¨‚è§€é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e9%8e%96" onclick="onNavClick(`#åˆ†ä½ˆå¼é–-nav`)" id="åˆ†ä½ˆå¼é–-nav">
									åˆ†ä½ˆå¼é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%94%af%e4%b8%80%e7%b4%84%e6%9d%9f" onclick="onNavClick(`#å”¯ä¸€ç´„æŸ-nav`)" id="å”¯ä¸€ç´„æŸ-nav">
									å”¯ä¸€ç´„æŸ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%8f%90%e4%ba%a4%e8%a8%82%e5%96%ae" onclick="onNavClick(`#æäº¤è¨‚å–®-nav`)" id="æäº¤è¨‚å–®-nav">
									æäº¤è¨‚å–®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b5%81%e7%a8%8b" onclick="onNavClick(`#æµç¨‹-nav`)" id="æµç¨‹-nav">
									æµç¨‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%a8%8b%e5%bc%8f%e7%a2%bc" onclick="onNavClick(`#ç¨‹å¼ç¢¼-nav`)" id="ç¨‹å¼ç¢¼-nav">
									ç¨‹å¼ç¢¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a4%87%e7%bf%92%e6%9c%ac%e5%9c%b0%e4%ba%8b%e5%8b%99" onclick="onNavClick(`#è¤‡ç¿’æœ¬åœ°äº‹å‹™-nav`)" id="è¤‡ç¿’æœ¬åœ°äº‹å‹™-nav">
									è¤‡ç¿’æœ¬åœ°äº‹å‹™
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#spring%e4%ba%8b%e5%8b%99%e5%8f%83%e6%95%b8" onclick="onNavClick(`#springäº‹å‹™åƒæ•¸-nav`)" id="springäº‹å‹™åƒæ•¸-nav">
									springäº‹å‹™åƒæ•¸
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%ba%8b%e5%8b%99%e5%82%b3%e6%92%ad" onclick="onNavClick(`#äº‹å‹™å‚³æ’­-nav`)" id="äº‹å‹™å‚³æ’­-nav">
									äº‹å‹™å‚³æ’­
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9d%91" onclick="onNavClick(`#å‘-nav`)" id="å‘-nav">
									å‘
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e6%95%a3%e5%bc%8f%e4%ba%a4%e6%98%93" onclick="onNavClick(`#åˆ†æ•£å¼äº¤æ˜“-nav`)" id="åˆ†æ•£å¼äº¤æ˜“-nav">
									åˆ†æ•£å¼äº¤æ˜“
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#cap%e5%ae%9a%e7%90%86" onclick="onNavClick(`#capå®šç†-nav`)" id="capå®šç†-nav">
									CAPå®šç†
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#raft%e7%ae%97%e6%b3%95" onclick="onNavClick(`#raftç®—æ³•-nav`)" id="raftç®—æ³•-nav">
									raftç®—æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%a0%98%e5%b0%8e%e9%81%b8%e8%88%89" onclick="onNavClick(`#é ˜å°é¸èˆ‰-nav`)" id="é ˜å°é¸èˆ‰-nav">
									é ˜å°é¸èˆ‰
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%97%a5%e8%aa%8c%e8%a4%87%e8%a3%bd" onclick="onNavClick(`#æ—¥èªŒè¤‡è£½-nav`)" id="æ—¥èªŒè¤‡è£½-nav">
									æ—¥èªŒè¤‡è£½
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#base%e7%90%86%e8%ab%96" onclick="onNavClick(`#baseç†è«–-nav`)" id="baseç†è«–-nav">
									BASEç†è«–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%86%e4%bd%88%e5%bc%8f%e4%ba%8b%e5%8b%99%e5%b9%be%e7%a8%ae%e6%96%b9%e6%a1%88" onclick="onNavClick(`#åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ-nav`)" id="åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ-nav">
									åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#2pc" onclick="onNavClick(`#2pc-nav`)" id="2pc-nav">
									2PC
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#xa-transaction" onclick="onNavClick(`#xa-transaction-nav`)" id="xa-transaction-nav">
									XA Transaction
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#at%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#atæ¨¡å¼-nav`)" id="atæ¨¡å¼-nav">
									ATæ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#tcc%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#tccæ¨¡å¼-nav`)" id="tccæ¨¡å¼-nav">
									TCCæ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9c%80%e5%a4%a7%e5%8a%aa%e5%8a%9b%e9%80%9a%e7%9f%a5" onclick="onNavClick(`#æœ€å¤§åŠªåŠ›é€šçŸ¥-nav`)" id="æœ€å¤§åŠªåŠ›é€šçŸ¥-nav">
									æœ€å¤§åŠªåŠ›é€šçŸ¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8f%af%e9%9d%a0%e6%b6%88%e6%81%af%e6%9c%80%e7%b5%82%e4%b8%80%e8%87%b4%e6%80%a7" onclick="onNavClick(`#å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§-nav`)" id="å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§-nav">
									å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/gulimall.png')"
                    
                
            >
                <div class="post-title">
                    æäº¤è¨‚å–®: å†ªç­‰æ€§ã€åˆ†æ•£å¼äº¤æ˜“çš„ä¸€è‡´æ€§
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-20
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-02-06 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">Java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="å†ªç­‰æ€§">å†ªç­‰æ€§</h1>
<blockquote>
<p>idempotent</p>
</blockquote>
<ul>
<li>å¤šæ¬¡æäº¤ï¼Œçµæœä¸è®Šï¼Œå¸¸è¦‹æœ‰é€™äº›è¾¦æ³•:</li>
</ul>
<h3 id="token">Token</h3>
<ul>
<li>ä»¤ç‰Œæˆ–é©—è­‰ç¢¼</li>
<li>ä¼ºæœå™¨å­˜å„²äº†ä¸€å€‹ä»¤ç‰Œï¼Œç„¶å¾Œé é¢è¦å¸¶ä¸Šé€™å€‹ä»¤ç‰Œæ¯”è¼ƒï¼Œä¸€æ¨£æ‰å¯ä»¥æäº¤
<ul>
<li>æäº¤å¾Œåˆªé™¤æ‰tokenï¼Œå†æ¬¡é»æ“Šæäº¤å°±æœƒå¤±æ•—</li>
<li>ä½†æ˜¯F5åˆ·æ–°çš„è©±å°±ä¸ä¸€æ¨£äº†ï¼Œæœƒæœ‰æ–°çš„tokenç”¢ç”Ÿ</li>
</ul>
</li>
<li>æ³¨æ„: ç²å–redisä»¤ç‰Œ + ä»¤ç‰ŒåŒ¹é… + redisåˆªé™¤ï¼Œå…¨ç¨‹è¦ä¿è­‰åŸå­æ€§ï¼Œä½¿ç”¨luaè…³æœ¬</li>
</ul>
<h3 id="é–">é–</h3>
<h4 id="æ•¸æ“šåº«æ‚²è§€é–">æ•¸æ“šåº«æ‚²è§€é–</h4>
<blockquote>
<p>Pessimistic Lock</p>
</blockquote>
<ul>
<li>å°±æ˜¯æ’ä»–é–ï¼Œæ‰€è¬‚æ‚²è§€åœ¨æ–¼è¦ºå¾—ç¸½æœ‰åˆæ°‘æƒ³äº‚ææˆ‘çš„dataï¼Œæ‰€ä»¥è‡ªå·±æ‹¿åˆ°é–å°±æŠŠdataè—åˆ°å¤§è¡£è£¡ï¼Œå®Œå…¨ä¸çµ¦å…¶ä»–äººç”¨ï¼Œé€£çœ‹éƒ½ä¸çµ¦çœ‹</li>
<li>ç•¶ä¸€å€‹SQL commandç²å¾—æ‚²è§€é–å¾Œï¼Œå…¶ä»–çš„SQL command ç„¡æ³•è®€å–ç„¡æ³•ä¿®æ”¹ï¼Œç›´åˆ°æ‚²è§€é–è¢«é‡‹æ”¾å¾Œæ‰èƒ½åŸ·è¡Œï¼Œä¾‹å¦‚:</li>
</ul>
<pre tabindex="0"><code>select* from xxx where id = 1 for update;
</code></pre><ul>
<li>æ‚²è§€é–ä½¿ç”¨æ™‚ä¸€èˆ¬ä¼´éš¨äº‹å‹™ä¸€èµ·ä½¿ç”¨ï¼Œæ•¸æ“šé–å®šæ™‚é–“å¯èƒ½æœƒå¾ˆé•·ï¼Œéœ€è¦æ ¹æ“šå¯¦éš›æƒ…æ³é¸ç”¨</li>
<li>å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œidå­—æ®µä¸€å®šæ˜¯ä¸»éµæˆ–è€…å”¯ä¸€ç´¢å¼•ï¼Œä¸ç„¶å¯èƒ½é€ æˆé–è¡¨çš„çµæœï¼Œè™•ç†èµ·ä¾†æœƒéå¸¸éº»ç…©</li>
<li>è³‡æ–™åº«ä¸­çš„è¡Œé–ï¼Œè¡¨é–ï¼Œè®€é–ï¼Œå¯«é–ï¼Œä»¥åŠsyncronizedå¯¦ç¾çš„é–å‡ç‚ºæ‚²è§€é–</li>
</ul>
<h4 id="æ•¸æ“šåº«æ¨‚è§€é–">æ•¸æ“šåº«æ¨‚è§€é–</h4>
<blockquote>
<p>Optimistic Lock</p>
</blockquote>
<ul>
<li>å…è¨±å¤šå€‹ SQL command ä¾†æ“ä½œ tableï¼Œä½†æ˜¯è¦å¸¶ä¸Šç‰ˆæœ¬è™Ÿ</li>
<li>ç•¶ SQL command æƒ³è¦è®Šæ›´æ¬„ä½ data æ™‚æœƒå…ˆæŠŠä¹‹å‰å–å‡º version è·Ÿ table ç¾åœ¨çš„ version åšå°æ¯”ï¼Œå¦‚æœç›¸åŒå°±ä»£è¡¨é€™æ®µæœŸé–“æ²’äººä¿®æ”¹å¯ä»¥åŸ·è¡Œï¼›å¦‚æœä¸åŒå°±æœƒç¦æ­¢é€™æ¬¡çš„æ“ä½œ</li>
<li>é€™ç¨®æ–¹æ³•é©åˆåœ¨æ›´æ–°çš„å ´æ™¯ä¸­ï¼Œä¾‹å¦‚:</li>
</ul>
<pre tabindex="0"><code>update t_goods set count = count-1,version =version + 1 where good_id=2 and version = 1
</code></pre><ul>
<li>æ¨‚è§€é–ä¸»è¦ä½¿ç”¨æ–¼è™•ç†è®€å¤šå¯«å°‘çš„å ´æ™¯</li>
</ul>
<h4 id="åˆ†ä½ˆå¼é–">åˆ†ä½ˆå¼é–</h4>
<ul>
<li>ä¸ç®¡å¤šå°‘æœå‹™ï¼Œé™åˆ¶åŒæ™‚éƒ½åªæœ‰ä¸€äººèƒ½æ“ä½œ</li>
<li>åƒè€ƒä¹‹å‰çš„ç­†è¨˜: <a href="https://yoziming.github.io/post/220128-gulimall-11-synchronized-lock/">https://yoziming.github.io/post/220128-gulimall-11-synchronized-lock/</a></li>
</ul>
<h3 id="å”¯ä¸€ç´„æŸ">å”¯ä¸€ç´„æŸ</h3>
<ul>
<li>åˆ©ç”¨è³‡æ–™åº«<code>UNIQUE</code>å”¯ä¸€ç´„æŸè¨‚å–®è™Ÿï¼Œå°±ç„¡æ³•ç”ŸæˆåŒæ¨£è¨‚å–®</li>
<li>æˆ–æ˜¯å»ºç«‹ä¸€å€‹é˜²é‡è¡¨ï¼Œè¦æ“ä½œæ™‚å°±åœ¨é˜²é‡è¡¨æ’å…¥ä¾‹å¦‚è¨‚å–®è™Ÿï¼Œæ’å…¥æˆåŠŸæ‰å¯ä»¥æ“ä½œï¼Œæ’å…¥å¤±æ•—è¡¨ç¤ºæœ‰åˆ¥äººæ­£åœ¨æ“ä½œé€™ç­†è¨‚å–®
<ul>
<li>ä¸æ¡ç”¨ï¼ŒDBæ…¢</li>
</ul>
</li>
<li>redis seté˜²é‡: å…¨å±€è«‹æ±‚å”¯ä¸€id	èª¿ç”¨æ¥å£æ™‚ç”Ÿæˆä¸€å€‹å”¯ä¸€IDï¼Œrediså°‡æ•¸æ“šä¿å­˜åˆ°seté›†åˆä¸­(ç‰¹æ€§æ˜¯ä¸å¯é‡è¤‡)ï¼Œå­˜åœ¨å³è™•ç†é</li>
<li>å¯ä»¥ä½¿ç”¨nginxè¨­ç½®æ¯ä¸€å€‹è«‹æ±‚çš„å”¯ä¸€id</li>
</ul>
<pre tabindex="0"><code>proxy_set_header X-Request-ld $request_id;
</code></pre><h1 id="æäº¤è¨‚å–®">æäº¤è¨‚å–®</h1>
<p><img src="1598753060984.png" alt="1598753060984"></p>
<p><img src="1598753078504.png" alt="1598753078504"></p>
<p><img src="1598753128441.png" alt="1598753128441"></p>
<p><img src="1598757953664.png" alt="1598757953664"></p>
<h2 id="æµç¨‹">æµç¨‹</h2>
<ul>
<li>å‰ç«¯POSTæäº¤: OrderSubmitVo</li>
<li>API: /submitOrder</li>
<li>ä¸‹å–®æˆåŠŸè½‰ç™¼æ”¯ä»˜é  pay.html</li>
<li>ä¸‹å–®å¤±æ•—é‡å®šå‘è·³è½‰ confirm.html é‡æ–°æŸ¥ä¸€é</li>
<li>serviceä¸‹å–®æµç¨‹ï¼š
<ul>
<li>é©—ä»¤ç‰ŒåŸå­æ“ä½œï¼šæŸ¥è©¢ï¼Œæ¯”è¼ƒï¼Œåˆªé™¤ï¼ˆluaæ“ä½œï¼‰</li>
<li>å‰µå»ºè¨‚å–®å°è£Entityï¼Œç„¶å¾Œå…¥åº«</li>
<li>ç²å–é‡‘é¡ï¼Œé‹è²»é ç¨‹èª¿ç”¨wareæœå‹™&hellip;</li>
<li>é©—åƒ¹æ ¼ï¼Œè¨ˆç®—çš„æ‡‰ä»˜åƒ¹æ ¼-æäº¤çš„æ‡‰ä»˜åƒ¹æ ¼&lt;0.01é€šéï¼Œå¦å‰‡ return</li>
<li>é–åº«å­˜WareSkuLockVoï¼Œé ç¨‹èª¿ç”¨ware</li>
</ul>
</li>
</ul>
<h2 id="ç¨‹å¼ç¢¼">ç¨‹å¼ç¢¼</h2>
<blockquote>
<p>è¶…ç´šç¹ç‘£å°±åˆ—å€‹å¤§æ¦‚ï¼Œé‡é»åœ¨æ–¼åˆ†ä½ˆå¼äº‹å‹™</p>
</blockquote>
<ul>
<li>OrderWebController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// ä¸‹å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@PostMapping</span>(value = <span style="color:#cd5555">&#34;/submitOrder&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">submitOrder</span>(OrderSubmitVo vo, Model model, RedirectAttributes attributes) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        SubmitOrderResponseVo responseVo = orderService.<span style="color:#658b00">submitOrder</span>(vo);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//ä¸‹å–®æˆåŠŸä¾†åˆ°æ”¯ä»˜é¸æ“‡é 
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">//ä¸‹å–®å¤±æ•—å›åˆ°è¨‚å–®ç¢ºèªé é‡æ–°ç¢ºå®šè¨‚å–®ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (responseVo.<span style="color:#658b00">getCode</span>() == <span style="color:#b452cd">0</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">//æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            model.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;submitOrderResp&#34;</span>, responseVo);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;pay&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            String msg = <span style="color:#cd5555">&#34;ä¸‹å–®å¤±æ•—&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">switch</span> (responseVo.<span style="color:#658b00">getCode</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#b452cd">1</span>:
</span></span><span style="display:flex;"><span>                    msg += <span style="color:#cd5555">&#34;ä»¤ç‰Œè¨‚å–®ä¿¡æ¯éæœŸï¼Œè«‹åˆ·æ–°å†æ¬¡æäº¤&#34;</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#8b008b;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#b452cd">2</span>:
</span></span><span style="display:flex;"><span>                    msg += <span style="color:#cd5555">&#34;è¨‚å–®å•†å“åƒ¹æ ¼ç™¼ç”Ÿè®ŠåŒ–ï¼Œè«‹ç¢ºèªåå†æ¬¡æäº¤&#34;</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#8b008b;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">case</span> <span style="color:#b452cd">3</span>:
</span></span><span style="display:flex;"><span>                    msg += <span style="color:#cd5555">&#34;åº«å­˜é–å®šå¤±æ•—ï¼Œå•†å“åº«å­˜ä¸è¶³&#34;</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#8b008b;font-weight:bold">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            attributes.<span style="color:#658b00">addFlashAttribute</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, msg);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://order.mall.com/toTrade&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (e <span style="color:#8b008b;font-weight:bold">instanceof</span> NoStockException) {
</span></span><span style="display:flex;"><span>            String message = ((NoStockException) e).<span style="color:#658b00">getMessage</span>();
</span></span><span style="display:flex;"><span>            attributes.<span style="color:#658b00">addFlashAttribute</span>(<span style="color:#cd5555">&#34;msg&#34;</span>, message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://order.mall.com/toTrade&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>OrderServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * æäº¤è¨‚å–®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param vo
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> SubmitOrderResponseVo <span style="color:#008b45">submitOrder</span>(OrderSubmitVo vo) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    confirmVoThreadLocal.<span style="color:#658b00">set</span>(vo);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ä¸‹å–®å¾Œæº–å‚™è¿”å›çš„çµæœ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SubmitOrderResponseVo responseVo = <span style="color:#8b008b;font-weight:bold">new</span> SubmitOrderResponseVo();
</span></span><span style="display:flex;"><span>    responseVo.<span style="color:#658b00">setCode</span>(<span style="color:#b452cd">0</span>); <span style="color:#228b22">// é è¨­è¿”å›0æ˜¯æˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// ç²å–ç•¶å‰ç”¨æˆ¶ç™»å…¥çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    MemberResponseTo memberResponseTo = LoginUserInterceptor.<span style="color:#658b00">loginUser</span>.<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// é©—è­‰ä»¤ç‰Œæ˜¯å¦åˆæ³•ï¼Œä»¤ç‰Œçš„å°æ¯”å’Œåˆªé™¤å¿…é ˆä¿è­‰åŸå­æ€§ï¼ŒLUAè…³æœ¬
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    String script = <span style="color:#cd5555">&#34;if redis.call(&#39;get&#39;, KEYS[1]) == ARGV[1] then return redis.call(&#39;del&#39;, KEYS[1]) else return &#34;</span> +
</span></span><span style="display:flex;"><span>            <span style="color:#cd5555">&#34;0 end&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ‹¿å‰ç«¯å‚³ä¾†çš„token
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    String orderToken = vo.<span style="color:#658b00">getOrderToken</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// é€šéè…³æœ¬åŸå­é©—è­‰ä»¤ç‰Œå’Œåˆªé™¤ä»¤ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Long result = redisTemplate.<span style="color:#658b00">execute</span>(<span style="color:#8b008b;font-weight:bold">new</span> DefaultRedisScript&lt;Long&gt;(script, Long.<span style="color:#658b00">class</span>),
</span></span><span style="display:flex;"><span>            Arrays.<span style="color:#658b00">asList</span>(USER_ORDER_TOKEN_PREFIX + memberResponseTo.<span style="color:#658b00">getId</span>()),
</span></span><span style="display:flex;"><span>            orderToken);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è‹¥ä»¤ç‰Œé©—è­‰å¤±æ•—ï¼Œæ³¨æ„è…³æœ¬0æ˜¯å¤±æ•—ï¼Œè·Ÿå‰é¢SubmitOrderResponseVo 0=æˆåŠŸç›¸å
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (result == <span style="color:#b452cd">0</span>L) {
</span></span><span style="display:flex;"><span>        responseVo.<span style="color:#658b00">setCode</span>(<span style="color:#b452cd">1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> responseVo;
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ä»¤ç‰Œé©—è­‰æˆåŠŸï¼Œå‰µå»ºã€ä¸‹è¨‚å–®ã€é©—ä»¤ç‰Œã€é©—åƒ¹æ ¼ã€é–å®šåº«å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">// 1ã€å‰µå»ºè¨‚å–®ã€è¨‚å–®é …ç­‰ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        OrderCreateTo order = createOrder();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// 2ã€é©—è­‰åƒ¹æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        BigDecimal payAmount = order.<span style="color:#658b00">getOrder</span>().<span style="color:#658b00">getPayAmount</span>();
</span></span><span style="display:flex;"><span>        BigDecimal payPrice = vo.<span style="color:#658b00">getPayPrice</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (Math.<span style="color:#658b00">abs</span>(payAmount.<span style="color:#658b00">subtract</span>(payPrice).<span style="color:#658b00">doubleValue</span>()) &lt; <span style="color:#b452cd">0.01</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// é‡‘é¡å°æ¯”ï¼Œä¿å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            saveOrder(order);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// 4ã€åº«å­˜é–å®š,åªè¦æœ‰ç•°å¸¸ï¼Œå›æ»¾è¨‚å–®æ•¸æ“š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// è¨‚å–®è™Ÿã€æ‰€æœ‰è¨‚å–®é …ä¿¡æ¯(skuId,skuNum,skuName)
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            WareSkuLockTo lockVo = <span style="color:#8b008b;font-weight:bold">new</span> WareSkuLockTo();
</span></span><span style="display:flex;"><span>            lockVo.<span style="color:#658b00">setOrderSn</span>(order.<span style="color:#658b00">getOrder</span>().<span style="color:#658b00">getOrderSn</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// ç²å–å‡ºè¦é–å®šçš„å•†å“æ•¸æ“šä¿¡æ¯ã€orderè£¡é¢å­˜å„²çš„æ˜¯Entityã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            List&lt;OrderItemTo&gt; orderItemTos = order.<span style="color:#658b00">getOrderItems</span>().<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>((item) -&gt; {
</span></span><span style="display:flex;"><span>                OrderItemTo orderItemTo = <span style="color:#8b008b;font-weight:bold">new</span> OrderItemTo();
</span></span><span style="display:flex;"><span>                orderItemTo.<span style="color:#658b00">setSkuId</span>(item.<span style="color:#658b00">getSkuId</span>());
</span></span><span style="display:flex;"><span>                orderItemTo.<span style="color:#658b00">setCount</span>(item.<span style="color:#658b00">getSkuQuantity</span>());
</span></span><span style="display:flex;"><span>                orderItemTo.<span style="color:#658b00">setTitle</span>(item.<span style="color:#658b00">getSkuName</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">return</span> orderItemTo;
</span></span><span style="display:flex;"><span>            }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>            lockVo.<span style="color:#658b00">setLocks</span>(orderItemTos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// å‡ºç¾çš„å•é¡Œï¼šæ‰£æ¸›åº«å­˜æˆåŠŸäº†ï¼Œä½†æ˜¯ç”±æ–¼ç¶²çµ¡åŸå› è¶…æ™‚ï¼Œå‡ºç¾ç•°å¸¸ï¼Œå°è‡´è¨‚å–®äº‹å‹™å›æ»¾ï¼Œåº«å­˜äº‹å‹™ä¸å›æ»¾(è§£æ±ºæ–¹æ¡ˆï¼šseata)
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// ç‚ºäº†ä¿è­‰é«˜ä½µç™¼ï¼Œä¸æ¨è–¦ä½¿ç”¨seataï¼Œå› ç‚ºæ˜¯åŠ é–ï¼Œå¹¶è¡ŒåŒ–ï¼Œæå‡ä¸äº†æ•ˆç‡,å¯ä»¥ç™¼æ¶ˆæ¯çµ¦åº«å­˜æœå‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            R r = wareFeignService.<span style="color:#658b00">orderLockStock</span>(lockVo);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (r.<span style="color:#658b00">getCode</span>() == <span style="color:#b452cd">0</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">// é–å®šæˆåŠŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                responseVo.<span style="color:#658b00">setOrder</span>(order.<span style="color:#658b00">getOrder</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">//int i = 10/0;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                <span style="color:#228b22">// è¨‚å–®å‰µå»ºæˆåŠŸï¼Œç™¼é€æ¶ˆæ¯çµ¦MQ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                rabbitTemplate.<span style="color:#658b00">convertAndSend</span>(<span style="color:#cd5555">&#34;order-event-exchange&#34;</span>, <span style="color:#cd5555">&#34;order.create.order&#34;</span>, order.<span style="color:#658b00">getOrder</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">// åˆªé™¤è³¼ç‰©è»Šè£¡çš„æ•¸æ“š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                redisTemplate.<span style="color:#658b00">delete</span>(CART_PREFIX + memberResponseTo.<span style="color:#658b00">getId</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">return</span> responseVo;
</span></span><span style="display:flex;"><span>            } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">//é–å®šå¤±æ•—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                String msg = (String) r.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;msg&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> NoStockException(msg);
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">// responseVo.setCode(3);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                <span style="color:#228b22">// return responseVo;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            responseVo.<span style="color:#658b00">setCode</span>(<span style="color:#b452cd">2</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> responseVo;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="è¤‡ç¿’æœ¬åœ°äº‹å‹™">è¤‡ç¿’æœ¬åœ°äº‹å‹™</h1>
<blockquote>
<p>åƒè€ƒ: <a href="https://yoziming.github.io/post/211230-agg-jdbc-02/">https://yoziming.github.io/post/211230-agg-jdbc-02/</a></p>
</blockquote>
<ul>
<li>åŸç†: é€£åˆ°SQLçš„æ˜¯åŒä¸€æ¢é€£çµï¼Œå¤šå€‹æ“ä½œå®Œæˆå¾Œç”¨<code>commit()</code>æ‰‹å‹•æäº¤ï¼Œå¦å‰‡æŠ“åˆ°ç•°å¸¸å°±<code>rollback()</code>
<ul>
<li>è¦å˜›å…¨éƒ¨æˆåŠŸã€è¦å˜›å…¨éƒ¨å¤±æ•—</li>
</ul>
</li>
<li>éš”é›¢ç´šåˆ¥: è®€æœªæäº¤ã€è®€å·²æäº¤ã€å¯é‡è¤‡è®€ã€åºåˆ—åŒ–ï¼Œè¶Šåš´æ ¼è¶Šå®‰å…¨ä½†æ•ˆç‡ä¹Ÿå°±è¶Šä½
<ul>
<li>MySQLé è¨­çš„äº‹å‹™éš”é›¢ç´šåˆ¥ç‚º: Repeatable read</li>
</ul>
</li>
<li>Springå°è£æˆ<code>@Transactional</code></li>
</ul>
<h3 id="springäº‹å‹™åƒæ•¸">springäº‹å‹™åƒæ•¸</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// ä¿®æ”¹äº‹å‹™éš”é›¢ç´šåˆ¥
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Transactional</span>(isolation = Isolation.<span style="color:#658b00">REPEATABLE</span> READ)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">// ä¿®æ”¹å‚³æ’­ç´šåˆ¥
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Transactional</span>(propagation = Propagation.<span style="color:#658b00">REQUIRED</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">// è¨­å®šè¶…æ™‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#707a7c">@Transactional</span>(timeout = <span style="color:#b452cd">30</span>)
</span></span></code></pre></div><h4 id="äº‹å‹™å‚³æ’­">äº‹å‹™å‚³æ’­</h4>
<blockquote>
<p>ç•¶äº‹å‹™çš„æ–¹æ³•è¢«åµŒå¥—æ™‚ï¼Œä¾‹å¦‚ä¸€å€‹äº‹å‹™æ–¹æ³•è¢«å¦ä¸€å€‹äº‹å‹™æ–¹æ³•èª¿ç”¨æ™‚ï¼Œé€™å€‹äº‹å‹™æ–¹æ³•æ‡‰è©²å¦‚ä½•é€²è¡Œ</p>
</blockquote>
<ul>
<li><code>PROPAGATION_REQUIRED</code>: å¦‚æœç•¶å‰æ²’æœ‰äº‹å‹™ï¼Œå°±å‰µå»ºä¸€å€‹æ–°äº‹å‹™ï¼Œå¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå°±åŠ å…¥è©²äº‹å‹™ã€‚æ˜¯æœ€å¸¸ç”¨çš„è¨­ç½®</li>
<li><code>PROPAGATION_SUPPORTS</code>: æ”¯æŒç•¶å‰äº‹å‹™ï¼Œå¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå°±åŠ å…¥è©²äº‹å‹™ï¼Œå¦‚æœç•¶å‰ä¸å­˜åœ¨äº‹å‹™ï¼Œå°±ä»¥éäº‹å‹™åŸ·è¡Œ</li>
<li><code>PROPAGATION_MANDATORY</code>: æ”¯æŒç•¶å‰äº‹å‹™ï¼Œå¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå°±åŠ å…¥è©²äº‹å‹™ï¼Œå¦‚æœç•¶å‰ä¸å­˜åœ¨äº‹å‹™ï¼Œå°±æ‹‹å‡ºç•°å¸¸</li>
<li><code>PROPAGATION_REQUIRES_NEW</code>: å‰µå»ºæ–°äº‹å‹™ï¼Œç„¡è«–ç•¶å‰å­˜ä¸å­˜åœ¨äº‹å‹™ï¼Œéƒ½å‰µå»ºæ–°äº‹å‹™</li>
<li><code>PROPAGATION_NOT_SUPPORTED</code>: ä»¥éäº‹å‹™æ–¹å¼åŸ·è¡Œæ“ä½œï¼Œå¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå°±æŠŠç•¶å‰äº‹å‹™æ›èµ·</li>
<li><code>PROPAGATION_NEVER</code>: ä»¥éäº‹å‹™æ–¹å¼åŸ·è¡Œï¼Œå¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå‰‡æ‹‹å‡ºç•°å¸¸</li>
<li><code>PROPAGATION_NESTED</code>: å¦‚æœç•¶å‰å­˜åœ¨äº‹å‹™ï¼Œå‰‡åœ¨åµŒå¥—äº‹å‹™å…§åŸ·è¡Œã€‚å¦‚æœç•¶å‰æ²’æœ‰äº‹å‹™ï¼Œå‰‡åŸ·è¡Œèˆ‡ PROPAGATON_REQUIREDé¡ä¼¼çš„æ“ä½œ</li>
<li>é‡é»: REQUIREDã€REQUIRES_NEW</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">æ¡ˆä¾‹ï¼š</span>b<span style="color:#a61717;background-color:#e3d2d2">ã€</span>c<span style="color:#a61717;background-color:#e3d2d2">èˆ‡</span>a<span style="color:#a61717;background-color:#e3d2d2">æ–¹æ³•æ˜¯å¦å…±ç”¨ä¸€å€‹äº‹å‹™</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(timeout=<span style="color:#b452cd">30</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">a</span>() {
</span></span><span style="display:flex;"><span>	b();<span style="color:#228b22">// aäº‹å‹™å‚³æ’­çµ¦äº†bäº‹å‹™ï¼Œä¸¦ä¸”bäº‹å‹™çš„è¨­ç½®å¤±æ•ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>	c();<span style="color:#228b22">// cå–®ç¨å‰µå»ºä¸€å€‹æ–°äº‹å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(propagation = Propagation.<span style="color:#658b00">REQUIRED</span>, timeout=<span style="color:#b452cd">2</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">b</span>() {
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>(propagation = Propagation.<span style="color:#658b00">REQUIRES_NEW</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">c</span>() {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="å‘">å‘</h4>
<ul>
<li>å¦‚æœæ–¹æ³•aã€bã€céƒ½åœ¨åŒä¸€å€‹serviceè£é¢ï¼Œäº‹å‹™å‚³æ’­è¡Œç‚ºä¸ç”Ÿæ•ˆï¼Œå…±äº«açš„äº‹å‹™</li>
<li>åŸç†: äº‹å‹™æ˜¯ç”¨ä»£ç†å°è±¡ä¾†æ§åˆ¶çš„ï¼Œå…§éƒ¨èª¿ç”¨b()ã€c()å°±ç›¸ç•¶æ–¼ç›´æ¥èª¿ç”¨æ²’æœ‰ç¶“éäº‹å‹™ï¼Œç¹éäº†ä»£ç†å°è±¡</li>
<li>è§£æ±º: ä½¿ç”¨aspectJä»£ç†ï¼Œæˆ–æ˜¯æ³¨å…¥è‡ªå·±(Springå·²ç¶“è§£æ±ºäº†å¾ªç’°ä¾è³´å•é¡Œï¼Œé€éä¸‰ç´šMap)</li>
</ul>
<h1 id="åˆ†æ•£å¼äº¤æ˜“">åˆ†æ•£å¼äº¤æ˜“</h1>
<blockquote>
<p>Distributed Transactionsï¼Œä¸­åœ‹ç¨±ç‚ºåˆ†ä½ˆå¼äº‹å‹™</p>
</blockquote>
<ul>
<li>åˆ†ä½ˆå¼äº‹å‹™ä¸å¯ç”¨æ‹‹ç•°å¸¸çš„æ–¹å¼å›æ»¾ï¼Œå› ç‚ºç•°å¸¸å¯èƒ½æ˜¯é ç¨‹èª¿ç”¨ç”¢ç”Ÿçš„ç•°å¸¸
<ul>
<li>ä¾‹å¦‚é ç¨‹å·²ç¶“èª¿ç”¨å®Œäº†ï¼Œä½†è¿”å›æ™‚å‡ºç¾ç¶²è·¯æ•…éšœï¼Œæœ¬åœ°<code>@Transactional</code>æ”¶åˆ°ç•°å¸¸å°±ç®—å›æ»¾ä¹Ÿæ²’ç”¨ï¼Œå› ç‚ºå®ƒå¯ç®¡ä¸åˆ°é ç¨‹çš„é‚£äº›</li>
</ul>
</li>
</ul>
<h2 id="capå®šç†">CAPå®šç†</h2>
<blockquote>
<p>åˆç¨±CAPåŸå‰‡ï¼ŒæŒ‡çš„æ˜¯åœ¨åˆ†ä½ˆå¼ç³»çµ±ä¸­çš„è³‡æ–™ï¼Œè¦å˜›çŠ§ç‰²ä¸€è‡´æ€§ï¼Œè¦å˜›çŠ§ç‰²å¯ç”¨æ€§</p>
</blockquote>
<p><img src="image-20220130155516174.png" alt="image-20220130155516174"></p>
<ul>
<li>
<p>Consistency ä¸€è‡´æ€§: åœ¨åˆ†ä½ˆå¼ç³»çµ±ä¸­çš„æ‰€æœ‰æ•¸æ“šï¼Œåœ¨åŒä¸€æ™‚åˆ»æ˜¯å¦åŒæ¨£çš„å€¼</p>
</li>
<li>
<p>Availability å¯ç”¨æ€§: é›†ç¾¤å…§ä¸€éƒ¨ä»½æ©Ÿå™¨ç¶²çµ¡é€šä¿¡æ•…éšœï¼Œæ˜¯å¦é‚„èƒ½ç¹¼çºŒå·¥ä½œ(æ•¸æ“šçš„åˆ†å¸ƒé‡æ˜¯å¦å¤ å¤š)</p>
<ul>
<li>ç‚ºäº†åˆ†å€å®¹éŒ¯æ€§ï¼Œä¸€è‡´æ€§è·Ÿå¯ç”¨æ€§åªèƒ½äºŒé¸ä¸€</li>
</ul>
</li>
<li>
<p>Partition tolerance åˆ†å€å®¹éŒ¯æ€§: åˆ†ä½ˆå¼ç³»çµ±ç¸½æœƒå‡ºç¾ç¶²çµ¡æ•…éšœï¼Œç•¶ç¯€é»ä¹‹é–“ä¸æµé€šçš„æ™‚å€™å°±å½¢æˆåˆ†å€(Partition)</p>
<ul>
<li>åˆ†å€å®¹éŒ¯çš„æ„æ€æ˜¯ï¼Œç•¶ä½ ä¸€å€‹è³‡æ–™é …ç›®åªåœ¨ä¸€å€‹ç¯€é»ä¸­ä¿å­˜ï¼Œé‚£éº¼åˆ†å€å‡ºç¾å¾Œï¼Œå’Œé€™å€‹ç¯€é»ä¸é€£é€šçš„éƒ¨åˆ†å°±è¨ªå•ä¸åˆ°é€™å€‹è³‡æ–™äº†ã€‚é€™æ™‚åˆ†å€å°±æ˜¯ç„¡æ³•å®¹å¿çš„</li>
<li>æé«˜åˆ†å€å®¹å¿æ€§çš„è¾¦æ³•å°±æ˜¯ä¸€å€‹è³‡æ–™é …ç›®è¤‡è£½åˆ°å¤šå€‹ç¯€é»ä¸Šï¼Œé€™ä¸€è³‡æ–™é …ç›®å°±å¯èƒ½åˆ†ä½ˆåˆ°å„å€‹å€è£¡ã€‚å®¹å¿æ€§å°±æé«˜äº†ã€‚</li>
<li>ç„¶è€Œï¼Œè¦æŠŠè³‡æ–™è¤‡è£½åˆ°å¤šå€‹ç¯€é»ï¼Œå°±æœƒå¸¶ä¾†ä¸€è‡´æ€§çš„å•é¡Œï¼Œå°±æ˜¯å¤šå€‹ç¯€é»ä¸Šé¢çš„è³‡æ–™å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚è¦ä¿è­‰ä¸€è‡´ï¼Œæ¯æ¬¡å¯«æ“ä½œå°±éƒ½è¦ç­‰å¾…å…¨éƒ¨ç¯€é»å¯«æˆåŠŸï¼Œè€Œé€™ç­‰å¾…åˆæœƒå¸¶ä¾†å¯ç”¨æ€§çš„å•é¡Œ</li>
<li>ç¸½çš„ä¾†èªªå°±æ˜¯ï¼Œè³‡æ–™å­˜åœ¨çš„ç¯€é»è¶Šå¤šï¼Œåˆ†å€å®¹å¿æ€§è¶Šé«˜ï¼Œä½†è¦è¤‡è£½æ›´æ–°çš„è³‡æ–™å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šé›£ä¿è­‰ã€‚ç‚ºäº†ä¿è­‰ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰ç¯€é»è³‡æ–™æ‰€éœ€è¦çš„æ™‚é–“å°±è¶Šé•·ï¼Œå¯ç”¨æ€§å°±æœƒé™ä½</li>
</ul>
</li>
<li>
<p>ç‚ºäº†åœ¨åˆ†å¸ƒå¼ç³»çµ±å¯¦ç¾ä¸€è‡´æ€§ï¼ŒLesile Lamportæå‡ºäº†Paxoså”è­°</p>
<ul>
<li>å¾ˆé›£æ‡‚åˆé›£ç”¨ï¼Œå·²éæ™‚ã€‚ç”±raftç®—æ³•æ¥æ£’</li>
</ul>
</li>
</ul>
<h3 id="raftç®—æ³•">raftç®—æ³•</h3>
<blockquote>
<p>ä¿è­‰åˆ†å¸ƒå¼ç³»çµ±ä¸­è³‡æ–™çš„ä¸€è‡´æ€§</p>
</blockquote>
<ul>
<li>æ¼”ç¤º: <a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></li>
<li>æ ¸å¿ƒè§€å¿µ: é ˜å°é¸èˆ‰ã€æ—¥èªŒè¤‡è£½</li>
</ul>
<h4 id="é ˜å°é¸èˆ‰">é ˜å°é¸èˆ‰</h4>
<ul>
<li>
<p>ç¯€é»å•“å‹•é è¨­éƒ½æ˜¯éš¨å¾ç‹€æ…‹</p>
</li>
<li>
<p>ç¯€é»å¦‚æœæ²’æœ‰ç›£è½åˆ°é ˜å°è€…å‘½ä»¤è‡ªå·±(æ‰¾ä¸åˆ°å¤§å“¥ï¼Œå½¢æˆåˆ†å€äº†)ï¼Œå°±è½‰è®Šæˆå€™é¸è€…ï¼Œç¶“éå¤šè¼ªæŠ•ç¥¨ç”¢ç”Ÿæ–°é ˜å°</p>
<ul>
<li>é¸èˆ‰è¶…æ™‚: election timeout éš¨å¾è®Šæˆå€™é¸è€…çš„æ™‚é–“ï¼Œ150ms and 300mséš¨æ©Ÿçš„</li>
</ul>
</li>
</ul>
<h4 id="æ—¥èªŒè¤‡è£½">æ—¥èªŒè¤‡è£½</h4>
<ul>
<li>å®¢æˆ·ç«¯é€šçŸ¥é ˜å°ä¿®æ”¹ä¸€å€‹æ•¸æ“šï¼Œé ˜å°å…ˆå‰µå»ºä¸€å€‹ç¯€é»æ—¥èªŒ</li>
<li>é ˜å°å°‡é€™æ¢æ—¥èªŒ ç™¼é€çµ¦æ‰€æœ‰æ‰€æœ‰éš¨å¾ç¯€é»
<ul>
<li>éš¨å¾ç¯€é»æ”¶åˆ°ä¸¦è¿”å›ç¢ºèªæ¶ˆæ¯çµ¦é ˜å°</li>
</ul>
</li>
<li>é ˜å°ç­‰å¾…å¤§å¤šæ•¸éš¨å¾ç¯€é»çš„ç¢ºèªæ¶ˆæ¯ï¼Œé ˜å°æäº¤æ•¸æ“šï¼Œç„¶å¾Œé€šçŸ¥éš¨å¾ç¯€é»å¯ä»¥æäº¤äº†
<ul>
<li>éš¨å¾ç¯€é»ä¹Ÿæäº¤æ•¸æ“šã€‚æœ€å¾Œé ˜å°ç¯€é»çµ¦è«‹æ±‚è¿”å›æäº¤æˆåŠŸ</li>
</ul>
</li>
</ul>
<blockquote>
<p>å°±åƒæˆ‘è¦æ±‚é–‹èˆ¹ï¼Œèˆ¹é•·å•å­©å­å€‘æº–å‚™å¥½äº†å—ï¼Œå­©å­å€‘å›æ‡‰èˆ¹é•·ï¼Œèˆ¹é•·æ”¶åˆ°å¤§å¤šæ•¸å›æ‡‰å°±èªç‚ºå¯ä»¥é–‹èˆ¹ï¼Œè‡ªå·±é–‹èˆ¹ä¸¦ä¸”å«å­©å­å€‘ä¹Ÿé–‹èˆ¹</p>
<p>ç•¶å¤§å®¶éƒ½é–‹èˆ¹ï¼Œå›æ‡‰çµ¦æˆ‘èªªèˆ¹é–‹äº†</p>
</blockquote>
<ul>
<li>ç•¶åˆ†å€ç™¼ç”Ÿï¼Œå¤§å¤šæ•¸äººçš„é‚£å€å¯ä»¥æäº¤ï¼Œå°‘éƒ¨åˆ†çš„é‚£å€é›–ç„¶å¯èƒ½æœ‰é ˜å°ï¼Œä½†ç”±æ–¼ä¸€ç›´æ”¶ä¸åˆ°<strong>å¤§å¤šæ•¸ç¢ºèª</strong>ï¼Œæ‰€ä»¥ç„¡æ³•æäº¤</li>
<li>ç›´åˆ°åˆ†å€é‡æ–°åˆä½µ(ç¶²è·¯ä¿®å¥½äº†)ï¼ŒèˆŠé ˜å°é€€ä½ï¼Œä¸¦ä¸”è·Ÿç€èˆŠé ˜å°æœªæäº¤çš„æ•¸æ“šéœ€è¦å›æ»¾ï¼Œä¸¦ä¸”åŒæ­¥æ–°é ˜å°çš„æ—¥èªŒ</li>
</ul>
<h2 id="baseç†è«–">BASEç†è«–</h2>
<blockquote>
<p>åˆ†å¸ƒå¼ç³»çµ±ä¸‹ç¶²è·¯æ•…éšœå¿…å®šæœƒç™¼ç”Ÿï¼Œä½†ä»è¦è®“ç”¨æˆ¶å¯ç”¨ï¼Œå³ä¿è­‰På’ŒAï¼Œæ¨æ£„Cçš„å¼·ä¸€è‡´æ€§ï¼Œæ”¹ç‚ºå¼±ä¸€è‡´æ€§</p>
</blockquote>
<ul>
<li>Basically Available åŸºæœ¬å¯ç”¨: åˆ†ä½ˆå¼ç³»çµ±åœ¨å‡ºç¾æ•…éšœçš„æ™‚å€™ï¼Œå…è¨±æå¤±éƒ¨åˆ†å¯ç”¨æ€§(ä¾‹å¦‚éŸ¿æ‡‰æ™‚é–“ã€åŠŸèƒ½ä¸Šçš„å¯ç”¨æ€§)</li>
<li>Soft State è»Ÿç‹€æ…‹: å…è¨±ç³»çµ±å­˜åœ¨ä¸­é–“ç‹€æ…‹ï¼Œä¾‹å¦‚å‘Šè¨´ç”¨æˆ¶æ­£åœ¨æ’éšŠä¸­</li>
<li>Eventual Consistency æœ€çµ‚ä¸€è‡´æ€§: ç³»çµ±ä¸­çš„æ‰€æœ‰æ•¸æ“šå‰¯æœ¬ç¶“éä¸€å®šæ™‚é–“å¾Œï¼Œæœ€çµ‚èƒ½å¤ é”åˆ°ä¸€è‡´çš„ç‹€æ…‹ï¼Œæ˜¯ä¸€ç¨®å¼±ä¸€è‡´æ€§</li>
</ul>
<h2 id="åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ">åˆ†ä½ˆå¼äº‹å‹™å¹¾ç¨®æ–¹æ¡ˆ</h2>
<h3 id="2pc">2PC</h3>
<blockquote>
<p>2 phase commitäºŒéšæäº¤</p>
</blockquote>
<ul>
<li>åŠƒåˆ†å‡ºäº†äº‹å‹™åƒèˆ‡è€…å’Œå”èª¿è€…çš„è§’è‰²ï¼Œä¸¦å°‡æ•´å€‹éç¨‹åŠƒåˆ†æˆå…©å€‹éšæ®µ
<ul>
<li>ç¬¬ä¸€éšæ®µ: äº‹å‹™å”èª¿å™¨è¦æ±‚æ¯å€‹æ¶‰åŠåˆ°äº‹å‹™çš„åƒèˆ‡è€…é æäº¤(precommit)æ­¤æ“ä½œï¼Œä¸¦åæ˜ æ˜¯å¦å¯ä»¥æäº¤</li>
<li>ç¬¬äºŒéšæ®µ: æ‰€æœ‰äº‹å‹™é æäº¤äº†å„è‡ªçš„çµæœå¾Œï¼Œç”±å”èª¿è€…æ±ºå®šæœ€çµ‚äº‹å‹™æ˜¯æˆåŠŸ(commit)é‚„æ˜¯å¤±æ•—(rollback)</li>
</ul>
</li>
<li>å¦‚æœæœ‰ä»»ä½•ä¸€æ­¥é©Ÿå¤±æ•—ï¼Œé‚£éº¼æ‰€æœ‰åƒèˆ‡è€…éƒ½æœƒè¢«è¦æ±‚å›æ»¾</li>
</ul>
<h4 id="xa-transaction">XA Transaction</h4>
<ul>
<li>ç”±è³‡æ–™åº«ä¾†å®ŒæˆäºŒéšæäº¤</li>
<li>XAè¢«è¨±å¤šè³‡æ–™åº«å¦‚Oracleã€DB2ã€SQL Serverã€MySQLæ”¯æ´</li>
<li>å„ªå‹¢åœ¨æ–¼ç°¡å–®ï¼Œç¼ºé»æ˜¯é¢å°ä½µç™¼æ™‚æ€§èƒ½å·®ï¼Œæ•…å¾ˆå°‘ç”¨</li>
</ul>
<h4 id="atæ¨¡å¼">ATæ¨¡å¼</h4>
<blockquote>
<p>Auto Transiaction è‡ªå‹•äº‹å‹™æ¨¡å¼</p>
</blockquote>
<ul>
<li>å„ªå‹¢åœ¨æ–¼ç°¡å–®ç„¡ä¾µå…¥</li>
</ul>
<p><img src="image-20220130165825007.png" alt="image-20220130165825007"></p>
<h4 id="tccæ¨¡å¼">TCCæ¨¡å¼</h4>
<blockquote>
<p>éœ€è¦æ‰‹å‹•ç·¨å¯«å›æ»¾çš„æ–¹æ³•(ä¾‹å¦‚åœ¨try+1ï¼Œå°±è¦åœ¨cancel-1)</p>
</blockquote>
<ul>
<li>å„ªå‹¢åœ¨æ–¼é«˜æ€§èƒ½ï¼Œå¤šè¢«æ¡ç”¨</li>
</ul>
<p><img src="image-20220130165847756.png" alt="image-20220130165847756"></p>
<hr>
<h3 id="æœ€å¤§åŠªåŠ›é€šçŸ¥">æœ€å¤§åŠªåŠ›é€šçŸ¥</h3>
<blockquote>
<p>Best-effort delivery æ˜¯ä¸€ç¨®æŸ”æ€§äº‹å‹™</p>
</blockquote>
<p><img src="image-20220130171049026.png" alt="image-20220130171049026"></p>
<ul>
<li>
<p>é©ç”¨æ–¼æœ€çµ‚ä¸€è‡´æ€§æ™‚é–“æ•æ„Ÿåº¦ä½çš„æ¥­å‹™ï¼Œä¸”è¢«å‹•æ–¹è™•ç†çµæœä¸å½±éŸ¿ä¸»å‹•æ–¹çš„è™•ç†çµæœ</p>
</li>
<li>
<p>æœ€å¤§åŠªåŠ›é€šçŸ¥å‹çš„å¯¦ç¾æ–¹æ¡ˆï¼Œä¸€èˆ¬ç¬¦åˆä»¥ä¸‹ç‰¹é»:</p>
<ul>
<li>ä¸å¯é æ¶ˆæ¯: ä¸»å‹•æ–¹åœ¨å®Œæˆæ¥­å‹™è™•ç†ä¹‹å¾Œï¼Œå‘è¢«å‹•æ–¹ç™¼é€æ¶ˆæ¯ï¼Œç›´åˆ°é€šçŸ¥Næ¬¡å¾Œä¸å†é€šçŸ¥ï¼Œå…è¨±æ¶ˆæ¯ä¸Ÿå¤±(ä¸å¯é æ¶ˆæ¯)</li>
<li>å®šæœŸæ ¡å°: è¢«å‹•æ–¹æ ¹æ“šå®šæ™‚ç­–ç•¥ï¼Œå‘ä¸»å‹•æ–¹æŸ¥è©¢(ä¸»å‹•æ–¹æä¾›æŸ¥è©¢ä»‹é¢)ï¼Œæ¢å¾©ä¸Ÿå¤±çš„æ¥­å‹™æ¶ˆæ¯</li>
</ul>
</li>
<li>
<p>å…¸å‹çš„ä½¿ç”¨å ´æ™¯: å¦‚éŠ€è¡Œé€šçŸ¥ã€å•†æˆ¶é€šçŸ¥ç­‰</p>
</li>
</ul>
<h3 id="å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§">å¯é æ¶ˆæ¯æœ€çµ‚ä¸€è‡´æ€§</h3>
<p><img src="image-20220130171239629.png" alt="image-20220130171239629"></p>
<ul>
<li>åŸºæ–¼MQå¯¦ç¾</li>
<li>ç•¶äº‹å‹™ç™¼èµ·æ–¹åŸ·è¡Œå®Œæˆæœ¬åœ°äº‹å‹™å¾Œä¸¦ç™¼å‡ºä¸€æ¢æ¶ˆæ¯ï¼Œäº‹å‹™åƒèˆ‡æ–¹(æ¶ˆæ¯æ¶ˆè²»è€…)ä¸€å®šèƒ½å¤ æ¥æ”¶æ¶ˆæ¯ä¸¦è™•ç†äº‹å‹™æˆåŠŸ</li>
<li>æ­¤æ–¹æ¡ˆå¼·èª¿çš„æ˜¯åªè¦æ¶ˆæ¯ç™¼çµ¦äº‹å‹™åƒèˆ‡æ–¹<strong>æœ€çµ‚äº‹å‹™è¦é”åˆ°ä¸€è‡´</strong>(ç•°æ­¥ç¢ºä¿æ€§)</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-02-06</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220206-eu-name/">
			ä¸‹ä¸€ç¯‡<br>ç”Ÿæ´»é›œè¨˜
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220205-leetcode-easy-35/">
			ä¸Šä¸€ç¯‡<br>LeetCode Easy: 35-58
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
