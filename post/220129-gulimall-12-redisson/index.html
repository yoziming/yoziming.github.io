<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>Redissonèˆ‡SpringCache</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-12">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="Redissonèˆ‡SpringCache" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-12" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220129-gulimall-12-redisson/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-29T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Redissonèˆ‡SpringCache"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-12"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#redisson" onclick="onNavClick(`#redisson-nav`)" id="redisson-nav">
									Redisson
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e7%bd%ae%e8%a8%ad%e5%ae%9a" onclick="onNavClick(`#å‰ç½®è¨­å®š-nav`)" id="å‰ç½®è¨­å®š-nav">
									å‰ç½®è¨­å®š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#lock-%e5%9f%ba%e6%9c%ac%e9%8e%96" onclick="onNavClick(`#lock-åŸºæœ¬é–-nav`)" id="lock-åŸºæœ¬é–-nav">
									Lock åŸºæœ¬é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#readwritelock-%e8%ae%80%e5%af%ab%e9%8e%96" onclick="onNavClick(`#readwritelock-è®€å¯«é–-nav`)" id="readwritelock-è®€å¯«é–-nav">
									ReadWriteLock è®€å¯«é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#semaphore-%e4%bf%a1%e8%99%9f%e9%87%8f" onclick="onNavClick(`#semaphore-ä¿¡è™Ÿé‡-nav`)" id="semaphore-ä¿¡è™Ÿé‡-nav">
									Semaphore ä¿¡è™Ÿé‡
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#countdownlatch-%e9%96%89%e9%8e%96" onclick="onNavClick(`#countdownlatch-é–‰é–-nav`)" id="countdownlatch-é–‰é–-nav">
									CountDownLatch é–‰é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%a5%97%e7%94%a8%e8%87%b3%e9%a0%85%e7%9b%ae" onclick="onNavClick(`#å¥—ç”¨è‡³é …ç›®-nav`)" id="å¥—ç”¨è‡³é …ç›®-nav">
									å¥—ç”¨è‡³é …ç›®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%b7%a9%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ç·©å­˜ä¸€è‡´æ€§å•é¡Œ-nav`)" id="ç·©å­˜ä¸€è‡´æ€§å•é¡Œ-nav">
									ç·©å­˜ä¸€è‡´æ€§å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a7%a3%e6%b1%ba%e8%be%a6%e6%b3%95" onclick="onNavClick(`#è§£æ±ºè¾¦æ³•-nav`)" id="è§£æ±ºè¾¦æ³•-nav">
									è§£æ±ºè¾¦æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#spring-cache" onclick="onNavClick(`#spring-cache-nav`)" id="spring-cache-nav">
									Spring Cache
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3" onclick="onNavClick(`#è¨»è§£-nav`)" id="è¨»è§£-nav">
									è¨»è§£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#cacheable" onclick="onNavClick(`#cacheable-nav`)" id="cacheable-nav">
									@Cacheable
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cacheevict" onclick="onNavClick(`#cacheevict-nav`)" id="cacheevict-nav">
									@CacheEvict
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cacheput" onclick="onNavClick(`#cacheput-nav`)" id="cacheput-nav">
									@CachePut
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#caching" onclick="onNavClick(`#caching-nav`)" id="caching-nav">
									@Caching
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#å°çµ-nav`)" id="å°çµ-nav">
									å°çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#redisson" onclick="onNavClick(`#redisson-nav`)" id="redisson-nav">
									Redisson
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e7%bd%ae%e8%a8%ad%e5%ae%9a" onclick="onNavClick(`#å‰ç½®è¨­å®š-nav`)" id="å‰ç½®è¨­å®š-nav">
									å‰ç½®è¨­å®š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#lock-%e5%9f%ba%e6%9c%ac%e9%8e%96" onclick="onNavClick(`#lock-åŸºæœ¬é–-nav`)" id="lock-åŸºæœ¬é–-nav">
									Lock åŸºæœ¬é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#readwritelock-%e8%ae%80%e5%af%ab%e9%8e%96" onclick="onNavClick(`#readwritelock-è®€å¯«é–-nav`)" id="readwritelock-è®€å¯«é–-nav">
									ReadWriteLock è®€å¯«é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#semaphore-%e4%bf%a1%e8%99%9f%e9%87%8f" onclick="onNavClick(`#semaphore-ä¿¡è™Ÿé‡-nav`)" id="semaphore-ä¿¡è™Ÿé‡-nav">
									Semaphore ä¿¡è™Ÿé‡
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#countdownlatch-%e9%96%89%e9%8e%96" onclick="onNavClick(`#countdownlatch-é–‰é–-nav`)" id="countdownlatch-é–‰é–-nav">
									CountDownLatch é–‰é–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%a5%97%e7%94%a8%e8%87%b3%e9%a0%85%e7%9b%ae" onclick="onNavClick(`#å¥—ç”¨è‡³é …ç›®-nav`)" id="å¥—ç”¨è‡³é …ç›®-nav">
									å¥—ç”¨è‡³é …ç›®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%b7%a9%e5%ad%98%e4%b8%80%e8%87%b4%e6%80%a7%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#ç·©å­˜ä¸€è‡´æ€§å•é¡Œ-nav`)" id="ç·©å­˜ä¸€è‡´æ€§å•é¡Œ-nav">
									ç·©å­˜ä¸€è‡´æ€§å•é¡Œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a7%a3%e6%b1%ba%e8%be%a6%e6%b3%95" onclick="onNavClick(`#è§£æ±ºè¾¦æ³•-nav`)" id="è§£æ±ºè¾¦æ³•-nav">
									è§£æ±ºè¾¦æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#spring-cache" onclick="onNavClick(`#spring-cache-nav`)" id="spring-cache-nav">
									Spring Cache
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3" onclick="onNavClick(`#è¨»è§£-nav`)" id="è¨»è§£-nav">
									è¨»è§£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#cacheable" onclick="onNavClick(`#cacheable-nav`)" id="cacheable-nav">
									@Cacheable
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cacheevict" onclick="onNavClick(`#cacheevict-nav`)" id="cacheevict-nav">
									@CacheEvict
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#cacheput" onclick="onNavClick(`#cacheput-nav`)" id="cacheput-nav">
									@CachePut
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#caching" onclick="onNavClick(`#caching-nav`)" id="caching-nav">
									@Caching
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#å°çµ-nav`)" id="å°çµ-nav">
									å°çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/redis.png')"
                    
                
            >
                <div class="post-title">
                    Redissonèˆ‡SpringCache
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-12
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-01-29 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">Java</a>
                                &nbsp;
                            
                                <a href="/tags/nosql">NoSQL</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="redisson">Redisson</h1>
<ul>
<li>
<p>Javaæ“ä½œRedisçš„æ¡†æ¶ï¼Œä¸»è¦ç”¨ä»–çš„åˆ†å¸ƒå¼é–çš„åŠŸèƒ½</p>
</li>
<li>
<p>åŠ é–çš„æ–¹æ³•èˆ‡é‚è¼¯å¹¾ä¹éƒ½è·Ÿ<code>java.util.concurrent</code>åŒ…ä¸‹çš„ä¸€æ¨£</p>
<ul>
<li>JUCåŒ…: <code>ReentrantLock</code>é‚£äº›ï¼Œå¦‚æœæ²’å°è±¡äº†çœ‹ä¸‹é¢å€‹ç¨®é–çš„ç¯„ä¾‹å°±æœƒå›æƒ³èµ·ä¾†</li>
</ul>
</li>
</ul>
<h2 id="å‰ç½®è¨­å®š">å‰ç½®è¨­å®š</h2>
<blockquote>
<p><a href="https://github.com/redisson/redisson/wiki/2.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95">https://github.com/redisson/redisson/wiki/2.-%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95</a></p>
</blockquote>
<ul>
<li>å¼•åŒ…</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.redisson<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>redisson<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#8b008b;font-weight:bold">&lt;version&gt;</span>3.16.8<span style="color:#8b008b;font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>  
</span></span></code></pre></div><ul>
<li>é€ configé¡
<ul>
<li>æ³¨æ„<code>import org.redisson.config.Config</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">RedissonConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ‰€æœ‰å°Redissonçš„ä½¿ç”¨éƒ½æ˜¯é€šéRedissonClient
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Bean</span>(destroyMethod = <span style="color:#cd5555">&#34;shutdown&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> RedissonClient <span style="color:#008b45">redisson</span>() <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å‰µå»ºé…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        Config config = <span style="color:#8b008b;font-weight:bold">new</span> Config();
</span></span><span style="display:flex;"><span>        config.<span style="color:#658b00">useSingleServer</span>().<span style="color:#658b00">setAddress</span>(<span style="color:#cd5555">&#34;redis://localhost:6379&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ ¹æ“šConfigå‰µå»ºå‡ºRedissonClientå¯¦ä¾‹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">// Redis url should start with redis:// or rediss://
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        RedissonClient redissonClient = Redisson.<span style="color:#658b00">create</span>(config);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> redissonClient;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ³¨å…¥RedissonClientï¼Œé–‹å§‹é€ é–</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Autowired</span>
</span></span><span style="display:flex;"><span>RedissonClient redisson;
</span></span></code></pre></div><h2 id="lock-åŸºæœ¬é–">Lock åŸºæœ¬é–</h2>
<ul>
<li>åªè¦é–çš„åå­—(ä¾‹å¦‚: <code>&quot;myLock&quot;</code>)ä¸€æ¨£ï¼Œå°±æ˜¯åŒä¸€æŠŠé–</li>
<li>é è¨­ç‚ºé˜»å¡å¼ç­‰å¾…ï¼ŒéæœŸæ™‚é–“æ²’æŒ‡å®šæ˜¯30s</li>
<li>è‡ªå‹•çºŒæœŸï¼Œå¦‚æœæ¥­å‹™è¶…é•·ï¼Œé‹è¡ŒæœŸé–“è‡ªå‹•é–ä¸Šæ–°çš„30s
<ul>
<li>å¦‚æœæ‰‹å‹•æŒ‡å®šäº†éæœŸæ™‚é–“å°±ä¸æœƒè‡ªå‹•çºŒæœŸï¼Œé™¤éå†ä½¿ç”¨çœ‹é–€ç‹—</li>
<li>ä½†ä½•å¿…æé‚£éº¼å¤šï¼Œè®“ä»–é è¨­30ç§’è‡ªå‹•çºŒå°±æŒºå¥½</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>RLock lock = redisson.<span style="color:#658b00">getLock</span>(<span style="color:#cd5555">&#34;myLock&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#228b22">// è¨­å®š10ç§’
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>lock.<span style="color:#658b00">lock</span>(10, TimeUnit.<span style="color:#658b00">SECONDS</span>);
</span></span></code></pre></div><h2 id="readwritelock-è®€å¯«é–">ReadWriteLock è®€å¯«é–</h2>
<ul>
<li>
<p>ç”¨ä¾†ä¿è­‰ä¸€å®šèƒ½è®€åˆ°æœ€æ–°è³‡æ–™</p>
</li>
<li>
<p>ä¸€å€‹è®€å¯«é–ä¸‹åŒ…å«ä¸€å€‹è®€é–èˆ‡ä¸€å€‹å¯«é–(å¥½åƒå»¢è©±)</p>
<ul>
<li>
<p>è®€è®€: ç„¡é™åˆ¶</p>
</li>
<li>
<p>å¯«å¯«: é˜»å¡ï¼Œæ’éšŠ</p>
</li>
<li>
<p>å¯«è®€: ä¿®æ”¹æœŸé–“(æœ‰äººæ‹¿èµ°äº†å¯«é–)ï¼Œè®€ä¹Ÿè¢«é–ä½ï¼Œä¿è­‰ä¸æœƒæœ‰äººè®€åˆ°é«’è³‡æ–™</p>
</li>
<li>
<p>è®€å¯«: æœ‰äººæ‹¿èµ°äº†è®€é–ï¼Œå¯«ä¹Ÿè¢«é–ä½</p>
</li>
</ul>
</li>
<li>
<p>ç¸½ä¹‹<strong>è®€</strong>ç„¡æ‰€è¬‚ï¼Œ<strong>å¯«</strong>æ˜¯äº’æ–¥é–ï¼Œåªè¦æ¶‰åŠå¯«å°±é˜»å¡</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/write&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">writeValue</span>() {
</span></span><span style="display:flex;"><span>    String s = <span style="color:#cd5555">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    RReadWriteLock readWriteLock = redisson.<span style="color:#658b00">getReadWriteLock</span>(<span style="color:#cd5555">&#34;rw-lock&#34;</span>);
</span></span><span style="display:flex;"><span>    RLock rLock = readWriteLock.<span style="color:#658b00">writeLock</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ”¹è³‡æ–™åŠ å¯«é–ï¼Œè®€æ•¸æ“šåŠ è®€é–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        rLock.<span style="color:#658b00">lock</span>();
</span></span><span style="display:flex;"><span>        s = UUID.<span style="color:#658b00">randomUUID</span>().<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>        ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.<span style="color:#658b00">opsForValue</span>();
</span></span><span style="display:flex;"><span>        ops.<span style="color:#658b00">set</span>(<span style="color:#cd5555">&#34;writeValue&#34;</span>,s);
</span></span><span style="display:flex;"><span>        TimeUnit.<span style="color:#658b00">SECONDS</span>.<span style="color:#658b00">sleep</span>(10);
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        rLock.<span style="color:#658b00">unlock</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> s;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/read&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">readValue</span>() {
</span></span><span style="display:flex;"><span>    String s = <span style="color:#cd5555">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    RReadWriteLock readWriteLock = redisson.<span style="color:#658b00">getReadWriteLock</span>(<span style="color:#cd5555">&#34;rw-lock&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// åŠ è®€é–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    RLock rLock = readWriteLock.<span style="color:#658b00">readLock</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        rLock.<span style="color:#658b00">lock</span>();
</span></span><span style="display:flex;"><span>        ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.<span style="color:#658b00">opsForValue</span>();
</span></span><span style="display:flex;"><span>        s = ops.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;writeValue&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">try</span> { TimeUnit.<span style="color:#658b00">SECONDS</span>.<span style="color:#658b00">sleep</span>(10); } <span style="color:#8b008b;font-weight:bold">catch</span> (InterruptedException e) { e.<span style="color:#658b00">printStackTrace</span>(); }
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        rLock.<span style="color:#658b00">unlock</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> s;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="semaphore-ä¿¡è™Ÿé‡">Semaphore ä¿¡è™Ÿé‡</h2>
<ul>
<li>
<p>åŒæ™‚åªèƒ½æœ‰å¹¾äººä¾†æ“ä½œçš„é–ï¼Œé¡ä¼¼ç®¡é“ï¼Œç”¨ä¾†é™æµ</p>
</li>
<li>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œç”¨<code>getSemaphore()</code>æ–¹æ³•ç²å–æŒ‡å®šä»¤ç‰Œå¯¦ä¾‹</p>
<ul>
<li>è¦å…ˆåœ¨redisæŒ‡å®šä»¤ç‰Œåç¨±èˆ‡æœ‰å¹¾å€‹ï¼Œä¾‹å¦‚: <code>(&quot;park&quot;,3)</code></li>
</ul>
</li>
<li>
<p>ç”¨<code>acquire()</code>ç²å–ä¸€å€‹ä¿¡è™Ÿï¼Œé€™æ˜¯é˜»å¡çš„</p>
<ul>
<li>ä¹Ÿå¯ä»¥ç”¨<code>tryAcquire()</code>ï¼Œåæ­£å¸¶tryé–‹é ­å°±æ˜¯éé˜»å¡çš„</li>
</ul>
</li>
<li>
<p>ç”¨<code>release()</code>é‡‹æ”¾ä¿¡è™Ÿ</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * è»Šåº«3è»Šä½ï¼Œè®“äººåœè»Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ä¿¡è™Ÿé‡ä¹Ÿå¯ä»¥åšåˆ†æ•£å¼é™æµ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/park&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">park</span>() <span style="color:#8b008b;font-weight:bold">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        RSemaphore park = redisson.<span style="color:#658b00">getSemaphore</span>(<span style="color:#cd5555">&#34;park&#34;</span>);
</span></span><span style="display:flex;"><span>        park.<span style="color:#658b00">acquire</span>();     <span style="color:#228b22">// ç²å–ä¸€å€‹ä¿¡è™Ÿã€ç²å–ä¸€å€‹å€¼,å ä¸€å€‹è»Šä½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#00688b;font-weight:bold">boolean</span> flag = park.<span style="color:#658b00">tryAcquire</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (flag) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// åŸ·è¡Œæ¥­å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;error&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;ok=&gt;&#34;</span> + flag;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/go&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">go</span>() {
</span></span><span style="display:flex;"><span>        RSemaphore park = redisson.<span style="color:#658b00">getSemaphore</span>(<span style="color:#cd5555">&#34;park&#34;</span>);
</span></span><span style="display:flex;"><span>        park.<span style="color:#658b00">release</span>();     <span style="color:#228b22">// é‡‹æ”¾ä¸€å€‹è»Šä½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;ok&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="countdownlatch-é–‰é–">CountDownLatch é–‰é–</h2>
<ul>
<li>é™åˆ¶å¹¹äº†å¹¾æ¬¡ä¹‹å¾Œå°±ä¸å¹¹äº†</li>
<li>å…ˆç”¨<code>getCountDownLatch()</code>ç²å–çœ‹é–€çš„å¯¦ä¾‹</li>
<li>ç”¨<code>trySetCount()</code>æ–¹æ³•è¨­å®šå€’æ•¸çš„æ¬¡æ•¸ï¼Œ<code>await()</code>é–‹å§‹å€’æ•¸</li>
<li>åŸ·è¡Œæ¥­å‹™é‚è¼¯å¾Œï¼Œç”¨<code>countDown()</code>æ–¹æ³•ä½¿è¨ˆæ•¸-1</li>
<li>è¨ˆæ•¸åˆ°0ï¼Œå°±é–æ­»</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ”¾å‡ã€é–é–€
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 5å€‹äººæ¬¡èµ°å®Œï¼Œæ‰å¯ä»¥é–å¤§é–€
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * åˆ†æ•£å¼é–‰é–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/lockDoor&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">lockDoor</span>() <span style="color:#8b008b;font-weight:bold">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        RCountDownLatch door = redisson.<span style="color:#658b00">getCountDownLatch</span>(<span style="color:#cd5555">&#34;door&#34;</span>);
</span></span><span style="display:flex;"><span>        door.<span style="color:#658b00">trySetCount</span>(5);
</span></span><span style="display:flex;"><span>        door.<span style="color:#658b00">await</span>();       <span style="color:#228b22">// ç­‰å¾…é–‰é–å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;æ”¾å‡äº†...&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/gogogo/{id}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@ResponseBody</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">gogogo</span>(<span style="color:#707a7c">@PathVariable</span>(<span style="color:#cd5555">&#34;id&#34;</span>) Long id) {
</span></span><span style="display:flex;"><span>        RCountDownLatch door = redisson.<span style="color:#658b00">getCountDownLatch</span>(<span style="color:#cd5555">&#34;door&#34;</span>);
</span></span><span style="display:flex;"><span>        door.<span style="color:#658b00">countDown</span>();       <span style="color:#228b22">// è¨ˆæ•¸-1
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">return</span> id + <span style="color:#cd5555">&#34;çš„äººéƒ½èµ°äº†...&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="å¥—ç”¨è‡³é …ç›®">å¥—ç”¨è‡³é …ç›®</h2>
<ul>
<li>å›åˆ°ä¹‹å‰çš„CategoryServiceImpl.javaï¼Œé€éredissonå¯ä»¥ç°¡åŒ–éå¸¸å¤š</li>
<li>æ³¨æ„é–çš„å‘½åè¡¨ç¤ºç²¾ç´°åº¦ï¼Œæ¯”å¦‚å…·é«”æƒ³é–1è™Ÿå•†å“çš„é–å°±è©²æ˜¯&quot;item-01-lock&quot;ï¼Œè€Œé&quot;item-lock&quot;
<ul>
<li>&ldquo;item-lock&quot;å°±è©²æ˜¯ç”¨æ–¼æ‰€æœ‰itemçš„é›†åˆçš„é–</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">// Redissonåˆ†å¸ƒå¼é–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">public</span> Map&lt;String, List&lt;Catalogs2Vo&gt;&gt; <span style="color:#008b45">getCatalogJsonWithRedisson</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ¶é–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    RLock lock = redisson.<span style="color:#658b00">getLock</span>(<span style="color:#cd5555">&#34;CatalogJson-lock&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ¶åˆ°äº†ï¼Œé–‹å§‹åŸ·è¡Œæ¥­å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    lock.<span style="color:#658b00">lock</span>();
</span></span><span style="display:flex;"><span>    Map&lt;String, List&lt;Catalogs2Vo&gt;&gt; result;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        result = getCatalogJsonFromDb();
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">finally</span> {
</span></span><span style="display:flex;"><span>        lock.<span style="color:#658b00">unlock</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="ç·©å­˜ä¸€è‡´æ€§å•é¡Œ">ç·©å­˜ä¸€è‡´æ€§å•é¡Œ</h2>
<ul>
<li>ç•¶æˆ‘å€‘æƒ³è®“ç·©å­˜èˆ‡DBä¸­çš„è³‡æ–™ä¸€æ¨£ï¼Œå¯ä»¥æ¡ç”¨:
<ul>
<li>é›™å¯«: æ›´æ–°DBçš„æ“ä½œåŒæ™‚ä¹Ÿæ›´æ–°ç·©å­˜</li>
<li>å¤±æ•ˆ: æ›´æ–°DBçš„æ“ä½œåŒæ™‚æŠŠç·©å­˜æ¸…ç©ºï¼Œç­‰ä¸‹å»åˆ¥äººè«‹æ±‚çš„æ™‚å€™æ›´æ–°ç·©å­˜</li>
</ul>
</li>
<li>ç„¶è€Œé«˜ä½µç™¼ä¹‹ä¸‹å°±å¯èƒ½æœ‰å•é¡Œï¼Œæ¯”å¦‚ä¸‹åœ–ç¯„ä¾‹:</li>
</ul>
<p><img src="image-20220122162940491.png" alt="image-20220122162940491"></p>
<p><img src="image-20220122163014851.png" alt="image-20220122163014851"></p>
<h3 id="è§£æ±ºè¾¦æ³•">è§£æ±ºè¾¦æ³•</h3>
<ul>
<li>ä½µç™¼æœ¬èº«ä¸å¤šå°±ä¸è€ƒæ…®é€™éº¼å¤šï¼Œæ©Ÿç‡å¤ªä½ï¼Œåªè¦éƒ½çµ¦ç·©å­˜è¨­å®šéæœŸæ™‚é–“ï¼Œæœ€çµ‚ç¸½æœƒæ›´æ–°çš„</li>
<li>æ”¾åˆ°ç·©å­˜çš„æ±è¥¿ï¼Œæœ¬ä¾†å°±æ˜¯è®€å¤šå¯«å°‘æ‰é©åˆï¼Œè¦æ±‚å³æ™‚ã€é«˜ä¸€è‡´æ€§å°±ä¹¾è„†å»è®€DBã€‚é ‚å¤šç”¨å€‹è®€å¯«é–ï¼Œéåº¦è¨­è¨ˆå¢åŠ ç³»çµ±è¤‡é›œæ€§ä¸å¯å–</li>
<li>é«˜ç´šå¯ä»¥ç”¨Cannlè¼”åŠ©ï¼ŒCanalé¡ä¼¼ä¸€å€‹MySQLçš„å¾åº«ï¼Œä»–æœƒè¿½è¹¤ä¸»åº«ï¼Œä¸¦å½è£è‡ªå·±æˆä¸€å€‹DBï¼Œæ‰€ä»¥å¯ä»¥é€éå®ƒä¾†æ›´æ–°ç·©å­˜
<ul>
<li>ç†Ÿæ‚‰çš„&quot;åŠ ä¸€å±¤&quot;æ“ä½œ</li>
</ul>
</li>
</ul>
<p><img src="image-20220122163722148.png" alt="image-20220122163722148"></p>
<ul>
<li>é¡¯ç„¶ï¼Œè‡ªå·±çµ¦æ–¹æ³•è¨­å®šç·©å­˜ã€è¨­å®šéæœŸ&hellip;é€™äº›å¹¹çš„äº‹æƒ…éƒ½æŒºé‡è¤‡çš„ï¼Œæ–¼æ˜¯ä¹Springåˆåˆåˆå°è£å¥½äº†ï¼ŒSpring Cacheå› æ‡‰è€Œç”Ÿ</li>
</ul>
<h1 id="spring-cache">Spring Cache</h1>
<blockquote>
<p>Cacheç™¼éŸ³åŒç¾é‡‘é‚£å€‹Cash</p>
</blockquote>
<ul>
<li>ç”¨è¨»è§£å°±èƒ½å®Œæˆç·©å­˜æ“ä½œï¼Œä¹‹å‰åœ¨å°šé†«é€šé …ç›®æœ‰ç¨å¾®å­¸é
<ul>
<li><a href="https://yoziming.github.io/post/220116-agg-spring-06/#spring-cache">https://yoziming.github.io/post/220116-agg-spring-06/#spring-cache</a></li>
</ul>
</li>
<li>æ ¸å¿ƒ: Springå·²ç¶“æŠŠå¹¾ç¨®å¸¸ç”¨çš„ç·©å­˜é¡è·Ÿä»–å€‘çš„AutoConfigurationå°è£å¥½äº†ï¼Œåªè¦åœ¨æƒ³ä½¿ç”¨ç·©å­˜çš„æ–¹æ³•ä¸Šè¨»è§£å°±èƒ½è‡ªå‹•èª¿ç”¨</li>
</ul>
<p><img src="image-20220122193127853.png" alt="image-20220122193127853"></p>
<ul>
<li>CacheManageræ¥å£ï¼Œé¡§åæ€ç¾©å°±æ˜¯ç”¨ä¾†ç®¡ç†Cacheçš„</li>
<li>ä¾‹å¦‚: ConcurrentMapCacheManagerå°±æ˜¯ç®¡ç†ConcurrentMapCache
<ul>
<li>ConcurrentMapCacheæœ¬èº«ä¹Ÿæ˜¯æ¥å£ï¼Œå°è£äº†æ“ä½œåº•å±¤ConcurrentMapåšæˆçš„Cacheçš„å„ç¨®æ–¹æ³•</li>
<li>åŒç†RedissonSpringCacheåº•å±¤å°±æ˜¯å­˜åˆ°Redisçš„Cache</li>
</ul>
</li>
</ul>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<ul>
<li>é¦–å…ˆå¼•åŒ…</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>spring-boot-starter-cache<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;version&gt;</span>2.6.3<span style="color:#8b008b;font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ul>
<li>application.properties æŒ‡å®šè¦ä½¿ç”¨çš„cacheé¡å‹</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#658b00">spring.cache.type</span>=<span style="color:#cd5555">redis</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å­˜æ´»æ™‚é–“ï¼Œæ¯«ç§’ç‚ºå–®ä½ï¼Œé è¨­æ˜¯-1å³æ°¸ä¹…</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cache.redis.time-to-live</span>=<span style="color:#cd5555">60000</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å¦‚æœæŒ‡å®šäº†å‰ç¶´å°±ç”¨æˆ‘å€‘æŒ‡å®šçš„å‰ç¶´ï¼Œä¹Ÿå¯ä»¥ä¸è¦å‰ç¶´</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#spring.cache.redis.key-prefix=CACHE_</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">#spring.cache.redis.use-key-prefix=false</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># æ˜¯å¦ç·©å­˜ç©ºå€¼ï¼Œç”¨ä¾†é˜²æ­¢ç·©å­˜ç©¿é€</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cache.redis.cache-null-values</span>=<span style="color:#cd5555">true</span>
</span></span></code></pre></div><ul>
<li>é€ Configé¡(æ²’æœ‰å°±æœƒç”¨é è¨­çš„)
<ul>
<li>é€šå¸¸æœƒåœ¨é¡ä¿®æ”¹ç·©å­˜çš„valueç·¨ç¢¼æ–¹å¼(é è¨­æ˜¯äºŒé€²ä½ä½†ä¸€èˆ¬éƒ½æ”¹æˆJSON)èˆ‡æ—¥æœŸæ ¼å¼çš„æ”¯æ´ç­‰ç­‰</li>
<li>Configé¡ &gt; application.propertiesï¼Œå¦‚æœåœ¨propertiesè¨­å®šäº†å…¨åŸŸå­˜æ´»æ™‚é–“ï¼Œåœ¨Configé¡å°±éœ€è¦åˆ¤æ–·å„ªå…ˆç´š
<ul>
<li>å°±æ˜¯ä¸‹é¢é‚£å †<code>if XXX !=null</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@EnableCaching</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">CustomCacheConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> RedisCacheConfiguration <span style="color:#008b45">redisCacheConfiguration</span>(CacheProperties cacheProperties) {
</span></span><span style="display:flex;"><span>        RedisCacheConfiguration config = RedisCacheConfiguration.<span style="color:#658b00">defaultCacheConfig</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// config = config.entryTtl();
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        config =
</span></span><span style="display:flex;"><span>                config.<span style="color:#658b00">serializeKeysWith</span>(RedisSerializationContext.<span style="color:#658b00">SerializationPair</span>.<span style="color:#658b00">fromSerializer</span>(<span style="color:#8b008b;font-weight:bold">new</span> StringRedisSerializer()));
</span></span><span style="display:flex;"><span>        config =
</span></span><span style="display:flex;"><span>                config.<span style="color:#658b00">serializeValuesWith</span>(RedisSerializationContext.<span style="color:#658b00">SerializationPair</span>.<span style="color:#658b00">fromSerializer</span>(<span style="color:#8b008b;font-weight:bold">new</span> GenericJackson2JsonRedisSerializer()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        CacheProperties.<span style="color:#658b00">Redis</span> redisProperties = cacheProperties.<span style="color:#658b00">getRedis</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è®“application.propertiesæ–‡ä»¶ä¸­çš„é…ç½®ç”Ÿæ•ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (redisProperties.<span style="color:#658b00">getTimeToLive</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            config = config.<span style="color:#658b00">entryTtl</span>(redisProperties.<span style="color:#658b00">getTimeToLive</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (redisProperties.<span style="color:#658b00">getKeyPrefix</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            config = config.<span style="color:#658b00">prefixKeysWith</span>(redisProperties.<span style="color:#658b00">getKeyPrefix</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (!redisProperties.<span style="color:#658b00">isCacheNullValues</span>()) {
</span></span><span style="display:flex;"><span>            config = config.<span style="color:#658b00">disableCachingNullValues</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (!redisProperties.<span style="color:#658b00">isUseKeyPrefix</span>()) {
</span></span><span style="display:flex;"><span>            config = config.<span style="color:#658b00">disableKeyPrefix</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> config;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="è¨»è§£">è¨»è§£</h3>
<h4 id="cacheable"><code>@Cacheable</code></h4>
<ul>
<li>
<p>å°‡æ–¹æ³•çš„çµæœç·©å­˜èµ·ä¾†ï¼Œå¦‚æœè«‹æ±‚æ™‚å·²ç¶“æœ‰å¿«å–ï¼Œå°±ç•¥éæ–¹æ³•ç›´æ¥èª¿ç”¨å¿«å–çµ¦çµæœï¼Œæœ‰ä»¥ä¸‹åƒæ•¸:</p>
<ul>
<li>
<p><code>value</code>: ç·©å­˜çš„åˆ¥å(ä¸æ˜¯å­˜åœ¨redisçš„åè€Œæ˜¯åœ¨javaé€™é‚Šæ¨™ç¤ºçš„)ï¼Œé€šå¸¸æŠŠåˆ¥åç•¶æˆ&quot;åˆ†é¡&quot;ä¾†ç”¨</p>
</li>
<li>
<p><code>cacheNames</code>: åŒä¸Šï¼ŒäºŒé¸ä¸€å³å¯</p>
</li>
<li>
<p><code>sync</code>: é–‹å•Ÿæœ¬åœ°é–ï¼Œé è¨­ç‚ºfalse</p>
</li>
<li>
<p><code>key</code>: å¯é¸ï¼Œé è¨­ç”Ÿæˆçš„æ˜¯<code>ç·©å­˜çš„åˆ¥å::SimpleKey[]</code></p>
<ul>
<li>æœ€å¥½è¨­å®šæˆæ–¹æ³•å<code>key = &quot;#root.method.name&quot;</code>
<ul>
<li><code>å‰ç¶´::</code>æ˜¯åœ¨redisä¸­æœƒæ­¸é¡æˆè³‡æ–™å¤¾æ–¹ä¾¿æ•´ç†</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="image-20220122222206658.png" alt="image-20220122222206658"></p>
<ul>
<li>
<p>ç·©å­˜çš„valueå€¼ï¼Œç‚ºäº†å¥½çœ‹å¥½é€šç”¨ï¼Œä¸€èˆ¬æœƒè½‰æˆJSONä¾†å­˜</p>
</li>
<li>
<p>ä¾‹å¦‚:</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Cacheable</span>(cacheNames = <span style="color:#cd5555">&#34;category&#34;</span>, key = <span style="color:#cd5555">&#34;#root.method.name&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> List&lt;CategoryEntity&gt; <span style="color:#008b45">getLevel1Catalog</span>() {
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">list</span>(<span style="color:#8b008b;font-weight:bold">new</span> QueryWrapper&lt;CategoryEntity&gt;().<span style="color:#658b00">eq</span>(<span style="color:#cd5555">&#34;parent_cid&#34;</span>, 0));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="cacheevict"><code>@CacheEvict</code></h4>
<ul>
<li>
<p>æ¸…ç©ºæŒ‡å®šå¿«å–ï¼Œé€šå¸¸ç”¨æ–¼æ›´æ–°æˆ–åˆªé™¤ä¾‹å¦‚å‰é¢æéçš„å¤±æ•ˆæ¨¡å¼ï¼Œæœ‰ä»¥ä¸‹åƒæ•¸:</p>
<ul>
<li>
<p><code>allEntries</code>: æ¸…ç©ºè©²åˆ¥åçš„æ‰€æœ‰å¿«å–ï¼Œé è¨­ç‚ºfalse</p>
</li>
<li>
<p><code>beforeInvocation</code>: åœ¨æ–¹æ³•åŸ·è¡Œå‰å°±æ¸…ç©ºï¼Œé è¨­ç‚ºfalse</p>
</li>
</ul>
</li>
<li>
<p>ä¹Ÿå¯ä»¥æŒ‡å®šåˆªé™¤æŸkeyä¾‹å¦‚:</p>
<ul>
<li>æ³¨æ„<code>key = &quot;'getLevel1Catalog'&quot;</code>ï¼Œå­—ç¬¦ä¸²é‚„è¦ç”¨å–®å¼•è™ŸåŒ…ä½</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/** 
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç´šè¯æ›´æ–°æ‰€æœ‰é—œè¯çš„è³‡æ–™ï¼Œæ›´æ–°äº†è¡¨ï¼Œæ‰€ä»¥åˆªé™¤å¿«å–
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param category
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@CacheEvict</span>(cacheNames = <span style="color:#cd5555">&#34;category&#34;</span>, key = <span style="color:#cd5555">&#34;&#39;getLevel1Catalog&#39;&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Transactional</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">updateCascade</span>(CategoryEntity category) {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">this</span>.<span style="color:#658b00">updateById</span>(category);
</span></span><span style="display:flex;"><span>    categoryBrandRelationService.<span style="color:#658b00">updateCategory</span>(category.<span style="color:#658b00">getCatId</span>(), category.<span style="color:#658b00">getName</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="cacheput"><code>@CachePut</code></h4>
<ul>
<li>
<p>ç„¡è«–å¦‚ä½•éƒ½æœƒåŸ·è¡Œæ–¹æ³•ä¸¦æ›´æ–°åˆ°å¿«å–ä¸­ï¼Œå¯ä»¥ç”¨æ–¼é›™å¯«æ¨¡å¼</p>
</li>
<li>
<p>å€åˆ¥åœ¨æ–¼<code>@Cacheable</code>æ˜¯å¦‚æœç·©å­˜ä¸­æœ‰è³‡æ–™ï¼Œæ–¹æ³•å°±ä¸æœƒè¢«åŸ·è¡Œ</p>
</li>
</ul>
<h4 id="caching"><code>@Caching</code></h4>
<ul>
<li>è‹¥ä¸€è¡Œå¯«ä¸ä¸‹ï¼Œå¯ä»¥é€™å€‹èšåˆå¤šè¡Œ@Cachxxxè¨»è§£</li>
</ul>
<h2 id="å°çµ">å°çµ</h2>
<ul>
<li>
<p>Spring Cacheå¾ˆæ–¹ä¾¿ï¼Œä½†å°æ–¼ä¹‹å‰æéçš„å•é¡Œ</p>
<ul>
<li>
<p>ç·©å­˜ç©¿é€: æœ‰äººç‹‚æŸ¥nullã€‚å¯ä»¥è¨­å®šé–‹å•Ÿå­˜nullï¼Œè§£æ±º</p>
</li>
<li>
<p>ç·©å­˜é›ªå´©: å¤§é‡keyåŒæ™‚éæœŸã€‚åªèƒ½é éæœŸæ™‚é–“ï¼Œä¸å¤ªè¡Œ</p>
</li>
<li>
<p>ç·©å­˜æ“Šç©¿: ä¸€å€‹ç†±é»keyè¢«å¤§ä½µç™¼è¨ªå•ã€‚æœ¬åœ°é–ä¹Ÿç®—èƒ½æ‡‰ä»˜</p>
</li>
</ul>
</li>
<li>
<p>å¸¸è¦è³‡æ–™: è®€å¤šå¯«å°‘ã€ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ã€ä½µç™¼é‡ä¸å¤§çš„é›¢è­œï¼ŒSpring Cacheå®Œå…¨å¯ä»¥å‹ä»»</p>
</li>
<li>
<p>ç‰¹æ®Šæƒ…æ³é‚£å°±ç‰¹æ®Šè¨­è¨ˆ</p>
</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-01-29</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220130-gulimall-13/">
			ä¸‹ä¸€ç¯‡<br>ç”¨ElasticSearchå¯¦ç¾å•†å“æœç´¢
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220128-gulimall-11-synchronized-lock/">
			ä¸Šä¸€ç¯‡<br>Redisç·©å­˜èˆ‡åˆ†ä½ˆå¼é–
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
