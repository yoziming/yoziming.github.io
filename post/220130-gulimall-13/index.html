<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>ç”¨ElasticSearchå¯¦ç¾å•†å“æœç´¢</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-13">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="ç”¨ElasticSearchå¯¦ç¾å•†å“æœç´¢" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-13" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220130-gulimall-13/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-30T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-30T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ç”¨ElasticSearchå¯¦ç¾å•†å“æœç´¢"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-13"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%90%9c%e7%b4%a2%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#æœç´¢é é¢-nav`)" id="æœç´¢é é¢-nav">
									æœç´¢é é¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%ad%e5%ae%9a%e7%b6%b2%e6%ae%b5" onclick="onNavClick(`#è¨­å®šç¶²æ®µ-nav`)" id="è¨­å®šç¶²æ®µ-nav">
									è¨­å®šç¶²æ®µ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%9d%9c%e6%85%8b%e8%b3%87%e6%ba%90" onclick="onNavClick(`#éœæ…‹è³‡æº-nav`)" id="éœæ…‹è³‡æº-nav">
									éœæ…‹è³‡æº
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%af%abvo" onclick="onNavClick(`#å¯«vo-nav`)" id="å¯«vo-nav">
									å¯«Vo
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#æŸ¥è©¢-nav`)" id="æŸ¥è©¢-nav">
									æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%ba%b5%e5%8c%85%e5%b1%91%e5%b0%8e%e8%88%aa" onclick="onNavClick(`#éºµåŒ…å±‘å°èˆª-nav`)" id="éºµåŒ…å±‘å°èˆª-nav">
									éºµåŒ…å±‘å°èˆª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%81%9a%e5%90%88%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#èšåˆå•é¡Œ-nav`)" id="èšåˆå•é¡Œ-nav">
									èšåˆå•é¡Œ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%90%9c%e7%b4%a2%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#æœç´¢é é¢-nav`)" id="æœç´¢é é¢-nav">
									æœç´¢é é¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%ad%e5%ae%9a%e7%b6%b2%e6%ae%b5" onclick="onNavClick(`#è¨­å®šç¶²æ®µ-nav`)" id="è¨­å®šç¶²æ®µ-nav">
									è¨­å®šç¶²æ®µ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%9d%9c%e6%85%8b%e8%b3%87%e6%ba%90" onclick="onNavClick(`#éœæ…‹è³‡æº-nav`)" id="éœæ…‹è³‡æº-nav">
									éœæ…‹è³‡æº
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%af%abvo" onclick="onNavClick(`#å¯«vo-nav`)" id="å¯«vo-nav">
									å¯«Vo
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#æŸ¥è©¢-nav`)" id="æŸ¥è©¢-nav">
									æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e9%ba%b5%e5%8c%85%e5%b1%91%e5%b0%8e%e8%88%aa" onclick="onNavClick(`#éºµåŒ…å±‘å°èˆª-nav`)" id="éºµåŒ…å±‘å°èˆª-nav">
									éºµåŒ…å±‘å°èˆª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%81%9a%e5%90%88%e5%95%8f%e9%a1%8c" onclick="onNavClick(`#èšåˆå•é¡Œ-nav`)" id="èšåˆå•é¡Œ-nav">
									èšåˆå•é¡Œ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/elasticsearch.jpg')"
                    
                
            >
                <div class="post-title">
                    ç”¨ElasticSearchå¯¦ç¾å•†å“æœç´¢
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-13
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-01-30 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">Java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="æœç´¢é é¢">æœç´¢é é¢</h1>
<ul>
<li>
<p>æœå°‹é é¢æœ‰è‡ªå·±çš„å­ç¶²åŸŸï¼Œç¶²å€æ˜¯ <a href="http://search.mall.com/">http://search.mall.com/</a></p>
</li>
<li>
<p>æˆ‘è§€å¯Ÿäº†ä¸€ä¸‹ï¼Œå°ç£çš„å•†åŸç¶²ç«™å¤§å¤šæ˜¯ç”¨å­ç›®éŒ„ï¼Œä¾‹å¦‚:</p>
</li>
</ul>
<pre tabindex="0"><code>https://www.momoshop.com.tw/search/

https://www.etmall.com.tw/Search?

https://shopping.friday.tw/ec2/search?
</code></pre><ul>
<li>
<p>è€Œç”¨å­ç¶²åŸŸçš„é€šå¸¸æ˜¯å¤§é™¸çš„é›»å•†ç¶²ç«™ï¼Œç¶“éæŸ¥è©¢å…©è€…å…¶å¯¦æ²’å¤ªå¤§å·®ç•°</p>
</li>
<li>
<p>é€šå¸¸ä¾†èªªï¼Œå±¬æ–¼ç¶²ç«™ä¸‹çš„é™„å±¬å°åŠŸèƒ½ï¼Œç”¨å­ç›®éŒ„ï¼›è€Œé«”é‡å¤§åˆ°å¯ä»¥åˆ†å‰²å‡ºå»æ‰ç”¨æœƒç”¨å­ç¶²åŸŸ</p>
</li>
<li>
<p>å­ç¶²åŸŸè¤‡é›œäº†ä¸€é»ï¼Œåæ­£éƒ½å­¸å­¸å§</p>
</li>
</ul>
<h2 id="è¨­å®šç¶²æ®µ">è¨­å®šç¶²æ®µ</h2>
<ul>
<li>æ”¹hostæ¨¡æ“¬DNS</li>
</ul>
<p><img src="image-20220122225938223.png" alt="image-20220122225938223"></p>
<ul>
<li>nginx
<ul>
<li>æ¡äº†å‘ï¼Œæ”¹å®Œå¿˜è¨˜è¦é‡é–‹æœå‹™</li>
</ul>
</li>
</ul>
<p><img src="image-20220122230310851.png" alt="image-20220122230310851"></p>
<ul>
<li>ç¶²é—œ</li>
</ul>
<pre tabindex="0"><code>- id: mall_search_route
  uri: lb://search
  predicates:
    - Host=search.mall.com
</code></pre><h2 id="éœæ…‹è³‡æº">éœæ…‹è³‡æº</h2>
<ul>
<li>é€™é‚Šä¸€æ¨£ç”¨thymeleafæ¸²æŸ“ï¼Œå¼•åŒ…</li>
<li>é—œé–‰ spring.thymeleaf.cache=false</li>
<li>èª¿æ•´ <code>list.html</code>ï¼Œç¢ºèªä¸€ä¸‹è·Ÿé¦–é çš„è¶…é€£çµæ˜¯å¦æ­£ç¢º</li>
</ul>
<h2 id="å¯«vo">å¯«Vo</h2>
<blockquote>
<p>é€™å¯å°±è¤‡é›œäº†ï¼Œéœ€è¦è€ƒæ…®å„ç¨®æœå°‹æ¢ä»¶ã€è¿”å›çš„çµæœ&hellip;</p>
</blockquote>
<ul>
<li>æœå°‹æ¢ä»¶ SearchParam.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">SearchParam</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * é é¢å‚³ééä¾†çš„å…¨æ–‡åŒ¹é…é—œéµå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String keyword;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å“ç‰Œid,å¯ä»¥å¤šé¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;Long&gt; brandId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ä¸‰ç´šåˆ†é¡id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long catalog3Id;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ’åºæ¢ä»¶ï¼šsort=price/salecount/hotscore_desc/asc
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String sort;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ˜¯å¦æœ‰è²¨
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer hasStock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * åƒ¹æ ¼å€é–“æŸ¥è©¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String skuPrice;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æŒ‰ç…§å±¬æ€§é€²è¡Œç¯©é¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;String&gt; attrs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * é ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer pageNum = 1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * åŸç”Ÿçš„æ‰€æœ‰æŸ¥è©¢æ¢ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String _queryString;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>è¿”å›çš„çµæœ SearchResult.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">SearchResult</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æŸ¥è©¢åˆ°çš„æ‰€æœ‰å•†å“ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;SkuEsModel&gt; product;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç•¶å‰é ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer pageNum;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç¸½è¨˜éŒ„æ•¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long total;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç¸½é ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer totalPages;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;Integer&gt; pageNavs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç•¶å‰æŸ¥è©¢åˆ°çš„çµæœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„å“ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;BrandVo&gt; brands;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç•¶å‰æŸ¥è©¢åˆ°çš„çµæœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„æ‰€æœ‰å±¬æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;AttrVo&gt; attrs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç•¶å‰æŸ¥è©¢åˆ°çš„çµæœï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„æ‰€æœ‰åˆ†é¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;CatalogVo&gt; catalogs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//===========================ä»¥ä¸Šæ˜¯è¿”å›çµ¦é é¢çš„æ‰€æœ‰ä¿¡æ¯============================//
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/* éºµåŒ…å±‘å°èˆªæ•¸æ“š */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> List&lt;NavVo&gt; navs;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">NavVo</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String navName;
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String navValue;
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String link;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">BrandVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> Long brandId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String brandName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String brandImg;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">AttrVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> Long attrId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String attrName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> List&lt;String&gt; attrValue;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">CatalogVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> Long catalogId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String catalogName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>è¿”å›çš„çµæœä¸­çš„å±¬æ€§ AttrResponseVo.java
<ul>
<li>å°±æ˜¯é€™äº›å•¦ï¼Œæ ¹æ“šçµæœå¾ESæŠ½å‡ºçš„å±¬æ€§</li>
</ul>
</li>
</ul>
<p><img src="image-20220122235040745.png" alt="image-20220122235040745"></p>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">AttrResponseVo</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å±¬æ€§id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long attrId;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å±¬æ€§å
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String attrName;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ˜¯å¦éœ€è¦æª¢ç´¢[0-ä¸éœ€è¦ï¼Œ1-éœ€è¦]
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer searchType;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å±¬æ€§åœ–æ¨™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String icon;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å¯é¸å€¼åˆ—è¡¨[ç”¨é€—è™Ÿåˆ†éš”]
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String valueSelect;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å±¬æ€§é¡å‹[0-éŠ·å”®å±¬æ€§ï¼Œ1-åŸºæœ¬å±¬æ€§ï¼Œ2-æ—¢æ˜¯éŠ·å”®å±¬æ€§åˆæ˜¯åŸºæœ¬å±¬æ€§]
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer attrType;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å•Ÿç”¨ç‹€æ…‹[0 - ç¦ç”¨ï¼Œ1 - å•Ÿç”¨]
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long enable;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ‰€å±¬åˆ†é¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long catalogId;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å¿«é€Ÿå±•ç¤ºã€æ˜¯å¦å±•ç¤ºåœ¨ä»‹ç´¹ä¸Šï¼›0-å¦ 1-æ˜¯ã€‘ï¼Œåœ¨skuä¸­ä»ç„¶å¯ä»¥èª¿æ•´
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer showDesc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long attrGroupId;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String catalogName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> String groupName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Long[] catalogPath;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="æŸ¥è©¢">æŸ¥è©¢</h2>
<blockquote>
<p>é€™ä¸€ç¯€çœŸçš„å¤ªåäº†ï¼Œå‰å¾Œç«¯ä¸åˆ†çš„thymeleafæœ¬èº«å·²ç¶“å¾ˆå°‘äººç”¨ï¼ŒESæŸ¥è©¢èªå¥çš„ç·¨å¯«çœŸçš„æ¯ç‡¥åˆç„¡èŠï¼Œæš«æ™‚å…ˆè¤‡è£½è²¼ä¸Šè·³é</p>
</blockquote>
<ul>
<li>ç°¡å–®æ•´ç†ä¸€ä¸‹æµç¨‹:
<ul>
<li>é€ Voå°è£æœç´¢æ¢ä»¶èˆ‡å‘ˆç¾çš„çµæœ</li>
<li>å…ˆåœ¨ESæ ¹æ“šæœç´¢æ¢ä»¶å¯«å‡ºDSL</li>
<li>å°‡DSLç·¨è­¯æˆJavaèªæ³•</li>
<li>è™•ç†èšåˆ</li>
<li>å°‡çµæœå°è£ï¼Œæ¨å›çµ¦å‰ç«¯</li>
</ul>
</li>
<li>SearchController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/list.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">listPage</span>(SearchParam param, Model model, HttpServletRequest request) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// Springè‡ªå‹•å°‡é é¢æäº¤éä¾†çš„æ‰€æœ‰è«‹æ±‚åƒæ•¸å°è£æˆæˆ‘å€‘æŒ‡å®šçš„SearchParam
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    param.<span style="color:#658b00">set_queryString</span>(request.<span style="color:#658b00">getQueryString</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ ¹æ“šå‚³éä¾†çš„é é¢çš„æŸ¥è©¢åƒæ•¸ï¼Œå»esä¸­æª¢ç´¢å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchResult result = mallSearchService.<span style="color:#658b00">search</span>(param);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å­˜åˆ°model
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    model.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;result&#34;</span>, result);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;list&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>MallSearchServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * åœ¨esæª¢ç´¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param param æª¢ç´¢çš„æ‰€æœ‰åƒæ•¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @return è¿”å›çš„çµæœ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> SearchResult <span style="color:#008b45">search</span>(SearchParam param) {
</span></span><span style="display:flex;"><span>    SearchResult result = <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€å‹•æ…‹æ§‹å»ºæª¢ç´¢éœ€è¦çš„DSLèªå¥
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€æº–å‚™æª¢ç´¢è«‹æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchRequest searchRequest = buildSearchRequest(param);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// 2ã€åŸ·è¡Œæª¢ç´¢è«‹æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        SearchResponse searchResponse = client.<span style="color:#658b00">search</span>(searchRequest, ElasticConfig.<span style="color:#658b00">COMMON_OPTIONS</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// 3ã€åˆ†æéŸ¿æ‡‰æ•¸æ“šï¼Œå°è£æˆéœ€è¦çš„æ ¼å¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        result = buildSearchResponse(param, searchResponse);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> SearchRequest <span style="color:#008b45">buildSearchRequest</span>(SearchParam param) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ§‹å»ºDSLèªå¥å°è±¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchSourceBuilder sourceBuilder = <span style="color:#8b008b;font-weight:bold">new</span> SearchSourceBuilder();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ¨¡ç³ŠåŒ¹é…ï¼Œéæ¿¾ï¼ˆæŒ‰ç…§å±¬æ€§ï¼Œåˆ†é¡ï¼Œå“ç‰Œï¼Œåƒ¹æ ¼å€é–“ï¼Œåº«å­˜ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€æ§‹å»ºbool - query
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BoolQueryBuilder boolQueryBuilder = QueryBuilders.<span style="color:#658b00">boolQuery</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.1ã€mustã€å¾—åˆ†ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// åˆ†è©åŒ¹é…skuTitle
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!StringUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getKeyword</span>())) {
</span></span><span style="display:flex;"><span>        boolQueryBuilder.<span style="color:#658b00">must</span>(QueryBuilders.<span style="color:#658b00">matchQuery</span>(<span style="color:#cd5555">&#34;skuTitle&#34;</span>, param.<span style="color:#658b00">getKeyword</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.2ã€filterã€ç„¡å¾—åˆ†ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// ä¸‰ç´šåˆ†é¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getCatalog3Id</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        boolQueryBuilder.<span style="color:#658b00">filter</span>(QueryBuilders.<span style="color:#658b00">termQuery</span>(<span style="color:#cd5555">&#34;catalogId&#34;</span>, param.<span style="color:#658b00">getCatalog3Id</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.3ã€å“ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!CollectionUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getBrandId</span>())) {
</span></span><span style="display:flex;"><span>        boolQueryBuilder.<span style="color:#658b00">filter</span>(QueryBuilders.<span style="color:#658b00">termsQuery</span>(<span style="color:#cd5555">&#34;brandId&#34;</span>, param.<span style="color:#658b00">getBrandId</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.4ã€å±¬æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!CollectionUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getAttrs</span>())) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (String attr : param.<span style="color:#658b00">getAttrs</span>()) {
</span></span><span style="display:flex;"><span>            BoolQueryBuilder boolQuery = QueryBuilders.<span style="color:#658b00">boolQuery</span>();
</span></span><span style="display:flex;"><span>            String[] s = attr.<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;_&#34;</span>);
</span></span><span style="display:flex;"><span>            String attrId = s[0];
</span></span><span style="display:flex;"><span>            String[] attrValues = s[1].<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;:&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// mustä¸­çš„å¿…é ˆæ˜¯åŒæ™‚æ»¿è¶³çš„ï¼Œå¦‚æœboolQueryä¸æ˜¯å…§å±¤çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// é‚£éº¼boolQueryæœƒæ‹¼æ¥å¤šå€‹must(attrs.attrId)ï¼Œä¾‹å¦‚id = 6æ™‚ï¼ŒåŒæ™‚å¿…é ˆid = 7ï¼Œæ²’æœ‰æ­¤attr
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            boolQuery.<span style="color:#658b00">must</span>(QueryBuilders.<span style="color:#658b00">termQuery</span>(<span style="color:#cd5555">&#34;attrs.attrId&#34;</span>, attrId));
</span></span><span style="display:flex;"><span>            boolQuery.<span style="color:#658b00">must</span>(QueryBuilders.<span style="color:#658b00">termsQuery</span>(<span style="color:#cd5555">&#34;attrs.attrValue&#34;</span>, attrValues));
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ¯ä¸€å€‹å±¬æ€§éƒ½è¦ç”Ÿæˆä¸€å€‹åµŒå…¥å¼æŸ¥è©¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">// å•†å“å¿…é ˆåŒ…å«æ¯ä¸€å€‹ å‚³å…¥çš„å±¬æ€§
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            NestedQueryBuilder nestedQuery = QueryBuilders.<span style="color:#658b00">nestedQuery</span>(<span style="color:#cd5555">&#34;attrs&#34;</span>, boolQuery, ScoreMode.<span style="color:#658b00">None</span>);
</span></span><span style="display:flex;"><span>            boolQueryBuilder.<span style="color:#658b00">filter</span>(nestedQuery);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.5ã€åº«å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getHasStock</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        boolQueryBuilder.<span style="color:#658b00">filter</span>(QueryBuilders.<span style="color:#658b00">termQuery</span>(<span style="color:#cd5555">&#34;hasStock&#34;</span>, param.<span style="color:#658b00">getHasStock</span>() == 1));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1.6ã€åƒ¹æ ¼å€é–“ 0_500  _500  500_
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!StringUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getSkuPrice</span>())) {
</span></span><span style="display:flex;"><span>        RangeQueryBuilder rangeQuery = QueryBuilders.<span style="color:#658b00">rangeQuery</span>(<span style="color:#cd5555">&#34;skuPrice&#34;</span>);
</span></span><span style="display:flex;"><span>        String[] s = param.<span style="color:#658b00">getSkuPrice</span>().<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;_&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (s.<span style="color:#658b00">length</span> == 2) {
</span></span><span style="display:flex;"><span>            rangeQuery.<span style="color:#658b00">gte</span>(s[0]).<span style="color:#658b00">lte</span>(s[1]);
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> <span style="color:#8b008b;font-weight:bold">if</span> (s.<span style="color:#658b00">length</span> == 1) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getSkuPrice</span>().<span style="color:#658b00">startsWith</span>(<span style="color:#cd5555">&#34;_&#34;</span>)) {
</span></span><span style="display:flex;"><span>                rangeQuery.<span style="color:#658b00">lte</span>(s[0]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getSkuPrice</span>().<span style="color:#658b00">endsWith</span>(<span style="color:#cd5555">&#34;_&#34;</span>)) {
</span></span><span style="display:flex;"><span>                rangeQuery.<span style="color:#658b00">gte</span>(s[0]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        boolQueryBuilder.<span style="color:#658b00">filter</span>(rangeQuery);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€END å°è£æŸ¥è©¢æ¢ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    sourceBuilder.<span style="color:#658b00">query</span>(boolQueryBuilder);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ’åºï¼Œåˆ†é ï¼Œé«˜äº®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 2.1ã€æ’åº
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!StringUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getSort</span>())) {
</span></span><span style="display:flex;"><span>        String[] s = param.<span style="color:#658b00">getSort</span>().<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;_&#34;</span>);
</span></span><span style="display:flex;"><span>        SortOrder order = s[1].<span style="color:#658b00">equalsIgnoreCase</span>(<span style="color:#cd5555">&#34;asc&#34;</span>) ? SortOrder.<span style="color:#658b00">ASC</span> : SortOrder.<span style="color:#658b00">DESC</span>;
</span></span><span style="display:flex;"><span>        sourceBuilder.<span style="color:#658b00">sort</span>(s[0], order);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 2.2ã€åˆ†é 
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    sourceBuilder.<span style="color:#658b00">from</span>((param.<span style="color:#658b00">getPageNum</span>() - 1) * EsConstant.<span style="color:#658b00">PRODUCT_PAGESIZE</span>);
</span></span><span style="display:flex;"><span>    sourceBuilder.<span style="color:#658b00">size</span>(EsConstant.<span style="color:#658b00">PRODUCT_PAGESIZE</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 2.3ã€é«˜äº®
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!StringUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getKeyword</span>())) {
</span></span><span style="display:flex;"><span>        HighlightBuilder highlightBuilder = <span style="color:#8b008b;font-weight:bold">new</span> HighlightBuilder();
</span></span><span style="display:flex;"><span>        highlightBuilder.<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;skuTitle&#34;</span>);
</span></span><span style="display:flex;"><span>        highlightBuilder.<span style="color:#658b00">preTags</span>(<span style="color:#cd5555">&#34;&lt;b style=&#39;color:red&#39;&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        highlightBuilder.<span style="color:#658b00">postTags</span>(<span style="color:#cd5555">&#34;&lt;/b&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        sourceBuilder.<span style="color:#658b00">highlighter</span>(highlightBuilder);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * èšåˆåˆ†æã€å“ç‰Œã€åˆ†é¡ã€åˆ†ææ‰€æœ‰å¯é¸çš„è¦æ ¼ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 3.1ã€å“ç‰Œèšåˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    TermsAggregationBuilder brand_agg = AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;brand_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;brandId&#34;</span>).<span style="color:#658b00">size</span>(10);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å­èšåˆï¼Œç²å¾—å“ç‰Œnameå’Œåœ–ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    brand_agg.<span style="color:#658b00">subAggregation</span>(AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;brand_name_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;brandName&#34;</span>).<span style="color:#658b00">size</span>(1));
</span></span><span style="display:flex;"><span>    brand_agg.<span style="color:#658b00">subAggregation</span>(AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;brand_img_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;brandImg&#34;</span>).<span style="color:#658b00">size</span>(1));
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ§‹å»ºDSL
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// TODO èšåˆå“ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(brand_agg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 3.2ã€åˆ†é¡èšåˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    TermsAggregationBuilder catalog_agg = AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;catalog_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;catalogId&#34;</span>).<span style="color:#658b00">size</span>(20);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å­èšåˆï¼Œç²å¾—åˆ†é¡å
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    catalog_agg.<span style="color:#658b00">subAggregation</span>(AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;catalog_name_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;catalogName&#34;</span>).<span style="color:#658b00">size</span>(1));
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ§‹å»ºDSL
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// TODO èšåˆåˆ†é¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(catalog_agg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 3.3ã€è¦æ ¼èšåˆã€åµŒå…¥å¼ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    NestedAggregationBuilder attr_agg = AggregationBuilders.<span style="color:#658b00">nested</span>(<span style="color:#cd5555">&#34;attr_agg&#34;</span>, <span style="color:#cd5555">&#34;attrs&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ ¹æ“šidåˆ†çµ„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    TermsAggregationBuilder attr_id_agg = AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;attr_id_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;attrs.attrId&#34;</span>).<span style="color:#658b00">size</span>(10);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å­èšåˆ=ã€‹åœ¨idåˆ†çµ„å…§éƒ¨ï¼Œç¹¼çºŒæŒ‰ç…§ attr_nameåˆ†çµ„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    attr_id_agg.<span style="color:#658b00">subAggregation</span>(AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;attr_name_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;attrs.attrName&#34;</span>).<span style="color:#658b00">size</span>(1));
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å­èšåˆ=ã€‹åœ¨idåˆ†çµ„å…§éƒ¨ï¼Œç¹¼çºŒæŒ‰ç…§ attr_valueåˆ†çµ„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    attr_id_agg.<span style="color:#658b00">subAggregation</span>(AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;attr_value_agg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;attrs.attrValue&#34;</span>).<span style="color:#658b00">size</span>(50));
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// åµŒå…¥å¼èšåˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    attr_agg.<span style="color:#658b00">subAggregation</span>(attr_id_agg);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ§‹å»ºDSL
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// TODO èšåˆå±¬æ€§è¦æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(attr_agg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SearchRequest searchRequest = <span style="color:#8b008b;font-weight:bold">new</span> SearchRequest(<span style="color:#8b008b;font-weight:bold">new</span> String[]{EsConstant.<span style="color:#658b00">PRODUCT_INDEX</span>}, sourceBuilder);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ‰“å°DSL
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(sourceBuilder.<span style="color:#658b00">toString</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> searchRequest;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * å°è£æª¢ç´¢çµæœ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 1ã€è¿”å›æ‰€æœ‰æŸ¥è©¢åˆ°çš„å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 2ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰å±¬æ€§ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 3ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰å“ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 4ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰åˆ†é¡ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 5ã€åˆ†é ä¿¡æ¯   pageNum:ç•¶å‰é ç¢¼  total:ç¸½è¨˜éŒ„æ•¸    totalPages: ç¸½é ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> SearchResult <span style="color:#008b45">buildSearchResponse</span>(SearchParam param, SearchResponse searchResponse) {
</span></span><span style="display:flex;"><span>    SearchResult result = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult();
</span></span><span style="display:flex;"><span>    SearchHits hits = searchResponse.<span style="color:#658b00">getHits</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 1ã€è¿”å›æ‰€æœ‰æŸ¥è©¢åˆ°çš„å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;SkuEsModel&gt; products = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (!ArrayUtils.<span style="color:#658b00">isEmpty</span>(hits.<span style="color:#658b00">getHits</span>())) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (SearchHit hit : hits.<span style="color:#658b00">getHits</span>()) {
</span></span><span style="display:flex;"><span>            String jsonStr = hit.<span style="color:#658b00">getSourceAsString</span>();
</span></span><span style="display:flex;"><span>            SkuEsModel model = JSON.<span style="color:#658b00">parseObject</span>(jsonStr, SkuEsModel.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// è¨­ç½®é«˜äº®ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#8b008b;font-weight:bold">if</span> (!StringUtils.<span style="color:#658b00">isEmpty</span>(param.<span style="color:#658b00">getKeyword</span>())) {
</span></span><span style="display:flex;"><span>                HighlightField skuTitle = hit.<span style="color:#658b00">getHighlightFields</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;skuTitle&#34;</span>);
</span></span><span style="display:flex;"><span>                model.<span style="color:#658b00">setSkuTitle</span>(skuTitle.<span style="color:#658b00">getFragments</span>()[0].<span style="color:#658b00">string</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            products.<span style="color:#658b00">add</span>(model);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setProducts</span>(products);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 2ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰å±¬æ€§ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;SearchResult.<span style="color:#658b00">AttrVo</span>&gt; attrVos = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    ParsedNested attr_agg = searchResponse.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;attr_agg&#34;</span>);
</span></span><span style="display:flex;"><span>    ParsedLongTerms attr_id_agg = attr_agg.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;attr_id_agg&#34;</span>);
</span></span><span style="display:flex;"><span>    List&lt;? <span style="color:#8b008b;font-weight:bold">extends</span> Terms.<span style="color:#658b00">Bucket</span>&gt; attrBuckets = attr_id_agg.<span style="color:#658b00">getBuckets</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (Terms.<span style="color:#658b00">Bucket</span> bucket : attrBuckets) {
</span></span><span style="display:flex;"><span>        SearchResult.<span style="color:#658b00">AttrVo</span> attrVo = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult.<span style="color:#658b00">AttrVo</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å±¬æ€§ID
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        attrVo.<span style="color:#658b00">setAttrId</span>(bucket.<span style="color:#658b00">getKeyAsNumber</span>().<span style="color:#658b00">longValue</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å±¬æ€§åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        ParsedStringTerms attr_name_agg = bucket.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;attr_name_agg&#34;</span>);
</span></span><span style="display:flex;"><span>        attrVo.<span style="color:#658b00">setAttrName</span>(attr_name_agg.<span style="color:#658b00">getBuckets</span>().<span style="color:#658b00">get</span>(0).<span style="color:#658b00">getKeyAsString</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å“ç‰Œåœ–ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        ParsedStringTerms attr_value_agg = bucket.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;attr_value_agg&#34;</span>);
</span></span><span style="display:flex;"><span>        List&lt;String&gt; attrValues = attr_value_agg.<span style="color:#658b00">getBuckets</span>().<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(item -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> ((Terms.<span style="color:#658b00">Bucket</span>) item).<span style="color:#658b00">getKeyAsString</span>();
</span></span><span style="display:flex;"><span>        }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>        attrVo.<span style="color:#658b00">setAttrValue</span>(attrValues);
</span></span><span style="display:flex;"><span>        attrVos.<span style="color:#658b00">add</span>(attrVo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setAttrs</span>(attrVos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 3ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰å“ç‰Œä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;SearchResult.<span style="color:#658b00">BrandVo</span>&gt; brandVos = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    ParsedLongTerms brand_agg = searchResponse.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;brand_agg&#34;</span>);
</span></span><span style="display:flex;"><span>    List&lt;? <span style="color:#8b008b;font-weight:bold">extends</span> Terms.<span style="color:#658b00">Bucket</span>&gt; brandBuckets = brand_agg.<span style="color:#658b00">getBuckets</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (Terms.<span style="color:#658b00">Bucket</span> bucket : brandBuckets) {
</span></span><span style="display:flex;"><span>        SearchResult.<span style="color:#658b00">BrandVo</span> brandVo = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult.<span style="color:#658b00">BrandVo</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å“ç‰ŒID
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        brandVo.<span style="color:#658b00">setBrandId</span>(bucket.<span style="color:#658b00">getKeyAsNumber</span>().<span style="color:#658b00">longValue</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å“ç‰Œåå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        ParsedStringTerms brand_name_agg = bucket.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;brand_name_agg&#34;</span>);
</span></span><span style="display:flex;"><span>        brandVo.<span style="color:#658b00">setBrandName</span>(brand_name_agg.<span style="color:#658b00">getBuckets</span>().<span style="color:#658b00">get</span>(0).<span style="color:#658b00">getKeyAsString</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–å“ç‰Œåœ–ç‰‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        ParsedStringTerms brand_img_agg = bucket.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;brand_img_agg&#34;</span>);
</span></span><span style="display:flex;"><span>        brandVo.<span style="color:#658b00">setBrandImg</span>(brand_img_agg.<span style="color:#658b00">getBuckets</span>().<span style="color:#658b00">get</span>(0).<span style="color:#658b00">getKeyAsString</span>());
</span></span><span style="display:flex;"><span>        brandVos.<span style="color:#658b00">add</span>(brandVo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setBrands</span>(brandVos);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 4ã€ç•¶å‰æ‰€æœ‰å•†å“æ¶‰åŠåˆ°çš„æ‰€æœ‰åˆ†é¡ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;SearchResult.<span style="color:#658b00">CatalogVo</span>&gt; catalogVos = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    ParsedLongTerms catalog_agg = searchResponse.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;catalog_agg&#34;</span>);
</span></span><span style="display:flex;"><span>    List&lt;? <span style="color:#8b008b;font-weight:bold">extends</span> Terms.<span style="color:#658b00">Bucket</span>&gt; catalogBuckets = catalog_agg.<span style="color:#658b00">getBuckets</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (Terms.<span style="color:#658b00">Bucket</span> bucket : catalogBuckets) {
</span></span><span style="display:flex;"><span>        SearchResult.<span style="color:#658b00">CatalogVo</span> catalogVo = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult.<span style="color:#658b00">CatalogVo</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–åˆ†é¡Id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        catalogVo.<span style="color:#658b00">setCatalogId</span>(Long.<span style="color:#658b00">parseLong</span>(bucket.<span style="color:#658b00">getKeyAsString</span>()));
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æå–åˆ†é¡åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        ParsedStringTerms catalog_name_agg = bucket.<span style="color:#658b00">getAggregations</span>().<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;catalog_name_agg&#34;</span>);
</span></span><span style="display:flex;"><span>        catalogVo.<span style="color:#658b00">setCatalogName</span>(catalog_name_agg.<span style="color:#658b00">getBuckets</span>().<span style="color:#658b00">get</span>(0).<span style="color:#658b00">getKeyAsString</span>());
</span></span><span style="display:flex;"><span>        catalogVos.<span style="color:#658b00">add</span>(catalogVo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setCatalogs</span>(catalogVos);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 5ã€åˆ†é ä¿¡æ¯   pageNum:ç•¶å‰é ç¢¼ ã€total:ç¸½è¨˜éŒ„æ•¸ ã€totalPages: ç¸½é ç¢¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#00688b;font-weight:bold">long</span> total = hits.<span style="color:#658b00">getTotalHits</span>().<span style="color:#658b00">value</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#00688b;font-weight:bold">int</span> totalPages = (<span style="color:#00688b;font-weight:bold">int</span>) total % EsConstant.<span style="color:#658b00">PRODUCT_PAGESIZE</span> == 0 ? (<span style="color:#00688b;font-weight:bold">int</span>) total / EsConstant.<span style="color:#658b00">PRODUCT_PAGESIZE</span> :
</span></span><span style="display:flex;"><span>            ((<span style="color:#00688b;font-weight:bold">int</span>) total / EsConstant.<span style="color:#658b00">PRODUCT_PAGESIZE</span> + 1);
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setPageNum</span>(param.<span style="color:#658b00">getPageNum</span>());
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setTotal</span>(total);
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setTotalPages</span>(totalPages);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 6ã€æ‰€æœ‰é ç¢¼æ•¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    List&lt;Integer&gt; pageNavs = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = 1; i &lt;= totalPages; i++) {
</span></span><span style="display:flex;"><span>        pageNavs.<span style="color:#658b00">add</span>(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    result.<span style="color:#658b00">setPageNavs</span>(pageNavs);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// 7ã€æ§‹å»ºéºµåŒ…å±‘å°èˆªåŠŸèƒ½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getAttrs</span>() != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; param.<span style="color:#658b00">getAttrs</span>().<span style="color:#658b00">size</span>() &gt; 0) {
</span></span><span style="display:flex;"><span>        List&lt;SearchResult.<span style="color:#658b00">NavVo</span>&gt; collect = param.<span style="color:#658b00">getAttrs</span>().<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>(attr -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">//1ã€åˆ†ææ¯ä¸€å€‹attrså‚³éä¾†çš„åƒæ•¸å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            SearchResult.<span style="color:#658b00">NavVo</span> navVo = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult.<span style="color:#658b00">NavVo</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// attrs=2_5å¯¸:6å¯¸
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            String[] s = attr.<span style="color:#658b00">split</span>(<span style="color:#cd5555">&#34;_&#34;</span>);
</span></span><span style="display:flex;"><span>            navVo.<span style="color:#658b00">setNavValue</span>(s[1]);
</span></span><span style="display:flex;"><span>            R r = productFeignService.<span style="color:#658b00">attrInfo</span>(Long.<span style="color:#658b00">parseLong</span>(s[0]));
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ ¹æ“šè«‹æ±‚æ§‹é€ éºµåŒ…å±‘ è¦æ ¼å±¬æ€§Idé›†åˆï¼Œé€™å€‹é›†åˆåŒ…å«çš„å±¬æ€§è¦æ ¼ä¸æ˜¾ç¤ºã€å‰ç«¯æœƒéæ­·æ¯å€‹åƒæ•¸æ˜¾ç¤ºã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            result.<span style="color:#658b00">getAttrIds</span>().<span style="color:#658b00">add</span>(Long.<span style="color:#658b00">parseLong</span>(s[0]));
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (r.<span style="color:#658b00">getCode</span>() == 0) {
</span></span><span style="display:flex;"><span>                AttrResponseVo data = r.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;attr&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;AttrResponseVo&gt;() {
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">// è¨­ç½®å±¬æ€§å
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                navVo.<span style="color:#658b00">setNavName</span>(data.<span style="color:#658b00">getAttrName</span>());
</span></span><span style="display:flex;"><span>            } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>                navVo.<span style="color:#658b00">setNavName</span>(s[0]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">//2ã€å–æ¶ˆäº†é€™å€‹éºµåŒ…å±‘ä»¥å¾Œï¼Œæˆ‘å€‘è¦è·³è½‰åˆ°å“ªå€‹åœ°æ–¹ï¼Œå°‡è«‹æ±‚çš„åœ°å€urlè£é¢çš„ç•¶å‰ç½®ç©º
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#228b22">//æ‹¿åˆ°æ‰€æœ‰çš„æŸ¥è©¢æ¢ä»¶ï¼Œå»æ‰ç•¶å‰
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            String replace = replaceQueryString(param, attr, <span style="color:#cd5555">&#34;attrs&#34;</span>);
</span></span><span style="display:flex;"><span>            navVo.<span style="color:#658b00">setLink</span>(<span style="color:#cd5555">&#34;http://search.mall.com/list.html?&#34;</span> + replace);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> navVo;
</span></span><span style="display:flex;"><span>        }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        result.<span style="color:#658b00">setNavs</span>(collect);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å“ç‰Œã€åˆ†é¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (param.<span style="color:#658b00">getBrandId</span>() != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; param.<span style="color:#658b00">getBrandId</span>().<span style="color:#658b00">size</span>() &gt; 0) {
</span></span><span style="display:flex;"><span>        List&lt;SearchResult.<span style="color:#658b00">NavVo</span>&gt; navs = result.<span style="color:#658b00">getNavs</span>();
</span></span><span style="display:flex;"><span>        SearchResult.<span style="color:#658b00">NavVo</span> navVo = <span style="color:#8b008b;font-weight:bold">new</span> SearchResult.<span style="color:#658b00">NavVo</span>();
</span></span><span style="display:flex;"><span>        navVo.<span style="color:#658b00">setNavName</span>(<span style="color:#cd5555">&#34;å“ç‰Œ&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// TODO é ç¨‹æŸ¥è©¢æ‰€æœ‰å“ç‰Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        R r = productFeignService.<span style="color:#658b00">brandsInfo</span>(param.<span style="color:#658b00">getBrandId</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (r.<span style="color:#658b00">getCode</span>() == 0) {
</span></span><span style="display:flex;"><span>            List&lt;BrandVo&gt; brand = r.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;brand&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;List&lt;BrandVo&gt;&gt;() {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>            StringBuffer sb = <span style="color:#8b008b;font-weight:bold">new</span> StringBuffer();
</span></span><span style="display:flex;"><span>            String replace = <span style="color:#cd5555">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">for</span> (BrandVo brandVo : brand) {
</span></span><span style="display:flex;"><span>                sb.<span style="color:#658b00">append</span>(brandVo.<span style="color:#658b00">getName</span>() + <span style="color:#cd5555">&#34;;&#34;</span>);
</span></span><span style="display:flex;"><span>                replace = replaceQueryString(param, brandVo.<span style="color:#658b00">getBrandId</span>() + <span style="color:#cd5555">&#34;&#34;</span>, <span style="color:#cd5555">&#34;brandId&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            navVo.<span style="color:#658b00">setNavValue</span>(sb.<span style="color:#658b00">toString</span>());
</span></span><span style="display:flex;"><span>            navVo.<span style="color:#658b00">setLink</span>(<span style="color:#cd5555">&#34;http://search.mall.com/list.html?&#34;</span> + replace);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        navs.<span style="color:#658b00">add</span>(navVo);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// TODO åˆ†é¡ éºµåŒ…å±‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> result;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> String <span style="color:#008b45">replaceQueryString</span>(SearchParam param, String value, String key) {
</span></span><span style="display:flex;"><span>    String encode = <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">try</span> {
</span></span><span style="display:flex;"><span>        encode = URLEncoder.<span style="color:#658b00">encode</span>(value, <span style="color:#cd5555">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        encode = encode.<span style="color:#658b00">replace</span>(<span style="color:#cd5555">&#34;+&#34;</span>, <span style="color:#cd5555">&#34;%20&#34;</span>);  <span style="color:#228b22">//ç€è¦½å™¨å°ç©ºæ ¼çš„ç·¨ç¢¼å’ŒJavaä¸ä¸€æ¨£ï¼Œå·®ç•°åŒ–è™•ç†
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    } <span style="color:#8b008b;font-weight:bold">catch</span> (UnsupportedEncodingException e) {
</span></span><span style="display:flex;"><span>        e.<span style="color:#658b00">printStackTrace</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å°±æ˜¯é»äº†Xä¹‹å¾Œï¼Œæ‡‰è©²è·³è½‰çš„åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// é€™è£è¦åˆ¤æ–·ä¸€ä¸‹ï¼Œattrsæ˜¯ä¸æ˜¯ç¬¬ä¸€å€‹åƒæ•¸ï¼Œå› ç‚ºç¬¬ä¸€å€‹åƒæ•¸ æ²’æœ‰&amp;ç¬¦è™Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#228b22">// TODO BUGï¼Œç¬¬ä¸€å€‹åƒæ•¸ä¸å¸¶&amp;
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">return</span> param.<span style="color:#658b00">get_queryString</span>().<span style="color:#658b00">replace</span>(<span style="color:#cd5555">&#34;&amp;&#34;</span> + key + <span style="color:#cd5555">&#34;=&#34;</span> + encode, <span style="color:#cd5555">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="éºµåŒ…å±‘å°èˆª">éºµåŒ…å±‘å°èˆª</h3>
<ul>
<li>å­¸åˆ°æ–°åè© Breadcrumbï¼Œå°±æ˜¯åƒé€™ç¨®æ±è¥¿å•¦</li>
</ul>
<p><img src="image-20220123211432913.png" alt="image-20220123211432913"></p>
<ul>
<li>ç¢ºå¯¦å°±æ˜¯æºè‡ªæ–¼ç«¥è©±æ•…äº‹ç³–æœå±‹ï¼Œä¸»è§’åœ¨å‰å¾€æ£®æ—çš„è·¯ä¸Šæ”¾ç½®éºµåŒ…å±‘æ‰¾åˆ°å›å®¶çš„æ–¹å‘
<ul>
<li>ä½†æˆ‘è¨˜å¾—ä¸æ˜¯è¢«é³¥åƒæ‰äº†å—?</li>
</ul>
</li>
</ul>
<h3 id="èšåˆå•é¡Œ">èšåˆå•é¡Œ</h3>
<ul>
<li>å ±éŒ¯ <code>fielddata is unsupported</code></li>
</ul>
<pre tabindex="0"><code>Can&#39;t load fielddata on [XXX] because fielddata is unsupported on fields of type [keyword]. Use doc values instead.
</code></pre><ul>
<li>å› ç‚ºç•¶åˆmappingä¸æƒ³è®“é€™äº›æ¬„ä½è¢«æŸ¥åˆ°ï¼Œåšçš„è¨­å®š</li>
</ul>
<p><img src="image-20220123003049183.png" alt="image-20220123003049183"></p>
<ul>
<li>doc_values é è¨­æ˜¯trueï¼Œç•¶æ‰‹å‹•è¨­ç‚º false æ™‚ï¼Œç„¡æ³•åŸºæ–¼è©²æ¬„ä½æ’åºã€èšåˆã€åœ¨è…³æœ¬ä¸­è¨ªå•æ¬„ä½å€¼ï¼Œæ‰€ä»¥å ±éŒ¯</li>
<li>è§£æ³•: é‡æ§‹å»ºmappingï¼Œå¯ä»¥ç”¨<code>POST _reindex</code>è¤‡è£½èµ°èˆŠçš„è³‡æ–™ï¼Œé‡é€ mappingå¾Œå†æ¬å›å»</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-01-30</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220131-gulimall-14-thread/">
			ä¸‹ä¸€ç¯‡<br>ç·šç¨‹æ± èˆ‡CompletableFutureç•°æ­¥ç·¨æ’
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220129-gulimall-12-redisson/">
			ä¸Šä¸€ç¯‡<br>Redissonèˆ‡SpringCache
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
