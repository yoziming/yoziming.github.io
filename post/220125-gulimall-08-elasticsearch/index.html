<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>ElasticSearchèˆ‡Springæ•´åˆ</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-08">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="ElasticSearchèˆ‡Springæ•´åˆ" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-08" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220125-gulimall-08-elasticsearch/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-01-25T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-01-25T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ElasticSearchèˆ‡Springæ•´åˆ"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-08"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#elasticsearch" onclick="onNavClick(`#elasticsearch-nav`)" id="elasticsearch-nav">
									ElasticSearch
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%89%e8%a3%9d" onclick="onNavClick(`#å®‰è£-nav`)" id="å®‰è£-nav">
									å®‰è£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6" onclick="onNavClick(`#æ¸¬è©¦-nav`)" id="æ¸¬è©¦-nav">
									æ¸¬è©¦
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8bdocument" onclick="onNavClick(`#å»ºç«‹ä¸€å€‹document-nav`)" id="å»ºç«‹ä¸€å€‹document-nav">
									å»ºç«‹ä¸€å€‹Document
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#put%e8%88%87post%e6%9b%b4%e6%96%b0" onclick="onNavClick(`#putèˆ‡postæ›´æ–°-nav`)" id="putèˆ‡postæ›´æ–°-nav">
									PUTèˆ‡POSTæ›´æ–°
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#æŸ¥è©¢-nav`)" id="æŸ¥è©¢-nav">
									æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%aa" onclick="onNavClick(`#åˆª-nav`)" id="åˆª-nav">
									åˆª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bulk%e6%89%b9%e6%ac%a1%e6%93%8d%e4%bd%9c" onclick="onNavClick(`#bulkæ‰¹æ¬¡æ“ä½œ-nav`)" id="bulkæ‰¹æ¬¡æ“ä½œ-nav">
									bulkæ‰¹æ¬¡æ“ä½œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#kibana" onclick="onNavClick(`#kibana-nav`)" id="kibana-nav">
									kibana
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#search-api" onclick="onNavClick(`#search-api-nav`)" id="search-api-nav">
									Search Api
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a3%9c%e5%85%85-sql%e6%96%b9%e5%bc%8f%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#è£œå……-sqlæ–¹å¼æŸ¥è©¢-nav`)" id="è£œå……-sqlæ–¹å¼æŸ¥è©¢-nav">
									è£œå……: SQLæ–¹å¼æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#query-dsl" onclick="onNavClick(`#query-dsl-nav`)" id="query-dsl-nav">
									Query DSL
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8c%b9%e9%85%8d%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#åŒ¹é…æŸ¥è©¢-nav`)" id="åŒ¹é…æŸ¥è©¢-nav">
									åŒ¹é…æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#match-%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#match-åŒ¹é…-nav`)" id="match-åŒ¹é…-nav">
									match åŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#match_phrase-%e7%9f%ad%e5%8f%a5%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#match_phrase-çŸ­å¥åŒ¹é…-nav`)" id="match_phrase-çŸ­å¥åŒ¹é…-nav">
									match_phrase çŸ­å¥åŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#multi_match-%e5%a4%9a%e5%ad%97%e6%ae%b5%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#multi_match-å¤šå­—æ®µåŒ¹é…-nav`)" id="multi_match-å¤šå­—æ®µåŒ¹é…-nav">
									multi_match å¤šå­—æ®µåŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#term-%e7%b2%be%e7%a2%ba%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#term-ç²¾ç¢ºåŒ¹é…-nav`)" id="term-ç²¾ç¢ºåŒ¹é…-nav">
									term ç²¾ç¢ºåŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a4%87%e5%90%88%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#è¤‡åˆæŸ¥è©¢-nav`)" id="è¤‡åˆæŸ¥è©¢-nav">
									è¤‡åˆæŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bool-%e6%a2%9d%e4%bb%b6%e5%88%a4%e6%96%b7" onclick="onNavClick(`#bool-æ¢ä»¶åˆ¤æ–·-nav`)" id="bool-æ¢ä»¶åˆ¤æ–·-nav">
									bool æ¢ä»¶åˆ¤æ–·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filter-%e7%b5%90%e6%9e%9c%e9%81%8e%e6%bf%be" onclick="onNavClick(`#filter-çµæœéæ¿¾-nav`)" id="filter-çµæœéæ¿¾-nav">
									filter çµæœéæ¿¾
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#aggregation-%e5%9f%b7%e8%a1%8c%e8%81%9a%e5%90%88" onclick="onNavClick(`#aggregation-åŸ·è¡Œèšåˆ-nav`)" id="aggregation-åŸ·è¡Œèšåˆ-nav">
									aggregation åŸ·è¡Œèšåˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ad%90%e8%81%9a%e5%90%88" onclick="onNavClick(`#å­èšåˆ-nav`)" id="å­èšåˆ-nav">
									å­èšåˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#mapping" onclick="onNavClick(`#mapping-nav`)" id="mapping-nav">
									Mapping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8c%87%e5%ae%9amapping" onclick="onNavClick(`#æŒ‡å®šmapping-nav`)" id="æŒ‡å®šmapping-nav">
									æŒ‡å®šmapping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e8%a9%9e" onclick="onNavClick(`#åˆ†è©-nav`)" id="åˆ†è©-nav">
									åˆ†è©
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%89%e8%a3%9dik%e5%88%86%e8%a9%9e%e5%99%a8" onclick="onNavClick(`#å®‰è£ikåˆ†è©å™¨-nav`)" id="å®‰è£ikåˆ†è©å™¨-nav">
									å®‰è£ikåˆ†è©å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%87%aa%e5%ae%9a%e7%be%a9%e8%a9%9e%e5%ba%ab" onclick="onNavClick(`#è‡ªå®šç¾©è©åº«-nav`)" id="è‡ªå®šç¾©è©åº«-nav">
									è‡ªå®šç¾©è©åº«
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%b4%e5%90%88spring" onclick="onNavClick(`#æ•´åˆspring-nav`)" id="æ•´åˆspring-nav">
									æ•´åˆSpring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6%e9%80%a3%e7%b7%9a" onclick="onNavClick(`#æ¸¬è©¦é€£ç·š-nav`)" id="æ¸¬è©¦é€£ç·š-nav">
									æ¸¬è©¦é€£ç·š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%aa%a2%e7%b4%a2%e7%af%84%e4%be%8b" onclick="onNavClick(`#æª¢ç´¢ç¯„ä¾‹-nav`)" id="æª¢ç´¢ç¯„ä¾‹-nav">
									æª¢ç´¢ç¯„ä¾‹
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#elasticsearch" onclick="onNavClick(`#elasticsearch-nav`)" id="elasticsearch-nav">
									ElasticSearch
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%89%e8%a3%9d" onclick="onNavClick(`#å®‰è£-nav`)" id="å®‰è£-nav">
									å®‰è£
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6" onclick="onNavClick(`#æ¸¬è©¦-nav`)" id="æ¸¬è©¦-nav">
									æ¸¬è©¦
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8bdocument" onclick="onNavClick(`#å»ºç«‹ä¸€å€‹document-nav`)" id="å»ºç«‹ä¸€å€‹document-nav">
									å»ºç«‹ä¸€å€‹Document
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#put%e8%88%87post%e6%9b%b4%e6%96%b0" onclick="onNavClick(`#putèˆ‡postæ›´æ–°-nav`)" id="putèˆ‡postæ›´æ–°-nav">
									PUTèˆ‡POSTæ›´æ–°
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#æŸ¥è©¢-nav`)" id="æŸ¥è©¢-nav">
									æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%88%aa" onclick="onNavClick(`#åˆª-nav`)" id="åˆª-nav">
									åˆª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#bulk%e6%89%b9%e6%ac%a1%e6%93%8d%e4%bd%9c" onclick="onNavClick(`#bulkæ‰¹æ¬¡æ“ä½œ-nav`)" id="bulkæ‰¹æ¬¡æ“ä½œ-nav">
									bulkæ‰¹æ¬¡æ“ä½œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#kibana" onclick="onNavClick(`#kibana-nav`)" id="kibana-nav">
									kibana
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#search-api" onclick="onNavClick(`#search-api-nav`)" id="search-api-nav">
									Search Api
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a3%9c%e5%85%85-sql%e6%96%b9%e5%bc%8f%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#è£œå……-sqlæ–¹å¼æŸ¥è©¢-nav`)" id="è£œå……-sqlæ–¹å¼æŸ¥è©¢-nav">
									è£œå……: SQLæ–¹å¼æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#query-dsl" onclick="onNavClick(`#query-dsl-nav`)" id="query-dsl-nav">
									Query DSL
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8c%b9%e9%85%8d%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#åŒ¹é…æŸ¥è©¢-nav`)" id="åŒ¹é…æŸ¥è©¢-nav">
									åŒ¹é…æŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#match-%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#match-åŒ¹é…-nav`)" id="match-åŒ¹é…-nav">
									match åŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#match_phrase-%e7%9f%ad%e5%8f%a5%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#match_phrase-çŸ­å¥åŒ¹é…-nav`)" id="match_phrase-çŸ­å¥åŒ¹é…-nav">
									match_phrase çŸ­å¥åŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#multi_match-%e5%a4%9a%e5%ad%97%e6%ae%b5%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#multi_match-å¤šå­—æ®µåŒ¹é…-nav`)" id="multi_match-å¤šå­—æ®µåŒ¹é…-nav">
									multi_match å¤šå­—æ®µåŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#term-%e7%b2%be%e7%a2%ba%e5%8c%b9%e9%85%8d" onclick="onNavClick(`#term-ç²¾ç¢ºåŒ¹é…-nav`)" id="term-ç²¾ç¢ºåŒ¹é…-nav">
									term ç²¾ç¢ºåŒ¹é…
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a4%87%e5%90%88%e6%9f%a5%e8%a9%a2" onclick="onNavClick(`#è¤‡åˆæŸ¥è©¢-nav`)" id="è¤‡åˆæŸ¥è©¢-nav">
									è¤‡åˆæŸ¥è©¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#bool-%e6%a2%9d%e4%bb%b6%e5%88%a4%e6%96%b7" onclick="onNavClick(`#bool-æ¢ä»¶åˆ¤æ–·-nav`)" id="bool-æ¢ä»¶åˆ¤æ–·-nav">
									bool æ¢ä»¶åˆ¤æ–·
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#filter-%e7%b5%90%e6%9e%9c%e9%81%8e%e6%bf%be" onclick="onNavClick(`#filter-çµæœéæ¿¾-nav`)" id="filter-çµæœéæ¿¾-nav">
									filter çµæœéæ¿¾
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#aggregation-%e5%9f%b7%e8%a1%8c%e8%81%9a%e5%90%88" onclick="onNavClick(`#aggregation-åŸ·è¡Œèšåˆ-nav`)" id="aggregation-åŸ·è¡Œèšåˆ-nav">
									aggregation åŸ·è¡Œèšåˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ad%90%e8%81%9a%e5%90%88" onclick="onNavClick(`#å­èšåˆ-nav`)" id="å­èšåˆ-nav">
									å­èšåˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#mapping" onclick="onNavClick(`#mapping-nav`)" id="mapping-nav">
									Mapping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8c%87%e5%ae%9amapping" onclick="onNavClick(`#æŒ‡å®šmapping-nav`)" id="æŒ‡å®šmapping-nav">
									æŒ‡å®šmapping
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%86%e8%a9%9e" onclick="onNavClick(`#åˆ†è©-nav`)" id="åˆ†è©-nav">
									åˆ†è©
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%ae%89%e8%a3%9dik%e5%88%86%e8%a9%9e%e5%99%a8" onclick="onNavClick(`#å®‰è£ikåˆ†è©å™¨-nav`)" id="å®‰è£ikåˆ†è©å™¨-nav">
									å®‰è£ikåˆ†è©å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%87%aa%e5%ae%9a%e7%be%a9%e8%a9%9e%e5%ba%ab" onclick="onNavClick(`#è‡ªå®šç¾©è©åº«-nav`)" id="è‡ªå®šç¾©è©åº«-nav">
									è‡ªå®šç¾©è©åº«
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%b4%e5%90%88spring" onclick="onNavClick(`#æ•´åˆspring-nav`)" id="æ•´åˆspring-nav">
									æ•´åˆSpring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6%e9%80%a3%e7%b7%9a" onclick="onNavClick(`#æ¸¬è©¦é€£ç·š-nav`)" id="æ¸¬è©¦é€£ç·š-nav">
									æ¸¬è©¦é€£ç·š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%aa%a2%e7%b4%a2%e7%af%84%e4%be%8b" onclick="onNavClick(`#æª¢ç´¢ç¯„ä¾‹-nav`)" id="æª¢ç´¢ç¯„ä¾‹-nav">
									æª¢ç´¢ç¯„ä¾‹
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/elasticsearch.jpg')"
                    
                
            >
                <div class="post-title">
                    ElasticSearchèˆ‡Springæ•´åˆ
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-08
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-01-25 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/nosql">NoSQL</a>
                                &nbsp;
                            
                                <a href="/tags/docker">Docker</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="elasticsearch">ElasticSearch</h1>
<blockquote>
<p>ç”¨ä¾†åŸ·è¡Œç«™å…§æœç´¢(å¦‚å•†å“æŸ¥è©¢)çš„å¼•æ“</p>
</blockquote>
<ul>
<li>é–‹æºçš„åˆ†æ•£å¼æœå°‹å¼•æ“ï¼ŒåŸºæ–¼Apache Luceneï¼Œä½†æ˜¯å°è£æˆREST APIï¼Œæ–¹ä¾¿æ“ä½œ</li>
<li>æ ¸å¿ƒè§€å¿µ: Inverted Index (åå‘ç´¢å¼•)</li>
<li>æ˜¯ NoSQL è³‡æ–™åº«çš„ä¸€ç¨®ï¼Œæ‰€æœ‰çš„è³‡æ–™éƒ½æ˜¯ä»¥ JSON çš„æ–¹å¼é€²è¡Œå­˜å–</li>
<li>åè©å°æ‡‰:</li>
</ul>
<table>
<thead>
<tr>
<th><strong>RDBMS</strong></th>
<th>æ¦‚å¿µ</th>
<th><strong>Elasticsearch</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Table</td>
<td>è¡¨</td>
<td>Index</td>
</tr>
<tr>
<td>Row</td>
<td>ä¸€ç­†è³‡æ–™(ä¾‹å¦‚:å¼µä¸‰)</td>
<td>Document</td>
</tr>
<tr>
<td>Column</td>
<td>å±¬æ€§(ä¾‹å¦‚:å§“å)</td>
<td>Field</td>
</tr>
<tr>
<td>Schema</td>
<td>æ¶æ§‹(ä¾‹å¦‚:è³‡æ–™é¡å‹ã€å…è¨±ç‚ºç©ºç­‰ç­‰)</td>
<td>Mapping</td>
</tr>
<tr>
<td>SQL</td>
<td>æ“ä½œèªå¥</td>
<td>DSL</td>
</tr>
</tbody>
</table>
<ul>
<li>ä»¥å‰å¯èƒ½æœ‰äººæœƒèªªIndexå°æ‡‰databaseï¼Œtypeæ‰æ˜¯å°æ‡‰è¡¨ï¼Œä½†åœ¨ES7ç‰ˆå¾ŒTypeå·²ç¶“å¹¾ä¹è¢«æ£„ç”¨</li>
<li>å€‹äººç›´æ¥æŠŠå®ƒçœ‹ä½œè¡¨äº†ï¼Œç•¢ç«Ÿæ˜¯æ¦‚å¿µï¼Œä¸ç”¨åˆ†å¤ªç´°</li>
</ul>
<h2 id="å®‰è£">å®‰è£</h2>
<blockquote>
<p>ä½¿ç”¨docker</p>
</blockquote>
<ul>
<li>æ•™å­¸çš„ä»–è¨­å®šæ›è¼‰ä½ç½®èˆ‡æ’ä»¶è·¯å¾‘ï¼Œä¸¦å–å¾—æ¬Šé™ç­‰ç­‰ï¼Œæ–¹ä¾¿å¾ŒçºŒæ“ä½œ</li>
</ul>
<pre tabindex="0"><code>mkdir -p /mydata/elasticsearch/config
mkdir -p /mydata/elasticsearch/data
echo &#34;http.host: 0.0.0.0&#34; &gt;/mydata/elasticsearch/config/elasticsearch.yml
chmod -R 777 /mydata/elasticsearch/
</code></pre><ul>
<li>äºŒåˆä¸€é¡åƒ: <a href="https://hub.docker.com/r/nshou/elasticsearch-kibana">https://hub.docker.com/r/nshou/elasticsearch-kibana</a>
<ul>
<li>ç›®å‰2022å¹´1æœˆæ˜¯7.16.2æ¿</li>
<li>æˆ‘ç›´æ¥ç”¨docker desktopï¼Œå°±æ²’æ›è¼‰é‚£éº¼å¤š</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>docker pull nshou/elasticsearch-kibana

docker run --name elasticsearch -p 5601:5601 -p 9200:9200 -e  &#34;discovery.type=single-node&#34; -e ES_JAVA_OPTS=&#34;-Xms64m -Xmx512m&#34; -d nshou/elasticsearch-kibana
</code></pre><ul>
<li><code>--name</code> å–å</li>
<li><code>-e &quot;discovery.type=single-node&quot;</code>  å–®ç¯€é»æ¨¡å¼</li>
<li><code>-e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot;</code> é™åˆ¶è¨˜æ†¶é«”ï¼Œä¸é™æœƒå ç”¨è¶…å¤š</li>
<li><code>-p</code> é€£æ¥é˜œ
<ul>
<li>Elasticsearch @ localhost:9200</li>
<li>Kibana @ localhost:5601</li>
</ul>
</li>
<li><code>-d</code> å¾Œå°é‹è¡Œä¸¦è¿”å›id</li>
</ul>
<h3 id="æ¸¬è©¦">æ¸¬è©¦</h3>
<ul>
<li>å˜—è©¦çœ‹çœ‹Kibanaä»‹é¢ï¼Œè¨ªå•: localhost:5601</li>
<li>æŸ¥çœ‹ä¸»æœå‹™å¥åº·: http://localhost:9200/_cat/health</li>
</ul>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<ul>
<li>æŸ¥çœ‹ç´¢å¼•: http://localhost:9200/_cat/indices
<ul>
<li>ç›¸ç•¶æ–¼show databasesæˆ–tables</li>
</ul>
</li>
</ul>
<h3 id="å»ºç«‹ä¸€å€‹document">å»ºç«‹ä¸€å€‹Document</h3>
<ul>
<li>ä½¿ç”¨PUTè«‹æ±‚ http://localhost:9200/customer/external/1
<ul>
<li>ä¸¦ä¸”å¸¶æœ‰bodyè³‡è¨Š</li>
</ul>
</li>
</ul>
<p><img src="image-20220118235447277.png" alt="image-20220118235447277"></p>
<ul>
<li>
<p>è¿”å›çš„æ˜¯metadataï¼Œå¾Œè¨­è³‡æ–™ï¼Œé€™äº›<code>_</code>é–‹é ­çš„å°±æ˜¯è³‡æ–™çš„è³‡æ–™</p>
<ul>
<li><code>_index</code>ï¼šdocument æ‰€å±¬çš„ index åç¨±ï¼Œç›¸ç•¶æ–¼&quot;è¡¨&quot;</li>
<li><code>_type</code>ï¼šdocument é¡å‹ ï¼Œé€šå¸¸ç‚º<code>_doc</code></li>
<li><code>_id</code>ï¼šdocument IDï¼Œä¸»éµ</li>
<li><code>_source</code>ï¼šdocument çš„åŸå§‹ JSON è³‡æ–™æ¨£è²Œ</li>
<li><code>_version</code>ï¼šç‰ˆæœ¬è¨Šæ¯ (æœ‰é€™æ¬„ä½å°±è¡¨ç¤º ES å…·æœ‰ç‰ˆæœ¬æ§ç®¡çš„èƒ½åŠ›)</li>
<li><code>_score</code>ï¼šæŸ¥è©¢æ™‚çš„ç®—åˆ†çµæœ (æ¯æ¬¡çš„æœå°‹éƒ½æœƒæ ¹æ“š document å°æ–¼æœå°‹å…§å®¹çš„ç›¸é—œåº¦é€²è¡Œç®—åˆ†)</li>
</ul>
</li>
<li>
<p><code>index</code> åœ¨ ES ä¸­æ˜¯å€‹é‚è¼¯ç©ºé–“çš„æ¦‚å¿µï¼Œç”¨ä¾†å„²å­˜ document çš„å®¹å™¨ï¼Œè€Œé€™äº› document å…§å®¹éƒ½æ˜¯ç›¸ä¼¼çš„ (è·Ÿå…¶ä»–é ˜åŸŸçš„ index ç”¨æ³•ä¸å¤ªä¸€æ¨£)</p>
</li>
<li>
<p><code>shard</code> åœ¨ ES ä¸­å‰‡æ˜¯å€‹ç‰©ç†ç©ºé–“çš„çš„æ¦‚å¿µï¼Œindex ä¸­çš„è³‡æ–™æœƒåˆ†æ•£æ”¾åœ¨ä¸åŒçš„ shard ä¸­</p>
</li>
</ul>
<h3 id="putèˆ‡postæ›´æ–°">PUTèˆ‡POSTæ›´æ–°</h3>
<ul>
<li>PUTå¿…é ˆæŒ‡å®šIDï¼Œå¦‚æœå­˜åœ¨å‰‡æ›´æ–°(è¦†è“‹æ›´æ–°)
<ul>
<li>èˆ‡RESTè¦å‰‡ç›¸ç¬¦ï¼ŒPUTæ˜¯å†ªç­‰ï¼Œå³å¤šæ¬¡æ“ä½œçµæœè¿”å›ç›¸åŒ(æ¯æ¬¡éƒ½æœƒæ•´å€‹åˆ·æ–°çš„æ„æ€)</li>
</ul>
</li>
<li>POSTä¸å¿…æŒ‡å®šIDï¼Œå¦‚æœä¸å­˜åœ¨å°±å»ºç«‹ï¼Œå·²å­˜åœ¨å°±æ›´æ–°
<ul>
<li>ä½†æ˜¯å¦‚æœè³‡æ–™éƒ½æ²’è®Šå‹•ï¼Œå°±ä¸æ›´æ–°ï¼Œä¸”æœƒè¿”å›&quot;noop&quot;</li>
</ul>
</li>
</ul>
<h3 id="æŸ¥è©¢">æŸ¥è©¢</h3>
<ul>
<li>
<p>ä½¿ç”¨GETè«‹æ±‚ http://localhost:9200/customer/external/1</p>
<ul>
<li>ä¸¦ä¸”ä¸èƒ½æœ‰body</li>
</ul>
</li>
<li>
<p>è¿”å›</p>
</li>
</ul>
<pre tabindex="0"><code>    &#34;_version&#34;: 1,
    &#34;_seq_no&#34;: 0,
    &#34;_primary_term&#34;: 1,
</code></pre><p><code>_seq_no</code> æ¯æ¬¡æ›´æ–°éƒ½æœƒ+1ï¼Œç”¨ä¾†åšæ¨‚è§€é–</p>
<p><code>_primary_term</code> ç•¶ä¸»åˆ†ç‰‡é‡æ–°åˆ†é…ï¼Œå¦‚é‡å•Ÿå°±æœƒè®ŠåŒ–</p>
<h3 id="åˆª">åˆª</h3>
<ul>
<li>å°±DELETEï¼Œå¯ä»¥æŒ‡å®šIDï¼Œæˆ–æ•´å€‹indexå…¨åˆª</li>
<li>æ²’è¾¦æ³•åˆªé™¤type</li>
</ul>
<h3 id="bulkæ‰¹æ¬¡æ“ä½œ">bulkæ‰¹æ¬¡æ“ä½œ</h3>
<ul>
<li>æ¯æ¢èªæ³•ç¨ç«‹ï¼Œå…¶ä¸­æœ‰èª°å¤±æ•—ä¸å½±éŸ¿å…¶ä»–äºº</li>
<li>ç¯„ä¾‹:</li>
</ul>
<pre tabindex="0"><code>POST customer/external/_bulk
{&#34;index&#34;:{&#34;_id&#34;:&#34;1&#34;}}
{&#34;name&#34;:&#34;John Doe&#34;}
{&#34;index&#34;:{&#34;_id&#34;:&#34;2&#34;}}
{&#34;name&#34;:&#34;John Doe&#34;}
</code></pre><h2 id="kibana">kibana</h2>
<blockquote>
<p>èˆ’æœçš„å¯è¦–åŒ–æ“ä½œä»‹é¢</p>
</blockquote>
<ul>
<li>
<p>é€£ç·šåˆ°: localhost:5601</p>
</li>
<li>
<p>å°å…¥æ¸¬è©¦æ•¸æ“š:</p>
</li>
<li>
<p><a href="https://github.com/elastic/elasticsearch/blob/v7.4.2/docs/src/test/resources/accounts.json">https://github.com/elastic/elasticsearch/blob/v7.4.2/docs/src/test/resources/accounts.json</a></p>
</li>
</ul>
<pre tabindex="0"><code>POST bank/account/_bulk
(å»githubè¤‡è£½è²¼åˆ°é€™)
</code></pre><p><img src="image-20220119003426307.png" alt="image-20220119003426307"></p>
<h2 id="search-api">Search Api</h2>
<blockquote>
<p>å…©ç¨®åŸºæœ¬æª¢ç´¢æ–¹å¼</p>
</blockquote>
<ul>
<li>é€šéREST request uri ç™¼é€æœç´¢åƒæ•¸ ï¼ˆuri +æª¢ç´¢åƒæ•¸ï¼‰</li>
</ul>
<pre tabindex="0"><code>GET bank/_search?q=*&amp;sort=account_number:asc
</code></pre><ul>
<li>é€šéREST request body ä¾†ç™¼é€å®ƒå€‘ï¼ˆuri+è«‹æ±‚é«”ï¼‰
<ul>
<li>åªèƒ½ç”¨åœ¨dev toolï¼Œä¸€èˆ¬HTTPä¸çµ¦ä½ ç™¼GETå¸¶bodyçš„</li>
<li>åœ¨kibana dev_toolsç”¨ctrl + enteråšç‚ºåŸ·è¡Œçš„å¿«æ·éµ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">/bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: { <span style="color:#8b008b;font-weight:bold">&#34;match_all&#34;</span>: {} },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;sort&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#8b008b;font-weight:bold">&#34;account_number&#34;</span>: <span style="color:#cd5555">&#34;asc&#34;</span> },
</span></span><span style="display:flex;"><span>    {<span style="color:#8b008b;font-weight:bold">&#34;balance&#34;</span>:<span style="color:#cd5555">&#34;desc&#34;</span>}
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>è¿”å›çš„å€¼</p>
<ul>
<li><code>hits</code> çµæœæ•¸é‡</li>
<li><code>_score</code> å¾—åˆ†(å­—ä¸²æ¯”å°çš„å¾—åˆ†)</li>
</ul>
</li>
</ul>
<h3 id="è£œå……-sqlæ–¹å¼æŸ¥è©¢">è£œå……: SQLæ–¹å¼æŸ¥è©¢</h3>
<ul>
<li>æˆ‘å¾Œä¾†æ‰çŸ¥é“ES 6.3ä»¥å¾ŒåŸç”Ÿæ”¯æŒç”¨SQLæ–¹å¼ä¾†æŸ¥ï¼Œä¾‹å¦‚:</li>
</ul>
<pre tabindex="0"><code>POST /_sql?format=txt
{
  &#34;query&#34;: &#34;SELECT account_number,address,age,balance FROM account LIMIT 10&#34;
}
</code></pre><ul>
<li>å°æ–¼ä¸€èˆ¬ä½¿ç”¨ä¾†èªªå®Œå…¨è¶³å¤ äº†ï¼Œæœ‰éœ€è¦æ·±åº¦ä½¿ç”¨å†å­¸DSLå§</li>
<li>åƒè€ƒ : <a href="http://www.macrozheng.com/#/reference/elasticsearch_sql_start">http://www.macrozheng.com/#/reference/elasticsearch_sql_start</a></li>
</ul>
<h2 id="query-dsl">Query DSL</h2>
<ul>
<li>Elasticsearchæä¾›äº†ä¸€å€‹å¯ä»¥åŸ·è¡ŒæŸ¥è©¢çš„Jsoné¢¨æ ¼çš„DSLã€‚é€™å€‹è¢«ç¨±ç‚ºQuery DSLï¼Œè©²æŸ¥è©¢èªè¨€éå¸¸å…¨é¢ã€‚ä¾‹å¦‚:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">QUERY_NAME:</span>{
</span></span><span style="display:flex;"><span>   <span style="color:#a61717;background-color:#e3d2d2">ARGUMENT:VALUE,</span>
</span></span><span style="display:flex;"><span>   <span style="color:#a61717;background-color:#e3d2d2">ARGUMENT:VALUE,...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#a61717;background-color:#e3d2d2">QUERY_NAME:{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a61717;background-color:#e3d2d2">FIELD_NAME:{</span>
</span></span><span style="display:flex;"><span>       <span style="color:#a61717;background-color:#e3d2d2">ARGUMENT:VALUE,</span>
</span></span><span style="display:flex;"><span>       <span style="color:#a61717;background-color:#e3d2d2">ARGUMENT:VALUE,...</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>   <span style="color:#a61717;background-color:#e3d2d2">}</span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match_all&#34;</span>: {}
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;from&#34;</span>: <span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">5</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;sort&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;account_number&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;order&#34;</span>: <span style="color:#cd5555">&#34;desc&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match_all&#34;</span>: {}
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;from&#34;</span>: <span style="color:#b452cd">0</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">5</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;sort&#34;</span>: [
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;account_number&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;order&#34;</span>: <span style="color:#cd5555">&#34;desc&#34;</span>
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  ],
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;_source&#34;</span>: [<span style="color:#cd5555">&#34;balance&#34;</span>,<span style="color:#cd5555">&#34;firstname&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>match_all</code> ä»£è¡¨æŸ¥è©¢æ‰€æœ‰ï¼Œesä¸­å¯ä»¥åœ¨<code>query</code>ä¸­çµ„åˆéå¸¸å¤šçš„æŸ¥è©¢é¡å‹å®Œæˆè¤‡é›œæŸ¥è©¢</li>
<li><code>from</code> + <code>size</code> é™å®šè¿”å›æ•¸é‡ï¼Œå®Œæˆåˆ†é åŠŸèƒ½</li>
<li><code>sort</code> æ’åºï¼Œå¯ä»¥å¤šé‡æ’åº(å‰ä¸€å€‹é †ä½ç›¸ç­‰æ™‚)</li>
<li><code>_source</code> åªæƒ³è¿”å›æŸäº›å±¬æ€§</li>
</ul>
<h3 id="åŒ¹é…æŸ¥è©¢">åŒ¹é…æŸ¥è©¢</h3>
<h4 id="match-åŒ¹é…">match åŒ¹é…</h4>
<ul>
<li>ä¾‹å¦‚åŒ¹é…æŸå€¼ç­‰æ–¼å¤šå°‘</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;account_number&#34;</span>: <span style="color:#cd5555">&#34;20&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ä¹Ÿå¯ä»¥æ¨¡ç³ŠåŒ¹é…ï¼Œæœƒé€²è¡Œåˆ†è©åŒ¹é…ä¸¦ä¾ç…§å¾—åˆ†æ’åºè¿”å›
<ul>
<li>æœƒç”¨AviationæŸ¥ã€ç”¨RoadæŸ¥ï¼Œç„¶å¾Œæœ€æ¥è¿‘Aviation Roadçš„æœƒæ’åœ¨å‰é¢</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;address&#34;</span>: <span style="color:#cd5555">&#34;Aviation Road&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="match_phrase-çŸ­å¥åŒ¹é…">match_phrase çŸ­å¥åŒ¹é…</h4>
<ul>
<li>ä¸èƒ½æ‹†åˆ†ï¼Œä¸€å®šè¦åŒ…å«å®Œæ•´çš„<code>Aviation Road</code>
<ul>
<li>ä½†æ˜¯å¯ä»¥æ›´é•·ï¼Œä¾‹å¦‚è¿”å›çš„çµæœæ˜¯ <code>2123 Aviation Road xxx</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match_phrase&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;address&#34;</span>: <span style="color:#cd5555">&#34;Aviation Road&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="multi_match-å¤šå­—æ®µåŒ¹é…">multi_match å¤šå­—æ®µåŒ¹é…</h4>
<ul>
<li>addressæˆ–cityä¸­åŒ…å«&quot;mill&quot;çš„
<ul>
<li>ä¹Ÿèƒ½å¤šæŸ¥è©¢å­—ï¼Œä¾‹å¦‚&quot;mill road&quot;å°±æœƒè·Ÿå‰é¢æ¨¡ç³ŠåŒ¹é…ä¸€æ¨£åˆ†è©</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;multi_match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: <span style="color:#cd5555">&#34;mill &#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;fields&#34;</span>: [<span style="color:#cd5555">&#34;address&#34;</span>,<span style="color:#cd5555">&#34;city&#34;</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="term-ç²¾ç¢ºåŒ¹é…">term ç²¾ç¢ºåŒ¹é…</h4>
<ul>
<li>
<p>é¡ä¼¼matchåŒ¹é…æŸå€‹å±¬æ€§ï¼Œä½†æ˜¯term<strong>ä¸åˆ†è©</strong>ä¸”é ˆå®Œå…¨ç¬¦åˆ</p>
<ul>
<li>ä¾‹å¦‚ç”¨termæ‰¾&quot;Aviation Road&quot;ï¼Œå°±åªæœƒæ‰¾addresså®Œå…¨ä¸€è‡´çš„é‚£å€‹&quot;Aviation Road&quot;ï¼Œå¤ªé•·å¤ªçŸ­æœ‰æ²’æœ‰ç©ºæ ¼é€šé€šout</li>
</ul>
</li>
<li>
<p>ç¸½ä¹‹æ–‡å­—æª¢ç´¢ç”¨matchï¼Œå…¶ä»–éæ–‡å­—åŒ¹é…ç”¨term</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;term&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;address&#34;</span>: <span style="color:#cd5555">&#34;Aviation Road&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="è¤‡åˆæŸ¥è©¢">è¤‡åˆæŸ¥è©¢</h3>
<blockquote>
<p>å¯ä»¥çµ„åˆåµŒå¥—ä½¿ç”¨ï¼Œè®“æŸ¥è©¢æ¢ä»¶åƒè®Šè¬åŒ–</p>
</blockquote>
<h4 id="bool-æ¢ä»¶åˆ¤æ–·">bool æ¢ä»¶åˆ¤æ–·</h4>
<ul>
<li>
<p><code>must</code> å¿…é ˆé”åˆ°mustæ‰€åˆ—èˆ‰çš„æ‰€æœ‰æ¢ä»¶</p>
<ul>
<li>å°±æ˜¯and</li>
</ul>
</li>
<li>
<p><code>must_not</code> å¿…é ˆä¸åŒ¹é…<code>must_not</code>æ‰€åˆ—èˆ‰çš„æ‰€æœ‰æ¢ä»¶</p>
<ul>
<li>å°±æ˜¯not</li>
</ul>
</li>
<li>
<p><code>should</code> æ‡‰è©²æ»¿è¶³shouldæ‰€åˆ—èˆ‰çš„æ¢ä»¶</p>
<ul>
<li>å°±æ˜¯åŠ åˆ†é …ï¼Œæœ‰æ›´å¥½ï¼Œæ²’æœ‰ä¹Ÿè¡Œ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>   <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>:{
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;bool&#34;</span>:{
</span></span><span style="display:flex;"><span>             <span style="color:#8b008b;font-weight:bold">&#34;must&#34;</span>:[
</span></span><span style="display:flex;"><span>              {<span style="color:#8b008b;font-weight:bold">&#34;match&#34;</span>:{<span style="color:#8b008b;font-weight:bold">&#34;address&#34;</span>:<span style="color:#cd5555">&#34;mill&#34;</span>}},
</span></span><span style="display:flex;"><span>              {<span style="color:#8b008b;font-weight:bold">&#34;match&#34;</span>:{<span style="color:#8b008b;font-weight:bold">&#34;gender&#34;</span>:<span style="color:#cd5555">&#34;M&#34;</span>}}
</span></span><span style="display:flex;"><span>             ]
</span></span><span style="display:flex;"><span>         }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>åœ¨booleanæŸ¥è©¢ä¸­ï¼Œ<code>must</code>, <code>should</code> å’Œ<code>must_not</code> å…ƒç´ éƒ½è¢«ç¨±ç‚ºæŸ¥è©¢å­å¥</li>
<li>æ–‡æª”æ˜¯å¦ç¬¦åˆæ¯å€‹å­å¥ä¸­çš„æ¨™æº–ï¼Œæ±ºå®šäº†æ–‡æª”çš„&quot;<strong>ç›¸é—œæ€§å¾—åˆ†</strong>&quot;</li>
</ul>
<h4 id="filter-çµæœéæ¿¾">filter çµæœéæ¿¾</h4>
<ul>
<li>ä¸æœƒè¨ˆç®—ç›¸é—œæ€§å¾—åˆ†ï¼Œç´”éæ¿¾
<ul>
<li>ç”¨åœ¨ä¸æƒ³å°è©•åˆ†æ’åºæœ‰å½±éŸ¿çš„å ´åˆï¼Œé¡ä¼¼betweenä¹‹é¡</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;bool&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;must&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;match&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;address&#34;</span>: <span style="color:#cd5555">&#34;mill&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ],
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;filter&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;range&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;balance&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;gte&#34;</span>: <span style="color:#cd5555">&#34;10000&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;lte&#34;</span>: <span style="color:#cd5555">&#34;20000&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="aggregation-åŸ·è¡Œèšåˆ">aggregation åŸ·è¡Œèšåˆ</h3>
<ul>
<li>é¡ä¼¼GROUP BYçš„æ¦‚å¿µï¼Œå¯ä»¥å°‡æŸ¥è©¢çš„çµæœä¾ç…§æ¢ä»¶åˆ†çµ„æ‰“åŒ…æˆ<code>buckets</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;NAME&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;AGG_TYPE&#34;</span>: {}
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>NAME</code> é€™æ¬¡èšåˆçš„åå­—ï¼Œå°±åƒMySQLå–åˆ¥å</li>
<li><code>AGG_TYPE</code> èšåˆçš„é¡å‹
<ul>
<li><code>avg</code> å¹³å‡</li>
<li><code>term</code> ç²¾ç¢ºåŒ¹é…</li>
<li><code>terms</code> å¤šå€‹ç²¾ç¢ºåŒ¹é…</li>
</ul>
</li>
</ul>
<p><img src="image-20220119152725760.png" alt="image-20220119152725760"></p>
<h4 id="å­èšåˆ">å­èšåˆ</h4>
<ul>
<li>åŸºæ–¼æŸå€‹èšåˆçµæœä¾†èšåˆï¼Œå¯«åœ¨çˆ¶èšåˆä¹‹å…§
<ul>
<li><code>&quot;size&quot;: 0</code> ä¸æƒ³é—œæ³¨æ¯å€‹äººçš„è©³æƒ…ï¼Œåªæƒ³è¦çµ±è¨ˆçµæœ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match_all&#34;</span>: {}
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;å¹´é½¡åˆ†çµ„&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;age&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">10</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;å¹³å‡è–ªè³‡&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;avg&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;balance&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="image-20220119154011303.png" alt="image-20220119154011303"></p>
<ul>
<li>ç¯„ä¾‹2: æŸ¥å‡ºæ‰€æœ‰å¹´é½¡åˆ†ä½ˆï¼Œä¸¦ä¸”é€™äº›å¹´é½¡æ®µä¸­Mçš„å¹³å‡è–ªè³‡å’ŒFçš„å¹³å‡è–ªè³‡ä»¥åŠé€™å€‹å¹´é½¡æ®µçš„ç¸½é«”å¹³å‡è–ªè³‡
<ul>
<li><code>.keyword</code> ç²¾ç¢ºåŒ¹é…</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">GET</span> <span style="color:#a61717;background-color:#e3d2d2">bank/_search</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;query&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;match_all&#34;</span>: {}
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&#34;ageAgg&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;age&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">100</span>
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>      <span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;genderAgg&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;terms&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;gender.keyword&#34;</span>
</span></span><span style="display:flex;"><span>          },
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;aggs&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;balanceAvg&#34;</span>: {
</span></span><span style="display:flex;"><span>              <span style="color:#8b008b;font-weight:bold">&#34;avg&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;balance&#34;</span>
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&#34;ageBalanceAvg&#34;</span>: {
</span></span><span style="display:flex;"><span>          <span style="color:#8b008b;font-weight:bold">&#34;avg&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&#34;field&#34;</span>: <span style="color:#cd5555">&#34;balance&#34;</span>
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;size&#34;</span>: <span style="color:#b452cd">0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="image-20220119154724229.png" alt="image-20220119154724229"></p>
<hr>
<h2 id="mapping">Mapping</h2>
<blockquote>
<p>å°±æ˜¯å»ºè¡¨æ™‚æŒ‡å®šå­˜åœ¨è£¡é¢çš„ç©æ„çš„è¦å‰‡</p>
</blockquote>
<ul>
<li>
<p>Mapingæ˜¯ç”¨ä¾†å®šç¾©ä¸€å€‹æ–‡æª”ï¼ˆdocumentï¼‰ï¼Œä»¥åŠå®ƒæ‰€åŒ…å«çš„å±¬æ€§ï¼ˆfieldï¼‰æ˜¯å¦‚ä½•å­˜å„²å’Œç´¢å¼•çš„ã€‚æ¯”å¦‚:</p>
<ul>
<li>
<p>æ•¸å€¼æ ¼å¼: éƒ½æ˜¯jsonä½†ä¹Ÿèƒ½åˆ†textã€long</p>
</li>
<li>
<p>å“ªäº›å­—ç¬¦ä¸²å±¬æ€§æ‡‰è©²è¢«çœ‹åšå…¨æ–‡æœ¬å±¬æ€§ï¼ˆfull text fieldsï¼‰</p>
</li>
<li>
<p>å“ªäº›å±¬æ€§åŒ…å«æ•¸å­—ï¼Œæ—¥æœŸæˆ–åœ°ç†ä½ç½®</p>
</li>
<li>
<p>æ–‡æª”ä¸­çš„æ‰€æœ‰å±¬æ€§æ˜¯å¦éƒ½è¢«ç´¢å¼•(å°±æ˜¯æ±ºå®šæ˜¯å¦æœƒè¢«æœï¼Œé è¨­éƒ½æ˜¯true)</p>
</li>
<li>
<p>æ—¥æœŸçš„æ ¼å¼</p>
</li>
<li>
<p>è‡ªå®šç¾©æ˜ å°„è¦å‰‡ä¾†åŸ·è¡Œå‹•æ…‹æ·»åŠ å±¬æ€§</p>
</li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹mappingä¿¡æ¯ <code>GET bank/_mapping</code></p>
</li>
</ul>
<h3 id="æŒ‡å®šmapping">æŒ‡å®šmapping</h3>
<ul>
<li>è¦åœ¨å»ºç«‹indexçš„æ™‚å€™å°±æŒ‡å®šï¼Œä¸ç„¶å°±æ˜¯é è¨­çš„
<ul>
<li>é¡ä¼¼SQLå»ºè¡¨çš„æ™‚å€™æŒ‡å®šè¡¨çš„æ§‹æˆ</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>PUT /my_index
{
  &#34;mappings&#34;: {
    &#34;properties&#34;: {
      &#34;age&#34;: {
        &#34;type&#34;: &#34;integer&#34;
      },
      &#34;email&#34;: {
        &#34;type&#34;: &#34;keyword&#34;
      },
      &#34;name&#34;: {
        &#34;type&#34;: &#34;text&#34;
      }
    }
  }
}
</code></pre><ul>
<li>Mappingå»ºå®Œå°±ä¸èƒ½æ”¹ï¼Œè¦æ”¹åªèƒ½åƒçµ¦databaseæ”¹åï¼Œè¤‡è£½å»ºæ–°çš„é‚£æ¨£</li>
</ul>
<h2 id="åˆ†è©">åˆ†è©</h2>
<ul>
<li>é¡§åæ€ç¾©å°‡è©æ‹†é–‹æˆæœ‰æ„ç¾©çš„ç‰‡æ®µï¼Œé è¨­å°±æ˜¯ç”¨standardæ¨™æº–åˆ†è©å™¨ï¼Œä¾‹å¦‚:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#cd5555">&#34;standard&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;text&#34;</span>: <span style="color:#cd5555">&#34;The 2 QUICK Brown-Foxes jumped over the lazy dog&#39;s bone.&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>tokenizeråˆ†è©å™¨ï¼Œå°‡è©æ‹†æˆä¸€å€‹ä¸€å€‹çš„<code>token</code></li>
<li>é è¨­çš„ä¸­æ–‡åˆ†ä¸å¥½(æ‡‰è©²èªªåªæœƒå…¨éƒ¨æ‹†æˆä¸€å€‹å­—)ï¼Œéœ€è¦ç«åŠ›æ”¯æ´</li>
</ul>
<h3 id="å®‰è£ikåˆ†è©å™¨">å®‰è£ikåˆ†è©å™¨</h3>
<ul>
<li>
<p><a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<ul>
<li>éœ€è¦å°æ‡‰ç‰ˆæœ¬</li>
</ul>
</li>
<li>
<p>ä½¿ç”¨æ’ä»¶å®‰è£ï¼Œè¶…ç°¡å–®ï¼Œé€²åˆ°å®¹å™¨å…§ä½¿ç”¨å‘½ä»¤</p>
</li>
</ul>
<pre tabindex="0"><code>./bin/elasticsearch-plugin install xxxæ’ä»¶ç‰ˆæœ¬è³‡æºç¶²å€
</code></pre><ul>
<li>ç›´æ¥å¾docker desktopæ‰“é–‹è©²å®¹å™¨çš„CLI</li>
<li>å› ç‚ºæ˜¯2åˆä¸€é¡åƒï¼Œé€²äº†å®¹å™¨é‚„è¦<code>cd elasticsearch-7.16.2</code>å†é€²åˆ°elasticsearchè³‡æ–™å¤¾ä¸‹ï¼ŒåŸ·è¡Œ:</li>
</ul>
<pre tabindex="0"><code>./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.16.2/elasticsearch-analysis-ik-7.16.2.zip
</code></pre><p><img src="image-20220119161207797.png" alt="image-20220119161207797"></p>
<ul>
<li>å¦å¤–é™„ä¸Šæ•™å­¸çš„æ‰‹å‹•æ–¹æ³•ï¼Œåœ¨å‰é¢æˆ‘å€‘å·²ç¶“å°‡elasticsearchå®¹å™¨çš„â€œ/usr/share/elasticsearch/pluginsâ€ç›®éŒ„ï¼Œæ˜ å°„åˆ°å®¿ä¸»æ©Ÿçš„â€œ /mydata/elasticsearch/pluginsâ€ç›®éŒ„ä¸‹ï¼Œæ‰€ä»¥æ¯”è¼ƒæ–¹ä¾¿çš„åšæ³•å°±æ˜¯ä¸‹è¼‰â€œ/elasticsearch-analysis-ik-xxx.zipâ€æ–‡ä»¶ï¼Œç„¶å¾Œè§£å£“åˆ°è©²æ–‡ä»¶å¤¾ä¸‹å³å¯</li>
</ul>
<pre tabindex="0"><code>// é€²å…¥eså®¹å™¨å…§éƒ¨pluginç›®éŒ„
docker exec -it elasticsearch /bin/bash

// ä¸‹è¼‰
# wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip

// è§£å£“ç¸®
unzip elasticsearch-analysis-ik-7.6.2.zip -d ink

// æ¬åˆ°æ’ä»¶è³‡æ–™å¤¾
mv ik plugins/

// åˆªé™¤æ®˜é¤˜
rm -rf elasticsearch-analysis-ik-7.6.2.zip
</code></pre><ul>
<li>æ”¹å®Œéƒ½è¦é‡å•Ÿå®¹å™¨æ‰èƒ½ç”Ÿæ•ˆ!</li>
<li>æ¸¬è©¦:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">POST</span> <span style="color:#a61717;background-color:#e3d2d2">_analyze</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;analyzer&#34;</span>: <span style="color:#cd5555">&#34;ik_max_word&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#8b008b;font-weight:bold">&#34;text&#34;</span>: <span style="color:#cd5555">&#34;ã€Šç™½é›ªå…¬ä¸»ã€‹æ˜¯å»£æ³›æµè¡Œæ–¼æ­æ´²çš„ä¸€ç¯‡å¾·åœ‹ç«¥è©±ï¼Œäº¦æ˜¯è©²ç«¥è©±ä¸­çš„ä¸»è§’ã€‚å…¶æœ€è‘—åçš„ç‰ˆæœ¬è¦‹æ–¼å¾·åœ‹ã€Šæ ¼æ—ç«¥è©±ã€‹ï¼Œè¬›è¿°äº†ç™½é›ªå…¬ä¸»å—åˆ°ç¹¼æ¯çš„è™å¾…ï¼Œé€ƒåˆ°æ£®æ—è£¡ï¼Œé‡åˆ°ä¸ƒå€‹å°çŸ®äººçš„æ•…äº‹&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="image-20220119161834409.png" alt="image-20220119161834409"></p>
<h3 id="è‡ªå®šç¾©è©åº«">è‡ªå®šç¾©è©åº«</h3>
<ul>
<li>ä¿®æ”¹<code>/usr/share/elasticsearch/plugins/ik/config</code>ä¸­çš„<code>IKAnalyzer.cfg.xml</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#1e889b">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#1e889b">&lt;!DOCTYPE properties SYSTEM &#34;http://java.sun.com/dtd/properties.dtd&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">&lt;comment&gt;</span>IK Analyzer æ“´å±•é…ç½®<span style="color:#8b008b;font-weight:bold">&lt;/comment&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨é€™è£é…ç½®è‡ªå·±çš„æ“´å±•å­—å…¸ --&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">&lt;entry</span> <span style="color:#658b00">key=</span><span style="color:#cd5555">&#34;ext_dict&#34;</span><span style="color:#8b008b;font-weight:bold">&gt;&lt;/entry&gt;</span>
</span></span><span style="display:flex;"><span>	 <span style="color:#228b22">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨é€™è£é…ç½®è‡ªå·±çš„æ“´å±•åœæ­¢è©å­—å…¸--&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8b008b;font-weight:bold">&lt;entry</span> <span style="color:#658b00">key=</span><span style="color:#cd5555">&#34;ext_stopwords&#34;</span><span style="color:#8b008b;font-weight:bold">&gt;&lt;/entry&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨é€™è£é…ç½®é ç¨‹æ“´å±•å­—å…¸ --&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">&lt;!-- &lt;entry key=&#34;remote_ext_dict&#34;&gt;words_location&lt;/entry&gt; --&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨é€™è£é…ç½®é ç¨‹æ“´å±•åœæ­¢è©å­—å…¸--&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#228b22">&lt;!-- &lt;entry key=&#34;remote_ext_stopwords&#34;&gt;words_location&lt;/entry&gt; --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/properties&gt;</span>
</span></span></code></pre></div><ul>
<li>æ›´æ–°å®Œæˆå¾Œï¼Œesåªæœƒå°æ–¼æ–°å¢çš„æ•¸æ“šç”¨æ›´æ–°åˆ†è©ã€‚æ­·å²æ•¸æ“šæ˜¯ä¸æœƒé‡æ–°åˆ†è©çš„ã€‚å¦‚æœæƒ³è¦æ­·å²æ•¸æ“šé‡æ–°åˆ†è©ï¼Œéœ€è¦åŸ·è¡Œ:</li>
</ul>
<pre tabindex="0"><code>POST my_index/_update_by_query?conflicts=proceed
</code></pre><ul>
<li>æˆ‘ç”¨çš„äºŒåˆä¸€é¡åƒæ˜¯åœ¨</li>
</ul>
<pre tabindex="0"><code>/home/elasticsearch/elasticsearch-7.16.2/config/analysis-ik/IKAnalyzer.cfg.xml
</code></pre><ul>
<li>å°‡æª”æ¡ˆæŠ“å‡ºä¾†æ”¾åˆ°linuxå®¿ä¸»<code>/mydata/elasticsearch</code>è·¯å¾‘ä¸‹</li>
</ul>
<pre tabindex="0"><code>docker cp elasticsearch:/home/elasticsearch/elasticsearch-7.16.2/config/analysis-ik/IKAnalyzer.cfg.xml /mydata/elasticsearch
</code></pre><ul>
<li>æ”¹ä¸€æ”¹ï¼Œå¡å›å»</li>
</ul>
<hr>
<h1 id="æ•´åˆspring">æ•´åˆSpring</h1>
<ul>
<li>å°ä¾è³´ï¼Œæ³¨æ„ç‰ˆæœ¬è¦ç­‰åŒELKçš„ç‰ˆæœ¬</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.elasticsearch.client<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>elasticsearch-rest-high-level-client<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;version&gt;</span>7.16.2<span style="color:#8b008b;font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ul>
<li>ä¸¦ä¸”è¦åœ¨é …ç›®ä¸­æŒ‡å®šproperties</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;properties&gt;</span>
</span></span><span style="display:flex;"><span>        ...
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;elasticsearch.version&gt;</span>7.16.2<span style="color:#8b008b;font-weight:bold">&lt;/elasticsearch.version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;/properties&gt;</span>
</span></span></code></pre></div><h2 id="æ¸¬è©¦é€£ç·š">æ¸¬è©¦é€£ç·š</h2>
<ul>
<li>å…ˆé€ ä¸€å€‹è¨­å®šé¡</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">ElasticConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è¨­å®š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> <span style="color:#8b008b;font-weight:bold">final</span> RequestOptions COMMON_OPTIONS;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">static</span> {
</span></span><span style="display:flex;"><span>        RequestOptions.<span style="color:#658b00">Builder</span> builder = RequestOptions.<span style="color:#658b00">DEFAULT</span>.<span style="color:#658b00">toBuilder</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// builder.addHeader(&#34;Authorization&#34;, &#34;Bearer &#34; + TOKEN);
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">// builder.setHttpAsyncResponseConsumerFactory(
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">//         new HttpAsyncResponseConsumerFactory
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">//                 .HeapBufferedResponseConsumerFactory(30 * 1024 * 1024 * 1024));
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        COMMON_OPTIONS = builder.<span style="color:#658b00">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å·²ç¶“è¢«æ£„ç”¨çš„å‰µé€ Clientæ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> RestHighLevelClient <span style="color:#008b45">restHighLevelClient</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// Create the low-level client
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        RestClientBuilder httpClientBuilder = RestClient.<span style="color:#658b00">builder</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">new</span> HttpHost(<span style="color:#cd5555">&#34;localhost&#34;</span>, 9200)
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// Create the HLRC
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        RestHighLevelClient hlrc = <span style="color:#8b008b;font-weight:bold">new</span> RestHighLevelClient(httpClientBuilder);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> hlrc;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ç°¡å–®æ¸¬è©¦ï¼Œå˜—è©¦é€ ä¸€å€‹indexèˆ‡ç‰©ä»¶</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@SpringBootTest</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">EsTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Autowired</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> RestHighLevelClient client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">User</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> String name;
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#00688b;font-weight:bold">int</span> age;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">test</span>() <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å»ºç«‹ä¸€å€‹æ¸¬è©¦çš„ç‰©ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        User user = <span style="color:#8b008b;font-weight:bold">new</span> User();
</span></span><span style="display:flex;"><span>        user.<span style="color:#658b00">setName</span>(<span style="color:#cd5555">&#34;Tom&#34;</span>);
</span></span><span style="display:flex;"><span>        user.<span style="color:#658b00">setAge</span>(30);
</span></span><span style="display:flex;"><span>        String s = JSONUtil.<span style="color:#658b00">toJsonStr</span>(user);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å‰µç«‹index
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        IndexRequest indexRequest = <span style="color:#8b008b;font-weight:bold">new</span> IndexRequest(<span style="color:#cd5555">&#34;users&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æŒ‡å®šid
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        indexRequest.<span style="color:#658b00">id</span>(<span style="color:#cd5555">&#34;1&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ”¾é€²å»çš„æ±è¥¿ï¼Œå¦‚æœæ˜¯å­—ä¸²å¿…é ˆè²æ˜æ˜¯XContentType.JSONï¼Œå¦å‰‡è¦æ”¾map
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        indexRequest.<span style="color:#658b00">source</span>(s, XContentType.<span style="color:#658b00">JSON</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// åŸ·è¡Œï¼Œç¬¬2å€‹åƒæ•¸æ˜¯ä½¿ç”¨ä¸€èˆ¬è¨­å®š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        IndexResponse response = client.<span style="color:#658b00">index</span>(indexRequest, ElasticConfig.<span style="color:#658b00">COMMON_OPTIONS</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;response = &#34;</span> + response);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ¸¬è©¦2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#707a7c">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">searchData</span>() <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>        GetRequest getRequest = <span style="color:#8b008b;font-weight:bold">new</span> GetRequest(
</span></span><span style="display:flex;"><span>                <span style="color:#cd5555">&#34;users&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#cd5555">&#34;_-2vAHIB0nzmLJLkxKWk&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        GetResponse getResponse = client.<span style="color:#658b00">get</span>(getRequest, RequestOptions.<span style="color:#658b00">DEFAULT</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(getResponse);
</span></span><span style="display:flex;"><span>        String index = getResponse.<span style="color:#658b00">getIndex</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(index);
</span></span><span style="display:flex;"><span>        String id = getResponse.<span style="color:#658b00">getId</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(id);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (getResponse.<span style="color:#658b00">isExists</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">long</span> version = getResponse.<span style="color:#658b00">getVersion</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(version);
</span></span><span style="display:flex;"><span>            String sourceAsString = getResponse.<span style="color:#658b00">getSourceAsString</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(sourceAsString);
</span></span><span style="display:flex;"><span>            Map&lt;String, Object&gt; sourceAsMap = getResponse.<span style="color:#658b00">getSourceAsMap</span>();
</span></span><span style="display:flex;"><span>            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(sourceAsMap);
</span></span><span style="display:flex;"><span>            <span style="color:#00688b;font-weight:bold">byte</span>[] sourceAsBytes = getResponse.<span style="color:#658b00">getSourceAsBytes</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h2 id="æª¢ç´¢ç¯„ä¾‹">æª¢ç´¢ç¯„ä¾‹</h2>
<blockquote>
<p>DSLæœ‰çš„é€™é‚Šéƒ½æœ‰ï¼Œç¿»è‘—å®˜æ–¹æ–‡æª”å¯«å§</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * è¤‡é›œæª¢ç´¢:åœ¨bankä¸­æœç´¢addressä¸­åŒ…å«millçš„æ‰€æœ‰äººçš„å¹´é½¡åˆ†ä½ˆä»¥åŠå¹³å‡å¹´é½¡ï¼Œå¹³å‡è–ªè³‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * @throws IOException
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Test</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">searchData</span>() <span style="color:#8b008b;font-weight:bold">throws</span> IOException {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1. å‰µå»ºæª¢ç´¢è«‹æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchRequest searchRequest = <span style="color:#8b008b;font-weight:bold">new</span> SearchRequest();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1.1ï¼‰æŒ‡å®šç´¢å¼•
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    searchRequest.<span style="color:#658b00">indices</span>(<span style="color:#cd5555">&#34;bank&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1.2ï¼‰æ§‹é€ æª¢ç´¢æ¢ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchSourceBuilder sourceBuilder = <span style="color:#8b008b;font-weight:bold">new</span> SearchSourceBuilder();
</span></span><span style="display:flex;"><span>    sourceBuilder.<span style="color:#658b00">query</span>(QueryBuilders.<span style="color:#658b00">matchQuery</span>(<span style="color:#cd5555">&#34;address&#34;</span>,<span style="color:#cd5555">&#34;Mill&#34;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1.2.1)æŒ‰ç…§å¹´é½¡åˆ†ä½ˆé€²è¡Œèšåˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    TermsAggregationBuilder ageAgg=AggregationBuilders.<span style="color:#658b00">terms</span>(<span style="color:#cd5555">&#34;ageAgg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;age&#34;</span>).<span style="color:#658b00">size</span>(10);
</span></span><span style="display:flex;"><span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(ageAgg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1.2.2)è¨ˆç®—å¹³å‡å¹´é½¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    AvgAggregationBuilder ageAvg = AggregationBuilders.<span style="color:#658b00">avg</span>(<span style="color:#cd5555">&#34;ageAvg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;age&#34;</span>);
</span></span><span style="display:flex;"><span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(ageAvg);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//1.2.3)è¨ˆç®—å¹³å‡è–ªè³‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    AvgAggregationBuilder balanceAvg = AggregationBuilders.<span style="color:#658b00">avg</span>(<span style="color:#cd5555">&#34;balanceAvg&#34;</span>).<span style="color:#658b00">field</span>(<span style="color:#cd5555">&#34;balance&#34;</span>);
</span></span><span style="display:flex;"><span>    sourceBuilder.<span style="color:#658b00">aggregation</span>(balanceAvg);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;æª¢ç´¢æ¢ä»¶ï¼š&#34;</span>+sourceBuilder);
</span></span><span style="display:flex;"><span>    searchRequest.<span style="color:#658b00">source</span>(sourceBuilder);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//2. åŸ·è¡Œæª¢ç´¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchResponse searchResponse = client.<span style="color:#658b00">search</span>(searchRequest, RequestOptions.<span style="color:#658b00">DEFAULT</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;æª¢ç´¢çµæœï¼š&#34;</span>+searchResponse);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//3. å°‡æª¢ç´¢çµæœå°è£ç‚ºBean
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    SearchHits hits = searchResponse.<span style="color:#658b00">getHits</span>();
</span></span><span style="display:flex;"><span>    SearchHit[] searchHits = hits.<span style="color:#658b00">getHits</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (SearchHit searchHit : searchHits) {
</span></span><span style="display:flex;"><span>        String sourceAsString = searchHit.<span style="color:#658b00">getSourceAsString</span>();
</span></span><span style="display:flex;"><span>        Account account = JSON.<span style="color:#658b00">parseObject</span>(sourceAsString, Account.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(account);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//4. ç²å–èšåˆä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    Aggregations aggregations = searchResponse.<span style="color:#658b00">getAggregations</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Terms ageAgg1 = aggregations.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;ageAgg&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">for</span> (Terms.<span style="color:#658b00">Bucket</span> bucket : ageAgg1.<span style="color:#658b00">getBuckets</span>()) {
</span></span><span style="display:flex;"><span>        String keyAsString = bucket.<span style="color:#658b00">getKeyAsString</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;å¹´é½¡ï¼š&#34;</span>+keyAsString+<span style="color:#cd5555">&#34; ==&gt; &#34;</span>+bucket.<span style="color:#658b00">getDocCount</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    Avg ageAvg1 = aggregations.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;ageAvg&#34;</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;å¹³å‡å¹´é½¡ï¼š&#34;</span>+ageAvg1.<span style="color:#658b00">getValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Avg balanceAvg1 = aggregations.<span style="color:#658b00">get</span>(<span style="color:#cd5555">&#34;balanceAvg&#34;</span>);
</span></span><span style="display:flex;"><span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;å¹³å‡è–ªè³‡ï¼š&#34;</span>+balanceAvg1.<span style="color:#658b00">getValue</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ­¥é©Ÿæ•´ç†:
<ul>
<li>æŒ‡å®šindex</li>
<li>å‰µå»ºsourceBuilderï¼Œè¨­å®šæŸ¥è©¢æ¢ä»¶</li>
<li>å°‡sourceå°è£åˆ°SearchRequest</li>
<li>ç”¨clientå°ESä¼ºæœç«¯ç™¼èµ·SearchRequest</li>
<li>æ¥æ”¶Hitsä¸¦è§£æ</li>
</ul>
</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-01-25</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220125-wsl2-docker/">
			ä¸‹ä¸€ç¯‡<br>DockerDekstopæ›è¼‰ç›¸é—œè¨­å®š
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220124-gulimall-07/">
			ä¸Šä¸€ç¯‡<br>å•†å“å±¬æ€§ç¶­è­·ã€åº«å­˜æ¨¡çµ„ã€åŸºç¤ç¯‡ç¸½çµ
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
