<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>é«˜ä½µç™¼æ–¹æ¡ˆã€Sentinelé™æµã€Sleuthéˆè·¯è¿½è¹¤</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-24">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="é«˜ä½µç™¼æ–¹æ¡ˆã€Sentinelé™æµã€Sleuthéˆè·¯è¿½è¹¤" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-24" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220210-gulimall-24-sentinel/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-10T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="é«˜ä½µç™¼æ–¹æ¡ˆã€Sentinelé™æµã€Sleuthéˆè·¯è¿½è¹¤"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-24"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%ab%98%e4%bd%b5%e7%99%bc%e9%97%9c%e6%b3%a8%e9%87%8d%e9%bb%9e" onclick="onNavClick(`#é«˜ä½µç™¼é—œæ³¨é‡é»-nav`)" id="é«˜ä½µç™¼é—œæ³¨é‡é»-nav">
									é«˜ä½µç™¼é—œæ³¨é‡é»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sentinel" onclick="onNavClick(`#sentinel-nav`)" id="sentinel-nav">
									Sentinel
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6" onclick="onNavClick(`#æ¸¬è©¦-nav`)" id="æ¸¬è©¦-nav">
									æ¸¬è©¦
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b3%e6%99%82%e7%9b%a3%e6%8e%a7" onclick="onNavClick(`#å³æ™‚ç›£æ§-nav`)" id="å³æ™‚ç›£æ§-nav">
									å³æ™‚ç›£æ§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%87%aa%e5%ae%9a%e7%be%a9%e9%98%bb%e5%a1%9e%e8%bf%94%e5%9b%9e" onclick="onNavClick(`#è‡ªå®šç¾©é˜»å¡è¿”å›-nav`)" id="è‡ªå®šç¾©é˜»å¡è¿”å›-nav">
									è‡ªå®šç¾©é˜»å¡è¿”å›
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%8e%a7%e5%88%b6%e8%a6%8f%e5%89%87" onclick="onNavClick(`#æ§åˆ¶è¦å‰‡-nav`)" id="æ§åˆ¶è¦å‰‡-nav">
									æ§åˆ¶è¦å‰‡
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b5%81%e6%8e%a7%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#æµæ§æ¨¡å¼-nav`)" id="æµæ§æ¨¡å¼-nav">
									æµæ§æ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b5%81%e6%8e%a7%e6%95%88%e6%9e%9c" onclick="onNavClick(`#æµæ§æ•ˆæœ-nav`)" id="æµæ§æ•ˆæœ-nav">
									æµæ§æ•ˆæœ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%86%94%e6%96%b7feign%e9%81%a0%e7%a8%8b%e8%aa%bf%e7%94%a8" onclick="onNavClick(`#ç†”æ–·feigné ç¨‹èª¿ç”¨-nav`)" id="ç†”æ–·feigné ç¨‹èª¿ç”¨-nav">
									ç†”æ–·feigné ç¨‹èª¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9d%91" onclick="onNavClick(`#å‘-nav`)" id="å‘-nav">
									å‘
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%aa%bf%e7%94%a8%e6%96%b9%e6%8c%87%e5%ae%9a%e7%86%94%e6%96%b7%e9%99%8d%e7%b4%9a%e7%ad%96%e7%95%a5" onclick="onNavClick(`#èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥-nav`)" id="èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥-nav">
									èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8f%90%e4%be%9b%e6%96%b9%e4%b8%bb%e5%8b%95%e9%99%8d%e7%b4%9a%e7%ad%96%e7%95%a5" onclick="onNavClick(`#æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥-nav`)" id="æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥-nav">
									æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%87%aa%e8%a8%82%e8%b3%87%e6%ba%90" onclick="onNavClick(`#è‡ªè¨‚è³‡æº-nav`)" id="è‡ªè¨‚è³‡æº-nav">
									è‡ªè¨‚è³‡æº
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#try-catch%e6%b3%95" onclick="onNavClick(`#try-catchæ³•-nav`)" id="try-catchæ³•-nav">
									Try-catchæ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3%e6%b3%95" onclick="onNavClick(`#è¨»è§£æ³•-nav`)" id="è¨»è§£æ³•-nav">
									è¨»è§£æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%b6%b2%e9%97%9c%e6%b5%81%e6%8e%a7" onclick="onNavClick(`#ç¶²é—œæµæ§-nav`)" id="ç¶²é—œæµæ§-nav">
									ç¶²é—œæµæ§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a6%8f%e5%89%87%e6%8c%81%e4%b9%85%e5%8c%96" onclick="onNavClick(`#è¦å‰‡æŒä¹…åŒ–-nav`)" id="è¦å‰‡æŒä¹…åŒ–-nav">
									è¦å‰‡æŒä¹…åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#sleuth-%e9%8f%88%e8%b7%af%e8%bf%bd%e8%b9%a4" onclick="onNavClick(`#sleuth-éˆè·¯è¿½è¹¤-nav`)" id="sleuth-éˆè·¯è¿½è¹¤-nav">
									Sleuth éˆè·¯è¿½è¹¤
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-1" onclick="onNavClick(`#ä½¿ç”¨-1-nav`)" id="ä½¿ç”¨-1-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9d%91-%e5%95%9f%e5%8b%95%e5%a0%b1%e9%8c%af" onclick="onNavClick(`#å‘-å•Ÿå‹•å ±éŒ¯-nav`)" id="å‘-å•Ÿå‹•å ±éŒ¯-nav">
									å‘-å•Ÿå‹•å ±éŒ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#zipkin" onclick="onNavClick(`#zipkin-nav`)" id="zipkin-nav">
									zipkin
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8c%81%e4%b9%85%e5%8c%96" onclick="onNavClick(`#æŒä¹…åŒ–-nav`)" id="æŒä¹…åŒ–-nav">
									æŒä¹…åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e9%ab%98%e7%b4%9a%e7%af%87%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#é«˜ç´šç¯‡å°çµ-nav`)" id="é«˜ç´šç¯‡å°çµ-nav">
									é«˜ç´šç¯‡å°çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e9%ab%98%e4%bd%b5%e7%99%bc%e9%97%9c%e6%b3%a8%e9%87%8d%e9%bb%9e" onclick="onNavClick(`#é«˜ä½µç™¼é—œæ³¨é‡é»-nav`)" id="é«˜ä½µç™¼é—œæ³¨é‡é»-nav">
									é«˜ä½µç™¼é—œæ³¨é‡é»
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#sentinel" onclick="onNavClick(`#sentinel-nav`)" id="sentinel-nav">
									Sentinel
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6" onclick="onNavClick(`#æ¸¬è©¦-nav`)" id="æ¸¬è©¦-nav">
									æ¸¬è©¦
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8d%b3%e6%99%82%e7%9b%a3%e6%8e%a7" onclick="onNavClick(`#å³æ™‚ç›£æ§-nav`)" id="å³æ™‚ç›£æ§-nav">
									å³æ™‚ç›£æ§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%87%aa%e5%ae%9a%e7%be%a9%e9%98%bb%e5%a1%9e%e8%bf%94%e5%9b%9e" onclick="onNavClick(`#è‡ªå®šç¾©é˜»å¡è¿”å›-nav`)" id="è‡ªå®šç¾©é˜»å¡è¿”å›-nav">
									è‡ªå®šç¾©é˜»å¡è¿”å›
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%8e%a7%e5%88%b6%e8%a6%8f%e5%89%87" onclick="onNavClick(`#æ§åˆ¶è¦å‰‡-nav`)" id="æ§åˆ¶è¦å‰‡-nav">
									æ§åˆ¶è¦å‰‡
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%b5%81%e6%8e%a7%e6%a8%a1%e5%bc%8f" onclick="onNavClick(`#æµæ§æ¨¡å¼-nav`)" id="æµæ§æ¨¡å¼-nav">
									æµæ§æ¨¡å¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b5%81%e6%8e%a7%e6%95%88%e6%9e%9c" onclick="onNavClick(`#æµæ§æ•ˆæœ-nav`)" id="æµæ§æ•ˆæœ-nav">
									æµæ§æ•ˆæœ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%86%94%e6%96%b7feign%e9%81%a0%e7%a8%8b%e8%aa%bf%e7%94%a8" onclick="onNavClick(`#ç†”æ–·feigné ç¨‹èª¿ç”¨-nav`)" id="ç†”æ–·feigné ç¨‹èª¿ç”¨-nav">
									ç†”æ–·feigné ç¨‹èª¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9d%91" onclick="onNavClick(`#å‘-nav`)" id="å‘-nav">
									å‘
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%aa%bf%e7%94%a8%e6%96%b9%e6%8c%87%e5%ae%9a%e7%86%94%e6%96%b7%e9%99%8d%e7%b4%9a%e7%ad%96%e7%95%a5" onclick="onNavClick(`#èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥-nav`)" id="èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥-nav">
									èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8f%90%e4%be%9b%e6%96%b9%e4%b8%bb%e5%8b%95%e9%99%8d%e7%b4%9a%e7%ad%96%e7%95%a5" onclick="onNavClick(`#æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥-nav`)" id="æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥-nav">
									æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%87%aa%e8%a8%82%e8%b3%87%e6%ba%90" onclick="onNavClick(`#è‡ªè¨‚è³‡æº-nav`)" id="è‡ªè¨‚è³‡æº-nav">
									è‡ªè¨‚è³‡æº
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#try-catch%e6%b3%95" onclick="onNavClick(`#try-catchæ³•-nav`)" id="try-catchæ³•-nav">
									Try-catchæ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a8%bb%e8%a7%a3%e6%b3%95" onclick="onNavClick(`#è¨»è§£æ³•-nav`)" id="è¨»è§£æ³•-nav">
									è¨»è§£æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e7%b6%b2%e9%97%9c%e6%b5%81%e6%8e%a7" onclick="onNavClick(`#ç¶²é—œæµæ§-nav`)" id="ç¶²é—œæµæ§-nav">
									ç¶²é—œæµæ§
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%a6%8f%e5%89%87%e6%8c%81%e4%b9%85%e5%8c%96" onclick="onNavClick(`#è¦å‰‡æŒä¹…åŒ–-nav`)" id="è¦å‰‡æŒä¹…åŒ–-nav">
									è¦å‰‡æŒä¹…åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#sleuth-%e9%8f%88%e8%b7%af%e8%bf%bd%e8%b9%a4" onclick="onNavClick(`#sleuth-éˆè·¯è¿½è¹¤-nav`)" id="sleuth-éˆè·¯è¿½è¹¤-nav">
									Sleuth éˆè·¯è¿½è¹¤
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8-1" onclick="onNavClick(`#ä½¿ç”¨-1-nav`)" id="ä½¿ç”¨-1-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%9d%91-%e5%95%9f%e5%8b%95%e5%a0%b1%e9%8c%af" onclick="onNavClick(`#å‘-å•Ÿå‹•å ±éŒ¯-nav`)" id="å‘-å•Ÿå‹•å ±éŒ¯-nav">
									å‘-å•Ÿå‹•å ±éŒ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#zipkin" onclick="onNavClick(`#zipkin-nav`)" id="zipkin-nav">
									zipkin
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%8c%81%e4%b9%85%e5%8c%96" onclick="onNavClick(`#æŒä¹…åŒ–-nav`)" id="æŒä¹…åŒ–-nav">
									æŒä¹…åŒ–
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e9%ab%98%e7%b4%9a%e7%af%87%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#é«˜ç´šç¯‡å°çµ-nav`)" id="é«˜ç´šç¯‡å°çµ-nav">
									é«˜ç´šç¯‡å°çµ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/gulimall.png')"
                    
                
            >
                <div class="post-title">
                    é«˜ä½µç™¼æ–¹æ¡ˆã€Sentinelé™æµã€Sleuthéˆè·¯è¿½è¹¤
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-24
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-02-10 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%B0%88%E6%A1%88">Javaå¾®æœå‹™å°ˆæ¡ˆ</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">Java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="é«˜ä½µç™¼é—œæ³¨é‡é»">é«˜ä½µç™¼é—œæ³¨é‡é»</h1>
<p><img src="image-20220206222827204.png" alt="image-20220206222827204"></p>
<p><img src="image-20220206223434557.png" alt="image-20220206223434557"></p>
<ul>
<li>å–®ä¸€è·è²¬: å°ˆé–€çš„æœå‹™æ¨¡çµ„ï¼Œå°±åªå¹¹é€™ä»¶äº‹ï¼Œä¸è«–è¦æ“´å®¹æˆ–æ˜¯æ›äº†éƒ½æ–¹ä¾¿</li>
<li>éˆçµåŠ å¯†: æ¯å ´å•†å“éƒ½æœ‰éš¨æ©Ÿç”¢ç”Ÿçš„Tokenï¼Œé˜²æœ‰å¿ƒäººææ—©æº–å‚™(å°éµæ¶ç¥¨ç³»çµ±å­¸ä¸€ä¸‹å¥½å—?)</li>
<li>é ç†±ã€æ‰£æ¸›: æ—¢ç„¶çŸ¥é“æœƒè®€å¤šå¯«å°‘ï¼Œæå‰æŠŠè¦è¢«æŸ¥çš„è³‡æ–™æ”¾Redisï¼›ç”¨ä¿¡è™Ÿé‡åšä»¤ç‰Œï¼Œåªæ”¾è¡Œé€™äº›æ•¸é‡</li>
<li>å‹•éœåˆ†é›¢: éœæ…‹è³‡æºå¾ç¶²é—œå°±æ‰“å›å»ï¼Œç¢ºä¿ä¾†åˆ°ä¼ºæœçš„éƒ½æ˜¯å‹•æ…‹è«‹æ±‚</li>
<li>æ””æˆªæƒ¡æ„è«‹æ±‚: åœ¨ç¶²é—œè¨­å®šï¼Œåˆ¤æ–·é‚£äº›éäººçš„æ“ä½œ(ä¾‹å¦‚åŒIPè¶…å¿«è¶…å¤§é‡çš„)ï¼Œç›´æ¥æ“‹å›å»</li>
<li>æµé‡éŒ¯å³°: ç”¨å¹²æ“¾æ‰‹æ®µä½¿äººçš„æ“ä½œæ™‚é–“ä¸åŒ(å°±æ˜¯å™å¿ƒç”¨æˆ¶)ï¼Œçˆ­å–éŒ¯é–‹è«‹æ±‚é€²ä¾†çš„æ™‚é–“</li>
<li>é™æµã€ç†”æ–·ã€é™ç´š: é™ç´šå°±æ˜¯è² è¼‰è¶…éä¸Šé™ï¼ŒShowä¸€å€‹&quot;ç•¶å‰æµé‡éé«˜ï¼Œè«‹ç¨å¾Œé‡è©¦&quot;ä¹‹é¡çš„æƒ±äººç•«é¢çµ¦ç”¨æˆ¶çœ‹</li>
<li>å»¶é²éšŠåˆ—: çµ‚æ¥µæ‰‹æ®µï¼Œç®¡ä½ å¤šå°‘è«‹æ±‚åªè¦é€šéé©—è­‰å°±æ”¾é€²éšŠåˆ—ï¼Œä¹‹å¾Œæ…¢æ…¢è™•ç†ï¼Œç¸½æœƒçµ¦ä½ è™•ç†åˆ°ï¼Œä½†ä¸ä¿è­‰æ˜¯ç¾åœ¨</li>
</ul>
<h1 id="sentinel">Sentinel</h1>
<blockquote>
<p>å®˜æ–¹: <a href="https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/Sentinel/wiki/%E4%BB%8B%E7%BB%8D</a></p>
</blockquote>
<ul>
<li>ç”¨ä¾†é™æµã€ä¿è­·è³‡æº</li>
<li>Sentinelåˆ†ç‚ºæ ¸å¿ƒåº« èˆ‡ Dashboardå¯è¦–åŒ–ç•Œé¢ï¼Œæ ¸å¿ƒåº«ä¸ä¾è³´Dashboard</li>
<li>å·¥ä½œåŸç†ä¸»è¦åˆ†ç‚ºä¸‰å€‹æ­¥é©Ÿ:
<ul>
<li>å®šç¾©è³‡æº: å«åš&quot;åŸ‹é»&quot;ï¼Œå³è²æ˜è¦ä¿è­·çš„è³‡æºï¼Œå¯ä»¥æ˜¯æœå‹™ã€æ–¹æ³•ã€ç”šè‡³å–®ç´”ä¸€æ®µç¨‹å¼ç¢¼
<ul>
<li>æ–¹æ³•å¾ˆå¤šï¼Œæœ€ç°¡å–®å°±æ˜¯ç”¨è¨»è§£æˆ–try-catch</li>
<li><a href="https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">https://github.com/alibaba/Sentinel/wiki/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8</a></li>
</ul>
</li>
<li>å®šç¾©è¦å‰‡: æµé‡æ§åˆ¶è¦å‰‡ã€ç†”æ–·é™ç´šè¦å‰‡ã€ç³»çµ±ä¿è­·è¦å‰‡ã€ä¾†æºè¨ªå•æ§åˆ¶è¦å‰‡ å’Œ ç†±é»åƒæ•¸è¦å‰‡
<ul>
<li>æœ€ç°¡å–®å°±æ˜¯é–‹å•ŸDashboardç”¨å¯è¦–åŒ–ç•Œé¢å»ºç«‹è¦å‰‡(ä½†é€™æ¨£ç”¨çš„è¨­å®šä¿å­˜åœ¨è¨˜æ†¶é«”ï¼Œé‡é–‹æœƒæ¶ˆå¤±)</li>
</ul>
</li>
<li>æª¢é©—è¦å‰‡æ˜¯å¦ç”Ÿæ•ˆ</li>
</ul>
</li>
</ul>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<ul>
<li>å¼•åŒ…</li>
</ul>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;
    &lt;version&gt;2021.1&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li>è¨­å®šapplication.properties
<ul>
<li>æ³¨æ„ä»–æœ‰2ç«¯å£ï¼Œä¸€å€‹æ˜¯è¨ªå•dashboardæœ¬èº«ï¼Œé è¨­æ˜¯8080</li>
<li>å¦ä¸€å€‹æ˜¯å¾®æœå‹™å‚³çµ¦sentinelä¸­å¿ƒï¼Œé è¨­æ˜¯8719</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#228b22"># sentinelæ§åˆ¶å°</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cloud.sentinel.transport.dashboard</span>=<span style="color:#cd5555">localhost:8333</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å¾®æœå‹™èˆ‡æ§åˆ¶å°å‚³è¼¸æ•¸æ“šçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cloud.sentinel.transport.port</span>=<span style="color:#cd5555">8719</span>
</span></span></code></pre></div><ul>
<li>
<p>è¼‰Dashboard: <a href="https://github.com/alibaba/Sentinel/releases">https://github.com/alibaba/Sentinel/releases</a></p>
</li>
<li>
<p>å•Ÿå‹•Dashboard</p>
<ul>
<li>é è¨­åŸ æ˜¯8080å¯èƒ½è¡çªï¼Œæ‰€ä»¥è‡ªå·±æŒ‡å®šä¸€å€‹</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>java -jar sentinel-dashboard-1.8.3.jar --server.port=8333
</code></pre><ul>
<li>è¨ªå• <code>localhost:8333</code>ï¼Œè³¬è™Ÿå¯†ç¢¼éƒ½æ˜¯<code>sentinel</code>
<ul>
<li>é»é€²å»çœ‹å•¥éƒ½æ²’æœ‰ï¼Œå› ç‚ºæœ‰è¨ªå•çš„æ™‚å€™æ‰æœƒåŠ è¼‰</li>
</ul>
</li>
</ul>
<h3 id="æ¸¬è©¦">æ¸¬è©¦</h3>
<ul>
<li>å•Ÿå‹•ç›£æ§å¾Œï¼Œèª¿ç”¨ä¸€æ¬¡APIè®“Dashboardç™¼ç¾è³‡æº</li>
<li>éš¨ä¾¿æ‰‹å‹•è¨­å®šä¸€å€‹é™æµï¼Œç„¶å¾Œå˜—è©¦å¿«é€Ÿé€£çºŒè¨ªå•</li>
</ul>
<p><img src="image-20220207155148467.png" alt="image-20220207155148467"></p>
<h3 id="å³æ™‚ç›£æ§">å³æ™‚ç›£æ§</h3>
<ul>
<li>pom.xml
<ul>
<li>æ³¨æ„actuatoræ˜¯ä¾è³´æ–¼springbootï¼Œå°å¿ƒå¾ªç’°ä¾è³´</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>&lt;!--springboot æ”¶é›†å¥åº·ç‹€æ³ä¿¡æ¯ï¼Œæä¾›çµ¦sentinelä½¿ç”¨--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li>application.properties</li>
</ul>
<pre tabindex="0"><code># æš´éœ²ç«¯é»çµ¦sentinelç›£æ§ç”¢ç”Ÿåœ–è¡¨
management.endpoints.web.exposure.include=*
</code></pre><ul>
<li>æ•ˆæœ:</li>
</ul>
<p><img src="image-20220207162007592.png" alt="image-20220207162007592"></p>
<h3 id="è‡ªå®šç¾©é˜»å¡è¿”å›">è‡ªå®šç¾©é˜»å¡è¿”å›</h3>
<ul>
<li>MyUrlBlockHandler.java
<ul>
<li>éœ€è¦å¯¦ç¾<code>BlockExceptionHandler</code>ä¸¦é‡å¯«<code>handle</code>æ–¹æ³•</li>
<li>æ³¨æ„ç·¨ç¢¼å•é¡Œ</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * æµé‡éé«˜é˜»å¡æ™‚è¿”å›çš„è³‡è¨Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyUrlBlockHandler</span> <span style="color:#8b008b;font-weight:bold">implements</span> BlockExceptionHandler {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">handle</span>(HttpServletRequest request, HttpServletResponse response, BlockException ex) <span style="color:#8b008b;font-weight:bold">throws</span>
</span></span><span style="display:flex;"><span>            IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// TOO_MANY_REQUEST(10002, &#34;è«‹æ±‚æµé‡éå¤§ï¼Œè«‹ç¨å¾Œå†è©¦&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        R error = R.<span style="color:#658b00">error</span>(BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getCode</span>(), BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>        response.<span style="color:#658b00">setCharacterEncoding</span>(<span style="color:#cd5555">&#34;UTF-8&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#658b00">setContentType</span>(<span style="color:#cd5555">&#34;application/json&#34;</span>);
</span></span><span style="display:flex;"><span>        response.<span style="color:#658b00">getWriter</span>().<span style="color:#658b00">write</span>(JSON.<span style="color:#658b00">toJSONString</span>(error));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ•ˆæœ:</li>
</ul>
<p><img src="image-20220207161840046.png" alt="image-20220207161840046"></p>
<h2 id="æ§åˆ¶è¦å‰‡">æ§åˆ¶è¦å‰‡</h2>
<p><img src="image-20220207163131552.png" alt="image-20220207163131552"></p>
<h3 id="æµæ§æ¨¡å¼">æµæ§æ¨¡å¼</h3>
<ul>
<li>ç›´æ¥: å°±åªé—œæ³¨è³‡æºæœ¬èº«</li>
<li>é—œè¯: Aé™æµï¼ŒAé—œè¯Bï¼Œå¦‚æœBçš„æµé‡å¤§å°±å°Aé™æµï¼Œå¦å‰‡ä¸é™</li>
<li>éˆè·¯: æŒ‡å®šæŸå€‹å…¥å£é–‹å§‹åˆ°é€™é‚Šçš„è«‹æ±‚(ä¸­é–“å¯èƒ½éš”äº†å¾ˆå¤šå±¤)ï¼Œæ‰æœƒè¢«é™åˆ¶</li>
</ul>
<h3 id="æµæ§æ•ˆæœ">æµæ§æ•ˆæœ</h3>
<ul>
<li>å¿«é€Ÿå¤±æ•—: ç›´æ¥æ‹’çµ•æ‹‹å‡ºç•°å¸¸</li>
<li>Warm Up: é ç†±å•“å‹•ï¼Œä¾‹å¦‚çµ¦å®š10Sï¼Œ10Så…§æ‰å°‡è«‹æ±‚å¢åŠ åˆ°é–¾å€¼500ï¼Œä¸æœƒä¸€æ¬¡æ€§æ”¾è¡Œ500å€‹
<ul>
<li>å‰›é–‹æ©Ÿæ²’æœ‰cacheæ‰€ä»¥åæ‡‰æ…¢ï¼Œä¸èƒ½ä¸€ä¸‹å­å¤ªé«˜æµé‡</li>
</ul>
</li>
<li>æ’éšŠç­‰å¾…: å¦‚æœé™åˆ¶é–¾å€¼500ï¼Œæ­¤æ™‚ä¾†äº†700å€‹è«‹æ±‚ï¼Œ500å€‹ç›´æ¥æ”¾è¡Œï¼Œå‰©ä¸‹200æ’éšŠ
<ul>
<li>å¯ä»¥è¨­ç½®è¶…æ™‚æ™‚é–“ï¼Œ3Så…§å¾—ä¸åˆ°è™•ç†ä¹Ÿæ˜¯å¤±æ•—</li>
</ul>
</li>
</ul>
<h3 id="ç†”æ–·feigné ç¨‹èª¿ç”¨">ç†”æ–·feigné ç¨‹èª¿ç”¨</h3>
<ul>
<li>
<p>æƒ…æ™¯: Aé ç¨‹èª¿ç”¨Bï¼Œç•¶Bæ›æ‰çš„æ™‚å€™ï¼Œå¸Œæœ›Aé‚„èƒ½ç¶­æŒä½œç”¨</p>
</li>
<li>
<p>Sentinelé è¨­æ”¯æ´openFeignï¼Œåªè¦è¨­å®šapplication.properties</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#228b22"># feigné–‹å•“sentinel</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">feign.sentinel.enabled</span>=<span style="color:#cd5555">true</span>
</span></span></code></pre></div><ul>
<li>åœ¨åŸæœ¬çš„Feignæ¥å£è¨­å®šfallback</li>
</ul>
<p><img src="image-20220207165856170.png" alt="image-20220207165856170"></p>
<ul>
<li>SeckillFeignServiceFallBack.java
<ul>
<li>å¯¦ç¾FeignServiceæ¥å£ï¼Œä¸¦ä¸”é‡å¯«æ–¹æ³•</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç†”æ–·æˆ–é™ç´šçš„å¯¦ç¾
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">SeckillFeignServiceFallBack</span> <span style="color:#8b008b;font-weight:bold">implements</span> SeckillFeignService {
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> R <span style="color:#008b45">getSkuSeckilInfo</span>(Long skuId) {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å¯ä»¥è¿”å›æŸäº›é è¨­å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#228b22">// TOO_MANY_REQUEST(10002, &#34;è«‹æ±‚æµé‡éå¤§ï¼Œè«‹ç¨å¾Œå†è©¦&#34;),
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">return</span> R.<span style="color:#658b00">error</span>(BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getCode</span>(), BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="å‘">å‘</h4>
<ul>
<li>ç‰ˆæœ¬å•é¡Œæœƒå°è‡´å•Ÿå‹•å ±éŒ¯</li>
</ul>
<pre tabindex="0"><code>FactoryBean threw exception on object creation; nested exception...
</code></pre><p><img src="image-20220207212645872.png" alt="image-20220207212645872"></p>
<ul>
<li>è§£æ³•: <a href="https://www.sqms.xyz/archives/springcloud%E4%B8%ADopenfeign%E6%95%B4%E5%90%88sentinel%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99">https://www.sqms.xyz/archives/springcloud%E4%B8%ADopenfeign%E6%95%B4%E5%90%88sentinel%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99</a></li>
</ul>
<h4 id="èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥">èª¿ç”¨æ–¹æŒ‡å®šç†”æ–·é™ç´šç­–ç•¥</h4>
<blockquote>
<p>åƒè€ƒå®˜æ–¹: <a href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7">https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7</a></p>
</blockquote>
<ul>
<li>æˆ‘æ˜¯Aèª¿ç”¨æ–¹ï¼Œæˆ‘å¤§æ¦‚çŸ¥é“Bæä¾›æ–¹èƒ½è² è¼‰å¤šå°‘(è¶…éè² è¼‰Bå°±æœƒçˆ†ç‚¸)ï¼Œç‚ºäº†ä¸è®“Bçˆ†ç‚¸å°è‡´æˆ‘Aä¹Ÿå—ç‰½é€£ï¼Œæ‰€ä»¥æˆ‘Aé ç¨‹èª¿ç”¨Bçš„æ™‚å€™åšç›£æ§ï¼Œè¨­å®šè¶…éå¤šå°‘å°±ç¯€åˆ¶ï¼Œè®“Bç·©ç·©</li>
</ul>
<p><img src="image-20220207170452522.png" alt="image-20220207170452522"></p>
<ul>
<li>RT: éŸ¿æ‡‰æ™‚é–“ï¼Œæ¯”å¦‚ä¸Šåœ–è¨­å®šæ„æ€æ˜¯ 1000mså…§ï¼Œå¦‚æœé€²ä¾†æœ‰5å€‹è«‹æ±‚ä»¥ä¸Šï¼Œä¸”å¹³å‡æ¯å€‹è«‹æ±‚çš„éŸ¿æ‡‰æ™‚é–“å¤§æ–¼1msï¼Œé‚£å°±ç†”æ–·10s</li>
<li>é€²å…¥ç†”æ–·å¾Œï¼Œä¸æœƒå ±éŒ¯ï¼Œä½†èª¿ç”¨çš„æ˜¯æœ¬åœ°FallBack.javaä¸­çš„æ–¹æ³•</li>
</ul>
<h4 id="æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥">æä¾›æ–¹ä¸»å‹•é™ç´šç­–ç•¥</h4>
<p><img src="image-20220207171811932.png" alt="image-20220207171811932"></p>
<ul>
<li>æˆ‘æ˜¯Bæä¾›æ–¹ï¼Œæˆ‘çŸ¥é“è‡ªå·±åªèƒ½å¹¹å¤šå°‘æ´»ï¼Œè¶…éå°±é™æµï¼Œå¯ä»¥ç›´æ¥ç”©æ‰‹ä¸å¹¹æˆ–æ˜¯è®“è«‹æ±‚æ’éšŠç­‰ç­‰</li>
<li>ç•¶ç„¶ä¹Ÿå¯ä»¥è¿”å›é™ç´šé é¢æˆ–é è¨­å€¼ï¼Œåšæ³•å°±æ˜¯å‰é¢èªªéçš„è‡ªå®šç¾©é˜»å¡è¿”å›</li>
</ul>
<h2 id="è‡ªè¨‚è³‡æº">è‡ªè¨‚è³‡æº</h2>
<ul>
<li>æ‰€æœ‰controllerè«‹æ±‚çš„æµæ§å’Œé™ç´šï¼Œé è¨­éƒ½æ˜¯ç”¨<code>BlockExceptionHandler</code>ä¸­çµ±ä¸€çš„è‡ªå®šç¾©é˜»å¡è¿”å›</li>
<li>serviceä¸­çš„æ¯ä¸€å€‹è³‡æº(å¯ä»¥æ˜¯ä¸€å€‹æ–¹æ³•æˆ–ä¸€å€‹ä»£ç¢¼å¡Š)éƒ½å¯ä»¥è‡ªè¨‚è‡ªå·±çš„è¿”å›</li>
<li>ä¸€å€‹æ–¹æ³•å¯ä»¥è¢«å®šç¾©æˆå¤šå€‹è³‡æº(å¯ä»¥éš¨ä¾¿å¥—å¨ƒ)ï¼Œä¸¦ä¸”æ¯å€‹è³‡æºçš„é™æµè¦å‰‡ä¸ä¸€æ¨£</li>
</ul>
<h3 id="try-catchæ³•">Try-catchæ³•</h3>
<ul>
<li>ç¿»sentinelæºç¢¼ï¼Œæœ€åº•å±¤çš„å¯¦ç¾å°±æ˜¯é€™æ¨£</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">try</span> (Entry entry = SphU.<span style="color:#658b00">entry</span>(<span style="color:#cd5555">&#34;è³‡æºå&#34;</span>)) {
</span></span><span style="display:flex;"><span><span style="color:#228b22">// æ¥­å‹™é‚è¼¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>}<span style="color:#8b008b;font-weight:bold">catch</span>(BlockException e){
</span></span><span style="display:flex;"><span> log.<span style="color:#658b00">error</span>(<span style="color:#cd5555">&#34;è³‡æºè¢«é™æµ{}&#34;</span>, e.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="è¨»è§£æ³•">è¨»è§£æ³•</h3>
<ul>
<li>åœ¨åŒé¡ä¸­å‰µé€ é™ç´šå¾ŒåŸ·è¡Œçš„<code>blockHandler</code>æ–¹æ³•ï¼Œä¸¦ä¸”åƒæ•¸ã€è¿”å›é¡å‹è·ŸåŸæ–¹æ³•ä¸€æ¨£</li>
<li>ä½¿ç”¨<code>@SentinelResource</code>è¨»è§£è³‡æº</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> List&lt;SeckillSkuRedisTo&gt; <span style="color:#008b45">blockHandler</span>(BlockException e) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#658b00">error</span>(<span style="color:#cd5555">&#34;getCurrentSeckillSkusResourceè¢«é™æµäº†,{}&#34;</span>, e.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç²å–åˆ°ç•¶å‰å¯ä»¥åƒåŠ ç§’æ®ºå•†å“çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@SentinelResource</span>(value = <span style="color:#cd5555">&#34;getCurrentSeckillSkusResource&#34;</span>, blockHandler = <span style="color:#cd5555">&#34;blockHandler&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> List&lt;SeckillSkuRedisTo&gt; <span style="color:#008b45">getCurrentSeckillSkus</span>() {
</span></span></code></pre></div><h2 id="ç¶²é—œæµæ§">ç¶²é—œæµæ§</h2>
<ul>
<li>å·²ç¶“æ•´åˆå¥½äº†ï¼Œå¯ä»¥ç›´æ¥åœ¨gatewayæ¨¡çµ„å¼•åŒ…</li>
</ul>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-sentinel-gateway&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li>ä¸€æ¨£åˆ°.propertiesè¨»å†Šsentinelç«¯å£</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#228b22"># sentinelæ§åˆ¶å°</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cloud.sentinel.transport.dashboard</span>=<span style="color:#cd5555">localhost:8333</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># å¾®æœå‹™èˆ‡æ§åˆ¶å°å‚³è¼¸æ•¸æ“šçš„ç«¯å£</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.cloud.sentinel.transport.port</span>=<span style="color:#cd5555">8719</span>
</span></span></code></pre></div><ul>
<li>åˆ°æ§åˆ¶å°å¯ä»¥ç™¼ç¾é‡å°ç¶²é—œæœ‰å°ˆé–€çš„è¦å‰‡å¯ä»¥èª¿æ§</li>
</ul>
<p><img src="image-20220207213813075.png" alt="image-20220207213813075"></p>
<ul>
<li>ä¸¦ä¸”ä¹Ÿå¯ä»¥è¨­å®šçµ±ä¸€çš„è¿”å›
<ul>
<li>ä»€éº¼Mono.justé—œéµå­—æ˜¯<code>éŸ¿æ‡‰å¼ç·¨ç¨‹</code></li>
<li>ç¨å¾®äº†è§£ä¸€ä¸‹æ˜¯Spring5çš„æ–°ç‰¹æ€§webfluxï¼Œç‰¹è‰²åœ¨æ–¼ç•°æ­¥ã€éé˜»å¡ã€å¤©ç„¶æ‡‰å°é«˜ä½µç™¼</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @Description: è‡ªå®šç¾©é˜»å¡è¿”å›æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> **/</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">SentinelGatewayConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#008b45">SentinelGatewayConfig</span>() {
</span></span><span style="display:flex;"><span>        GatewayCallbackManager.<span style="color:#658b00">setBlockHandler</span>(<span style="color:#8b008b;font-weight:bold">new</span> BlockRequestHandler() {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// ç¶²é—œé™æµäº†è«‹æ±‚ï¼Œå°±æœƒèª¿ç”¨æ­¤å›èª¿
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">public</span> Mono&lt;ServerResponse&gt; <span style="color:#008b45">handleRequest</span>(ServerWebExchange serverWebExchange, Throwable throwable) {
</span></span><span style="display:flex;"><span>                R error = R.<span style="color:#658b00">error</span>(BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getCode</span>(), BizCodeEnum.<span style="color:#658b00">TOO_MANY_REQUEST</span>.<span style="color:#658b00">getMessage</span>());
</span></span><span style="display:flex;"><span>                String errJson = JSON.<span style="color:#658b00">toJSONString</span>(error);
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">return</span> ServerResponse.<span style="color:#658b00">ok</span>().<span style="color:#658b00">body</span>(Mono.<span style="color:#658b00">just</span>(errJson), String.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ä¸€åœ–ç†è§£éŸ¿æ‡‰å¼ç·¨ç¨‹:</li>
</ul>
<p><img src="image-20220207214935780.png" alt="image-20220207214935780"></p>
<h2 id="è¦å‰‡æŒä¹…åŒ–">è¦å‰‡æŒä¹…åŒ–</h2>
<ul>
<li>é è¨­å­˜åœ¨è¨˜æ†¶é«”é‡é–‹å°±æ¶ˆå¤±ï¼Œå¯ä»¥æŠŠè¦å‰‡å­˜åˆ°Nacos</li>
<li>åƒè€ƒ: <a href="https://www.cnblogs.com/jian0110/p/14139044.html">https://www.cnblogs.com/jian0110/p/14139044.html</a></li>
</ul>
<h1 id="sleuth-éˆè·¯è¿½è¹¤">Sleuth éˆè·¯è¿½è¹¤</h1>
<ul>
<li>è‹¥æœ‰ä¸€å€‹è«‹æ±‚è·¨è¶Šäº†å¤šå€‹å¾®æœå‹™ï¼Œæƒ³çŸ¥é“å„æœå‹™èŠ±è²»äº†å¤šå°‘æ™‚é–“ï¼Œå¯ä»¥ç”¨Spring Sleuthè¿½è¹¤</li>
<li>ç•¶ç™¼ç¾æŸå€‹æœå‹™ç‰¹åˆ¥æ…¢ï¼Œé‡å°æ”¹å–„æˆ–ç›´æ¥å°‡å…¶é™ç´š</li>
<li>æ ¸å¿ƒåŸç†å°±æ˜¯æ¯åˆ°é”ä¸€å€‹ç¯€é»éƒ½æœƒè¨˜éŒ„æ™‚é–“æˆ³ï¼Œè¨ˆç®—å·®å€¼å°±å¯ä»¥å¾—åˆ°å‚³è¼¸æ™‚é–“ã€æŸå€‹ç¯€é»è™•ç†è«‹æ±‚çš„æ™‚é–“
<ul>
<li>æ¯ä¸€å€‹ç¯€é»éƒ½æ˜¯ä¸€å€‹<code>Span</code></li>
<li>å¤šå€‹<code>Span</code>å…±åŒçµ„æˆ<code>Trace</code>ï¼Œå°±æ˜¯ä¸€å€‹å®Œæ•´å¾å®¢æˆ¶ç«¯ç™¼èµ·åˆ°è¿”å›çš„ä»»å‹™</li>
</ul>
</li>
<li>ä¸¦ä¸”å¯ä»¥æ­é…Zipkinå¯è¦–åŒ–</li>
</ul>
<h2 id="ä½¿ç”¨-1">ä½¿ç”¨</h2>
<ul>
<li>å¼•åŒ…ï¼Œsleuthéœ€è¦spring-cloud</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#228b22">&lt;!-- éˆè·¯è¿½è¹¤sleuth --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>spring-cloud-starter-sleuth<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependencyManagement&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;dependencies&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>spring-cloud-dependencies<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&lt;version&gt;</span>Hoxton.SR9<span style="color:#8b008b;font-weight:bold">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&lt;scope&gt;</span>import<span style="color:#8b008b;font-weight:bold">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">&lt;type&gt;</span>pom<span style="color:#8b008b;font-weight:bold">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;/dependencies&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependencyManagement&gt;</span>
</span></span></code></pre></div><ul>
<li>application.properties</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#228b22"># é–‹å•“sleuthéˆè·¯è¿½è¹¤debugæ—¥èªŒ</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">logging.level.org.springframework.cloud.openfeign</span>=<span style="color:#cd5555">debug</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">logging.level.org.springframework.cloud.sleuth</span>=<span style="color:#cd5555">debug</span>
</span></span></code></pre></div><h3 id="å‘-å•Ÿå‹•å ±éŒ¯">å‘-å•Ÿå‹•å ±éŒ¯</h3>
<ul>
<li>å¼•å…¥sleuthå¾Œå•Ÿå‹•å ±éŒ¯</li>
</ul>
<pre tabindex="0"><code>Error creating bean with name &#39;scopedTarget.defaultTraceSampler&#39;
</code></pre><blockquote>
<p>åƒè€ƒ: <a href="https://blog.csdn.net/u011039332/article/details/107423951">https://blog.csdn.net/u011039332/article/details/107423951</a></p>
<p><a href="https://blog.csdn.net/weixin_44743245/article/details/120813121">https://blog.csdn.net/weixin_44743245/article/details/120813121</a></p>
</blockquote>
<ul>
<li>åŸå› : main ç·šç¨‹æŒæœ‰ singletonObjects çš„é–, ä¸¦ä¸”ç­‰å¾… lettuce-kqueueEventLoop-4-1 ä¾† unpark, lettuce-kqueueEventLoop-4-1 ç·šç¨‹éœ€è¦ singletonObjects çš„é–, æ‰€ä»¥ å°±é€ æˆäº†æ­»é–</li>
<li>è§£æ³•æœ‰ä»¥ä¸‹å¹¾ç¨®å¯é¸</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#658b00">è§£æ³•1</span>: <span style="color:#cd5555">åœ¨é…ç½®æ–‡ä»¶application.properties</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># é˜²æ­¢å•Ÿå‹•æ­»é–è¡çª</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.sleuth.redis.enabled</span>=<span style="color:#cd5555">false</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">è§£æ³•</span><span style="color:#b452cd">2</span>: <span style="color:#a61717;background-color:#e3d2d2">å•Ÿå‹•é¡æ’é™¤</span>TraceRedisAutoConfiguration.<span style="color:#658b00">class</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@SpringBootApplication</span>(exclude = {DataSourceAutoConfiguration.<span style="color:#658b00">class</span>,TraceRedisAutoConfiguration.<span style="color:#658b00">class</span>})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a61717;background-color:#e3d2d2">è§£æ³•</span><span style="color:#b452cd">3</span>: <span style="color:#a61717;background-color:#e3d2d2">è‡ªå·±è²æ˜é…ç½®ä¸€å€‹</span>zipkin<span style="color:#a61717;background-color:#e3d2d2">çš„æ¡æ¨£å™¨ï¼Œè€Œä¸æ˜¯ä½¿ç”¨</span> spring boot <span style="color:#a61717;background-color:#e3d2d2">è‡ªå‹•é…ç½®çš„</span> <span style="color:#a61717;background-color:#e3d2d2">ä»£ç¢¼å¦‚ä¸‹ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">SleuthSamplerConfiguration</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> Sampler <span style="color:#008b45">defaultSampler</span>() <span style="color:#8b008b;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è¿™ä¸ªå€¼æ˜¯é‡‡æ ·ç‡ï¼Œè®¾ç½®ä¸º1å°±æ˜¯100%é‡‡æ ·ï¼Œæ¯ä¸€æ¡è¯·æ±‚éƒ½é‡‡ï¼Œ0.1å°±æ˜¯10%é‡‡æ ·ç‡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        Float f = <span style="color:#8b008b;font-weight:bold">new</span> Float(<span style="color:#b452cd">0.1f</span>);
</span></span><span style="display:flex;"><span>        SamplerProperties samplerProperties = <span style="color:#8b008b;font-weight:bold">new</span> SamplerProperties();
</span></span><span style="display:flex;"><span>        samplerProperties.<span style="color:#658b00">setProbability</span>(f);
</span></span><span style="display:flex;"><span>        ProbabilityBasedSampler sampler = <span style="color:#8b008b;font-weight:bold">new</span> ProbabilityBasedSampler(samplerProperties);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> sampler;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="zipkin">zipkin</h2>
<blockquote>
<p>å¯è¦–åŒ–é¡¯ç¤ºéˆè·¯ï¼Œå®˜æ–¹: <a href="https://zipkin.io">https://zipkin.io</a></p>
</blockquote>
<ul>
<li>æ‹‰dockeræœå‹™ï¼Œä¹Ÿæœ‰jaråŸ·è¡Œç‰ˆï¼Œä½†dockeræ¯”è¼ƒé€šç”¨</li>
</ul>
<pre tabindex="0"><code>docker run -d -p 9411:9411 openzipkin/zipkin
</code></pre><ul>
<li>å¼•åŒ…</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#228b22">&lt;!-- å¯è¦–åŒ–zipkinå·²ç¶“åŒ…å«éˆè·¯è¿½è¹¤sleuth --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;groupId&gt;</span>org.springframework.cloud<span style="color:#8b008b;font-weight:bold">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">&lt;artifactId&gt;</span>spring-cloud-starter-zipkin<span style="color:#8b008b;font-weight:bold">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ul>
<li>application.properties
<ul>
<li>æ¯å€‹æœå‹™éƒ½è¦è¨­å®š</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-properties" data-lang="properties"><span style="display:flex;"><span><span style="color:#228b22"># éˆè·¯è¿½è¹¤å¯è¦–åŒ–zipkinä¼ºæœå™¨</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.zipkin.base-url</span>=<span style="color:#cd5555">http://localhost:9411/</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># é—œé–‰æœå‹™ç™¼ç¾ï¼Œå¦å‰‡spring cloudæœƒæŠŠzipkinçš„urlç•¶åšæœå‹™åç¨±</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.zipkin.discovery-client-enabled</span>=<span style="color:#cd5555">false</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># ä½¿ç”¨httpçš„æ–¹å¼å‚³è¼¸æ•¸æ“š</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.zipkin.sender.type</span>=<span style="color:#cd5555">web</span>
</span></span><span style="display:flex;"><span><span style="color:#228b22"># è¨­ç½®æŠ½æ¨£æ¡é›†ç‡ç‚º100%ï¼Œé è¨­æ˜¯0.1</span>
</span></span><span style="display:flex;"><span><span style="color:#658b00">spring.sleuth.sampler.probability</span>=<span style="color:#cd5555">1</span>
</span></span></code></pre></div><ul>
<li>ç€è¦½å™¨è¨ªå• http://localhost:9411/
<ul>
<li>ç™¼èµ·è«‹æ±‚ï¼Œçœ‹åˆ°åº•åœ¨å“ªé‚Šè€—æ™‚æœ€å¤šã€å“ªè£¡æ˜¯ç“¶é ¸</li>
</ul>
</li>
</ul>
<p><img src="image-20220207235808905.png" alt="image-20220207235808905"></p>
<ul>
<li>ç™¼ç¾åªè¦æœ‰feigné ç¨‹èª¿ç”¨å°±ç‰¹åˆ¥æ…¢ï¼Œç›¡é‡å°‘ç”¨ï¼ŒçœŸè¦ç”¨è¦ç›¡é‡åšç•°æ­¥
<ul>
<li>è€Œç™¼æ¶ˆæ¯çµ¦MQè·Ÿæ¥æ”¶éƒ½è¶…å¿«ï¼Œé›£æ€ªå–œæ­¡ç”¨æ¶ˆæ¯éšŠåˆ—ï¼ŒçœŸçš„èˆ’æœ</li>
</ul>
</li>
</ul>
<p><img src="image-20220208003057292.png" alt="image-20220208003057292"></p>
<ul>
<li>é‚„å¯ä»¥æŸ¥çœ‹ä¾è³´</li>
</ul>
<p><img src="image-20220208003438550.png" alt="image-20220208003438550"></p>
<ul>
<li>é¸å–ç¯€é»ï¼Œèƒ½æŸ¥çœ‹ä»–çš„ä¸Šä¸‹æ¸¸</li>
</ul>
<p><img src="image-20220208003722008.png" alt="image-20220208003722008"></p>
<h3 id="æŒä¹…åŒ–">æŒä¹…åŒ–</h3>
<ul>
<li>é è¨­æ˜¯å­˜åœ¨è¨˜æ†¶é«”ï¼Œä¸€æ¨£é—œæ©Ÿå°±GG</li>
<li>å¯ä»¥å­˜åˆ°MySQLæˆ–elasticsearchï¼Œç”±æ–¼è¿½è¹¤è¦æœå°‹ã€ç¯©é¸ï¼Œç”¨ESæ›´å¥½ä¸€é»</li>
</ul>
<pre tabindex="0"><code>docker run --env STORAGE_TYPE=elasticsearch --env ES_HOSTS=localhost:9200 openzipkin/zipkin-dependencies
</code></pre><h1 id="é«˜ç´šç¯‡å°çµ">é«˜ç´šç¯‡å°çµ</h1>
<ul>
<li>ä½µç™¼æœ‰ä¸‰å¯¶: ç·©å­˜ã€ç•°æ­¥ã€éšŠæ’å¥½</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-02-10</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220211-javaweb-heroku/">
			ä¸‹ä¸€ç¯‡<br>ç”¨Herokuéƒ¨ç½²Tomcatç¶²ç«™
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220209-javaweb-book-market/">
			ä¸Šä¸€ç¯‡<br>æŸšå­æ›¸åŸ
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
