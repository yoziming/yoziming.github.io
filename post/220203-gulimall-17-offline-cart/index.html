<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>cookie&amp;rediså¯¦ç¾è¨ªå®¢è³¼ç‰©è»Š</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-17">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="cookie&amp;rediså¯¦ç¾è¨ªå®¢è³¼ç‰©è»Š" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-17" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220203-gulimall-17-offline-cart/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-03T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="cookie&amp;rediså¯¦ç¾è¨ªå®¢è³¼ç‰©è»Š"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-17"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b3%bc%e7%89%a9%e8%bb%8a%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90" onclick="onNavClick(`#è³¼ç‰©è»Šéœ€æ±‚åˆ†æ-nav`)" id="è³¼ç‰©è»Šéœ€æ±‚åˆ†æ-nav">
									è³¼ç‰©è»Šéœ€æ±‚åˆ†æ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%aa%e5%ae%a2%e8%b3%bc%e7%89%a9%e8%bb%8a" onclick="onNavClick(`#è¨ªå®¢è³¼ç‰©è»Š-nav`)" id="è¨ªå®¢è³¼ç‰©è»Š-nav">
									è¨ªå®¢è³¼ç‰©è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%94%a8%e6%88%b7%e8%b3%bc%e7%89%a9%e8%bb%8a" onclick="onNavClick(`#ç”¨æˆ·è³¼ç‰©è»Š-nav`)" id="ç”¨æˆ·è³¼ç‰©è»Š-nav">
									ç”¨æˆ·è³¼ç‰©è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%93%8d%e4%bd%9c%e5%88%86%e6%9e%90" onclick="onNavClick(`#æ“ä½œåˆ†æ-nav`)" id="æ“ä½œåˆ†æ-nav">
									æ“ä½œåˆ†æ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b3%87%e6%96%99%e5%ba%ab%e8%a8%ad%e8%a8%88" onclick="onNavClick(`#è³‡æ–™åº«è¨­è¨ˆ-nav`)" id="è³‡æ–™åº«è¨­è¨ˆ-nav">
									è³‡æ–™åº«è¨­è¨ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vo%e8%a8%ad%e8%a8%88" onclick="onNavClick(`#voè¨­è¨ˆ-nav`)" id="voè¨­è¨ˆ-nav">
									Voè¨­è¨ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%af%a6%e4%bd%9c" onclick="onNavClick(`#å¯¦ä½œ-nav`)" id="å¯¦ä½œ-nav">
									å¯¦ä½œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8" onclick="onNavClick(`#æ””æˆªå™¨-nav`)" id="æ””æˆªå™¨-nav">
									æ””æˆªå™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8%e8%88%87%e9%81%8e%e6%bf%be%e5%99%a8" onclick="onNavClick(`#æ””æˆªå™¨èˆ‡éæ¿¾å™¨-nav`)" id="æ””æˆªå™¨èˆ‡éæ¿¾å™¨-nav">
									æ””æˆªå™¨èˆ‡éæ¿¾å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9f%a5%e7%9c%8b%e6%95%b4%e8%bb%8a" onclick="onNavClick(`#æŸ¥çœ‹æ•´è»Š-nav`)" id="æŸ¥çœ‹æ•´è»Š-nav">
									æŸ¥çœ‹æ•´è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b7%bb%e5%8a%a0%e8%87%b3%e8%bb%8a" onclick="onNavClick(`#æ·»åŠ è‡³è»Š-nav`)" id="æ·»åŠ è‡³è»Š-nav">
									æ·»åŠ è‡³è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sql-concat%e7%9a%84%e7%94%a8%e6%b3%95" onclick="onNavClick(`#sql-concatçš„ç”¨æ³•-nav`)" id="sql-concatçš„ç”¨æ³•-nav">
									SQL CONCATçš„ç”¨æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%95%e5%b0%8e%e8%87%b3%e6%b7%bb%e5%8a%a0%e6%88%90%e5%8a%9f%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢-nav`)" id="å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢-nav">
									å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%aa%e6%94%b9" onclick="onNavClick(`#åˆªæ”¹-nav`)" id="åˆªæ”¹-nav">
									åˆªã€æ”¹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%8b%e5%96%ae%e5%89%8d%e8%a8%88%e7%ae%97%e5%83%b9%e6%a0%bc" onclick="onNavClick(`#ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼-nav`)" id="ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼-nav">
									ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#å°çµ-nav`)" id="å°çµ-nav">
									å°çµ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8-1" onclick="onNavClick(`#æ””æˆªå™¨-1-nav`)" id="æ””æˆªå™¨-1-nav">
									æ””æˆªå™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%9c%a8redis%e6%b7%bb%e5%8a%a0hash" onclick="onNavClick(`#åœ¨redisæ·»åŠ hash-nav`)" id="åœ¨redisæ·»åŠ hash-nav">
									åœ¨redisæ·»åŠ hash
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%95%b0%e6%ad%a5%e4%bb%bb%e5%8b%99" onclick="onNavClick(`#ç•°æ­¥ä»»å‹™-nav`)" id="ç•°æ­¥ä»»å‹™-nav">
									ç•°æ­¥ä»»å‹™
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%85%88%e8%87%aa%e8%a8%82%e7%b7%9a%e7%a8%8b%e6%b1%a0" onclick="onNavClick(`#å…ˆè‡ªè¨‚ç·šç¨‹æ± -nav`)" id="å…ˆè‡ªè¨‚ç·šç¨‹æ± -nav">
									å…ˆè‡ªè¨‚ç·šç¨‹æ± 
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b3%bc%e7%89%a9%e8%bb%8a%e9%9c%80%e6%b1%82%e5%88%86%e6%9e%90" onclick="onNavClick(`#è³¼ç‰©è»Šéœ€æ±‚åˆ†æ-nav`)" id="è³¼ç‰©è»Šéœ€æ±‚åˆ†æ-nav">
									è³¼ç‰©è»Šéœ€æ±‚åˆ†æ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%a8%aa%e5%ae%a2%e8%b3%bc%e7%89%a9%e8%bb%8a" onclick="onNavClick(`#è¨ªå®¢è³¼ç‰©è»Š-nav`)" id="è¨ªå®¢è³¼ç‰©è»Š-nav">
									è¨ªå®¢è³¼ç‰©è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%94%a8%e6%88%b7%e8%b3%bc%e7%89%a9%e8%bb%8a" onclick="onNavClick(`#ç”¨æˆ·è³¼ç‰©è»Š-nav`)" id="ç”¨æˆ·è³¼ç‰©è»Š-nav">
									ç”¨æˆ·è³¼ç‰©è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%93%8d%e4%bd%9c%e5%88%86%e6%9e%90" onclick="onNavClick(`#æ“ä½œåˆ†æ-nav`)" id="æ“ä½œåˆ†æ-nav">
									æ“ä½œåˆ†æ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e8%b3%87%e6%96%99%e5%ba%ab%e8%a8%ad%e8%a8%88" onclick="onNavClick(`#è³‡æ–™åº«è¨­è¨ˆ-nav`)" id="è³‡æ–™åº«è¨­è¨ˆ-nav">
									è³‡æ–™åº«è¨­è¨ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#vo%e8%a8%ad%e8%a8%88" onclick="onNavClick(`#voè¨­è¨ˆ-nav`)" id="voè¨­è¨ˆ-nav">
									Voè¨­è¨ˆ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%af%a6%e4%bd%9c" onclick="onNavClick(`#å¯¦ä½œ-nav`)" id="å¯¦ä½œ-nav">
									å¯¦ä½œ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8" onclick="onNavClick(`#æ””æˆªå™¨-nav`)" id="æ””æˆªå™¨-nav">
									æ””æˆªå™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8%e8%88%87%e9%81%8e%e6%bf%be%e5%99%a8" onclick="onNavClick(`#æ””æˆªå™¨èˆ‡éæ¿¾å™¨-nav`)" id="æ””æˆªå™¨èˆ‡éæ¿¾å™¨-nav">
									æ””æˆªå™¨èˆ‡éæ¿¾å™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9f%a5%e7%9c%8b%e6%95%b4%e8%bb%8a" onclick="onNavClick(`#æŸ¥çœ‹æ•´è»Š-nav`)" id="æŸ¥çœ‹æ•´è»Š-nav">
									æŸ¥çœ‹æ•´è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b7%bb%e5%8a%a0%e8%87%b3%e8%bb%8a" onclick="onNavClick(`#æ·»åŠ è‡³è»Š-nav`)" id="æ·»åŠ è‡³è»Š-nav">
									æ·»åŠ è‡³è»Š
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#sql-concat%e7%9a%84%e7%94%a8%e6%b3%95" onclick="onNavClick(`#sql-concatçš„ç”¨æ³•-nav`)" id="sql-concatçš„ç”¨æ³•-nav">
									SQL CONCATçš„ç”¨æ³•
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%bc%95%e5%b0%8e%e8%87%b3%e6%b7%bb%e5%8a%a0%e6%88%90%e5%8a%9f%e9%a0%81%e9%9d%a2" onclick="onNavClick(`#å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢-nav`)" id="å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢-nav">
									å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%88%aa%e6%94%b9" onclick="onNavClick(`#åˆªæ”¹-nav`)" id="åˆªæ”¹-nav">
									åˆªã€æ”¹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%b8%8b%e5%96%ae%e5%89%8d%e8%a8%88%e7%ae%97%e5%83%b9%e6%a0%bc" onclick="onNavClick(`#ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼-nav`)" id="ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼-nav">
									ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%b0%8f%e7%b5%90" onclick="onNavClick(`#å°çµ-nav`)" id="å°çµ-nav">
									å°çµ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e6%94%94%e6%88%aa%e5%99%a8-1" onclick="onNavClick(`#æ””æˆªå™¨-1-nav`)" id="æ””æˆªå™¨-1-nav">
									æ””æˆªå™¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e5%9c%a8redis%e6%b7%bb%e5%8a%a0hash" onclick="onNavClick(`#åœ¨redisæ·»åŠ hash-nav`)" id="åœ¨redisæ·»åŠ hash-nav">
									åœ¨redisæ·»åŠ hash
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%95%b0%e6%ad%a5%e4%bb%bb%e5%8b%99" onclick="onNavClick(`#ç•°æ­¥ä»»å‹™-nav`)" id="ç•°æ­¥ä»»å‹™-nav">
									ç•°æ­¥ä»»å‹™
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%85%88%e8%87%aa%e8%a8%82%e7%b7%9a%e7%a8%8b%e6%b1%a0" onclick="onNavClick(`#å…ˆè‡ªè¨‚ç·šç¨‹æ± -nav`)" id="å…ˆè‡ªè¨‚ç·šç¨‹æ± -nav">
									å…ˆè‡ªè¨‚ç·šç¨‹æ± 
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e4%bd%bf%e7%94%a8" onclick="onNavClick(`#ä½¿ç”¨-nav`)" id="ä½¿ç”¨-nav">
									ä½¿ç”¨
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/gulimall.png')"
                    
                
            >
                <div class="post-title">
                    cookie&amp;rediså¯¦ç¾è¨ªå®¢è³¼ç‰©è»Š
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-17
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-02-03 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%95%86%E5%9F%8E%E9%A0%85%E7%9B%AE">Javaå¾®æœå‹™å•†åŸé …ç›®</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="è³¼ç‰©è»Šéœ€æ±‚åˆ†æ">è³¼ç‰©è»Šéœ€æ±‚åˆ†æ</h1>
<h2 id="è¨ªå®¢è³¼ç‰©è»Š">è¨ªå®¢è³¼ç‰©è»Š</h2>
<blockquote>
<p>æ²’ç™»å…¥ä¹Ÿèƒ½æ”¾åœ°è³¼ç‰©è»Šï¼Œæ˜¯æˆ‘æ‰ä¸æé‚£éº¼å¤šï¼Œæ²’ç™»å…¥å°±è®“ç”¨æˆ¶ç™»ä¸€ä¸‹ä¸å°±å¥½äº†ï¼Œå”‰ç•¶ç·´ç¿’å§</p>
<p>æ„å¤–çš„æ˜¯é€™å€‹é …ç›®æ˜¯ä»¿äº¬æ±ï¼Œçµæœäº¬æ±ç¾åœ¨ä¹Ÿä¸æä¾›é€™ç¨®åŠŸèƒ½äº†ï¼Œä¸€å¾‹å…ˆç™»å…¥å†èªª</p>
</blockquote>
<ul>
<li>
<p>å¯ä»¥æŠŠè³‡æ–™æš«å­˜åœ¨å®¢æˆ¶ç«¯ï¼Œä¾‹å¦‚:</p>
<ul>
<li>localstorage</li>
<li>cookie</li>
<li>WebSQL</li>
</ul>
</li>
<li>
<p>ä½†ä½•ç¨®å•†å“è¢«æ”¾åˆ°è³¼ç‰©è»Šæœ¬èº«æ˜¯ä¸€å€‹æœ‰åƒ¹å€¼çš„è³‡è¨Šï¼Œæ‰€ä»¥é¸æ“‡æ”¾åˆ°ä¼ºæœç«¯çš„redis</p>
</li>
</ul>
<h2 id="ç”¨æˆ·è³¼ç‰©è»Š">ç”¨æˆ·è³¼ç‰©è»Š</h2>
<ul>
<li>ä¸€æ¨£æ¡ç”¨redisï¼Œå„ªå‹¢åœ¨æ–¼
<ul>
<li>æ¥µé«˜çš„è®€å¯«ä½µç™¼æ€§èƒ½</li>
<li>å¥½çµ„ç¹”æ•¸æ“šçµæ§‹</li>
<li>redisä¹Ÿæœ‰æŒä¹…åŒ–ç­–ç•¥ï¼ŒAOF</li>
</ul>
</li>
<li>ç™»å…¥å¾Œæœƒå°‡é›¢ç·šè³¼ç‰©è»Šåˆä½µ</li>
</ul>
<h2 id="æ“ä½œåˆ†æ">æ“ä½œåˆ†æ</h2>
<ul>
<li>å¢ï¼ˆæ·»åŠ å•†å“åˆ°è³¼ç‰©è»Šï¼‰</li>
<li>åˆªï¼ˆåˆªé™¤æŸå€‹å•†å“ï¼‰</li>
<li>æ”¹ï¼ˆä¿®æ”¹å•†å“æ•¸é‡ï¼‰</li>
<li>æŸ¥ï¼ˆæŸ¥è©¢è³¼ç‰©è»Šä¸­çš„å•†å“ï¼‰
<ul>
<li>å•†å“æ˜¯å¦è¢«é¸ä¸­ï¼Œä¸‹æ¬¡é€²ä¾†é‚„æ˜¯é¸ä¸­ç‹€æ…‹</li>
<li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨è³¼ç‰©è»Šå¤šä»¶å•†å“ä¸€èµ·çµç®—ä¸‹å–®</li>
<li>åœ¨è³¼ç‰©è»Šä¸­å±•ç¤ºå•†å“å„ªæƒ ä¿¡æ¯</li>
<li>æç¤ºè³¼ç‰©è»Šå•†å“åƒ¹æ ¼è®ŠåŒ–</li>
</ul>
</li>
</ul>
<h2 id="è³‡æ–™åº«è¨­è¨ˆ">è³‡æ–™åº«è¨­è¨ˆ</h2>
<ul>
<li>Redisæ•¸æ“šçµæ§‹ç”¨Hashï¼Œé€ ä¸€å€‹é›™å±¤Mapä¾†å­˜</li>
</ul>
<pre tabindex="0"><code>Map&lt;String, Map&lt;String, String&gt;&gt; 
</code></pre><ul>
<li>ç¬¬ä¸€å€‹keyæ˜¯ç”¨æˆ·idï¼Œvalueæ˜¯è³¼ç‰©è»Šä¿¡æ¯</li>
<li>ç¬¬äºŒå€‹keyæ˜¯skuIdï¼Œvalueæ˜¯è³¼ç‰©é …æ•¸æ“š</li>
</ul>
<h2 id="voè¨­è¨ˆ">Voè¨­è¨ˆ</h2>
<blockquote>
<p>é¡ä¼¼ä¹‹å‰åšçš„æ›¸åŸé …ç›®</p>
</blockquote>
<ul>
<li>CartVoæ˜¯å®Œæ•´çš„ä¸€å°è»Šï¼Œé€™é‚Šæœ‰CartItemVoæ§‹æˆçš„Listã€ç¸½ä»¶æ•¸ã€ç¸½åƒ¹</li>
<li>CartItemVoç•¥ç­‰åŒæ–¼Skuï¼Œå°±æ˜¯è»Šä¸­çš„æŸé …å•†å“ï¼ŒåŠ ä¸Šä»¶æ•¸èˆ‡åƒ¹æ ¼</li>
</ul>
<p><img src="image-20220126011315913.png" alt="image-20220126011315913"></p>
<ul>
<li>åœ¨CartVo.java å°‡è¨ˆç®—ç¸½åƒ¹ç­‰ç­‰æ–¹æ³•å°è£èµ·ä¾†</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> BigDecimal <span style="color:#008b45">getTotalAmount</span>() {
</span></span><span style="display:flex;"><span>    BigDecimal amount = <span style="color:#8b008b;font-weight:bold">new</span> BigDecimal(<span style="color:#cd5555">&#34;0&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è¨ˆç®—è³¼ç‰©é …ç¸½åƒ¹
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (!CollectionUtils.<span style="color:#658b00">isEmpty</span>(items)) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">for</span> (CartItemVo cartItem : items) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">if</span> (cartItem.<span style="color:#658b00">getCheck</span>()) {
</span></span><span style="display:flex;"><span>                amount = amount.<span style="color:#658b00">add</span>(cartItem.<span style="color:#658b00">getTotalPrice</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// è¨ˆç®—å„ªæƒ çš„åƒ¹æ ¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">return</span> amount.<span style="color:#658b00">subtract</span>(getReduce());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="å¯¦ä½œ">å¯¦ä½œ</h1>
<h2 id="æ””æˆªå™¨">æ””æˆªå™¨</h2>
<ul>
<li>
<p>ç•¶ç”¨æˆ¶æƒ³ç”¨è³¼ç‰©è»Šï¼Œå¿…é ˆåˆ¤æ–·æ˜¯å¦å·²ç™»å…¥ï¼Œè‹¥ç„¡ç™»å…¥ï¼Œå‰µé€ ä¸€å€‹è‡¨æ™‚ç”¨æˆ¶cookie:user-key</p>
</li>
<li>
<p>é€ ä¸€å€‹WebMvcConfigureré…ç½®é¡è¨»å†Šæ””æˆªå™¨ï¼ŒMallWebConfig.java</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MallWebConfig</span> <span style="color:#8b008b;font-weight:bold">implements</span> WebMvcConfigurer {
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">addInterceptors</span>(InterceptorRegistry registry) {
</span></span><span style="display:flex;"><span>        registry.<span style="color:#658b00">addInterceptor</span>(<span style="color:#8b008b;font-weight:bold">new</span> CartInterceptor())<span style="color:#228b22">// è¨»å†Šæ””æˆªå™¨
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                .<span style="color:#658b00">addPathPatterns</span>(<span style="color:#cd5555">&#34;/**&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ç”¨ThreadLocalä¾†å„²å­˜ç”¨æˆ¶çš„ç™»å…¥ç‹€æ…‹UserInfoTo</li>
</ul>
<p><img src="image-20220126143902191.png" alt="image-20220126143902191"></p>
<ul>
<li>ThreadLocalåœ¨åŒä¸€å€‹ç·šç¨‹å…§éƒ½èƒ½å­˜å–ï¼Œä¹‹å‰å­¸é</li>
</ul>
<blockquote>
<p><a href="https://yoziming.github.io/post/220110-agg-javaweb-10/#threadlocal">https://yoziming.github.io/post/220110-agg-javaweb-10/#threadlocal</a></p>
</blockquote>
<ul>
<li>CartInterceptor.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * åœ¨åŸ·è¡Œç›®æ¨™æ–¹æ³•ä¹‹å‰ï¼Œåˆ¤æ–·ç”¨æˆ¶çš„ç™»å…¥ç‹€æ…‹.ä¸¦å°è£å‚³éçµ¦controllerç›®æ¨™è«‹æ±‚
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">CartInterceptor</span> <span style="color:#8b008b;font-weight:bold">implements</span> HandlerInterceptor {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">static</span> ThreadLocal&lt;UserInfoTo&gt; toThreadLocal = <span style="color:#8b008b;font-weight:bold">new</span> ThreadLocal&lt;&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/***
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ””æˆªæ‰€æœ‰è«‹æ±‚çµ¦ThreadLocalå°è£UserInfoToç‰©ä»¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 1ã€å¾sessionä¸­ç²å–MemberResponseVo != nullï¼Œç™»å…¥ç‹€æ…‹ï¼Œç‚ºUserInfoToè¨­ç½®Id
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * 2ã€å¾requestä¸­ç²å–cookieï¼Œæ‰¾åˆ°user-keyçš„valueï¼Œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * ç›®æ¨™æ–¹æ³•åŸ·è¡Œä¹‹å‰ï¼šåœ¨ThreadLocalä¸­å­˜å…¥ç”¨æˆ¶ä¿¡æ¯ã€åŒä¸€å€‹ç·šç¨‹å…±äº«æ•¸æ“šã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * å¾sessionä¸­ç²å–æ•¸æ“šã€ä½¿ç”¨sessionéœ€è¦cookieä¸­çš„GULISESSION å€¼ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">boolean</span> <span style="color:#008b45">preHandle</span>(HttpServletRequest request, HttpServletResponse response, Object handler) <span style="color:#8b008b;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        UserInfoTo userInfoTo = <span style="color:#8b008b;font-weight:bold">new</span> UserInfoTo();
</span></span><span style="display:flex;"><span>        HttpSession session = request.<span style="color:#658b00">getSession</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç²å¾—ç•¶å‰ç™»å…¥ç”¨æˆ¶çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        MemberResponseVo memberResponseVo = (MemberResponseVo) session.<span style="color:#658b00">getAttribute</span>(AuthServerConstant.<span style="color:#658b00">LOGIN_USER</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (memberResponseVo != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// ç”¨æˆ¶ç™»å…¥äº†
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            userInfoTo.<span style="color:#658b00">setUserId</span>(memberResponseVo.<span style="color:#658b00">getId</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        Cookie[] cookies = request.<span style="color:#658b00">getCookies</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (cookies != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; cookies.<span style="color:#658b00">length</span> &gt; 0) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">for</span> (Cookie cookie : cookies) {
</span></span><span style="display:flex;"><span>                <span style="color:#228b22">// user-key
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                String name = cookie.<span style="color:#658b00">getName</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">if</span> (name.<span style="color:#658b00">equals</span>(CartConstant.<span style="color:#658b00">TEMP_USER_COOKIE_NAME</span>)) {
</span></span><span style="display:flex;"><span>                    userInfoTo.<span style="color:#658b00">setUserKey</span>(cookie.<span style="color:#658b00">getValue</span>());
</span></span><span style="display:flex;"><span>                    <span style="color:#228b22">// æ¨™è­˜å®¢æˆ¶ç«¯å·²ç¶“å­˜å„²äº† user-key
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                    userInfoTo.<span style="color:#658b00">setTempUser</span>(<span style="color:#8b008b;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å¦‚æœæ²’æœ‰è‡¨æ™‚ç”¨æˆ¶ä¸€å®šåˆ†é…ä¸€å€‹è‡¨æ™‚ç”¨æˆ¶UUID
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isEmpty</span>(userInfoTo.<span style="color:#658b00">getUserKey</span>())) {
</span></span><span style="display:flex;"><span>            String uuid = UUID.<span style="color:#658b00">randomUUID</span>().<span style="color:#658b00">toString</span>();
</span></span><span style="display:flex;"><span>            userInfoTo.<span style="color:#658b00">setUserKey</span>(uuid);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç›®æ¨™æ–¹æ³•åŸ·è¡Œä¹‹å‰
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        toThreadLocal.<span style="color:#658b00">set</span>(userInfoTo);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">true</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     * æ¥­å‹™åŸ·è¡Œä¹‹å¾Œï¼Œè®“ç€è¦½å™¨ä¿å­˜è‡¨æ™‚ç”¨æˆ¶user-keyçš„Cookie
</span></span></span><span style="display:flex;"><span><span style="color:#228b22">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">postHandle</span>(HttpServletRequest request, HttpServletResponse response, Object handler,
</span></span><span style="display:flex;"><span>                           ModelAndView modelAndView) <span style="color:#8b008b;font-weight:bold">throws</span> Exception {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç²å–ç•¶å‰ç”¨æˆ¶çš„å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        UserInfoTo userInfoTo = toThreadLocal.<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// 1ã€åˆ¤æ–·æ˜¯å¦ç™»å…¥ï¼›2ã€åˆ¤æ–·æ˜¯å¦å‰µå»ºuser-tokençš„cookie
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        <span style="color:#8b008b;font-weight:bold">if</span> (userInfoTo != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; !userInfoTo.<span style="color:#658b00">isTempUser</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// å‰µå»ºä¸€å€‹cookie
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            Cookie cookie = <span style="color:#8b008b;font-weight:bold">new</span> Cookie(CartConstant.<span style="color:#658b00">TEMP_USER_COOKIE_NAME</span>, userInfoTo.<span style="color:#658b00">getUserKey</span>());
</span></span><span style="display:flex;"><span>            cookie.<span style="color:#658b00">setDomain</span>(<span style="color:#cd5555">&#34;mall.com&#34;</span>);
</span></span><span style="display:flex;"><span>            cookie.<span style="color:#658b00">setMaxAge</span>(CartConstant.<span style="color:#658b00">TEMP_USER_COOKIE_TIMEOUT</span>);
</span></span><span style="display:flex;"><span>            response.<span style="color:#658b00">addCookie</span>(cookie);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ””æˆªå™¨èˆ‡éæ¿¾å™¨">æ””æˆªå™¨èˆ‡éæ¿¾å™¨</h3>
<blockquote>
<p>åƒè€ƒ <a href="https://iter01.com/527287.html">https://iter01.com/527287.html</a></p>
</blockquote>
<ul>
<li>åŸ·è¡Œé †åº: éæ¿¾å‰-æ””æˆªå‰-actionåŸ·è¡Œ-æ””æˆªå¾Œ-éæ¿¾å¾Œ</li>
</ul>
<p><img src="image-20220126144548868.png" alt="image-20220126144548868"></p>
<ul>
<li>ç¸½çš„ä¾†èªªæ””æˆªå™¨æ›´å¥½ç”¨ä¸€é»</li>
</ul>
<h2 id="æŸ¥çœ‹æ•´è»Š">æŸ¥çœ‹æ•´è»Š</h2>
<ul>
<li>CartController.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * å»è³¼ç‰©è»Šé é¢çš„è«‹æ±‚ã€æœªç™»å…¥ç‹€æ…‹ä¹Ÿå¯ä»¥æŸ¥çœ‹ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç€è¦½å™¨æœ‰ä¸€å€‹cookie:user-key æ¨™è­˜ç”¨æˆ¶çš„èº«ä»½ï¼Œä¸€å€‹æœˆéæœŸ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * å¦‚æœç¬¬ä¸€æ¬¡ä½¿ç”¨jdçš„è³¼ç‰©è»ŠåŠŸèƒ½ï¼Œéƒ½æœƒçµ¦ä¸€å€‹è‡¨æ™‚çš„ç”¨æˆ¶èº«ä»½:
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç€è¦½å™¨ä»¥å¾Œä¿å­˜ï¼Œæ¯æ¬¡è¨ªå•éƒ½æœƒå¸¶ä¸Šé€™å€‹cookieï¼›
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç™»å…¥ï¼šsessionæœ‰ç”¨æˆ¶çš„èº«ä»½
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * æ²’ç™»å…¥ï¼šæŒ‰ç…§cookieè£é¢å¸¶ä¾†user-keyä¾†åš
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç¬¬ä¸€æ¬¡ï¼Œå¦‚æœæ²’æœ‰è‡¨æ™‚ç”¨æˆ¶ï¼Œè‡ªå‹•å‰µå»ºä¸€å€‹è‡¨æ™‚ç”¨æˆ¶
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/cart.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">cartListPage</span>(Model model) <span style="color:#8b008b;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    CartVo cartVo = cartService.<span style="color:#658b00">getCart</span>();
</span></span><span style="display:flex;"><span>    model.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;cart&#34;</span>, cartVo);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;cartList&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>CartServiceImpl.java
<ul>
<li>å¦‚æœç™»å…¥äº†ï¼Œè¦æŠŠè‡¨æ™‚è»Šä¸Šçš„åˆä½µéä¾†ä¸¦æ¸…ç©ºè‡¨æ™‚è»Š</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * è·³è½‰cartListé é¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * å°è£è³¼ç‰©è»Šé¡ã€æ‰€æœ‰å•†å“ï¼Œæ‰€æœ‰å•†å“çš„åƒ¹æ ¼ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ã€æ•´åˆç™»å…¥ç‹€æ…‹èˆ‡æœªç™»å…¥ç‹€æ…‹ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> CartVo <span style="color:#008b45">getCart</span>() <span style="color:#8b008b;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    CartVo cartVo = <span style="color:#8b008b;font-weight:bold">new</span> CartVo();
</span></span><span style="display:flex;"><span>    UserInfoTo userInfoTo = CartInterceptor.<span style="color:#658b00">toThreadLocal</span>.<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(userInfoTo);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (userInfoTo.<span style="color:#658b00">getUserId</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//  1ï¼‰ã€ç™»å…¥å¾Œè³¼ç‰©è»Šçš„key
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String cartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserId</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//  2ï¼‰ã€è‡¨æ™‚è³¼ç‰©è»Šçš„key
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String temptCartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserKey</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// å¦‚æœè‡¨æ™‚è³¼ç‰©è»Šçš„æ•¸æ“šé‚„æœªé€²è¡Œåˆä½µ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        List&lt;CartItemVo&gt; tempCartItems = getCartItems(temptCartKey);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (tempCartItems != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// è‡¨æ™‚è³¼ç‰©è»Šæœ‰æ•¸æ“šéœ€è¦é€²è¡Œåˆä½µæ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            <span style="color:#8b008b;font-weight:bold">for</span> (CartItemVo item : tempCartItems) {
</span></span><span style="display:flex;"><span>                addToCart(item.<span style="color:#658b00">getSkuId</span>(), item.<span style="color:#658b00">getCount</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ¸…é™¤è‡¨æ™‚è³¼ç‰©è»Šçš„æ•¸æ“š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            clearCartInfo(temptCartKey);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç²å–ç™»å…¥å¾Œçš„è³¼ç‰©è»Šæ•¸æ“šã€åŒ…å«åˆä½µéä¾†çš„è‡¨æ™‚è³¼ç‰©è»Šçš„æ•¸æ“šå’Œç™»å…¥å¾Œè³¼ç‰©è»Šçš„æ•¸æ“šã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        List&lt;CartItemVo&gt; cartItems = getCartItems(cartKey);
</span></span><span style="display:flex;"><span>        cartVo.<span style="color:#658b00">setItems</span>(cartItems);
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ²’ç™»å…¥
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String cartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserKey</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç²å–è‡¨æ™‚è³¼ç‰©è»Šè£¡é¢çš„æ‰€æœ‰è³¼ç‰©é …
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        List&lt;CartItemVo&gt; cartItems = getCartItems(cartKey);
</span></span><span style="display:flex;"><span>        cartVo.<span style="color:#658b00">setItems</span>(cartItems);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> cartVo;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç²å–è³¼ç‰©è»Šè£¡é¢çš„æ•¸æ“šã€æ ¹æ“škeyï¼ŒåŒ…è£æˆList&lt;CartItemVo&gt;ã€‘ï¼Œåˆä½µè‡¨æ™‚è»Šç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * key=ã€mall:cart:2 æˆ– mall:cart:lkajkashjghj2989dsjã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param cartKey
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> List&lt;CartItemVo&gt; <span style="color:#008b45">getCartItems</span>(String cartKey) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ç²å–è³¼ç‰©è»Šè£¡é¢çš„æ‰€æœ‰å•†å“
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BoundHashOperations&lt;String, Object, Object&gt; operations = redisTemplate.<span style="color:#658b00">boundHashOps</span>(cartKey);
</span></span><span style="display:flex;"><span>    List&lt;Object&gt; values = operations.<span style="color:#658b00">values</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (values != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; values.<span style="color:#658b00">size</span>() &gt; 0) {
</span></span><span style="display:flex;"><span>        List&lt;CartItemVo&gt; cartItemVoStream = values.<span style="color:#658b00">stream</span>().<span style="color:#658b00">map</span>((obj) -&gt; {
</span></span><span style="display:flex;"><span>            String str = (String) obj;
</span></span><span style="display:flex;"><span>            CartItemVo cartItem = JSON.<span style="color:#658b00">parseObject</span>(str, CartItemVo.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">return</span> cartItem;
</span></span><span style="display:flex;"><span>        }).<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> cartItemVoStream;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="æ·»åŠ è‡³è»Š">æ·»åŠ è‡³è»Š</h2>
<ul>
<li>CartController.java
<ul>
<li>æ·»åŠ å®Œç”¨redirectè·³è½‰ï¼Œé˜²æ­¢é‡è¤‡æäº¤</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * æ·»åŠ å•†å“åˆ°è³¼ç‰©è»Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * attributes.addFlashAttribute():å°‡æ•¸æ“šæ”¾åœ¨sessionä¸­ï¼Œå¯ä»¥åœ¨é é¢ä¸­å–å‡ºï¼Œä½†æ˜¯åªèƒ½å–ä¸€æ¬¡
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * attributes.addAttribute():å°‡æ•¸æ“šæ”¾åœ¨urlå¾Œé¢
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/addCartItem&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">addCartItem</span>(<span style="color:#707a7c">@RequestParam</span>(<span style="color:#cd5555">&#34;skuId&#34;</span>) Long skuId,
</span></span><span style="display:flex;"><span>                          <span style="color:#707a7c">@RequestParam</span>(<span style="color:#cd5555">&#34;num&#34;</span>) Integer num,
</span></span><span style="display:flex;"><span>                          RedirectAttributes attributes) <span style="color:#8b008b;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    cartService.<span style="color:#658b00">addToCart</span>(skuId, num);
</span></span><span style="display:flex;"><span>    attributes.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;skuId&#34;</span>, skuId);<span style="color:#228b22">// çµ¦é‡å®šå‘è«‹æ±‚ç”¨çš„ã€åƒæ•¸æœƒæ‹¼æ¥åœ¨ä¸‹é¢è«‹æ±‚ä¹‹å¾Œã€‘ã€è½‰ç™¼æœƒåœ¨è«‹æ±‚åŸŸä¸­ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;redirect:http://cart.mall.com/addToCartSuccessPage.html&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * è·³è½‰åˆ°æ·»åŠ è³¼ç‰©è»ŠæˆåŠŸé é¢ã€é˜²æ­¢é‡è¤‡æäº¤ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@GetMapping</span>(value = <span style="color:#cd5555">&#34;/addToCartSuccessPage.html&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> String <span style="color:#008b45">addToCartSuccessPage</span>(<span style="color:#707a7c">@RequestParam</span>(<span style="color:#cd5555">&#34;skuId&#34;</span>) Long skuId,
</span></span><span style="display:flex;"><span>                                   Model model) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//é‡å®šå‘åˆ°æˆåŠŸé é¢ã€‚å†æ¬¡æŸ¥è©¢è³¼ç‰©è»Šæ•¸æ“šå³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    CartItemVo cartItemVo = cartService.<span style="color:#658b00">getCartItem</span>(skuId);
</span></span><span style="display:flex;"><span>    model.<span style="color:#658b00">addAttribute</span>(<span style="color:#cd5555">&#34;cartItem&#34;</span>, cartItemVo);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#cd5555">&#34;success&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>CartServiceImpl.java
<ul>
<li>é¦–å…ˆè¦åœ¨redisä¸­é–‹é—¢å±¬æ–¼æŸç”¨æˆ¶çš„è³¼ç‰©è»Šç‰©ä»¶ï¼Œç”¨<code>redisTemplate.boundHashOps()</code>æ–¹æ³•ï¼ŒKeyå°±æ˜¯UserIDï¼Œç‚ºäº†åœ¨redisä¸­æ•´ç†æ–¹ä¾¿åŠ ä¸Šå‰ç¶´<code>mall:cart:</code></li>
<li>å‰é¢åœ¨æ””æˆªå™¨ä¸­æŠŠuserInfoå­˜åˆ°toThreadLocaläº†ï¼Œå¦‚æœæœªç™»å…¥å‰‡æœƒå‰µé€ è‡¨æ™‚çš„ï¼Œæ‰€ä»¥å¾è£¡é¢å¿…å®šèƒ½å–å‡ºä¸€å€‹userId</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç²å–åˆ°æˆ‘å€‘è¦æ“ä½œçš„è³¼ç‰©è»Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç°¡åŒ–ä»£ç¢¼ï¼š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 1ã€åˆ¤æ–·æ˜¯å¦ç™»å…¥ï¼Œæ‹¼æ¥key
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * 2ã€æ•¸æ“šæ˜¯hashé¡å‹ï¼Œæ‰€ä»¥æ¯æ¬¡è¦èª¿ç”¨å…©æ¬¡keyã€ç›´æ¥ç¶å®šå¤–å±¤keyã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç¬¬ä¸€å±¤keyï¼šmall:cart:2
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç¬¬äºŒå±¤keyï¼šskuId
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> BoundHashOperations&lt;String, Object, Object&gt; <span style="color:#008b45">getCartOps</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å…ˆå¾—åˆ°ç•¶å‰ç”¨æˆ¶ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    UserInfoTo userInfoTo = CartInterceptor.<span style="color:#658b00">toThreadLocal</span>.<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>    String cartKey = <span style="color:#cd5555">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">if</span> (userInfoTo.<span style="color:#658b00">getUserId</span>() != <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// mall:cart:UserID
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        cartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserId</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        cartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserKey</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// ç¶å®šæŒ‡å®šçš„keyæ“ä½œRedis
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BoundHashOperations&lt;String, Object, Object&gt; operations = redisTemplate.<span style="color:#658b00">boundHashOps</span>(cartKey);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> operations;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>æ¥è‘—å¯¦ä½œæ·»åŠ ï¼Œå…ˆåˆ¤æ–·å•†å“é …æ˜¯å¦å·²ç¶“åœ¨è»Šä¸­
<ul>
<li>è‹¥ç„¡ï¼Œå°±æ–°å¢ï¼Œéœ€è¦é ç¨‹èª¿ç”¨ç²å–skuInfoèˆ‡skuAttrValuesï¼Œé€™é‚Šè¤‡è£½ä¸€ä»½ä½¿ç”¨ä¹‹å‰è¨­å®šå¥½çš„ç·šç¨‹æ± configä¾†ç”¨ï¼Œç•°æ­¥ç²å–è³‡è¨Šå¾Œä¸€æ¨£ç”¨allOfèˆ‡getç­‰å¾…å…¨éƒ¨ä»»å‹™å®Œæˆï¼Œè½‰JSONå¾Œå­˜åˆ°redis</li>
<li>è‹¥å·²ç¶“å­˜åœ¨ï¼Œåªéœ€è¦ä¿®æ”¹æ•¸é‡</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * æ·»åŠ å•†å“åˆ°è³¼ç‰©è»Š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param skuId
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param num
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> CartItemVo <span style="color:#008b45">addToCart</span>(Long skuId, Integer num) <span style="color:#8b008b;font-weight:bold">throws</span> ExecutionException, InterruptedException {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// æ‹¿åˆ°è¦æ“ä½œçš„è³¼ç‰©è»Šä¿¡æ¯ã€cartOpså°±ç›¸ç•¶æ–¼ç¶å®šäº†ç•¶å‰ç”¨æˆ¶è³¼ç‰©è»Šæ•¸æ“šçš„hashã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BoundHashOperations&lt;String, Object, Object&gt; cartOps = getCartOps();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// åˆ¤æ–·Redisæ˜¯å¦æœ‰è©²å•†å“çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    String productRedisValue = (String) cartOps.<span style="color:#658b00">get</span>(skuId.<span style="color:#658b00">toString</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">// å¦‚æœæ²’æœ‰å°±æ·»åŠ æ•¸æ“šã€é ç¨‹æŸ¥è©¢skuIdã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (StringUtils.<span style="color:#658b00">isEmpty</span>(productRedisValue)) {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// æ·»åŠ æ–°çš„å•†å“åˆ°è³¼ç‰©è»Š(redis)
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        CartItemVo cartItem = <span style="color:#8b008b;font-weight:bold">new</span> CartItemVo();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// é–‹å•Ÿç¬¬ä¸€å€‹ç•°æ­¥ä»»å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        CompletableFuture&lt;Void&gt; getSkuInfoFuture = CompletableFuture.<span style="color:#658b00">runAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// é ç¨‹æŸ¥è©¢ç•¶å‰è¦æ·»åŠ å•†å“çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            R productSkuInfo = productFeignService.<span style="color:#658b00">getInfo</span>(skuId);
</span></span><span style="display:flex;"><span>            SkuInfoVo skuInfo = productSkuInfo.<span style="color:#658b00">getData</span>(<span style="color:#cd5555">&#34;skuInfo&#34;</span>, <span style="color:#8b008b;font-weight:bold">new</span> TypeReference&lt;SkuInfoVo&gt;() {
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// æ•¸æ“šè³¦å€¼æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            cartItem.<span style="color:#658b00">setSkuId</span>(skuInfo.<span style="color:#658b00">getSkuId</span>());
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setTitle</span>(skuInfo.<span style="color:#658b00">getSkuTitle</span>());
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setImage</span>(skuInfo.<span style="color:#658b00">getSkuDefaultImg</span>());
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setPrice</span>(skuInfo.<span style="color:#658b00">getPrice</span>());
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setCount</span>(num);
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setCheck</span>(<span style="color:#8b008b;font-weight:bold">true</span>);
</span></span><span style="display:flex;"><span>        }, executor);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// é–‹å•Ÿç¬¬äºŒå€‹ç•°æ­¥ä»»å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        CompletableFuture&lt;Void&gt; getSkuAttrValuesFuture = CompletableFuture.<span style="color:#658b00">runAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#228b22">// é ç¨‹æŸ¥è©¢skuAttrValuesçµ„åˆä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>            List&lt;String&gt; skuSaleAttrValues = productFeignService.<span style="color:#658b00">getSkuSaleAttrValues</span>(skuId);
</span></span><span style="display:flex;"><span>            cartItem.<span style="color:#658b00">setSkuAttrValues</span>(skuSaleAttrValues);
</span></span><span style="display:flex;"><span>        }, executor);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ç­‰å¾…æ‰€æœ‰çš„ç•°æ­¥ä»»å‹™å…¨éƒ¨å®Œæˆ
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        CompletableFuture.<span style="color:#658b00">allOf</span>(getSkuInfoFuture, getSkuAttrValuesFuture).<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// åºåˆ—åŒ–ä¸¦å­˜åˆ°redis
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String cartItemJson = JSON.<span style="color:#658b00">toJSONString</span>(cartItem);
</span></span><span style="display:flex;"><span>        cartOps.<span style="color:#658b00">put</span>(skuId.<span style="color:#658b00">toString</span>(), cartItemJson);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> cartItem;
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// è³¼ç‰©è»Šä¸­å·²æœ‰æ­¤å•†å“ï¼Œä¿®æ”¹æ•¸é‡å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        CartItemVo cartItemVo = JSON.<span style="color:#658b00">parseObject</span>(productRedisValue, CartItemVo.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>        cartItemVo.<span style="color:#658b00">setCount</span>(cartItemVo.<span style="color:#658b00">getCount</span>() + num);
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">// ä¿®æ”¹redisçš„æ•¸æ“š
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String cartItemJson = JSON.<span style="color:#658b00">toJSONString</span>(cartItemVo);
</span></span><span style="display:flex;"><span>        cartOps.<span style="color:#658b00">put</span>(skuId.<span style="color:#658b00">toString</span>(), cartItemJson);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> cartItemVo;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="sql-concatçš„ç”¨æ³•">SQL CONCATçš„ç”¨æ³•</h3>
<ul>
<li>åœ¨ç¬¬äºŒå€‹é ç¨‹èª¿ç”¨skuSaleAttrValuesï¼Œæƒ³è¦è¿”å› <code>æ©Ÿèº«ï¼šé»‘è‰²</code>é€™æ¨£çš„è³‡æ–™æ ¼å¼ï¼Œç”¨<code>CONCAT(A, &quot;ï¼š&quot;, B)</code></li>
</ul>
<pre tabindex="0"><code>&lt;select id=&#34;getSkuSaleAttrValuesAsStringList&#34; resultType=&#34;java.lang.String&#34;&gt;
    SELECT CONCAT(attr_name, &#34;ï¼š&#34;, attr_value)
    FROM pms_sku_sale_attr_value
    WHERE sku_id = #{skuId}
&lt;/select&gt;
</code></pre><h3 id="å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢">å¼•å°è‡³æ·»åŠ æˆåŠŸé é¢</h3>
<ul>
<li>é›–ç„¶æˆ‘è¦ºå¾—é€™å€‹åŠŸèƒ½æ€ªæ€ªçš„ï¼Œèª°æ·»åŠ æˆåŠŸé‚„å°ˆé–€è·‘å»çœ‹é‚£ä¸€å€‹å“é …ï¼Œä¸æ‡‰è©²æ˜¯åŠ äº†å°±é¡¯ç¤ºä¸€å€‹æ”¶éå»è»Šå­çš„å°å‹•ç•«ï¼Œè®“ç”¨æˆ¶ç¹¼çºŒé€›åŒé¡é …ç›®å—?</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * é‡å®šå‘é é¢ç²å–ç•¶å‰è³¼ç‰©è»Šä¸­skuå•†å“ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> *
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @param skuId
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * @return
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> CartItemVo <span style="color:#008b45">getCartItem</span>(Long skuId) {
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//æ‹¿åˆ°è¦æ“ä½œçš„è³¼ç‰©è»Šä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    BoundHashOperations&lt;String, Object, Object&gt; cartOps = getCartOps();
</span></span><span style="display:flex;"><span>    String redisValue = (String) cartOps.<span style="color:#658b00">get</span>(skuId.<span style="color:#658b00">toString</span>());
</span></span><span style="display:flex;"><span>    CartItemVo cartItemVo = JSON.<span style="color:#658b00">parseObject</span>(redisValue, CartItemVo.<span style="color:#658b00">class</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> cartItemVo;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="åˆªæ”¹">åˆªã€æ”¹</h2>
<ul>
<li>æ²’ä»€éº¼ç‰¹æ®Šçš„ï¼Œå°±ä¸å¤šè²¼</li>
<li>æ¯”è¼ƒç‰¹åˆ¥çš„æ˜¯&quot;é¸ä¸­&quot;é€™å€‹åŠŸèƒ½ï¼Œä¹Ÿåšæˆäº†ä¸€å€‹æ¬„ä½è·Ÿä¿®æ”¹çš„æ–¹æ³•å»ä¿å­˜åˆ°redisï¼Œå³ä½¿é—œæ‰é‡é–‹ä¸Šæ¬¡é¸ä¸­é‚£äº›éƒ½æœƒä¿ç•™</li>
<li>å¯æ˜¯ä»–æ¯æ¬¡æ›´æ”¹é¸/ä¸é¸ä¸­éƒ½ç™¼ä¸€æ¬¡è«‹æ±‚çµ¦å¾Œç«¯ç„¶å¾Œredirectï¼Œæ„Ÿè¦ºå¥½å›§ï¼Œæ‡‰è©²ç”¨ajaxï¼Œé€™å€‹çœŸçš„å¤ªæ‰¯äº†</li>
<li>ç«‹æ„è‰¯å¥½ï¼Œä½†æ„Ÿè¦ºæœ‰é»å¤šé¤˜äº†ï¼Œæ‡‰è©²çµ¦å‰ç«¯åšå°±å¥½ï¼Œä¹Ÿæ²’äººcareé—œæ‰ä¸‹æ¬¡å†é€²åˆ°è³¼ç‰©è»Šé¸ä¸­çš„ç‹€æ…‹æ˜¯å¦è·Ÿä¸Šæ¬¡ä¸€æ¨£å§</li>
<li>ä¸‹å–®çš„æ™‚å€™ä¹Ÿæ˜¯è¦æ ¹æ“šé¸ä¸­é‚£äº›å»è¨ˆç®—åƒ¹æ ¼èˆ‡ç”Ÿæˆè¨‚å–®</li>
</ul>
<h2 id="ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼">ä¸‹å–®å‰è¨ˆç®—åƒ¹æ ¼</h2>
<ul>
<li>é€™å€‹å€’æ˜¯èƒ½ç†è§£ï¼Œä¸‹è¨‚å–®ä¹‹å‰ï¼Œä»¥å‰æ·»åŠ åˆ°è»Šè£¡çš„é …ç›®ï¼Œåƒ¹æ ¼èªªä¸å®šæœ‰è®Šå‹•ï¼Œä¸éåªæŸ¥åƒ¹æ ¼æ˜¯ä¸æ˜¯åˆä¸å¤ å‘¨å…¨ï¼Œå¦‚æœå•†å“ä¸‹æ¶äº†å‘¢?
<ul>
<li>é‚„æ˜¯èªªä»–åœ¨è¨‚å–®æ¨¡çµ„æ‰æœƒç¢ºèªé€™é»ï¼Œä¸ç®¡äº†å°±å…ˆé€™æ¨£å§</li>
</ul>
</li>
<li>CartServiceImpl.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#228b22">/**
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * é ç¨‹èª¿ç”¨ï¼šè¨‚å–®æœå‹™èª¿ç”¨ã€æ›´æ–°æœ€æ–°åƒ¹æ ¼ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> * ç²å–ç•¶å‰ç”¨æˆ¶è³¼ç‰©è»Šæ‰€æœ‰é¸ä¸­çš„å•†å“é …check=trueã€å¾redisä¸­å–ã€‘
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Override</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> List&lt;CartItemVo&gt; <span style="color:#008b45">getUserCartItems</span>() {
</span></span><span style="display:flex;"><span>    List&lt;CartItemVo&gt; cartItemVoList = <span style="color:#8b008b;font-weight:bold">new</span> ArrayList&lt;&gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//ç²å–ç•¶å‰ç”¨æˆ¶ç™»å…¥çš„ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    UserInfoTo userInfoTo = CartInterceptor.<span style="color:#658b00">toThreadLocal</span>.<span style="color:#658b00">get</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#228b22">//å¦‚æœç”¨æˆ¶æœªç™»å…¥ç›´æ¥è¿”å›null
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">if</span> (userInfoTo.<span style="color:#658b00">getUserId</span>() == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">null</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#8b008b;font-weight:bold">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//ç²å–è³¼ç‰©è»Šé …
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        String cartKey = CartConstant.<span style="color:#658b00">CART_PREFIX</span> + userInfoTo.<span style="color:#658b00">getUserId</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//ç²å–æ‰€æœ‰çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        List&lt;CartItemVo&gt; cartItems = getCartItems(cartKey);
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">if</span> (cartItems == <span style="color:#8b008b;font-weight:bold">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#8b008b;font-weight:bold">throw</span> <span style="color:#8b008b;font-weight:bold">new</span> CartExceptionHandler();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#228b22">//ç¯©é¸å‡ºé¸ä¸­çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>        cartItemVoList = cartItems.<span style="color:#658b00">stream</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">filter</span>(items -&gt; items.<span style="color:#658b00">getCheck</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">map</span>(item -&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#228b22">//æ›´æ–°ç‚ºæœ€æ–°çš„åƒ¹æ ¼ï¼ˆæŸ¥è©¢æ•¸æ“šåº«ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                    <span style="color:#228b22">// redisä¸­çš„åƒ¹æ ¼ä¸æ˜¯æœ€æ–°çš„
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>                    BigDecimal price = productFeignService.<span style="color:#658b00">getPrice</span>(item.<span style="color:#658b00">getSkuId</span>());
</span></span><span style="display:flex;"><span>                    item.<span style="color:#658b00">setPrice</span>(price);
</span></span><span style="display:flex;"><span>                    <span style="color:#8b008b;font-weight:bold">return</span> item;
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#658b00">collect</span>(Collectors.<span style="color:#658b00">toList</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">return</span> cartItemVoList;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="å°çµ">å°çµ</h1>
<h3 id="æ””æˆªå™¨-1">æ””æˆªå™¨</h3>
<ul>
<li>å¯ä»¥ç”¨ä¾†ä¿®é£¾request</li>
<li>åˆ°WebMvcConfigurerè¨»å†Šï¼Œé‡å¯«preHandleæˆ–postHandleæ–¹æ³•</li>
<li>ç”¨ThreadLocalä½œç‚ºåŒä¸€ç·šç¨‹çš„ç½®ç‰©æ«ƒ
<ul>
<li>é€™ç©æ„æˆ‘è¨˜å¾—ç”¨å®Œè¦æ¸…ï¼Œä½†æ˜¯æ‰¾ä¸åˆ°å¥½åœ°æ–¹æ¸…ï¼Œåªèƒ½æœŸå¾…ä»–çš„å¼±å¼•ç”¨éè‡ªå·±æ¸…ç†å§</li>
</ul>
</li>
</ul>
<h2 id="åœ¨redisæ·»åŠ hash">åœ¨redisæ·»åŠ hash</h2>
<pre tabindex="0"><code>redisTemplate.boundHashOps(key)
</code></pre><h2 id="ç•°æ­¥ä»»å‹™">ç•°æ­¥ä»»å‹™</h2>
<h3 id="å…ˆè‡ªè¨‚ç·šç¨‹æ± ">å…ˆè‡ªè¨‚ç·šç¨‹æ± </h3>
<ul>
<li>application.properties</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># ç·šç¨‹æ± ç›¸é—œ
mall.thread.core-size=20
mall.thread.max-size=200
mall.thread.keep-alive-time=10
</code></pre><ul>
<li>ThreadPoolConfigProperties.java
<ul>
<li>é€™æ˜¯é€ äº†ä¸€å€‹é¡ï¼Œæ‡‰è©²ä¹Ÿå¯ä»¥ç”¨<code>@values</code></li>
<li>å¾Œä¾†æ‰æ‡‚åŸä¾†é‚£äº›æ¡†æ¶åº•å±¤å°±æ˜¯é€™æ¨£å¯«çš„å°è£å¥½äº†ï¼Œæ‰€ä»¥åœ¨propertieså¯«åƒæ•¸å°±èƒ½å®Œæˆé…ç½®</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@ConfigurationProperties</span>(prefix = <span style="color:#cd5555">&#34;mall.thread&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#707a7c">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">ThreadPoolConfigProperties</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer coreSize;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer maxSize;
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">private</span> Integer keepAliveTime;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>CustomThreadConfig.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">CustomThreadConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#707a7c">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b008b;font-weight:bold">public</span> ThreadPoolExecutor <span style="color:#008b45">threadPoolExecutor</span>(ThreadPoolConfigProperties properties) {
</span></span><span style="display:flex;"><span>        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> ThreadPoolExecutor(
</span></span><span style="display:flex;"><span>                properties.<span style="color:#658b00">getCoreSize</span>(),
</span></span><span style="display:flex;"><span>                properties.<span style="color:#658b00">getMaxSize</span>(),
</span></span><span style="display:flex;"><span>                properties.<span style="color:#658b00">getKeepAliveTime</span>(),
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#658b00">SECONDS</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">new</span> LinkedBlockingDeque&lt;&gt;(10000),
</span></span><span style="display:flex;"><span>                Executors.<span style="color:#658b00">defaultThreadFactory</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#8b008b;font-weight:bold">new</span> ThreadPoolExecutor.<span style="color:#658b00">AbortPolicy</span>()
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<ul>
<li>æ³¨å…¥ ThreadPoolExecutor</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#707a7c">@Autowired</span>
</span></span><span style="display:flex;"><span><span style="color:#8b008b;font-weight:bold">private</span> ThreadPoolExecutor executor;
</span></span></code></pre></div><ul>
<li>ç·¨æ’CompletableFuture
<ul>
<li>è¨˜å¾—å‚³å…¥è‡ªå®šç¾©çš„executorï¼Œå¦å‰‡æœƒé€ é è¨­çš„ç·šç¨‹æ± 
<ul>
<li>ç”¨åŒä¸€å€‹é‹ç…®èœï¼Œè€Œéä¸€ç›´ç”¨æ–°é‹</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>CompletableFuture&lt;Void&gt; xxxFuture = CompletableFuture.<span style="color:#658b00">runAsync</span>(() -&gt; {
</span></span><span style="display:flex;"><span><span style="color:#228b22">// ä»»å‹™
</span></span></span><span style="display:flex;"><span><span style="color:#228b22"></span>}, executor);
</span></span></code></pre></div><ul>
<li>é˜»å¡ç­‰å¾…æ”¶é›†çµæœ</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>CompletableFuture.<span style="color:#658b00">allOf</span>(xxxFuture, oooFuture...).<span style="color:#658b00">get</span>();
</span></span></code></pre></div>
                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-02-03</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220204-gulimall-18-rabbitmq/">
			ä¸‹ä¸€ç¯‡<br>RabbitMQèˆ‡è¨Šæ¯ç¢ºèª
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220203-leetcode-easy-26-28/">
			ä¸Šä¸€ç¯‡<br>LeetCode Easy: 26-28
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
