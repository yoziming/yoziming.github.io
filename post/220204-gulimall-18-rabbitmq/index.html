<!DOCTYPE html>
<html><head>
<meta name="google-site-verification" content="XrwF-xUZWSGJVBBm7jM8vqemVqx--zo5Tb9d-Vr7BCc" />
<title>RabbitMQèˆ‡è¨Šæ¯ç¢ºèª</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-18">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="RabbitMQèˆ‡è¨Šæ¯ç¢ºèª" />
<meta property="og:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-18" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoziming.github.io/post/220204-gulimall-18-rabbitmq/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-04T00:00:00+00:00" /><meta property="og:site_name" content="My Blog" />






<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="RabbitMQèˆ‡è¨Šæ¯ç¢ºèª"/>
<meta name="twitter:description" content="SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-18"/>







<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="https://yoziming.github.io/images/favicon.png">



<link rel="stylesheet" href="https://yoziming.github.io/scss/journal.min.3f72a5fc8f5b5dd732a4b476aced0eece2156958d9d414316494ddb10593ddf7.css" integrity="sha256-P3Kl/I9bXdcypLR2rO0O7OIVaVjZ1BQxZJTdsQWT3fc=" media="screen">



<link rel="stylesheet" href="https://yoziming.github.io/scss/dark-mode.min.f7c2efa7183435a6bd1842f91c541481c7a5137b5991629a870f24e4a516ad4b.css" integrity="sha256-98Lvpxg0Naa9GEL5HFQUgcelE3tZkWKahw8k5KUWrUs=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>






  <script src="/js/toc.js"></script>











<script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script>





</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://yoziming.github.io/">
    
        <div class="nav-title">
            æŸšå­èŒ¶å®¤
        </div>
        
        <div class="nav-subtitle">
            ç´€éŒ„è‡ªå­¸å¤§å°äº‹
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/">
                é¦–é ğŸ 
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                ç³»åˆ—æ–‡ğŸ“–
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                æ¨™ç±¤ğŸ·ï¸
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/about-me">
                é—œæ–¼æˆ‘ğŸ£
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#message-queue" onclick="onNavClick(`#message-queue-nav`)" id="message-queue-nav">
									Message Queue
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%9b%ae%e7%9a%84" onclick="onNavClick(`#ç›®çš„-nav`)" id="ç›®çš„-nav">
									ç›®çš„
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8d%e8%a9%9e" onclick="onNavClick(`#åè©-nav`)" id="åè©-nav">
									åè©
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#rabbitmq" onclick="onNavClick(`#rabbitmq-nav`)" id="rabbitmq-nav">
									RabbitMQ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%95%9f%e7%94%a8" onclick="onNavClick(`#å•Ÿç”¨-nav`)" id="å•Ÿç”¨-nav">
									å•Ÿç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#exchange%e9%a1%9e%e5%9e%8b" onclick="onNavClick(`#exchangeé¡å‹-nav`)" id="exchangeé¡å‹-nav">
									Exchangeé¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%87%aa%e8%a8%82exchange" onclick="onNavClick(`#è‡ªè¨‚exchange-nav`)" id="è‡ªè¨‚exchange-nav">
									è‡ªè¨‚Exchange
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%b4%e5%90%88spring" onclick="onNavClick(`#æ•´åˆspring-nav`)" id="æ•´åˆspring-nav">
									æ•´åˆSpring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e7%bd%ae" onclick="onNavClick(`#å‰ç½®-nav`)" id="å‰ç½®-nav">
									å‰ç½®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6%e5%89%b5%e5%bb%ba" onclick="onNavClick(`#æ¸¬è©¦å‰µå»º-nav`)" id="æ¸¬è©¦å‰µå»º-nav">
									æ¸¬è©¦å‰µå»º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%99%bc%e8%a8%8a%e6%81%af" onclick="onNavClick(`#ç™¼è¨Šæ¯-nav`)" id="ç™¼è¨Šæ¯-nav">
									ç™¼è¨Šæ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8e%a5%e6%94%b6%e8%a8%8a%e6%81%af" onclick="onNavClick(`#æ¥æ”¶è¨Šæ¯-nav`)" id="æ¥æ”¶è¨Šæ¯-nav">
									æ¥æ”¶è¨Šæ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a8%8a%e6%81%af%e7%a2%ba%e8%aa%8d" onclick="onNavClick(`#è¨Šæ¯ç¢ºèª-nav`)" id="è¨Šæ¯ç¢ºèª-nav">
									è¨Šæ¯ç¢ºèª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%80%e6%ae%b5pb" onclick="onNavClick(`#ç¬¬ä¸€æ®µpb-nav`)" id="ç¬¬ä¸€æ®µpb-nav">
									ç¬¬ä¸€æ®µP&gt;B
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%ba%8c%e6%ae%b5eq" onclick="onNavClick(`#ç¬¬äºŒæ®µeq-nav`)" id="ç¬¬äºŒæ®µeq-nav">
									ç¬¬äºŒæ®µE&gt;Q
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%ae%b5-%e6%b6%88%e8%b2%bb%e7%ab%af" onclick="onNavClick(`#ç¬¬ä¸‰æ®µ-æ¶ˆè²»ç«¯-nav`)" id="ç¬¬ä¸‰æ®µ-æ¶ˆè²»ç«¯-nav">
									ç¬¬ä¸‰æ®µ æ¶ˆè²»ç«¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%b0%bd%e6%94%b6" onclick="onNavClick(`#ç°½æ”¶-nav`)" id="ç°½æ”¶-nav">
									ç°½æ”¶
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8b%92%e6%94%b6" onclick="onNavClick(`#æ‹’æ”¶-nav`)" id="æ‹’æ”¶-nav">
									æ‹’æ”¶
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9c%80%e7%b5%82%e6%96%b9%e6%a1%88" onclick="onNavClick(`#æœ€çµ‚æ–¹æ¡ˆ-nav`)" id="æœ€çµ‚æ–¹æ¡ˆ-nav">
									æœ€çµ‚æ–¹æ¡ˆ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/">
                    é¦–é ğŸ 
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    ç³»åˆ—æ–‡ğŸ“–
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    æ¨™ç±¤ğŸ·ï¸
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/about-me">
                    é—œæ–¼æˆ‘ğŸ£
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- ç›®éŒ„ -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#message-queue" onclick="onNavClick(`#message-queue-nav`)" id="message-queue-nav">
									Message Queue
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%9b%ae%e7%9a%84" onclick="onNavClick(`#ç›®çš„-nav`)" id="ç›®çš„-nav">
									ç›®çš„
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%90%8d%e8%a9%9e" onclick="onNavClick(`#åè©-nav`)" id="åè©-nav">
									åè©
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#rabbitmq" onclick="onNavClick(`#rabbitmq-nav`)" id="rabbitmq-nav">
									RabbitMQ
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%95%9f%e7%94%a8" onclick="onNavClick(`#å•Ÿç”¨-nav`)" id="å•Ÿç”¨-nav">
									å•Ÿç”¨
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#exchange%e9%a1%9e%e5%9e%8b" onclick="onNavClick(`#exchangeé¡å‹-nav`)" id="exchangeé¡å‹-nav">
									Exchangeé¡å‹
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e8%87%aa%e8%a8%82exchange" onclick="onNavClick(`#è‡ªè¨‚exchange-nav`)" id="è‡ªè¨‚exchange-nav">
									è‡ªè¨‚Exchange
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%95%b4%e5%90%88spring" onclick="onNavClick(`#æ•´åˆspring-nav`)" id="æ•´åˆspring-nav">
									æ•´åˆSpring
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%89%8d%e7%bd%ae" onclick="onNavClick(`#å‰ç½®-nav`)" id="å‰ç½®-nav">
									å‰ç½®
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%b8%ac%e8%a9%a6%e5%89%b5%e5%bb%ba" onclick="onNavClick(`#æ¸¬è©¦å‰µå»º-nav`)" id="æ¸¬è©¦å‰µå»º-nav">
									æ¸¬è©¦å‰µå»º
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%99%bc%e8%a8%8a%e6%81%af" onclick="onNavClick(`#ç™¼è¨Šæ¯-nav`)" id="ç™¼è¨Šæ¯-nav">
									ç™¼è¨Šæ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8e%a5%e6%94%b6%e8%a8%8a%e6%81%af" onclick="onNavClick(`#æ¥æ”¶è¨Šæ¯-nav`)" id="æ¥æ”¶è¨Šæ¯-nav">
									æ¥æ”¶è¨Šæ¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e8%a8%8a%e6%81%af%e7%a2%ba%e8%aa%8d" onclick="onNavClick(`#è¨Šæ¯ç¢ºèª-nav`)" id="è¨Šæ¯ç¢ºèª-nav">
									è¨Šæ¯ç¢ºèª
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%80%e6%ae%b5pb" onclick="onNavClick(`#ç¬¬ä¸€æ®µpb-nav`)" id="ç¬¬ä¸€æ®µpb-nav">
									ç¬¬ä¸€æ®µP&gt;B
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%ba%8c%e6%ae%b5eq" onclick="onNavClick(`#ç¬¬äºŒæ®µeq-nav`)" id="ç¬¬äºŒæ®µeq-nav">
									ç¬¬äºŒæ®µE&gt;Q
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e7%ac%ac%e4%b8%89%e6%ae%b5-%e6%b6%88%e8%b2%bb%e7%ab%af" onclick="onNavClick(`#ç¬¬ä¸‰æ®µ-æ¶ˆè²»ç«¯-nav`)" id="ç¬¬ä¸‰æ®µ-æ¶ˆè²»ç«¯-nav">
									ç¬¬ä¸‰æ®µ æ¶ˆè²»ç«¯
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e7%b0%bd%e6%94%b6" onclick="onNavClick(`#ç°½æ”¶-nav`)" id="ç°½æ”¶-nav">
									ç°½æ”¶
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%8b%92%e6%94%b6" onclick="onNavClick(`#æ‹’æ”¶-nav`)" id="æ‹’æ”¶-nav">
									æ‹’æ”¶
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
							
								</ul>
							
						
						
						
							<li>
								<a href="#%e6%9c%80%e7%b5%82%e6%96%b9%e6%a1%88" onclick="onNavClick(`#æœ€çµ‚æ–¹æ¡ˆ-nav`)" id="æœ€çµ‚æ–¹æ¡ˆ-nav">
									æœ€çµ‚æ–¹æ¡ˆ
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://yoziming.github.io/">
            æŸšå­èŒ¶å®¤
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://yoziming.github.io/">
        <div class="single-column-header-title">æŸšå­èŒ¶å®¤</div>
        
        <div class="single-column-header-subtitle">ç´€éŒ„è‡ªå­¸å¤§å°äº‹</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            
                
            

            <div class="post-head-wrapper"
                
                    
                    
                    style="background-image: url('https://yoziming.github.io/images/rabbitmq.jpg')"
                    
                
            >
                <div class="post-title">
                    RabbitMQèˆ‡è¨Šæ¯ç¢ºèª
                    
                    <div class="post-subtitle">
                        SpringBootå¾®æœå‹™é …ç›®ç­†è¨˜-18
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2022-02-04 00:00
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/java%E5%BE%AE%E6%9C%8D%E5%8B%99%E5%95%86%E5%9F%8E%E9%A0%85%E7%9B%AE">Javaå¾®æœå‹™å•†åŸé …ç›®</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/java">java</a>
                                &nbsp;
                            
                                <a href="/tags/mq">mq</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <h1 id="message-queue">Message Queue</h1>
<blockquote>
<p><em>Message queue</em> è¨Šæ¯ä½‡åˆ—</p>
</blockquote>
<ul>
<li><em>ä½‡åˆ—</em>ï¼ˆqueueï¼‰ï¼Œåˆç¨±ç‚ºéšŠåˆ—ï¼Œç‰¹æ€§æ˜¯å…ˆé€²å…ˆå‡º(FIFO)</li>
<li>è¨Šæ¯ä½‡åˆ—æ˜¯ä¸€å€‹ä¸­é–“ä»¶ï¼Œåˆæ˜¯ç¶“å…¸çš„&quot;åŠ ä¸€å±¤&quot;æ“ä½œï¼ŒæŠ½å‡ºä¸€å€‹å°ˆé–€å­˜æ”¾æºé€šè¨Šæ¯çš„åœ°æ–¹ï¼Œå°±æ˜¯è¨Šæ¯ä½‡åˆ—
<ul>
<li>å¯ä»¥ç†è§£æˆå»éŠ€è¡Œè¾¦äº‹ï¼Œé‚£å€‹é ˜è™Ÿç¢¼ç‰Œçš„æ©Ÿå™¨</li>
</ul>
</li>
<li>å¸‚é¢ä¸Šå¸¸è¦‹çš„MQ: ActiveMQã€RabbitMQã€RocketMQã€Kafka</li>
</ul>
<h2 id="ç›®çš„">ç›®çš„</h2>
<ul>
<li>ç¸®çŸ­èª¿ç”¨æ™‚é–“: é€éåºåˆ—åˆ†ç™¼å¾ŒçºŒçš„ç•°æ­¥èª¿ç”¨ï¼Œä¸éœ€è¦ä¸€æ­¥ä¸€æ­¥å¾€ä¸‹èµ°ç­‰è¿”å›
<ul>
<li>å°±åƒå»é†«é™¢ï¼Œé†«ç”Ÿé–‹äº†æª¢æŸ¥è¦ä½ å»æŠ½è¡€è·Ÿç…§Xå…‰ï¼Œå“ªé‚Šæ–¹ä¾¿å°±å…ˆå»åšï¼Œç¸½ä¹‹æª¢æŸ¥å–®é–‹äº†é†«ç”Ÿå°±ä¸ç®¡äº†ï¼Œä½ ç¸½æœƒå»åšå®Œæª¢æŸ¥</li>
</ul>
</li>
</ul>
<p><img src="image-20220127212728258.png" alt="image-20220127212728258"></p>
<ul>
<li>è§£è€¦: æ¨¡çµ„é–“æºé€šç”¨è¨‚é–±ä½‡åˆ—çš„å½¢å¼ï¼Œåªéœ€è¦é—œæ³¨æ”¶ç™¼è¨Šæ¯ï¼Œæ¸›å°‘æ¥­å‹™é‚è¼¯çš„ä¾µå…¥
<ul>
<li>æ¯”å¦‚åˆ°äº†æŠ½è¡€ç«™ï¼Œæ‹¿æª¢é©—å–®å»æƒæ©Ÿå™¨å°±èƒ½å®ŒæˆæŠ½è¡€å ±åï¼Œä¸éœ€è¦é†«ç”Ÿæ‰“é›»è©±å‘ŠçŸ¥æŠ½è¡€ç«™èª°è¦æŠ½ä»€éº¼è¡€</li>
</ul>
</li>
</ul>
<p><img src="image-20220127213129008.png" alt="image-20220127213129008"></p>
<ul>
<li>å‰Šå³°: æµé‡æ§åˆ¶ï¼ŒéŒ¯é–‹é«˜ä½µç™¼ï¼Œä¾é †åºè™•ç†
<ul>
<li>éšŠåˆ—æ˜¯æœ‰åºã€å¯æ§åˆ¶æµé‡çš„ï¼Œä¸æœƒçªç„¶1000äººæ“ çˆ†æŠ½è¡€ç«™</li>
</ul>
</li>
</ul>
<p><img src="image-20220127213027170.png" alt="image-20220127213027170"></p>
<h2 id="åè©">åè©</h2>
<ul>
<li>
<p>æ¶ˆæ¯ä»£ç†ï¼ˆmessage brokerï¼‰: å®‰è£äº†æ¶ˆæ¯ä¸­é–“ä»¶çš„ä¼ºæœå™¨ï¼Œç™¼é€æ¶ˆæ¯å’Œæ¥æ”¶æ¶ˆæ¯éƒ½è¦é€£ä¸Šå®ƒ</p>
<ul>
<li>å†’éšªè€…å…¬æœƒçš„ä»»å‹™çœ‹æ¿</li>
</ul>
</li>
<li>
<p>ç›®çš„åœ°ï¼ˆdestinationï¼‰: ç›®çš„åœ°è¡¨ç¤ºç”Ÿç”¢è€…ç™¼é€æ¶ˆæ¯çµ¦æ¶ˆæ¯ä»£ç†ä¹‹å¾Œï¼Œæ˜¯å­˜å„²åˆ°æ¶ˆæ¯ä»£ç†ä¸­å“ªä¸€å€‹å…·é«”çš„ç›®çš„åœ°ï¼ˆéšŠåˆ—æˆ–ä¸»é¡Œï¼‰</p>
<ul>
<li>
<p>éšŠåˆ—ï¼ˆqueueï¼‰ï¼šé»å°é»é€šä¿¡ï¼Œ1å€‹ç™¼é€è€…ï¼Œnå€‹æ¥å—è€…ï¼Œä½†ä¸€å€‹ä¿¡æ¯åªæœƒè¢«ä¸€å€‹æ¥å—è€…æ¶ˆè²»ï¼ˆæ¶ˆè²»å¾Œç§»å‡ºéšŠåˆ—ï¼‰</p>
<ul>
<li>ç†è§£ç‚ºæ‹‹ç¹¡çƒ</li>
</ul>
</li>
<li>
<p>ä¸»é¡Œï¼ˆtopicï¼‰ï¼šç™¼ä½ˆ/è¨‚é–²ï¼Œå¤šå€‹ç™¼é€è€…+å¤šå€‹è¨‚é–²è€…ã€‚å¤šå€‹è¨‚é–²è€…æœƒåŒæ™‚æ¥æ”¶åˆ°</p>
<ul>
<li>å»£æ’­</li>
</ul>
</li>
</ul>
</li>
<li>
<p>JMS (Java Message Service): åŸºæ–¼JAVA APIå®šç¾©çš„æ¨™æº–ä»‹é¢</p>
<ul>
<li>
<p>é¡ä¼¼JDBCèˆ‡è³‡æ–™åº«å» å•†ä¹‹é–“çš„é—œä¿‚</p>
</li>
<li>
<p>ActiveMQã€HornetMQæ˜¯JMSå¯¦ç¾</p>
</li>
<li>
<blockquote>
<p>åƒè€ƒ <a href="https://openhome.cc/Gossip/EJB3Gossip/JavaMessageService.html">https://openhome.cc/Gossip/EJB3Gossip/JavaMessageService.html</a></p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>AMQP(Advanced Message Queuing Protocol)</p>
<ul>
<li>é«˜ç´šæ¶ˆæ¯éšŠåˆ—å”è­°ï¼Œä¹Ÿæ˜¯ä¸€å€‹æ¶ˆæ¯ä»£ç†çš„è¦ç¯„ï¼Œå…¼å®¹JMS</li>
<li>RabbitMQæ˜¯AMQPçš„å¯¦ç¾</li>
</ul>
</li>
<li>
<p>ä¸ç®¡JMSæˆ–AMQPï¼ŒSpringéƒ½æœ‰æä¾›æ”¯æŒï¼Œåªè¦å¯¦ç¾ConnectionFactoryä¾†é€£æ¥æ¶ˆæ¯ä»£ç†ï¼ŒSpring Bootä¹Ÿéƒ½æœ‰è‡ªå‹•é…ç½®</p>
<ul>
<li>SpringçœŸçš„æ˜¯ç„¡æ•µï¼Œä¸€çµ±Javaæ±Ÿæ¹–</li>
</ul>
</li>
</ul>
<h1 id="rabbitmq">RabbitMQ</h1>
<blockquote>
<p>é€™ä¸€Partè¬›çš„è¶…æ¸…æ™°ï¼Œè¬›çš„å¤ªå¥½äº† <a href="https://www.bilibili.com/video/BV1np4y1C7Yf?p=250&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1np4y1C7Yf?p=250&amp;spm_id_from=pageDriver</a></p>
</blockquote>
<p><img src="image-20220126230205048.png" alt="image-20220126230205048"></p>
<ul>
<li>publisherç™¼é€message</li>
<li>messageç”±æ¶ˆæ¯é ­ + æ¶ˆæ¯é«”çµ„æˆ(é¡ä¼¼HTTP)ï¼Œç™¼é€åˆ°Message Brokeræ¶ˆæ¯ä»£ç†ä¼ºæœå™¨ä¸Š</li>
<li>åœ¨Brokerä¸­ï¼ŒExchangeäº¤æ›æ©Ÿç¶å®šQueueï¼Œä¸¦è­˜åˆ¥route key(æ¶ˆæ¯è¦å»å“ª)</li>
<li>æ¶ˆè²»è€…è¨‚é–±éšŠåˆ—ï¼Œå»ºç«‹ä¸€æ¢Connectioné•·é€£æ¥(é€£æ¥ä¸Šé–‹é—¢æœ‰å¤šæ¢channelä¿¡é“)
<ul>
<li>é¡ä¼¼é«˜é€Ÿå…¬è·¯æœ‰6è»Šé“é‚£æ¨£</li>
<li>é•·é€£æ¥èƒ½ç›£è½æ¶ˆè²»è€…æ˜¯å¦æ–·é–‹ï¼Œå¦‚æœæ–·é–‹äº†å°±å›æ”¶æ¶ˆæ¯ï¼Œä¸è‡³æ–¼ä¸Ÿå¤±</li>
</ul>
</li>
<li>åœ¨Brokerä¸­ï¼ŒExchangeèˆ‡Queueå¯ä»¥çµ„æˆVHostè™›æ“¬ä¸»æ©Ÿï¼Œé¡ä¼¼å‘½åç©ºé–“äº’ç›¸éš”é›¢ï¼Œå¯ä»¥ç”¨ä¾†å€åˆ†ä¸åŒå¹³å°æˆ–æ˜¯devèˆ‡pub</li>
</ul>
<h2 id="å•Ÿç”¨">å•Ÿç”¨</h2>
<blockquote>
<p>å®˜æ–¹: <a href="https://www.rabbitmq.com/networking.html">https://www.rabbitmq.com/networking.html</a></p>
</blockquote>
<pre tabindex="0"><code>docker run -d --name rabbitmq --restart=always -p 5671:5671 -p 5672:5672 -p 4369:4369 -p 25672:25672 -p 15671:15671 -p 15672:15672 rabbitmq:management
</code></pre><ul>
<li>
<p>é€™æ˜¯ç« é­šä¸æ˜¯å…”å­å§ï¼Œé€™éº¼å¤šç«¯å£</p>
<ul>
<li>4369,25672(Erlangç™¼ç¾&amp;é›†ç¾¤ç«¯å£)</li>
<li>5672,5671(AMQPç«¯å£)</li>
<li>15672(webç®¡ç†å¾Œå°ç«¯å£)</li>
<li>61613,61614(STOMPå”è­°ç«¯å£)</li>
<li>1883,8883(MQTTå”è­°ç«¯å£)</li>
</ul>
</li>
<li>
<p>ç®¡ç†é é¢: http://localhost:15672</p>
<ul>
<li>é è¨­å¸³è™Ÿå¯†ç¢¼éƒ½æ˜¯ <code>guest</code></li>
</ul>
</li>
</ul>
<h2 id="exchangeé¡å‹">Exchangeé¡å‹</h2>
<ul>
<li>
<p>direct: ç›´æ¥é¡å‹ï¼ŒæŒ‰ç…§è·¯ç”±éµç²¾ç¢ºä¸€å°ä¸€åŒ¹é…</p>
</li>
<li>
<p>fanout: å»£æ’­é¡å‹ï¼Œæœ‰ç¶å®šå°±ç™¼ï¼Œç„¡è«–è·¯ç”±éµï¼Œæœ€å¿«</p>
</li>
<li>
<p>topic: ä¸»é¡Œé¡å‹ï¼Œç”¨é¡ä¼¼é€šé…ç¬¦çš„è¦å‰‡åŒ¹é…</p>
<ul>
<li><code>*</code>: å¿…é ˆæœ‰ä¸€å€‹å–®è©</li>
</ul>
<ul>
<li><code>#</code>: 0å€‹æˆ–å¤šå€‹å–®è©</li>
</ul>
</li>
</ul>
<p><img src="image-20220126235029445.png" alt="image-20220126235029445"></p>
<h3 id="è‡ªè¨‚exchange">è‡ªè¨‚Exchange</h3>
<ul>
<li>å‘½åæœ€å¥½åœ¨å°¾éƒ¨å¸¶ä¸Šé¡å‹</li>
</ul>
<p><img src="image-20220126235605507.png" alt="image-20220126235605507"></p>
<ul>
<li>æ¥è‘—çµ¦äº¤æ›æ©Ÿç¶å®šéšŠåˆ—ï¼Œç¶å®šä¹‹å‰ï¼Œè¦å…ˆæœ‰éšŠåˆ—ï¼Œé€™é‚Šå‰µ</li>
</ul>
<p><img src="image-20220126235816493.png" alt="image-20220126235816493"></p>
<ul>
<li>æ¥è‘—ç¶å®š
<ul>
<li>äº¤æ›æ©Ÿä¹Ÿå¯ä»¥ç¶äº¤æ›æ©Ÿï¼Œå½¢æˆå¤šå±¤æ¬¡é—œä¿‚</li>
<li>è¨˜å¾—æŒ‡å®šroute key</li>
</ul>
</li>
</ul>
<p><img src="image-20220127000338395.png" alt="image-20220127000338395"></p>
<h1 id="æ•´åˆspring">æ•´åˆSpring</h1>
<h2 id="å‰ç½®">å‰ç½®</h2>
<ul>
<li>å¼•åŒ…</li>
</ul>
<pre tabindex="0"><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre><ul>
<li>application.properties</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># MQ
spring.rabbitmq.host=localhost
spring.rabbitmq.port=5672
spring.rabbitmq.virtual-host=/
</code></pre><ul>
<li>å•Ÿå‹•é¡è¨»è§£ <code>@EnableRabbit</code></li>
</ul>
<pre tabindex="0"><code>@EnableRabbitè¨»è§£ä½¿RabbitAutoConfigurationç”Ÿæ•ˆï¼Œè‡ªå‹•é…ç½®äº†:
	RabbitTemplate
	AmqpAdmin
	CachingConnectionFactory
	RabbitMessagingTemplate
</code></pre><h2 id="æ¸¬è©¦å‰µå»º">æ¸¬è©¦å‰µå»º</h2>
<ul>
<li>å‰µå»ºExchangerã€Queueã€Bindingé€™äº›åƒæ•¸èˆ‡é‚è¼¯éƒ½è·Ÿåœ¨ç¶²é ä¸Šæ“ä½œä¸€æ¨£</li>
<li>å…ˆæ³¨å…¥ä¸€å€‹<code>AmqpAdmin</code>ï¼Œç”±å®ƒ<code>declare</code>å®Œæˆå‰µå»º</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@Slf4j</span>
<span style="color:#707a7c">@SpringBootTest</span>
<span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">OrderApplicationTests</span> {

    <span style="color:#707a7c">@Autowired</span>
    AmqpAdmin amqpAdmin;

    <span style="color:#707a7c">@Test</span>
    <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">createExchange</span>() {
        <span style="color:#228b22">// åç¨±, æŒä¹…, è‡ªå‹•åˆª
</span><span style="color:#228b22"></span>        DirectExchange directExchange = <span style="color:#8b008b;font-weight:bold">new</span> DirectExchange(<span style="color:#cd5555">&#34;hello-exchange&#34;</span>, <span style="color:#8b008b;font-weight:bold">true</span>, <span style="color:#8b008b;font-weight:bold">false</span>);
        amqpAdmin.<span style="color:#658b00">declareExchange</span>(directExchange);
        log.<span style="color:#658b00">info</span>(<span style="color:#cd5555">&#34;Exchange[{}]å‰µå»ºæˆåŠŸ&#34;</span>, <span style="color:#cd5555">&#34;hello-exchange&#34;</span>);
    }

    <span style="color:#707a7c">@Test</span>
    <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">createQueue</span>() {
        <span style="color:#228b22">// import org.springframework.amqp.core.Queue;
</span><span style="color:#228b22"></span>        <span style="color:#228b22">// ç¬¬ä¸‰å€‹åƒæ•¸ æ’ä»–ï¼Œè‹¥trueè¡¨ç¤ºéšŠåˆ—åªèƒ½è¢«è²æ˜çš„é€£æ¥ç¶å®šï¼Œå…¶ä»–äººç¶ä¸ä¸Š
</span><span style="color:#228b22"></span>        amqpAdmin.<span style="color:#658b00">declareQueue</span>(<span style="color:#8b008b;font-weight:bold">new</span> Queue(<span style="color:#cd5555">&#34;hello-queue&#34;</span>, <span style="color:#8b008b;font-weight:bold">true</span>, <span style="color:#8b008b;font-weight:bold">false</span>, <span style="color:#8b008b;font-weight:bold">false</span>));
        log.<span style="color:#658b00">info</span>(<span style="color:#cd5555">&#34;Queueå‰µå»º[{}]æˆåŠŸ&#34;</span>, <span style="color:#cd5555">&#34;hello-queue&#34;</span>);
    }

    <span style="color:#707a7c">@Test</span>
    <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">createBinding</span>() {
        <span style="color:#228b22">// String destinationç›®çš„åœ°ï¼ŒéšŠåˆ—nameæˆ– äº¤æ›æ©Ÿname
</span><span style="color:#228b22"></span>        <span style="color:#228b22">// Binding.DestinationType destinationTypeç›®çš„åœ°é¡å‹ queueé‚„æ˜¯exchange
</span><span style="color:#228b22"></span>        <span style="color:#228b22">// String exchange äº¤æ›æ©Ÿ
</span><span style="color:#228b22"></span>        <span style="color:#228b22">// String routingKey è·¯ç”±éµ
</span><span style="color:#228b22"></span>        <span style="color:#228b22">// @Nullable Map&lt;String, Object&gt; arguments è‡ªå®šç¾©åƒæ•¸
</span><span style="color:#228b22"></span>        amqpAdmin.<span style="color:#658b00">declareBinding</span>(<span style="color:#8b008b;font-weight:bold">new</span> Binding(<span style="color:#cd5555">&#34;hello-queue&#34;</span>, Binding.<span style="color:#658b00">DestinationType</span>.<span style="color:#658b00">QUEUE</span>,<span style="color:#cd5555">&#34;hello-exchange&#34;</span>,
                <span style="color:#cd5555">&#34;hello.java&#34;</span>, <span style="color:#8b008b;font-weight:bold">null</span>));
        log.<span style="color:#658b00">info</span>(<span style="color:#cd5555">&#34;Bindingå‰µå»º[{}]æˆåŠŸ&#34;</span>, <span style="color:#cd5555">&#34;hello-binding&#34;</span>);
    }
}
</code></pre></div><h2 id="ç™¼è¨Šæ¯">ç™¼è¨Šæ¯</h2>
<ul>
<li>æ³¨å…¥<code>RabbitTemplate</code>ï¼Œä½¿ç”¨<code>convertAndSend</code>æ–¹æ³•
<ul>
<li>èƒ½æ¥æ”¶Objectï¼Œç›´æ¥è½‰æˆæµç™¼å‡ºå»</li>
<li>è‹¥æƒ³ç”Ÿç™¼ä¸€å€‹ç‰©ä»¶ï¼Œè©²ç‰©ä»¶çš„é¡è¦å¯¦ç¾åºåˆ—åŒ– <code>implments Serializable</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@Autowired</span>
RabbitTemplate rabbitTemplate;

<span style="color:#707a7c">@Test</span>
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">send</span>() {
    String msg = <span style="color:#cd5555">&#34;ä¸€æ¢è¨Šæ¯&#34;</span>;
    rabbitTemplate.<span style="color:#658b00">convertAndSend</span>(<span style="color:#cd5555">&#34;hello-exchange&#34;</span>, <span style="color:#cd5555">&#34;hello.java&#34;</span>, msg);
}
</code></pre></div><ul>
<li>å¯¦å‹™ä¸Šé‚„æ˜¯è½‰JSONå§ï¼Œéœ€è¦ä¸€å€‹é…ç½®é¡
<ul>
<li>æ³¨æ„å¼•çš„åŒ…æ˜¯<code>amqp.support.converter</code></li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">org.springframework.amqp.support.converter.MessageConverter</span>;

<span style="color:#707a7c">@Configuration</span>
<span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">MyRabbitConfig</span> {
    <span style="color:#707a7c">@Bean</span>
    <span style="color:#8b008b;font-weight:bold">public</span> MessageConverter <span style="color:#008b45">messageConverter</span>() {
        <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">new</span> Jackson2JsonMessageConverter();
    }
}
</code></pre></div><ul>
<li>ç™¼é€ä¸€å€‹è‡ªè¨‚é¡RefundInfoEntity</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@Test</span>
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">send</span>() {
      <span style="color:#8b008b;font-weight:bold">for</span> (<span style="color:#00688b;font-weight:bold">int</span> i = 0; i &lt; 5; i++) {
        RefundInfoEntity refundInfoEntity = <span style="color:#8b008b;font-weight:bold">new</span> RefundInfoEntity();
        refundInfoEntity.<span style="color:#658b00">setRefundContent</span>(<span style="color:#cd5555">&#34;test&#34;</span> + i);
        rabbitTemplate.<span style="color:#658b00">convertAndSend</span>(<span style="color:#cd5555">&#34;hello-exchange&#34;</span>, <span style="color:#cd5555">&#34;hello.java&#34;</span>, refundInfoEntity);
    }
}
</code></pre></div><h2 id="æ¥æ”¶è¨Šæ¯">æ¥æ”¶è¨Šæ¯</h2>
<ul>
<li>
<p>å¿…é ˆå…ˆåœ¨å•Ÿå‹•é¡ <code>@EnableRabbit</code>ï¼Œæ¥è‘—åœ¨è¦æ”¶è¨Šæ¯çš„æ–¹æ³•æˆ–é¡ä¸Šè¨»è§£<code>@RabbitListener(queues={&quot;hello-queue&quot;})</code></p>
<ul>
<li>æ³¨æ„ç›£è½çš„æ˜¯ä¸€å€‹queue</li>
</ul>
</li>
<li>
<p>ç•¶æœ‰è¨»è§£äº†æ¥æ”¶çš„æ–¹æ³•æˆ–é¡ï¼Œåªè¦æœå‹™ä¸€å•Ÿå‹•å°±æœƒé€£ä¸Šæ¶ˆæ¯ä¸­å¿ƒï¼Œé–‹å§‹å˜—è©¦æ¥æ”¶</p>
</li>
<li>
<p>æœ€åŸå§‹çš„æ¥æ”¶ï¼Œæ”¶åˆ°çš„æ˜¯Messageé¡</p>
<ul>
<li><code>org.springframework.amqp.core.Message</code></li>
<li>ç”¨getBosyæ–¹æ³•æ‹¿å‡ºæµåŒ–çš„ç‰©ä»¶</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@RabbitListener</span>(queues = {<span style="color:#cd5555">&#34;hello-queue&#34;</span>})
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">receiveMsg</span>(Message message) {
    <span style="color:#00688b;font-weight:bold">byte</span>[] body = message.<span style="color:#658b00">getBody</span>();
    MessageProperties messageProperties = message.<span style="color:#658b00">getMessageProperties</span>();
    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(body);
    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;è¨Šæ¯é ­=&#34;</span> + messageProperties);
}
</code></pre></div><ul>
<li>å¯ä»¥æŠŠbodyå–å‡ºä¾†ï¼Œç„¶å¾Œå¾é ­çš„è³‡è¨Šä¸­æ‰¾<code>__TypeId__</code>ç¢ºå®šé¡ï¼Œå†è‡ªå·±JSON.parseå›å»æˆç‚ºä¸€å€‹ç‰©ä»¶</li>
</ul>
<p><img src="image-20220127195128933.png" alt="image-20220127195128933"></p>
<ul>
<li>ä½†å…¶å¯¦åœ¨æ–¹æ³•çš„å…¥åƒè²æ˜é¡å°±å¯ä»¥ç›´æ¥å–åˆ°åå°„åŒ…å¥½çš„ç‰©ä»¶äº†</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@RabbitListener</span>(queues = {<span style="color:#cd5555">&#34;hello-queue&#34;</span>})
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">receiveMsg</span>(RefundInfoEntity content,
                Channel channel) {
    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(content);
}
</code></pre></div><ul>
<li><code>@RabbitListener</code>å¯ä»¥ç”¨åœ¨é¡æˆ–æ–¹æ³•ï¼Œé‚„æœ‰ä¸€å€‹<code>@RabbitHandler</code>åªèƒ½ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå¯ä»¥ç´°åˆ†è™•ç†ä¸åŒçš„è¨Šæ¯</li>
<li>ä¾‹å¦‚ä¸€å€‹queueä¸­æœ‰å¤šç¨®è¨Šæ¯ï¼ŒAé¡å»æ–¹æ³•1ï¼ŒBé¡å»æ–¹æ³•2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@RabbitHandler</span>
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">æ–¹æ³•1</span>(Aé¡ a){...}

<span style="color:#707a7c">@RabbitHandler</span>
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">æ–¹æ³•2</span>(Bé¡ b){...}
</code></pre></div><h1 id="è¨Šæ¯ç¢ºèª">è¨Šæ¯ç¢ºèª</h1>
<ul>
<li>ä¿è­‰æ¶ˆæ¯ä¸ä¸Ÿå¤±ï¼Œå¯ä»¥ä½¿ç”¨äº‹å‹™åŒ…ä½æ•´æ¢å‚³éåºåˆ—ï¼Œä½†æ€§èƒ½ä¸‹é™250å€</li>
</ul>
<p><img src="1598625968345.png" alt="1598625968345"></p>
<ul>
<li>ç”¨åˆ†æ®µç¢ºèªæ©Ÿåˆ¶å°±ä¸æœƒé‚£éº¼åš´é‡æå¤±æ€§èƒ½</li>
</ul>
<h2 id="ç¬¬ä¸€æ®µpb">ç¬¬ä¸€æ®µP&gt;B</h2>
<ul>
<li>publisher confirmCallback: å‘Šè¨´ä½ è¨Šæ¯æœ‰é€é€²è¨Šæ¯ä¸­å¿ƒ</li>
<li>application.properties</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># é–‹å•“ç™¼é€ç¢ºèªï¼Œç¢ºå®šæœ‰é€åˆ°Broker
spring.rabbitmq.publisher-confirm-type=correlated
</code></pre><ul>
<li>å¯ä»¥è‡ªè¨‚RabbitTemplateä¸­çš„confirmæ–¹æ³•</li>
<li>MyRabbitConfig.java</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@Autowired</span>
RabbitTemplate rabbitTemplate;

<span style="color:#707a7c">@PostConstruct</span> <span style="color:#228b22">// RabbitTemplateç‰©ä»¶å‰µå»ºä¹‹å¾ŒåŸ·è¡Œæ­¤æ–¹æ³•
</span><span style="color:#228b22"></span><span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">initRabbitTemplate</span>() {
    rabbitTemplate.<span style="color:#658b00">setConfirmCallback</span>(<span style="color:#8b008b;font-weight:bold">new</span> RabbitTemplate.<span style="color:#658b00">ConfirmCallback</span>() {
        <span style="color:#228b22">/**
</span><span style="color:#228b22">         * è¨Šæ¯æœ‰é€åˆ°è¨Šæ¯ä¸­å¿ƒå°±åŸ·è¡Œæ­¤æ–¹æ³•
</span><span style="color:#228b22">         * @param correlationData æ¶ˆæ¯çš„å”¯ä¸€é—œè¯æ•¸æ“šï¼Œå¯ä»¥è¦–ç‚ºæ¶ˆæ¯id
</span><span style="color:#228b22">         * @param b æ˜¯å¦é€é”
</span><span style="color:#228b22">         * @param s å¤±æ•—åŸå› 
</span><span style="color:#228b22">         */</span>
        <span style="color:#707a7c">@Override</span>
        <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">confirm</span>(CorrelationData correlationData, <span style="color:#00688b;font-weight:bold">boolean</span> b, String s) {
            System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;è¨Šæ¯&#34;</span>+correlationData+<span style="color:#cd5555">&#34;å·²é€é”ä¸­å¿ƒ&#34;</span>);

        }
    });
}
</code></pre></div><h2 id="ç¬¬äºŒæ®µeq">ç¬¬äºŒæ®µE&gt;Q</h2>
<ul>
<li>
<p>publisher returnCallback: å‘Šè¨´ä½ è¨Šæ¯åœ¨äº¤æ›æ©Ÿè¦å»éšŠåˆ—æ™‚å‡ºäº‹äº†</p>
</li>
<li>
<p>application.properties</p>
</li>
</ul>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># é–‹å•“ç™¼é€ç¢ºèªï¼Œç¢ºå®šç¶“éäº¤æ›æ©ŸæŠµé”Queue
spring.rabbitmq.publisher-returns=true
# åªè¦æŠµé”Queueï¼Œç”¨ç•°æ­¥æ¨¡å¼å„ªå…ˆå›èª¿return confirm
spring.rabbitmq.template.mandatory=true
</code></pre><ul>
<li>MyRabbitConfig.java
<ul>
<li>æ³¨æ„é€™æ˜¯å¦‚æœæ²’é€²éšŠåˆ—æ™‚ï¼Œèª¿ç”¨çš„æ–¹æ³•</li>
<li>å‰é¢P&gt;Bæ˜¯é€é€²ä¸­å¿ƒçš„å·²è®€ï¼Œé€™é‚Šæ˜¯E&gt;Qå‡ºäº‹çš„è­¦å ±</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">rabbitTemplate.<span style="color:#658b00">setReturnCallback</span>(<span style="color:#8b008b;font-weight:bold">new</span> RabbitTemplate.<span style="color:#658b00">ReturnCallback</span>() {
    <span style="color:#707a7c">@Override</span>
    <span style="color:#8b008b;font-weight:bold">public</span> <span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">returnedMessage</span>(Message message, <span style="color:#00688b;font-weight:bold">int</span> i, String s, String s1, String s2) {
        <span style="color:#228b22">// å¦‚æœæ²’æœ‰åˆ°queueï¼Œè¦è¿”å›é€™äº›è¨Šæ¯
</span><span style="color:#228b22"></span>    }
});
</code></pre></div><h2 id="ç¬¬ä¸‰æ®µ-æ¶ˆè²»ç«¯">ç¬¬ä¸‰æ®µ æ¶ˆè²»ç«¯</h2>
<ul>
<li>
<p>æ¶ˆè²»ç«¯ç¢ºèªæ©Ÿåˆ¶: æ¶ˆè²»è€…æ”¶åˆ°æ¶ˆæ¯ï¼Œçµ¦ä¼ºæœå™¨ç™¼é€ç¢ºèªï¼Œä¼ºæœå™¨åˆªé™¤è©²æ¶ˆæ¯</p>
</li>
<li>
<p>consumer ack: è®“BrokerçŸ¥é“å“ªäº›æ¶ˆæ¯è¢«æ¶ˆè²»è€…æ­£ç¢ºæ¶ˆè²»äº†ï¼ˆå¦‚æœæ²’æœ‰å‰‡é‡æ–°æŠ•éï¼‰</p>
<ul>
<li>é è¨­æ˜¯autoï¼Œå®¢æˆ·ç«¯åªè¦æ¥æ”¶åˆ°æ¶ˆæ¯å°±æœƒè‡ªå‹•ç¢ºèªï¼Œæœå‹™ç«¯å°±ç§»é™¤é€™å€‹æ¶ˆæ¯</li>
<li>æœƒé€ æˆå•é¡Œï¼Œæ¯”å¦‚æŸæ¨¡çµ„ä¸€æ¥åˆ°æ¶ˆæ¯ï¼Œé‚„åœ¨è™•ç†å°±ç•¶æ©Ÿäº†ï¼Œçµæœå°±é€ æˆä¸Ÿå¤±</li>
</ul>
</li>
<li>
<p>é–‹å•Ÿæ‰‹å‹•ç¢ºèªï¼Œè¨­å®šapplication.properties</p>
<pre tabindex="0"><code class="language-properties" data-lang="properties"># ä½¿ç”¨æ‰‹å‹•ç¢ºèªæ¨¡å¼ï¼Œé—œé–‰è‡ªå‹•ç¢ºèªï¼Œé˜²æ­¢æ¶ˆæ¯ä¸Ÿå¤±
spring.rabbitmq.listener.simple.acknowledge-mode=manual
</code></pre></li>
<li>
<p>è™•ç†ä¸€å€‹å®Œæ‰ç¢ºèªä¸€å€‹ï¼Œæ²’è™•ç†å®Œä¿æŒåœ¨æœªç°½æ”¶(Unacked)ç‹€æ…‹ï¼Œè‹¥ç•¶æ©Ÿå‰‡æœƒä½¿æ¶ˆæ¯é‡æ–°é€²å…¥readyç‹€æ…‹ï¼Œä¸æœƒä¸Ÿå¤±</p>
</li>
</ul>
<p><img src="image-20220127205156239.png" alt="image-20220127205156239"></p>
<h3 id="ç°½æ”¶">ç°½æ”¶</h3>
<ul>
<li>ä½¿ç”¨<code>channel.basicAck(deliveryTag, false)</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#707a7c">@RabbitListener</span>(queues = {<span style="color:#cd5555">&#34;hello-queue&#34;</span>})
<span style="color:#00688b;font-weight:bold">void</span> <span style="color:#008b45">receiveMsg</span>(Message message,
                RefundInfoEntity content,
                Channel channel) {
    System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(content);
    <span style="color:#228b22">// deliveryTagåœ¨channelå…§æŒ‰é †åºè‡ªå¢
</span><span style="color:#228b22"></span>    <span style="color:#00688b;font-weight:bold">long</span> deliveryTag = message.<span style="color:#658b00">getMessageProperties</span>().<span style="color:#658b00">getDeliveryTag</span>();
    <span style="color:#228b22">// æ‰‹å‹•ç°½æ”¶ï¼Œå¾Œé¢çš„false = éæ‰¹é‡æ¨¡å¼
</span><span style="color:#228b22"></span>    <span style="color:#8b008b;font-weight:bold">try</span> {
        channel.<span style="color:#658b00">basicAck</span>(deliveryTag, <span style="color:#8b008b;font-weight:bold">false</span>);
        System.<span style="color:#658b00">out</span>.<span style="color:#658b00">println</span>(<span style="color:#cd5555">&#34;ç°½æ”¶ï¼Œå–®æ“šæµæ°´è™Ÿ=&#34;</span> + deliveryTag);
    } <span style="color:#8b008b;font-weight:bold">catch</span> (IOException e) {
        <span style="color:#228b22">// ç°½æ”¶å¤±æ•—ï¼Œä¾‹å¦‚ç¶²è·¯ç•°å¸¸
</span><span style="color:#228b22"></span>        e.<span style="color:#658b00">printStackTrace</span>();
    }
}
</code></pre></div><h3 id="æ‹’æ”¶">æ‹’æ”¶</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#228b22">// æ‹’æ”¶ï¼Œåƒæ•¸æ˜¯: æµæ°´è™Ÿ, æ‰¹æ¬¡, é‡æ–°å…¥éšŠåˆ—
</span><span style="color:#228b22"></span>channel.<span style="color:#658b00">basicNack</span>(deliveryTag, <span style="color:#8b008b;font-weight:bold">false</span>, <span style="color:#8b008b;font-weight:bold">false</span>); <span style="color:#228b22">// é€™æ¨£æœƒä¸Ÿæ£„
</span><span style="color:#228b22"></span>
<span style="color:#228b22">// é‡æ–°å…¥éšŠåˆ—=trueçš„è©±ï¼Œè¨Šæ¯æœƒé‡æ–°å›åˆ°éšŠåˆ—
</span><span style="color:#228b22"></span>channel.<span style="color:#658b00">basicNack</span>(deliveryTag, <span style="color:#8b008b;font-weight:bold">false</span>, <span style="color:#8b008b;font-weight:bold">true</span>);
<span style="color:#228b22">// ç­‰åŒæ–¼
</span><span style="color:#228b22"></span>channel.<span style="color:#658b00">basicReject</span>(deliveryTag, <span style="color:#8b008b;font-weight:bold">false</span>);
</code></pre></div><h2 id="æœ€çµ‚æ–¹æ¡ˆ">æœ€çµ‚æ–¹æ¡ˆ</h2>
<ul>
<li>
<p>ç¢ºèªæ©Ÿåˆ¶ + æœ¬åœ°äº‹å‹™è¡¨</p>
<ul>
<li>ç™¼é€æ¶ˆæ¯çš„æ™‚å€™ç”Ÿæˆæ¶ˆæ¯IDï¼Œç„¶å¾Œåœ¨å›èª¿æ–¹æ³•ä¿®æ”¹æ•¸æ“šåº«ä¸­æ¶ˆæ¯çš„ç‹€æ…‹</li>
<li>å®šæ™‚æƒææ•¸æ“šåº«æ¶ˆæ¯çš„ç‹€æ…‹ï¼Œæ²’æœ‰æˆåŠŸçš„é‡æ–°æŠ•éä¸€æ¬¡</li>
<li>æ¶ˆè²»æ¶ˆæ¯æ™‚ä½¿ç”¨æ‰‹å‹•ç°½æ”¶æ©Ÿåˆ¶(ä¸ä½¿ç”¨è‡ªå‹•ç°½æ”¶)</li>
</ul>
</li>
</ul>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">ä¸Šæ¬¡ä¿®æ”¹æ–¼ 2022-02-04</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://yoziming.github.io/post/220205-gulimall-19/">
			ä¸‹ä¸€ç¯‡<br>ç¢ºèªè¨‚å–®ã€feignè«‹æ±‚é ­å•é¡Œ
                </a>
                
                
                
                <a class="older-posts" href="https://yoziming.github.io/post/220203-gulimall-17-offline-cart/">
			ä¸Šä¸€ç¯‡<br>cookie&amp;rediså¯¦ç¾è¨ªå®¢è³¼ç‰©è»Š
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                








<div id="waline"></div>
<script>
    new Waline({
        el: '#waline',
        path: location.pathname,
        serverURL: "https://waline-pn38gfwbz-yoziming.vercel.app/" ,
		lang: 'en-US',
		visitor: true,
		meta: ['nick', 'mail'],
    });
    </script>



            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://amazingrise.net">Rise</a>
<br>
ç§»æ¤è‡ª <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	Yoziming
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
